<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> __cxa_atexit prototype
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20__cxa_atexit%20prototype&In-Reply-To=%3C199912170134.RAA31653%40baalbek.engr.sgi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000373.html">
   <LINK REL="Next"  HREF="000383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>__cxa_atexit prototype</H1>
    <B>Jim Dehnert</B> 
    <A HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20__cxa_atexit%20prototype&In-Reply-To=%3C199912170134.RAA31653%40baalbek.engr.sgi.com%3E"
       TITLE="__cxa_atexit prototype">dehnert at baalbek.engr.sgi.com
       </A><BR>
    <I>Fri Dec 17 01:34:15 UTC 1999</I>
    <P><UL>
        <LI>Previous message: <A HREF="000373.html">__cxa_atexit prototype
</A></li>
        <LI>Next message: <A HREF="000383.html">__cxa_atexit prototype
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#377">[ date ]</a>
              <a href="thread.html#377">[ thread ]</a>
              <a href="subject.html#377">[ subject ]</a>
              <a href="author.html#377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Date: Thu, 16 Dec 1999 21:03:48 +0100
</I>&gt;<i> From: Martin von Loewis &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">loewis at informatik.hu-berlin.de</A>&gt;
</I>&gt;<i> To: <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">mark at codesourcery.com</A>
</I>&gt;<i> 
</I>&gt;<i> &gt;   The type of __cxa_atexit involves a type `dso_handle'.  This type is
</I>&gt;<i> &gt;   undefined.  
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Suggested Resolution:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   Replace all occurrences of this type with `void *'.
</I>&gt;<i> 
</I>&gt;<i> There is another issue here. I tried implementing this approach in
</I>&gt;<i> gcc, for x86 ELF32 (Linux in particular), and found it
</I>&gt;<i> unimplementable; maybe I was just stupid.
</I>&gt;<i> 
</I>&gt;<i> The problem was to get at the dso_handle, inside the object file for a
</I>&gt;<i> translation unit. Say, crtsomething.o exports a symbol __dso_handle,
</I>&gt;<i> whose address is passed to __cxa_atexit. One copy of crtsomething.o
</I>&gt;<i> gets linked into each DSO. Inside each translation unit, you want to
</I>&gt;<i> get at the address of the __dso_handle defined *in your own DSO*.  I
</I>&gt;<i> understand that -Bsymbolic does that, but requiring -Bsymbolic was
</I>&gt;<i> inacceptable. Does the base ABI offer a better mechanism?
</I>
The generic ABI has been modified (by the IA-64 ABI group) to add an
&quot;export class&quot; to symbols.  One of the possible settings of the export
class is &quot;protected,&quot; which means that references from within the
executable being linked are linked to the copy defined in that
executable, and not subject to preemption by a symbol from another DSO.
That is, it is the -Bsymbolic effect on a per-symbol basis, and can be
set by the compiler.

The solution, then, is that the __dso_handle symbol generated by the
linker (or some runtime module) is made protected.  Obviously, this
requires implementation of the new symbol export class feature.

(The other new export classes are &quot;hidden,&quot; which are symbols visible
only from within the same executable object and are converted to LOCAL
or removed by the linker, and &quot;internal,&quot; which are at least as
restricted as hidden, with the psABI allowed to apply further
restrictions.  The MIPS psABI requires that objects named by internal
symbols not be referenced from outside the linked object, either by
name or via pointers passed out.  In fact, therefore, __dso_handle
could be made either protected or hidden, and hidden might be cleaner.)

Jim

-	    Jim Dehnert		<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">dehnert at sgi.com</A>
				(650)933-4272


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000373.html">__cxa_atexit prototype
</A></li>
	<LI>Next message: <A HREF="000383.html">__cxa_atexit prototype
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#377">[ date ]</a>
              <a href="thread.html#377">[ thread ]</a>
              <a href="subject.html#377">[ subject ]</a>
              <a href="author.html#377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">More information about the cxx-abi-dev
mailing list</a><br>
</body></html>
