<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Fw%3A%20%5Bcxx-abi-dev%5D%20Decimal%20Floating%20Point%20mangling%20was%28Fw%3A%20%20%5Bcxx-abi-dev%5D%20C%2B%2B0x%3A%20Mangling%0A%20of%20rvalue%20reference%20type%29s&In-Reply-To=%3COFB23FC684.87AEC7E6-ON8525733E.0042AA5F-8525733E.0045FA6A%40ca.ibm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001937.html">
   <LINK REL="Next"  HREF="001942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s</H1>
    <B>Michael Wong</B> 
    <A HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Fw%3A%20%5Bcxx-abi-dev%5D%20Decimal%20Floating%20Point%20mangling%20was%28Fw%3A%20%20%5Bcxx-abi-dev%5D%20C%2B%2B0x%3A%20Mangling%0A%20of%20rvalue%20reference%20type%29s&In-Reply-To=%3COFB23FC684.87AEC7E6-ON8525733E.0042AA5F-8525733E.0045FA6A%40ca.ibm.com%3E"
       TITLE="Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s">michaelw at ca.ibm.com
       </A><BR>
    <I>Tue Aug 21 12:44:21 UTC 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="001937.html">Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s
</A></li>
        <LI>Next message: <A HREF="001942.html">Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1939">[ date ]</a>
              <a href="thread.html#1939">[ thread ]</a>
              <a href="subject.html#1939">[ subject ]</a>
              <a href="author.html#1939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>All, thanks I think we are getting somewhere but there seems to be still
some dangling issues.

First, an appeal that we send only to the cxx-abi group unless someone is
not on it. This avoids duplication and the fact that some mail server is
sending out messages at different times. Based on pattern of discussion so
far, I think that is Prem Rao. If Prem is on the group, then we can remove
his name.

The other way is that I would like to get Mark Mitchell in on this and
discuss this in real time. When I proposed this back in summer of last year
privately to Mark, I was constrained by confidentiality agreement from
discussing much of the details. At that time, Mark asked that I submit the
patch and with a rationale explaining why we are constraining the choices.
Now almost a year later, I can't remember if these were his exact
instructions. I suppose I could just copy Mark and ask him but let me
propose something else.

This discussion has brought up some more  issues and resolution seems
important to the outcome of what kind of mangling we should ultimately
support in the ABI, including whether we need a native mangling or not.

So I would suggest that I try to contact Mark and get a telecon together of
the interested parties with Mark arbitrating the discussion. Would people
be amenable to participate in that? Thanks.

Michael Wong
XL C++ Compiler kernel Development
IBM Canada Ltd., C2/KD2/8200/MKM
8200 Warden Avenue
Markham, Ontario  L6G 1C7
W:905-413-3283 F:905-413-4839
Boost test results
<A HREF="http://www-1.ibm.com/support/docview.wss?rs=2239&amp;context=SSJT9L&amp;uid=swg27006911">http://www-1.ibm.com/support/docview.wss?rs=2239&amp;context=SSJT9L&amp;uid=swg27006911</A>

C/C++ Compilers Support Page
<A HREF="http://www.ibm.com/software/awdtools/ccompilers/support/">http://www.ibm.com/software/awdtools/ccompilers/support/</A>
C/C++ Feature Request Interface
<A HREF="http://www.ibm.com/support/docview.wss?uid=swg27005811">http://www.ibm.com/support/docview.wss?uid=swg27005811</A>
XL Fortran Compiler Support Page
<A HREF="http://www.ibm.com/software/awdtools/fortran/xlfortran/support/">http://www.ibm.com/software/awdtools/fortran/xlfortran/support/</A>
XL Fortran Feature Request Interface
<A HREF="http://www.ibm.com/support/docview.wss?uid=swg27005812">http://www.ibm.com/support/docview.wss?uid=swg27005812</A>

Dennis Handly &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">dhandly at cup.hp.com</A>&gt; wrote on 08/21/2007 12:09:08 AM:

&gt;<i> &gt;From: Michael Wong &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">michaelw at ca.ibm.com</A>&gt;
</I>&gt;<i> &gt;I believe one of the point of an ABI is to settle on one type where
</I>there
&gt;<i> &gt;are ambiguity or possible differences in choices. Otherwise, it is not
</I>an
&gt;<i> &gt;ABI and there would be no interoperability.
</I>&gt;<i>
</I>&gt;<i> Exactly.
</I>
That too is what I am trying to achieve. But I want to hear out some of the
other folks who are supporting multiple choices.
&gt;<i>
</I>&gt;<i> &gt;So I agree with Dennis that having both types would be confusing.
</I>&gt;<i> Michael Wong
</I>&gt;<i>
</I>&gt;<i> Unless you allow a platform to pick one.
</I>
I would like to leave that choice to the platform as much as possible
within the constrains of the ABI. I assume this statement means you let the
platform pick one to support? Or does it mean you allow the platform to
pick one based on internal implementation?
&gt;<i>
</I>&gt;<i> &gt;From: Sean Perry &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">perry at ca.ibm.com</A>&gt;
</I>&gt;<i> &gt;Are you trying to say that the C++ class type shall be binary compatible
</I>&gt;<i> &gt;with the C native type?  That is going to fail immediately on parameter
</I>&gt;<i> &gt;passing and return values.
</I>&gt;<i>
</I>&gt;<i> Why?  We just wave our ABI wands and say it can't.
</I>&gt;<i>
</I>&gt;<i> &gt;then someone can throw a C
</I>&gt;<i> &gt;native type and catch it as the C++ class type.  Similar odd behaviour
</I>&gt;<i> &gt;would happen with dynamic casting.  The fact is that we have two
</I>different
&gt;<i> &gt;types because C++ choose to implement decimal floating point as a class.
</I>&gt;<i> &gt;We need two different mangling schemes.
</I>&gt;<i> Sean Perry
</I>&gt;<i>
</I>&gt;<i> Can't we make sure we mangle them the same and so the type_info would
</I>&gt;<i> be the same?
</I>&gt;<i>
</I>&gt;<i> &gt;From: Michael Wong &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">michaelw at ca.ibm.com</A>&gt;
</I>&gt;<i> &gt;Absolutely not. That would be silly even to me.
</I>&gt;<i>
</I>&gt;<i> As Prem asks below, are you saying:
</I>&gt;<i>   Are you trying to say that the C++ class type shall be binary
</I>compatible
&gt;<i>   with the C native type?
</I>&gt;<i>
</I>&gt;<i> We want it to be the same.
</I>&gt;<i>
</I>&gt;<i> &gt;The point is that for platforms that support native types, the native
</I>type
&gt;<i> &gt;mangling is available for a potentially more efficient implementation.
</I>For
&gt;<i> &gt;platforms that can only support emulation, the class library type and
</I>its
&gt;<i> &gt;mangling is available. Have I missed the point?
</I>&gt;<i> Michael Wong
</I>&gt;<i>
</I>&gt;<i> The only point you missed is it not only to do with platforms but the
</I>&gt;<i> compiler too.
</I>Thats fine.
&gt;<i>
</I>&gt;<i> &gt;From: Daveed Vandevoorde &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">daveed at edg.com</A>&gt;
</I>&gt;<i> &gt;Most likely, indeed (though magical class types could be possible).
</I>&gt;<i>
</I>&gt;<i> Sign me up for magic.  ;-)
</I>&gt;<i>
</I>&gt;<i> &gt;I still don't see why.  C signatures need no mangling.  In C++ it's a
</I>&gt;<i> &gt;class type, so there is an encoding for that.
</I>&gt;<i>    Daveed
</I>&gt;<i>
</I>&gt;<i> Except my suggestion is that we special case that class type and mangle
</I>&gt;<i> it as the native type.
</I>That is one way if the platform can accept the native type.
&gt;<i>
</I>&gt;<i> &gt;From: PremAnand M Rao &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">premanand.rao at hp.com</A>&gt;
</I>&gt;<i> &gt;I am not sure what you said &quot;Absolutely not&quot; to.
</I>&gt;<i>
</I>&gt;<i> Right.
</I>&gt;<i>
</I>&gt;<i> &gt;If the mangling for the type are different based on how they are
</I>&gt;<i> &gt;implemented, it removes a lot of flexibility from this choice.
</I>&gt;<i> PremAnand.
</I>&gt;<i>
</I>&gt;<i> Right.
</I>Also from Prem:
 &gt; The point is that for platforms that support native types, the
 &gt; native type mangling is available for a potentially more efficient
 &gt; implementation. For platforms that can only support emulation,
 &gt; the class library type and its mangling is available. Have I missed
 &gt; the point?

&gt;<i>I may have misunderstood what you are saying, if so, please correct me.
</I>&gt;<i>The current C++ TR specification permits an implementation to choose to
</I>&gt;<i>implement the Decimal FP types as either a native type or a class type,
</I>
Yes, that is my understanding too.


&gt;<i>if it preserves the semantics of a class type.   If the mangling for the
</I>&gt;<i>type are different based on how they are implemented, it removes a lot
</I>&gt;<i>of flexibility from this choice.
</I>
So even if the platform/compiler were to choose to implement the class
magically as a native type, perhaps by embedding inside the class a private
member __decimal32 because it has it, then it would still be constrained to
mangle it as a class type as long as it maintains the class interface.
This would keep it consistent with the platform/compiler that implements it
as an emulation (perhaps with a char /bitfield member). So far, you are
still free to make that choice of internal implementation.

&gt;<i>From the ABI point of view, it is saying that if you implement a native
</I>type (not one inside a class type)because you can, then the native type
must have a specific mangling to be consistent with the native type other
C++ compilers create if they also run on platforms that support native
types.

Again, if I am wrong or missed something which is a possibility I am always
willing to entertain, then let us hash it out in the teleconference because
I am finding the discussion fracturing to more confusion then actually
leading to an end.

PremAnand.

Michael Wong wrote:
&gt;<i> Absolutely not. That would be silly even to me.
</I>&gt;<i> I want to settle the mangling chosen for the native type for platforms
</I>that
&gt;<i> can support it. I am not saying there should not coexists different
</I>&gt;<i> manglings for class types and native types.
</I>&gt;<i> What Mark wanted, I believe was a rationale to explain why there  exists
</I>&gt;<i> both types and their mangling and that is what I am seeing a convergence
</I>&gt;<i> here in this discussion, for which I am glad.
</I>&gt;<i> The point is that for platforms that support native types, the native
</I>type
&gt;<i> mangling is available for a potentially more efficient implementation.
</I>For
&gt;<i> platforms that can only support emulation, the class library type and its
</I>&gt;<i> mangling is available. Have I missed the point?
</I>&gt;<i>
</I>&gt;<i> What I was hoping to ask was if people are sufficiently happy with this
</I>&gt;<i> state so that I can write up the mangling addendum proposal?
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001937.html">Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s
</A></li>
	<LI>Next message: <A HREF="001942.html">Fw: [cxx-abi-dev] Decimal Floating Point mangling was(Fw:  [cxx-abi-dev] C++0x: Mangling of rvalue reference type)s
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1939">[ date ]</a>
              <a href="thread.html#1939">[ thread ]</a>
              <a href="subject.html#1939">[ subject ]</a>
              <a href="author.html#1939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">More information about the cxx-abi-dev
mailing list</a><br>
</body></html>
