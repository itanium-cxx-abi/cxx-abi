<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;28&nbsp;February&nbsp;2016&nbsp;at&nbsp;19:26,&nbsp;Jason&nbsp;Merrill&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:jason@redhat.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jason@redhat.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;02/27/2016&nbsp;02:57&nbsp;AM,&nbsp;Gabriel&nbsp;Dos&nbsp;Reis&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;Fri,&nbsp;Feb&nbsp;26,&nbsp;2016&nbsp;at&nbsp;8:01&nbsp;PM,&nbsp;Jason&nbsp;Merrill&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:jason@redhat.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jason@redhat.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;12/11/2015&nbsp;01:37&nbsp;PM,&nbsp;Jason&nbsp;Merrill&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;12/10/2015&nbsp;07:32&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;10&nbsp;December&nbsp;2015&nbsp;at&nbsp;16:15,&nbsp;John&nbsp;McCall&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Dec&nbsp;10,&nbsp;2015,&nbsp;at&nbsp;4:11&nbsp;PM,&nbsp;Nelson,&nbsp;Clark&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:clark.nelson@intel.com&quot;&nbsp;target=&quot;_blank&quot;&gt;clark.nelson@intel.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
It&nbsp;has&nbsp;come&nbsp;to&nbsp;my&nbsp;attention&nbsp;that&nbsp;GCC&nbsp;and&nbsp;clang&nbsp;generate&nbsp;incompatible&lt;br&gt;<br>
code&lt;br&gt;<br>
for&nbsp;passing&nbsp;an&nbsp;argument&nbsp;of&nbsp;an&nbsp;empty&nbsp;class&nbsp;type.&lt;br&gt;<br>
&lt;br&gt;<br>
clang&nbsp;seems&nbsp;to&nbsp;completely&nbsp;ignore&nbsp;arguments&nbsp;and&nbsp;parameters&nbsp;of&nbsp;empty&lt;br&gt;<br>
class&lt;br&gt;<br>
type&nbsp;--&nbsp;which&nbsp;seems&nbsp;to&nbsp;make&nbsp;a&nbsp;certain&nbsp;amount&nbsp;of&nbsp;sense.&lt;br&gt;<br>
&lt;br&gt;<br>
OTOH,&nbsp;as&nbsp;far&nbsp;as&nbsp;I&nbsp;understand&nbsp;it,&nbsp;GCC&nbsp;effectively&nbsp;treats&nbsp;an&nbsp;empty&nbsp;class&lt;br&gt;<br>
equivalently&nbsp;to&nbsp;a&nbsp;class&nbsp;containing&nbsp;a&nbsp;single&nbsp;member&nbsp;with&nbsp;some&nbsp;character&lt;br&gt;<br>
type&nbsp;--&nbsp;which&nbsp;also&nbsp;seems&nbsp;pretty&nbsp;reasonable.&lt;br&gt;<br>
&lt;br&gt;<br>
Should&nbsp;the&nbsp;C++&nbsp;ABI&nbsp;come&nbsp;down&nbsp;on&nbsp;one&nbsp;side&nbsp;or&nbsp;the&nbsp;other&nbsp;of&nbsp;this&nbsp;question?&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;really&nbsp;the&nbsp;sort&nbsp;of&nbsp;question&nbsp;a&nbsp;psABI&nbsp;should&nbsp;settle.&nbsp;But&nbsp;of&lt;br&gt;<br>
course&lt;br&gt;<br>
the&nbsp;C&nbsp;language&nbsp;doesn&#39;t&nbsp;actually&nbsp;support&nbsp;a&nbsp;structure&nbsp;with&nbsp;no&nbsp;members,&nbsp;so&lt;br&gt;<br>
it&#39;s&nbsp;not&nbsp;too&nbsp;surprising&nbsp;if&nbsp;a&nbsp;psABI&nbsp;doesn&#39;t&nbsp;nail&nbsp;down&nbsp;what&nbsp;should&nbsp;happen&lt;br&gt;<br>
for&nbsp;this.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
It’s&nbsp;valid&nbsp;as&nbsp;a&nbsp;C&nbsp;extension&nbsp;in&nbsp;GCC. &nbsp;If&nbsp;there&nbsp;are&nbsp;platforms&nbsp;where&nbsp;we&lt;br&gt;<br>
use&nbsp;a&lt;br&gt;<br>
different&nbsp;rule&nbsp;from&nbsp;GCC,&nbsp;we&nbsp;should&nbsp;come&nbsp;to&nbsp;some&nbsp;understanding&nbsp;with&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
Because&nbsp;of&nbsp;the&nbsp;GCC&nbsp;extension,&nbsp;C++&nbsp;can’t&nbsp;really&nbsp;use&nbsp;different&nbsp;rules&lt;br&gt;<br>
from&nbsp;C.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
(For&nbsp;x86_64:)&nbsp;GCC&nbsp;uses&nbsp;different&nbsp;rules&nbsp;for&nbsp;C&nbsp;and&nbsp;C++.&nbsp;In&nbsp;C,&nbsp;they&nbsp;do&nbsp;not&lt;br&gt;<br>
pass&nbsp;anything.&nbsp;In&nbsp;C++,&nbsp;they&nbsp;pass&nbsp;a&nbsp;1-byte&nbsp;object&nbsp;on&nbsp;the&nbsp;stack.&nbsp;Clang&nbsp;uses&lt;br&gt;<br>
the&nbsp;same&nbsp;rules&nbsp;for&nbsp;C&nbsp;and&nbsp;C++,&nbsp;passing&nbsp;nothing&nbsp;in&nbsp;both&nbsp;cases.&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;careful&nbsp;reading&nbsp;of&nbsp;the&nbsp;x86_64&nbsp;psABI&nbsp;suggests&nbsp;that&nbsp;clang&nbsp;is&nbsp;right&nbsp;in&lt;br&gt;<br>
both&lt;br&gt;<br>
cases;&nbsp;the&nbsp;eightbyte&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;1-byte&nbsp;empty&nbsp;struct&lt;br&gt;<br>
parameter&nbsp;is&lt;br&gt;<br>
never&nbsp;classified&nbsp;(at&nbsp;all),&nbsp;so&nbsp;should&nbsp;occupy&nbsp;neither&nbsp;a&nbsp;register&nbsp;nor&lt;br&gt;<br>
memory,&lt;br&gt;<br>
but&nbsp;it&#39;s&nbsp;not&nbsp;really&nbsp;especially&nbsp;clear.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;any&nbsp;case,&nbsp;I&nbsp;think&nbsp;GCC&nbsp;should&nbsp;be&nbsp;the&nbsp;one&nbsp;to&nbsp;change&nbsp;here,&nbsp;because&nbsp;its&nbsp;C&lt;br&gt;<br>
and&nbsp;C++&nbsp;ABIs&nbsp;don&#39;t&nbsp;match.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Agreed.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
On&nbsp;further&nbsp;discussion,&nbsp;it&nbsp;came&nbsp;up&nbsp;that&nbsp;the&nbsp;C&nbsp;and&nbsp;C++&nbsp;ABIs&nbsp;really&nbsp;can&#39;t&lt;br&gt;<br>
match. &nbsp;In&nbsp;GNU&nbsp;C,&nbsp;an&nbsp;empty&nbsp;struct&nbsp;has&nbsp;size&nbsp;0;&nbsp;in&nbsp;C++&nbsp;it&nbsp;has&nbsp;size&nbsp;1. &nbsp;We&lt;br&gt;<br>
could&nbsp;finesse&nbsp;this&nbsp;difference&nbsp;for&nbsp;argument&nbsp;passing,&nbsp;as&nbsp;suggested&nbsp;here,&nbsp;but&lt;br&gt;<br>
we&nbsp;really&nbsp;can&#39;t&nbsp;paper&nbsp;over&nbsp;the&nbsp;difference&nbsp;in&nbsp;general. &nbsp;What&nbsp;if&nbsp;you&nbsp;have&nbsp;a&lt;br&gt;<br>
class&nbsp;containing&nbsp;an&nbsp;empty&nbsp;class? &nbsp;GNU&nbsp;C&nbsp;still&nbsp;says&nbsp;that&nbsp;has&nbsp;size&nbsp;0,&nbsp;but&lt;br&gt;<br>
it&#39;s&nbsp;less&nbsp;clear&nbsp;that&nbsp;this&nbsp;makes&nbsp;sense&nbsp;for&nbsp;C++. &nbsp;Significantly,&nbsp;this&nbsp;does&lt;br&gt;<br>
not&nbsp;fit&nbsp;the&nbsp;ABI&nbsp;definition&nbsp;of&nbsp;an&nbsp;empty&nbsp;class.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Five&nbsp;years&nbsp;ago,&nbsp;we&nbsp;determined&nbsp;that&nbsp;it&nbsp;would&nbsp;make&nbsp;sense&nbsp;(read:&nbsp;provably&lt;br&gt;<br>
safe)&nbsp;to&nbsp;optimize&nbsp;that&nbsp;case&nbsp;too&nbsp;--&nbsp;even&nbsp;for&nbsp;arrays. &nbsp;See&nbsp;section&nbsp;6.2&nbsp;of&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://www.axiomatics.org/~gdr/formal-cxx/layout-popl11.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.axiomatics.org/~gdr/formal-cxx/layout-popl11.pdf&lt;/a&gt;&lt;br&gt;<br>
for&nbsp;the&nbsp;&quot;layman&quot;&nbsp;summary.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
Sure. &nbsp;But&nbsp;my&nbsp;point&nbsp;is&nbsp;that&nbsp;this&nbsp;represents&nbsp;a&nbsp;change&nbsp;to&nbsp;the&nbsp;ABI,&nbsp;not&nbsp;a&nbsp;simple&nbsp;implementation&nbsp;bug&nbsp;as&nbsp;I&nbsp;initially&nbsp;thought. &nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;omit&nbsp;passing&nbsp;some&nbsp;parameters,&nbsp;we&nbsp;need&nbsp;some&nbsp;specification&nbsp;of&nbsp;which&nbsp;parameters&nbsp;qualify,&nbsp;and&nbsp;I&#39;m&nbsp;rather&nbsp;uncomfortable&nbsp;with&nbsp;that&nbsp;level&nbsp;of&nbsp;invention&nbsp;at&nbsp;this&nbsp;point.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;x86_64&nbsp;psABI&nbsp;already&nbsp;classifies&nbsp;an&nbsp;empty&nbsp;struct&nbsp;of&nbsp;size&nbsp;&lt;=&nbsp;16&nbsp;as&nbsp;NO_CLASS,&nbsp;so&nbsp;it&nbsp;is&nbsp;not&nbsp;passed&nbsp;in&nbsp;registers&nbsp;nor&nbsp;memory.&nbsp;The&nbsp;recent&nbsp;discussion&nbsp;on&nbsp;the&nbsp;GCC&nbsp;and&nbsp;LLVM&nbsp;dev&nbsp;lists&nbsp;(subject&nbsp;line&nbsp;&quot;Update&nbsp;Intel386,&nbsp;x86-64&nbsp;and&nbsp;IA&nbsp;MCU&nbsp;psABIs&nbsp;for&nbsp;passing/returning&nbsp;empty&nbsp;struct&quot;)&nbsp;concluded&nbsp;by&nbsp;adding&nbsp;this&nbsp;rule&nbsp;to&nbsp;the&nbsp;i386,&nbsp;x86-64,&nbsp;and&nbsp;Itanium&nbsp;psABI&nbsp;documents:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;An&nbsp;empty&nbsp;type&nbsp;is&nbsp;a&nbsp;type&nbsp;where&nbsp;it&nbsp;and&nbsp;all&nbsp;of&nbsp;its&nbsp;subobjects&nbsp;(recursively)&nbsp;are&nbsp;of&nbsp;class,&nbsp;structure,&nbsp;union,&nbsp;or&nbsp;array&nbsp;type. &nbsp;No&nbsp;memory&nbsp;slot&nbsp;nor&nbsp;register&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;pass&nbsp;or&nbsp;return&nbsp;an&nbsp;object&nbsp;of&nbsp;empty&nbsp;type.&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...&nbsp;which&nbsp;effectively&nbsp;extends&nbsp;that&nbsp;rule&nbsp;to&nbsp;empty&nbsp;types&nbsp;of&nbsp;all&nbsp;sizes.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
