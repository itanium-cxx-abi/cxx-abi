<tt>
&lt;!doctype&nbsp;html&nbsp;public&nbsp;&quot;-//w3c//dtd&nbsp;html&nbsp;4.0&nbsp;transitional//en&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;name=&quot;GENERATOR&quot;&nbsp;content=&quot;Mozilla/4.6&nbsp;[en]&nbsp;(Win98;&nbsp;U)&nbsp;[Netscape]&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&lt;title&gt;C++&nbsp;ABI&nbsp;for&nbsp;IA-64:&nbsp;Data&nbsp;Layout&lt;/title&gt;<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=small-table.css&nbsp;type=&quot;text/css&quot;&gt;<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=code.css&nbsp;type=&quot;text/css&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
<br>
&lt;hr&gt;<br>
&lt;p&gt;&lt;b&gt;&lt;i&gt;&lt;font&nbsp;size=+3&gt;C++&nbsp;ABI&nbsp;for&nbsp;IA-64:&nbsp;Data&nbsp;Layout&lt;/font&gt;&lt;/i&gt;&lt;/b&gt;<br>
&lt;p&gt;&lt;i&gt;&lt;font&nbsp;size=-1&gt;Revised&nbsp;30&nbsp;September&nbsp;1999&lt;/font&gt;&lt;/i&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;Revisions&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;font&nbsp;color=&quot;#0000FF&quot;&gt;[990930]&lt;/font&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;<br>
Updated&nbsp;to&nbsp;new&nbsp;vtable&nbsp;layout&nbsp;proposal.&lt;/font&gt;&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;&lt;font&nbsp;color=&quot;#0000FF&quot;&gt;[990811]&lt;/font&gt;&nbsp;Described&nbsp;member<br>
pointer&nbsp;representations,&nbsp;virtual&nbsp;table&nbsp;layout.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;&lt;font&nbsp;color=&quot;#0000FF&quot;&gt;[990730]&lt;/font&gt;&nbsp;Selected&nbsp;first&nbsp;variant<br>
for&nbsp;empty&nbsp;base&nbsp;allocation;&nbsp;removed&nbsp;others.&lt;/font&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;General&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;In&nbsp;what&nbsp;follows,&nbsp;we&nbsp;define&nbsp;the&nbsp;memory&nbsp;layout&nbsp;for&nbsp;C++&nbsp;data<br>
objects.&nbsp;Specifically,&nbsp;for&nbsp;each&nbsp;type,&nbsp;we&nbsp;specify&nbsp;the&nbsp;following&nbsp;information<br>
about&nbsp;an&nbsp;object&nbsp;O&nbsp;of&nbsp;that&nbsp;type:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;the&nbsp;&lt;i&gt;size&lt;/i&gt;&nbsp;of&nbsp;an&nbsp;object,&nbsp;&lt;i&gt;sizeof&lt;/i&gt;(O);&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;the&nbsp;&lt;i&gt;alignment&lt;/i&gt;&nbsp;of&nbsp;an&nbsp;object,&nbsp;&lt;i&gt;align&lt;/i&gt;(O);&nbsp;and&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;the&nbsp;&lt;i&gt;offset&lt;/i&gt;&nbsp;within&nbsp;O,&nbsp;&lt;i&gt;offset&lt;/i&gt;(C),&nbsp;of&nbsp;each&nbsp;data<br>
component&nbsp;C,&nbsp;i.e.&nbsp;base&nbsp;or&nbsp;member.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;purposes&nbsp;internal&nbsp;to&nbsp;the&nbsp;specification,&nbsp;we&nbsp;also&nbsp;specify<br>
the&nbsp;&lt;i&gt;data&nbsp;size&lt;/i&gt;&nbsp;of&nbsp;an&nbsp;object,&nbsp;&lt;i&gt;dsize&lt;/i&gt;(O),&nbsp;which&nbsp;intuitively&nbsp;is<br>
sizeof(O)&nbsp;minus&nbsp;the&nbsp;size&nbsp;of&nbsp;tail&nbsp;padding.&lt;/font&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;Definitions&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;descriptions&nbsp;below&nbsp;make&nbsp;use&nbsp;of&nbsp;the&nbsp;following&nbsp;definitions:&lt;/font&gt;<br>
&lt;dl&gt;<br>
&lt;dt&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;i&gt;alignment&lt;/i&gt;&nbsp;of&nbsp;a&nbsp;type&nbsp;T&nbsp;(or&nbsp;object&nbsp;X)&lt;/font&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;value&nbsp;A&nbsp;such&nbsp;that&nbsp;any&nbsp;object&nbsp;X&nbsp;of&nbsp;type&nbsp;T&nbsp;has&nbsp;an&nbsp;address<br>
satisfying&nbsp;the&nbsp;constraint&nbsp;that&nbsp;&amp;X&nbsp;modulo&nbsp;A&nbsp;==&nbsp;0.&lt;/font&gt;&lt;/dd&gt;<br>
<br>
&lt;dt&gt;<br>
&lt;i&gt;&lt;font&nbsp;size=-1&gt;empty&nbsp;class&lt;/font&gt;&lt;/i&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;class&nbsp;with&nbsp;no&nbsp;non-static&nbsp;data&nbsp;members,&nbsp;no&nbsp;virtual&nbsp;functions,<br>
no&nbsp;virtual&nbsp;base&nbsp;classes,&nbsp;and&nbsp;no&nbsp;non-empty&nbsp;non-virtual&nbsp;base&nbsp;classes.&lt;/font&gt;&lt;/dd&gt;<br>
<br>
&lt;dt&gt;<br>
&lt;i&gt;&lt;font&nbsp;size=-1&gt;nearly&nbsp;empty&nbsp;class&lt;/font&gt;&lt;/i&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;class,&nbsp;the&nbsp;objects&nbsp;of&nbsp;which&nbsp;contain&nbsp;only&nbsp;a&nbsp;Vptr.&lt;/font&gt;&lt;/dd&gt;<br>
<br>
&lt;dt&gt;<br>
&lt;i&gt;&lt;font&nbsp;size=-1&gt;polymorphic&nbsp;class&lt;/font&gt;&lt;/i&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;class&nbsp;requiring&nbsp;a&nbsp;virtual&nbsp;table&nbsp;pointer&nbsp;(because&nbsp;it&nbsp;or<br>
its&nbsp;bases&nbsp;have&nbsp;one&nbsp;or&nbsp;more&nbsp;virtual&nbsp;member&nbsp;functions&nbsp;or&nbsp;virtual&nbsp;base&nbsp;classes).&lt;/font&gt;&lt;/dd&gt;<br>
<br>
&lt;dt&gt;<br>
&lt;i&gt;&lt;font&nbsp;size=-1&gt;primary&nbsp;base&nbsp;class&lt;/font&gt;&lt;/i&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;a&nbsp;polymorphic&nbsp;class,&nbsp;the&nbsp;unique&nbsp;base&nbsp;class&nbsp;(if&nbsp;any)&nbsp;with<br>
which&nbsp;it&nbsp;shares&nbsp;the&nbsp;Vptr&nbsp;at&nbsp;offset&nbsp;0.&lt;/font&gt;&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
<br>
&lt;hr&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;POD&nbsp;Data&nbsp;Types&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;size&nbsp;and&nbsp;alignment&nbsp;of&nbsp;C&nbsp;POD&nbsp;types&nbsp;is&nbsp;as&nbsp;specified&nbsp;by<br>
the&nbsp;base&nbsp;(C)&nbsp;ABI.&nbsp;Type&nbsp;bool&nbsp;has&nbsp;size&nbsp;and&nbsp;alignment&nbsp;1.&nbsp;All&nbsp;of&nbsp;these&nbsp;types<br>
have&nbsp;data&nbsp;size&nbsp;equal&nbsp;to&nbsp;their&nbsp;size.&nbsp;(We&nbsp;ignore&nbsp;tail&nbsp;padding&nbsp;for&nbsp;PODs&nbsp;because<br>
the&nbsp;Standard&nbsp;does&nbsp;not&nbsp;allow&nbsp;us&nbsp;to&nbsp;use&nbsp;it&nbsp;for&nbsp;anything&nbsp;else.)&lt;/font&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;p&gt;&lt;a&nbsp;NAME=&quot;member-pointers&quot;&gt;&lt;/a&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;Member&nbsp;Pointers&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;pointer&nbsp;to&nbsp;data&nbsp;member&nbsp;is&nbsp;an&nbsp;offset&nbsp;from&nbsp;the&nbsp;base&nbsp;address<br>
of&nbsp;the&nbsp;class&nbsp;object&nbsp;containing&nbsp;it,&nbsp;represented&nbsp;as&nbsp;a&nbsp;&lt;tt&gt;ptrdiff_t&lt;/tt&gt;.<br>
It&nbsp;has&nbsp;the&nbsp;size,&nbsp;data&nbsp;size,&nbsp;and&nbsp;alignment&nbsp;of&nbsp;a&nbsp;&lt;tt&gt;ptrdiff_t&lt;/tt&gt;.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;A&nbsp;pointer&nbsp;to&nbsp;member&nbsp;function&nbsp;is&nbsp;a&nbsp;pair&nbsp;&lt;ptr,&nbsp;adj&gt;as<br>
follows:&lt;/font&gt;<br>
&lt;dl&gt;<br>
&lt;dt&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;tt&gt;ptr&lt;/tt&gt;:&lt;/font&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;a&nbsp;non-virtual&nbsp;function,&nbsp;this&nbsp;field&nbsp;is&nbsp;a&nbsp;simple&nbsp;function<br>
pointer.&nbsp;(Under&nbsp;current&nbsp;base&nbsp;IA-64&nbsp;psABI&nbsp;conventions,&nbsp;that&nbsp;is&nbsp;a&nbsp;pointer<br>
to&nbsp;a&nbsp;GP/function&nbsp;address&nbsp;pair.)&nbsp;For&nbsp;a&nbsp;virtual&nbsp;function,&nbsp;it&nbsp;is&nbsp;1&nbsp;plus&nbsp;twice<br>
the&nbsp;Vtable&nbsp;offset&nbsp;of&nbsp;the&nbsp;function.&nbsp;The&nbsp;value&nbsp;zero&nbsp;is&nbsp;a&nbsp;NULL&nbsp;pointer.&lt;/font&gt;&lt;/dd&gt;<br>
<br>
&lt;dt&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;tt&gt;adj&lt;/tt&gt;:&lt;/font&gt;&lt;/dt&gt;<br>
<br>
&lt;dd&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;required&nbsp;adjustment&nbsp;to&nbsp;&lt;i&gt;this&lt;/i&gt;,&nbsp;represented&nbsp;as&nbsp;a<br>
&lt;tt&gt;ptrdiff_t&lt;/tt&gt;.&lt;/font&gt;&lt;/dd&gt;<br>
&lt;/dl&gt;<br>
&lt;font&nbsp;size=-1&gt;It&nbsp;has&nbsp;the&nbsp;size,&nbsp;data&nbsp;size,&nbsp;and&nbsp;alignment&nbsp;of&nbsp;a&nbsp;class&nbsp;containing<br>
those&nbsp;two&nbsp;members,&nbsp;in&nbsp;that&nbsp;order.&nbsp;(For&nbsp;64-bit&nbsp;IA-64,&nbsp;that&nbsp;will&nbsp;be&nbsp;16,&nbsp;16,<br>
and&nbsp;8&nbsp;bytes&nbsp;respectively.)&lt;/font&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;p&gt;&lt;a&nbsp;NAME=&quot;class-types&quot;&gt;&lt;/a&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;Non-POD&nbsp;Class&nbsp;Types&lt;/font&gt;&lt;/h3&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;non-POD&nbsp;class&nbsp;types&nbsp;C,&nbsp;assume&nbsp;that&nbsp;all&nbsp;component&nbsp;types<br>
(i.e.&nbsp;base&nbsp;classes&nbsp;and&nbsp;non-static&nbsp;data&nbsp;member&nbsp;types)&nbsp;have&nbsp;been&nbsp;laid&nbsp;out,<br>
defining&nbsp;size,&nbsp;data&nbsp;size,&nbsp;and&nbsp;alignment.&nbsp;Layout&nbsp;(of&nbsp;type&nbsp;C)&nbsp;is&nbsp;done&nbsp;using<br>
the&nbsp;following&nbsp;procedure.&lt;/font&gt;<br>
&lt;ol&nbsp;type=I&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Initialization&lt;/font&gt;&lt;/h5&gt;<br>
<br>
&lt;ol&nbsp;type=1&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Initialize&nbsp;sizeof(C)&nbsp;to&nbsp;zero,&nbsp;align(C)&nbsp;to&nbsp;one,&nbsp;dsize(C)&nbsp;to<br>
zero.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;C&nbsp;is&nbsp;a&nbsp;polymorphic&nbsp;type:&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;ol&nbsp;type=a&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;C&nbsp;has&nbsp;a&nbsp;polymorphic&nbsp;base&nbsp;class,&nbsp;attempt&nbsp;to&nbsp;choose&nbsp;a&nbsp;primary<br>
base&nbsp;class&nbsp;B.&nbsp;It&nbsp;is&nbsp;the&nbsp;first&nbsp;non-virtual&nbsp;polymorphic&nbsp;base&nbsp;class,&nbsp;if&nbsp;any,<br>
or&nbsp;else&nbsp;the&nbsp;first&nbsp;nearly&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;class.&nbsp;Allocate&nbsp;it&nbsp;at&nbsp;offset<br>
zero,&nbsp;and&nbsp;set&nbsp;sizeof(C)&nbsp;to&nbsp;sizeof(B),&nbsp;align(C)&nbsp;to&nbsp;align(B),&nbsp;dsize(C)&nbsp;to<br>
dsize(B).&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Otherwise,&nbsp;allocate&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;for&nbsp;C&nbsp;at&nbsp;offset&nbsp;zero,<br>
and&nbsp;set&nbsp;sizeof(C),&nbsp;align(C),&nbsp;and&nbsp;dsize(C)&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;values&nbsp;for<br>
a&nbsp;pointer&nbsp;(all&nbsp;8&nbsp;bytes&nbsp;for&nbsp;IA-64&nbsp;64-bit&nbsp;ABI).&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ol&gt;<br>
&lt;/ol&gt;<br>
<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Non-Virtual-Base&nbsp;Allocation&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;each&nbsp;data&nbsp;component&nbsp;D&nbsp;(i.e.&nbsp;base&nbsp;or&nbsp;non-static&nbsp;data&nbsp;member)<br>
except&nbsp;virtual&nbsp;bases,&nbsp;first&nbsp;the&nbsp;non-virtual&nbsp;base&nbsp;classes&nbsp;in&nbsp;declaration<br>
order&nbsp;and&nbsp;then&nbsp;the&nbsp;non-static&nbsp;data&nbsp;members&nbsp;in&nbsp;declaration&nbsp;order,&nbsp;allocate<br>
as&nbsp;follows:&lt;/font&gt;<br>
&lt;ol&nbsp;type=1&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;D&nbsp;is&nbsp;not&nbsp;an&nbsp;empty&nbsp;base&nbsp;class,&nbsp;start&nbsp;at&nbsp;offset&nbsp;dsize(C),<br>
incremented&nbsp;if&nbsp;necessary&nbsp;to&nbsp;alignment&nbsp;align(type(D)).&nbsp;Place&nbsp;D&nbsp;at&nbsp;this&nbsp;offset<br>
unless&nbsp;doing&nbsp;so&nbsp;would&nbsp;result&nbsp;in&nbsp;two&nbsp;components&nbsp;(direct&nbsp;or&nbsp;indirect)&nbsp;of<br>
the&nbsp;same&nbsp;type&nbsp;having&nbsp;the&nbsp;same&nbsp;offset.&nbsp;If&nbsp;such&nbsp;a&nbsp;component&nbsp;type&nbsp;conflict<br>
occurs,&nbsp;increment&nbsp;the&nbsp;candidate&nbsp;offset&nbsp;by&nbsp;align(type(D)),&nbsp;and&nbsp;try&nbsp;again,<br>
repeating&nbsp;until&nbsp;success&nbsp;occurs&nbsp;(which&nbsp;will&nbsp;occur&nbsp;no&nbsp;later&nbsp;than&nbsp;sizeof(C)<br>
incremented&nbsp;to&nbsp;the&nbsp;required&nbsp;alignment).&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;br&gt;&nbsp;<br>
&lt;p&gt;&nbsp;<br>
&lt;br&gt;&nbsp;<br>
&lt;br&gt;&nbsp;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;Update&nbsp;sizeof(C)&nbsp;to&nbsp;max&nbsp;(sizeof(C),&nbsp;offset(D)+sizeof(D)).<br>
Update&nbsp;align(C)&nbsp;to&nbsp;max&nbsp;(align(C),&nbsp;align(D)).&nbsp;If&nbsp;D&nbsp;is&nbsp;a&nbsp;base&nbsp;class&nbsp;(not<br>
empty&nbsp;in&nbsp;this&nbsp;case),&nbsp;update&nbsp;dsize(C)&nbsp;to&nbsp;offset(D)+dsize(D).&nbsp;If&nbsp;D&nbsp;is&nbsp;a&nbsp;data<br>
member,&nbsp;update&nbsp;dsize(C)&nbsp;to&nbsp;max&nbsp;(offset(D)+dsize(D),&nbsp;offset(D)+1).&lt;/font&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;D&nbsp;is&nbsp;an&nbsp;empty&nbsp;base&nbsp;class,&nbsp;its&nbsp;allocation&nbsp;is&nbsp;similar&nbsp;to<br>
the&nbsp;first&nbsp;case&nbsp;above,&nbsp;except&nbsp;that&nbsp;additional&nbsp;candidate&nbsp;offsets&nbsp;are&nbsp;considered<br>
before&nbsp;starting&nbsp;at&nbsp;dsize(C).&nbsp;First,&nbsp;attempt&nbsp;to&nbsp;place&nbsp;D&nbsp;at&nbsp;offset&nbsp;zero.<br>
If&nbsp;unsuccessful&nbsp;(due&nbsp;to&nbsp;a&nbsp;component&nbsp;type&nbsp;conflict),&nbsp;proceed&nbsp;with&nbsp;attempts<br>
at&nbsp;dsize(C)&nbsp;as&nbsp;for&nbsp;non-empty&nbsp;bases.&nbsp;As&nbsp;for&nbsp;that&nbsp;case,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;type<br>
conflict&nbsp;at&nbsp;dsize(C)&nbsp;(with&nbsp;alignment&nbsp;updated&nbsp;as&nbsp;necessary),&nbsp;increment&nbsp;the<br>
candidate&nbsp;offset&nbsp;by&nbsp;align(type(D)),&nbsp;and&nbsp;try&nbsp;again,&nbsp;repeating&nbsp;until&nbsp;success<br>
occurs.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;br&gt;&nbsp;<br>
&lt;p&gt;&nbsp;<br>
&lt;br&gt;&nbsp;<br>
&lt;br&gt;&nbsp;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;Once&nbsp;offset(D)&nbsp;has&nbsp;been&nbsp;chosen,&nbsp;update&nbsp;sizeof(C)&nbsp;to&nbsp;max<br>
(sizeof(C),&nbsp;offset(D)+sizeof(D)).&nbsp;Note&nbsp;that&nbsp;align(D)&nbsp;is&nbsp;1,&nbsp;so&nbsp;no&nbsp;update<br>
of&nbsp;align(C)&nbsp;is&nbsp;needed.&nbsp;Similarly,&nbsp;since&nbsp;D&nbsp;is&nbsp;an&nbsp;empty&nbsp;base&nbsp;class,&nbsp;no&nbsp;update<br>
of&nbsp;dsize(C)&nbsp;is&nbsp;needed.&lt;/font&gt;&lt;/ol&gt;<br>
<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Virtual&nbsp;Base&nbsp;Allocation&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Finally&nbsp;allocate&nbsp;any&nbsp;virtual&nbsp;base&nbsp;classes&nbsp;(except&nbsp;one&nbsp;selected<br>
as&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;in&nbsp;I-2a,&nbsp;if&nbsp;any)&nbsp;as&nbsp;we&nbsp;did&nbsp;non-virtual&nbsp;base&nbsp;classes<br>
in&nbsp;step&nbsp;II-1,&nbsp;in&nbsp;declaration&nbsp;order.&nbsp;Update&nbsp;sizeof(C)&nbsp;to&nbsp;max&nbsp;(sizeof(C),<br>
offset(D)+sizeof(D)).&nbsp;If&nbsp;non-empty,&nbsp;also&nbsp;update&nbsp;align(C)&nbsp;and&nbsp;dsize(C)&nbsp;as<br>
in&nbsp;II-1.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Finalization&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Round&nbsp;sizeof(C)&nbsp;up&nbsp;to&nbsp;a&nbsp;non-zero&nbsp;multiple&nbsp;of&nbsp;align(C).&lt;/font&gt;&lt;/ol&gt;<br>
<br>
&lt;hr&gt;<br>
&lt;p&gt;&lt;a&nbsp;NAME=&quot;vtable&quot;&gt;&lt;/a&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;Virtual&nbsp;Table&nbsp;Layout&lt;/font&gt;&lt;/h3&gt;<br>
<br>
&lt;h4&gt;<br>
&lt;font&nbsp;size=-1&gt;General&lt;/font&gt;&lt;/h4&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;&lt;i&gt;virtual&nbsp;table&lt;/i&gt;&nbsp;(&lt;i&gt;vtable&lt;/i&gt;)&nbsp;is&nbsp;a&nbsp;table&nbsp;of&nbsp;information<br>
used&nbsp;to&nbsp;dispatch&nbsp;virtual&nbsp;functions,&nbsp;to&nbsp;access&nbsp;virtual&nbsp;base&nbsp;class&nbsp;subobjects,<br>
and&nbsp;to&nbsp;access&nbsp;information&nbsp;for&nbsp;runtime&nbsp;type&nbsp;identification&nbsp;(RTTI).&nbsp;Each<br>
class&nbsp;that&nbsp;has&nbsp;virtual&nbsp;member&nbsp;functions&nbsp;or&nbsp;virtual&nbsp;bases&nbsp;has&nbsp;an&nbsp;associated<br>
set&nbsp;of&nbsp;vtables.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;vtables&nbsp;for&nbsp;a&nbsp;particular&nbsp;class,&nbsp;if<br>
it&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;base&nbsp;class&nbsp;for&nbsp;other&nbsp;classes.&nbsp;However,&nbsp;the&nbsp;vtable&nbsp;pointers<br>
within&nbsp;all&nbsp;the&nbsp;objects&nbsp;(instances)&nbsp;of&nbsp;a&nbsp;particular&nbsp;most-derived&nbsp;class&nbsp;point<br>
to&nbsp;the&nbsp;same&nbsp;set&nbsp;of&nbsp;vtables.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;A&nbsp;vtable&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;offsets,&nbsp;data&nbsp;pointers,<br>
and&nbsp;function&nbsp;pointers,&nbsp;as&nbsp;well&nbsp;as&nbsp;structures&nbsp;composed&nbsp;of&nbsp;such&nbsp;items.&nbsp;We<br>
will&nbsp;describe&nbsp;below&nbsp;the&nbsp;sequence&nbsp;of&nbsp;such&nbsp;items.&nbsp;Their&nbsp;offsets&nbsp;within&nbsp;the<br>
vtable&nbsp;are&nbsp;determined&nbsp;by&nbsp;that&nbsp;allocation&nbsp;sequence&nbsp;and&nbsp;the&nbsp;natural&nbsp;ABI&nbsp;size<br>
and&nbsp;alignment,&nbsp;just&nbsp;as&nbsp;a&nbsp;data&nbsp;struct&nbsp;would&nbsp;be.&nbsp;In&nbsp;particular:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Offsets&nbsp;are&nbsp;of&nbsp;type&nbsp;&lt;tt&gt;ptrdiff_t&lt;/tt&gt;&nbsp;unless&nbsp;otherwise&nbsp;stated.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Data&nbsp;pointers&nbsp;have&nbsp;normal&nbsp;pointer&nbsp;size&nbsp;and&nbsp;alignment.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Function&nbsp;pointers&nbsp;remain&nbsp;to&nbsp;be&nbsp;defined.&nbsp;One&nbsp;possibility&nbsp;is<br>
that&nbsp;they&nbsp;will&nbsp;be&nbsp;&lt;function&nbsp;address,&nbsp;GP&nbsp;address&gt;&nbsp;pairs,&nbsp;with&nbsp;pointer<br>
alignment.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;In&nbsp;general,&nbsp;what&nbsp;we&nbsp;consider&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;vtable&nbsp;(i.e.<br>
the&nbsp;address&nbsp;contained&nbsp;in&nbsp;objects&nbsp;pointing&nbsp;to&nbsp;a&nbsp;vtable)&nbsp;may&nbsp;not&nbsp;be&nbsp;the&nbsp;beginning<br>
of&nbsp;the&nbsp;vtable.&nbsp;We&nbsp;call&nbsp;it&nbsp;the&nbsp;&lt;i&gt;address&nbsp;point&lt;/i&gt;&nbsp;of&nbsp;the&nbsp;vtable.&nbsp;The&nbsp;vtable<br>
may&nbsp;therefore&nbsp;contain&nbsp;components&nbsp;at&nbsp;either&nbsp;positive&nbsp;or&nbsp;negative&nbsp;offsets<br>
from&nbsp;its&nbsp;address&nbsp;point.&lt;/font&gt;<br>
&lt;h4&gt;<br>
&lt;font&nbsp;size=-1&gt;Components&lt;/font&gt;&lt;/h4&gt;<br>
&lt;font&nbsp;size=-1&gt;Each&nbsp;vtable&nbsp;consists&nbsp;of&nbsp;the&nbsp;following&nbsp;components:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;i&gt;Base&nbsp;offsets&lt;/i&gt;&nbsp;are&nbsp;used&nbsp;to&nbsp;access&nbsp;the&nbsp;virtual&nbsp;bases<br>
of&nbsp;an&nbsp;object.&nbsp;Such&nbsp;an&nbsp;entry&nbsp;is&nbsp;a&nbsp;displacement&nbsp;to&nbsp;a&nbsp;virtual&nbsp;base&nbsp;subobject<br>
from&nbsp;the&nbsp;location&nbsp;within&nbsp;the&nbsp;object&nbsp;of&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;that&nbsp;addresses<br>
this&nbsp;vtable.&nbsp;These&nbsp;entries&nbsp;are&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;class&nbsp;directly&nbsp;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;(or<br>
indirectly?)&lt;/font&gt;&nbsp;inherits&nbsp;from&nbsp;virtual&nbsp;base&nbsp;classes.&nbsp;These&nbsp;values&nbsp;may<br>
be&nbsp;positive&nbsp;or&nbsp;negative.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;i&gt;vcall&nbsp;offsets&nbsp;&lt;/i&gt;are&nbsp;used&nbsp;to&nbsp;perform&nbsp;pointer&nbsp;adjustment<br>
for&nbsp;overridden&nbsp;virtual&nbsp;functions.&nbsp;These&nbsp;entries&nbsp;are&nbsp;allocated&nbsp;when&nbsp;the<br>
class&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;virtual&nbsp;base.&nbsp;They&nbsp;are&nbsp;referenced&nbsp;by&nbsp;the&nbsp;virtual&nbsp;functions<br>
to&nbsp;find&nbsp;the&nbsp;necessary&nbsp;adjustment&nbsp;from&nbsp;the&nbsp;base&nbsp;to&nbsp;the&nbsp;derived&nbsp;class,&nbsp;if<br>
any.&nbsp;&nbsp;These&nbsp;values&nbsp;may&nbsp;be&nbsp;positive&nbsp;or&nbsp;negative.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;&lt;i&gt;offset&nbsp;to&nbsp;top&lt;/i&gt;&nbsp;holds&nbsp;the&nbsp;displacement&nbsp;to&nbsp;the&nbsp;top<br>
of&nbsp;the&nbsp;object&nbsp;from&nbsp;the&nbsp;location&nbsp;within&nbsp;the&nbsp;object&nbsp;of&nbsp;the&nbsp;vtable&nbsp;pointer<br>
that&nbsp;addresses&nbsp;this&nbsp;vtable,&nbsp;as&nbsp;a&nbsp;&lt;tt&gt;ptrdiff_t&lt;/tt&gt;.&nbsp;A&nbsp;negative&nbsp;value&nbsp;indicates<br>
the&nbsp;vtable&nbsp;pointer&nbsp;is&nbsp;part&nbsp;of&nbsp;an&nbsp;embedded&nbsp;base&nbsp;class&nbsp;subobject;&nbsp;otherwise<br>
it&nbsp;is&nbsp;zero.&nbsp;The&nbsp;offset&nbsp;provides&nbsp;a&nbsp;way&nbsp;to&nbsp;find&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;object&nbsp;from<br>
any&nbsp;base&nbsp;subobject&nbsp;with&nbsp;a&nbsp;vtable&nbsp;pointer.&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;dynamic_cast&lt;void*&gt;<br>
in&nbsp;particular.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;&lt;i&gt;typeinfo&nbsp;pointer&lt;/i&gt;&nbsp;points&nbsp;to&nbsp;the&nbsp;typeinfo&nbsp;object<br>
used&nbsp;for&nbsp;RTTI.&nbsp;All&nbsp;entries&nbsp;in&nbsp;each&nbsp;of&nbsp;the&nbsp;vtables&nbsp;for&nbsp;a&nbsp;given&nbsp;class&nbsp;point<br>
to&nbsp;the&nbsp;same&nbsp;typeinfo&nbsp;object.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;i&gt;Virtual&nbsp;function&nbsp;pointers&lt;/i&gt;&nbsp;are&nbsp;used&nbsp;for&nbsp;virtual&nbsp;function<br>
dispatch.&nbsp;Each&nbsp;pointer&nbsp;holds&nbsp;either&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;virtual&nbsp;function&nbsp;of<br>
the&nbsp;class&nbsp;(or&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;secondary&nbsp;entry&nbsp;point&nbsp;that&nbsp;performs&nbsp;certain<br>
adjustments&nbsp;before&nbsp;transferring&nbsp;control&nbsp;to&nbsp;a&nbsp;virtual&nbsp;function.)&nbsp;In&nbsp;the<br>
case&nbsp;of&nbsp;shared&nbsp;library&nbsp;builds,&nbsp;a&nbsp;virtual&nbsp;function&nbsp;pointer&nbsp;entry&nbsp;contains<br>
a&nbsp;pair&nbsp;of&nbsp;components&nbsp;(each&nbsp;64&nbsp;bits&nbsp;in&nbsp;the&nbsp;64-bit&nbsp;IA-64&nbsp;ABI):&nbsp;the&nbsp;value<br>
of&nbsp;the&nbsp;target&nbsp;GP&nbsp;value&nbsp;and&nbsp;the&nbsp;actual&nbsp;function&nbsp;address.&nbsp;That&nbsp;is,&nbsp;rather<br>
than&nbsp;being&nbsp;a&nbsp;normal&nbsp;function&nbsp;pointer,&nbsp;which&nbsp;points&nbsp;to&nbsp;such&nbsp;a&nbsp;two-component<br>
descriptor,&nbsp;a&nbsp;virtual&nbsp;function&nbsp;pointer&nbsp;entry&nbsp;is&nbsp;the&nbsp;descriptor.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;&lt;i&gt;Secondary&nbsp;vtables&lt;/i&gt;&nbsp;are&nbsp;copies&nbsp;of&nbsp;the&nbsp;vtables&nbsp;for&nbsp;base<br>
classes&nbsp;of&nbsp;the&nbsp;current&nbsp;class&nbsp;(copies&nbsp;in&nbsp;the&nbsp;sense&nbsp;that&nbsp;they&nbsp;have&nbsp;the&nbsp;same<br>
layout,&nbsp;though&nbsp;virtual&nbsp;function&nbsp;pointers&nbsp;may&nbsp;point&nbsp;to&nbsp;overriding&nbsp;functions).&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;virtual&nbsp;pointer&nbsp;in&nbsp;the&nbsp;object&nbsp;points&nbsp;to&nbsp;the&nbsp;first&nbsp;virtual<br>
function&nbsp;pointer.&lt;/font&gt;<br>
&lt;h4&gt;<br>
&lt;font&nbsp;size=-1&gt;Virtual&nbsp;Table&nbsp;Order&lt;/font&gt;&lt;/h4&gt;<br>
&lt;font&nbsp;size=-1&gt;A&nbsp;virtual&nbsp;table's&nbsp;components&nbsp;are&nbsp;laid&nbsp;out&nbsp;in&nbsp;the&nbsp;following<br>
order,&nbsp;analogous&nbsp;to&nbsp;the&nbsp;corresponding&nbsp;object&nbsp;layout.&lt;/font&gt;<br>
&lt;ol&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;vcall&nbsp;offsets&nbsp;are&nbsp;required,&nbsp;they&nbsp;come&nbsp;first,&nbsp;with&nbsp;ordering<br>
as&nbsp;defined&nbsp;in&nbsp;categories&nbsp;3&nbsp;and&nbsp;4&nbsp;below.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;If&nbsp;virtual&nbsp;base&nbsp;offsets&nbsp;are&nbsp;required,&nbsp;they&nbsp;come&nbsp;next,&nbsp;with<br>
ordering&nbsp;as&nbsp;defined&nbsp;in&nbsp;categories&nbsp;3&nbsp;and&nbsp;4&nbsp;below.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;offset&nbsp;to&nbsp;top&nbsp;field&nbsp;is&nbsp;next.&nbsp;It&nbsp;is&nbsp;present&nbsp;if&nbsp;the&nbsp;class<br>
has&nbsp;virtual&nbsp;functions.&nbsp;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;Question:&nbsp;Should&nbsp;we&nbsp;include<br>
the&nbsp;RTTI&nbsp;fields&nbsp;for&nbsp;classes&nbsp;with&nbsp;no&nbsp;virtual&nbsp;functions&nbsp;(only&nbsp;virtual&nbsp;bases),<br>
too?&lt;/font&gt;&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;typeinfo&nbsp;pointer&nbsp;field&nbsp;is&nbsp;next.&nbsp;It&nbsp;is&nbsp;present&nbsp;if&nbsp;the<br>
class&nbsp;has&nbsp;virtual&nbsp;functions.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;vtable&nbsp;address&nbsp;point&nbsp;points&nbsp;here,&nbsp;i.e.&nbsp;this&nbsp;is&nbsp;the&nbsp;address<br>
of&nbsp;the&nbsp;vtable&nbsp;contained&nbsp;in&nbsp;an&nbsp;object's&nbsp;vptr.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Virtual&nbsp;function&nbsp;pointers&nbsp;come&nbsp;next,&nbsp;in&nbsp;order&nbsp;of&nbsp;declaration<br>
of&nbsp;the&nbsp;corresponding&nbsp;member&nbsp;function&nbsp;in&nbsp;the&nbsp;class.&nbsp;They&nbsp;appear&nbsp;both&nbsp;for<br>
newly&nbsp;introduced&nbsp;functions&nbsp;and&nbsp;overridden&nbsp;functions.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;secondary&nbsp;vtables&nbsp;are&nbsp;last.&nbsp;They&nbsp;are&nbsp;laid&nbsp;out&nbsp;in&nbsp;the<br>
order&nbsp;that&nbsp;the&nbsp;bases&nbsp;themselves&nbsp;are&nbsp;laid&nbsp;out&nbsp;in&nbsp;the&nbsp;object.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ol&gt;<br>
<br>
&lt;h4&gt;<br>
&lt;font&nbsp;size=-1&gt;Virtual&nbsp;Table&nbsp;Construction&lt;/font&gt;&lt;/h4&gt;<br>
&lt;font&nbsp;size=-1&gt;In&nbsp;this&nbsp;section,&nbsp;we&nbsp;describe&nbsp;how&nbsp;to&nbsp;construct&nbsp;the&nbsp;vtable<br>
for&nbsp;an&nbsp;class,&nbsp;given&nbsp;vtables&nbsp;for&nbsp;all&nbsp;of&nbsp;its&nbsp;base&nbsp;classes.&nbsp;To&nbsp;do&nbsp;so,&nbsp;we&nbsp;divide<br>
classes&nbsp;into&nbsp;several&nbsp;categories,&nbsp;based&nbsp;on&nbsp;their&nbsp;base&nbsp;class&nbsp;structure.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Category&nbsp;0:&nbsp;Trivial&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Structure:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;No&nbsp;virtual&nbsp;base&nbsp;classes.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;No&nbsp;virtual&nbsp;functions.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;Such&nbsp;a&nbsp;class&nbsp;has&nbsp;no&nbsp;associated&nbsp;vtable,&nbsp;and&nbsp;its&nbsp;objects&nbsp;contain<br>
no&nbsp;vptr.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Category&nbsp;1:&nbsp;Leaf&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Structure:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;No&nbsp;inherited&nbsp;virtual&nbsp;functions.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;No&nbsp;virtual&nbsp;base&nbsp;classes.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Declares&nbsp;virtual&nbsp;functions.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;vtable&nbsp;contains&nbsp;the&nbsp;RTTI&nbsp;fields&nbsp;followed&nbsp;by&nbsp;virtual&nbsp;function<br>
pointers.&nbsp;There&nbsp;is&nbsp;one&nbsp;function&nbsp;pointer&nbsp;entry&nbsp;for&nbsp;each&nbsp;virtual&nbsp;function<br>
declared&nbsp;in&nbsp;the&nbsp;class.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Category&nbsp;2:&nbsp;Non-Virtual&nbsp;Bases&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Structure:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Only&nbsp;non-virtual&nbsp;base&nbsp;classes.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Inherits&nbsp;virtual&nbsp;functions&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;class&nbsp;has&nbsp;a&nbsp;vtable&nbsp;for&nbsp;each&nbsp;base&nbsp;class&nbsp;that&nbsp;has&nbsp;a&nbsp;vtable.<br>
The&nbsp;class's&nbsp;vtables&nbsp;are&nbsp;constructed&nbsp;from&nbsp;copies&nbsp;of&nbsp;the&nbsp;base&nbsp;class&nbsp;vtables.<br>
The&nbsp;entries&nbsp;are&nbsp;the&nbsp;same,&nbsp;except:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;RTTI&nbsp;fields&nbsp;contain&nbsp;information&nbsp;for&nbsp;the&nbsp;class,&nbsp;rather<br>
than&nbsp;for&nbsp;the&nbsp;base&nbsp;class.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;function&nbsp;pointer&nbsp;entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;inherited<br>
from&nbsp;the&nbsp;base&nbsp;class&nbsp;and&nbsp;overridden&nbsp;by&nbsp;this&nbsp;class&nbsp;are&nbsp;replaced&nbsp;with&nbsp;the<br>
addresses&nbsp;of&nbsp;the&nbsp;overriding&nbsp;functions&nbsp;(or&nbsp;the&nbsp;corresponding&nbsp;adjustor&nbsp;secondary<br>
entry&nbsp;points).&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;For&nbsp;a&nbsp;base&nbsp;class&nbsp;&lt;tt&gt;Base&lt;/tt&gt;,&nbsp;and&nbsp;a&nbsp;derived&nbsp;class&nbsp;&lt;tt&gt;Derived&lt;/tt&gt;<br>
for&nbsp;which&nbsp;we&nbsp;are&nbsp;constructing&nbsp;this&nbsp;set&nbsp;of&nbsp;vtables,&nbsp;we&nbsp;shall&nbsp;refer&nbsp;to&nbsp;the<br>
vtable&nbsp;for&nbsp;&lt;tt&gt;Base&lt;/tt&gt;&nbsp;as<br>
&lt;tt&gt;Base-in-Derived&lt;/tt&gt;.&nbsp;The&nbsp;vptr&nbsp;of&nbsp;each<br>
base&nbsp;subobject&nbsp;of&nbsp;an&nbsp;object&nbsp;of&nbsp;the&nbsp;derived&nbsp;class&nbsp;will&nbsp;point&nbsp;to&nbsp;the&nbsp;corresponding<br>
base&nbsp;vtable&nbsp;in&nbsp;this&nbsp;set.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;The&nbsp;vtable&nbsp;copied&nbsp;from&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;is&nbsp;also<br>
called&nbsp;the&nbsp;primary&nbsp;vtable;&nbsp;it&nbsp;is&nbsp;addressed&nbsp;by&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;at&nbsp;the<br>
top&nbsp;of&nbsp;the&nbsp;object.&nbsp;The&nbsp;other&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class&nbsp;are&nbsp;called&nbsp;secondary<br>
vtables;&nbsp;they&nbsp;are&nbsp;addressed&nbsp;by&nbsp;vtable&nbsp;pointers&nbsp;inside&nbsp;the&nbsp;object.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;Following&nbsp;the&nbsp;function&nbsp;pointer&nbsp;entries&nbsp;that&nbsp;correspond<br>
to&nbsp;those&nbsp;of&nbsp;the&nbsp;primary&nbsp;base&nbsp;class,&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;holds&nbsp;the&nbsp;following<br>
additional&nbsp;entries&nbsp;at&nbsp;its&nbsp;tail:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;introduced&nbsp;by&nbsp;this&nbsp;class.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Entries&nbsp;for&nbsp;overridden&nbsp;virtual&nbsp;functions&nbsp;not&nbsp;already&nbsp;in&nbsp;the<br>
vtable.&nbsp;(These&nbsp;are&nbsp;also&nbsp;called&nbsp;replicated&nbsp;entries&nbsp;because&nbsp;they&nbsp;are&nbsp;already<br>
in&nbsp;the&nbsp;secondary&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class.)&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;primary&nbsp;vtable,&nbsp;therefore,&nbsp;has&nbsp;the&nbsp;base&nbsp;class&nbsp;functions<br>
appearing&nbsp;before&nbsp;the&nbsp;derived&nbsp;class&nbsp;functions.&nbsp;The&nbsp;primary&nbsp;vtable&nbsp;can&nbsp;be<br>
viewed&nbsp;as&nbsp;two&nbsp;vtables&nbsp;accessed&nbsp;from&nbsp;a&nbsp;shared&nbsp;vtable&nbsp;pointer.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;&lt;i&gt;Note&lt;/i&gt;:&nbsp;The&nbsp;benefit&nbsp;of&nbsp;replicating&nbsp;virtual&nbsp;function<br>
entries&nbsp;is&nbsp;that&nbsp;it&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;this&nbsp;pointer&nbsp;adjustments&nbsp;during<br>
virtual&nbsp;calls.&nbsp;Without&nbsp;replication,&nbsp;there&nbsp;would&nbsp;be&nbsp;more&nbsp;cases&nbsp;where&nbsp;the<br>
this&nbsp;pointer&nbsp;would&nbsp;have&nbsp;to&nbsp;be&nbsp;adjusted&nbsp;to&nbsp;access&nbsp;a&nbsp;secondary&nbsp;vtable&nbsp;prior<br>
to&nbsp;the&nbsp;call.&nbsp;These&nbsp;additional&nbsp;cases&nbsp;would&nbsp;be&nbsp;exactly&nbsp;those&nbsp;where&nbsp;the&nbsp;function<br>
is&nbsp;overridden&nbsp;in&nbsp;the&nbsp;derived&nbsp;class,&nbsp;implying&nbsp;an&nbsp;additional&nbsp;thunk&nbsp;adjustment<br>
back&nbsp;to&nbsp;the&nbsp;original&nbsp;pointer.&nbsp;Thus&nbsp;replication&nbsp;saves&nbsp;two&nbsp;adjustments&nbsp;for<br>
each&nbsp;virtual&nbsp;call&nbsp;to&nbsp;an&nbsp;overridden&nbsp;function&nbsp;introduced&nbsp;by&nbsp;a&nbsp;non-primary<br>
base&nbsp;class.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Category&nbsp;3:&nbsp;Virtual&nbsp;Bases&nbsp;Only&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Structure:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Only&nbsp;virtual&nbsp;base&nbsp;classes.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Base&nbsp;classes&nbsp;are&nbsp;not&nbsp;empty&nbsp;or&nbsp;nearly&nbsp;empty.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;class&nbsp;has&nbsp;a&nbsp;vtable&nbsp;for&nbsp;each&nbsp;virtual&nbsp;base&nbsp;class&nbsp;that&nbsp;has<br>
a&nbsp;vtable.&nbsp;These&nbsp;are&nbsp;all&nbsp;secondary&nbsp;vtables&nbsp;and&nbsp;are&nbsp;constructed&nbsp;from&nbsp;copies<br>
of&nbsp;the&nbsp;base&nbsp;class&nbsp;vtables&nbsp;according&nbsp;to&nbsp;the&nbsp;same&nbsp;rules&nbsp;as&nbsp;in&nbsp;Category&nbsp;2,<br>
except&nbsp;that&nbsp;the&nbsp;vtable&nbsp;for&nbsp;a&nbsp;virtual&nbsp;base&nbsp;A&nbsp;also&nbsp;includes&nbsp;a&nbsp;vcall&nbsp;offset<br>
entry&nbsp;for&nbsp;each&nbsp;virtual&nbsp;function&nbsp;represented&nbsp;in&nbsp;A's&nbsp;primary&nbsp;vtable&nbsp;and&nbsp;the<br>
secondary&nbsp;vtables&nbsp;from&nbsp;A's&nbsp;non-virtual&nbsp;bases.&nbsp;&nbsp;The&nbsp;vcall&nbsp;offset&nbsp;entries<br>
are&nbsp;allocated&nbsp;from&nbsp;the&nbsp;inside&nbsp;out,&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;the&nbsp;functions&nbsp;appear<br>
in&nbsp;A's&nbsp;vtables.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;The&nbsp;class&nbsp;also&nbsp;has&nbsp;a&nbsp;vtable&nbsp;that&nbsp;is&nbsp;not&nbsp;copied&nbsp;from&nbsp;the<br>
virtual&nbsp;base&nbsp;class&nbsp;vtables.&nbsp;This&nbsp;vtable&nbsp;is&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;of&nbsp;the&nbsp;class<br>
and&nbsp;addressed&nbsp;by&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;object,&nbsp;which&nbsp;is<br>
not&nbsp;shared.&nbsp;It&nbsp;holds&nbsp;the&nbsp;following&nbsp;function&nbsp;pointer&nbsp;entries:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;introduced&nbsp;by&nbsp;this&nbsp;class.&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;Entries&nbsp;for&nbsp;overridden&nbsp;virtual&nbsp;functions.&nbsp;(These&nbsp;are&nbsp;also<br>
called&nbsp;replicated&nbsp;entries,&nbsp;because&nbsp;they&nbsp;are&nbsp;already&nbsp;in&nbsp;the&nbsp;secondary&nbsp;vtables<br>
of&nbsp;the&nbsp;class.)&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;primary&nbsp;vtable&nbsp;also&nbsp;has&nbsp;virtual&nbsp;base&nbsp;offset&nbsp;entries&nbsp;to<br>
allow&nbsp;finding&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects.&nbsp;There&nbsp;is&nbsp;one&nbsp;virtual&nbsp;base&nbsp;offset<br>
entry&nbsp;for&nbsp;each&nbsp;virtual&nbsp;base&nbsp;class.&nbsp;For&nbsp;a&nbsp;class&nbsp;that&nbsp;inherits&nbsp;only&nbsp;virtual<br>
bases,&nbsp;the&nbsp;entries&nbsp;are&nbsp;allocated&nbsp;from&nbsp;the&nbsp;inside&nbsp;out,&nbsp;in&nbsp;the&nbsp;same&nbsp;order<br>
in&nbsp;which&nbsp;the&nbsp;virtual&nbsp;bases&nbsp;appear&nbsp;in&nbsp;the&nbsp;class&nbsp;declaration,&nbsp;that&nbsp;is,&nbsp;the<br>
entry&nbsp;for&nbsp;the&nbsp;leftmost&nbsp;virtual&nbsp;base&nbsp;is&nbsp;closest&nbsp;to&nbsp;the&nbsp;address&nbsp;point&nbsp;of<br>
the&nbsp;vtable.&lt;/font&gt;<br>
&lt;h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Category&nbsp;4:&nbsp;Complex&lt;/font&gt;&lt;/h5&gt;<br>
&lt;font&nbsp;size=-1&gt;Structure:&lt;/font&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;font&nbsp;size=-1&gt;None&nbsp;of&nbsp;the&nbsp;above,&nbsp;i.e.&nbsp;directly&nbsp;or&nbsp;indirectly&nbsp;inherits&nbsp;both<br>
virtual&nbsp;and&nbsp;non-virtual&nbsp;base&nbsp;classes,&nbsp;or&nbsp;at&nbsp;least&nbsp;one&nbsp;nearly&nbsp;empty&nbsp;virtual<br>
base&nbsp;class.&lt;/font&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
&lt;font&nbsp;size=-1&gt;The&nbsp;rules&nbsp;for&nbsp;constructing&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class&nbsp;are&nbsp;a&nbsp;combination<br>
of&nbsp;the&nbsp;rules&nbsp;from&nbsp;Categories&nbsp;2&nbsp;and&nbsp;3,&nbsp;and&nbsp;for&nbsp;the&nbsp;most&nbsp;part&nbsp;can&nbsp;be&nbsp;determined<br>
inductively.&nbsp;However&nbsp;the&nbsp;rules&nbsp;for&nbsp;placing&nbsp;virtual&nbsp;base&nbsp;offset&nbsp;entries<br>
in&nbsp;the&nbsp;vtables&nbsp;requires&nbsp;elaboration.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;The&nbsp;primary&nbsp;vtable&nbsp;has&nbsp;virtual&nbsp;base&nbsp;offset&nbsp;entries&nbsp;for<br>
all&nbsp;virtual&nbsp;bases&nbsp;directly&nbsp;or&nbsp;indirectly&nbsp;inherited&nbsp;by&nbsp;the&nbsp;class.&nbsp;Each&nbsp;secondary<br>
vtable&nbsp;has&nbsp;entries&nbsp;only&nbsp;for&nbsp;virtual&nbsp;bases&nbsp;visible&nbsp;to&nbsp;the&nbsp;corresponding<br>
base&nbsp;class.&nbsp;The&nbsp;entries&nbsp;in&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;are&nbsp;ordered&nbsp;so&nbsp;that&nbsp;entries<br>
for&nbsp;virtual&nbsp;bases&nbsp;visible&nbsp;to&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;are&nbsp;placed&nbsp;closest<br>
to&nbsp;the&nbsp;vtable&nbsp;address&nbsp;point,&nbsp;i.e.&nbsp;at&nbsp;higher&nbsp;addresses,&nbsp;while&nbsp;entries&nbsp;for<br>
virtual&nbsp;bases&nbsp;only&nbsp;visible&nbsp;to&nbsp;this&nbsp;class&nbsp;are&nbsp;further&nbsp;from&nbsp;the&nbsp;vtable&nbsp;address<br>
point,&nbsp;i.e.&nbsp;at&nbsp;lower&nbsp;addresses.&lt;/font&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=-1&gt;For&nbsp;virtual&nbsp;bases&nbsp;only&nbsp;visible&nbsp;to&nbsp;this&nbsp;class,&nbsp;the&nbsp;entries<br>
are&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;virtual&nbsp;bases&nbsp;are&nbsp;encountered&nbsp;in<br>
a&nbsp;depth-first,&nbsp;left-to-right&nbsp;traversal&nbsp;of&nbsp;the&nbsp;inheritance&nbsp;graph&nbsp;formed<br>
by&nbsp;the&nbsp;class&nbsp;definitions.&nbsp;Note&nbsp;that&nbsp;this&nbsp;does&nbsp;not&nbsp;follow&nbsp;the&nbsp;order&nbsp;that<br>
virtual&nbsp;bases&nbsp;are&nbsp;placed&nbsp;in&nbsp;the&nbsp;object.&lt;/font&gt;<br>
&lt;h4&gt;<br>
&lt;i&gt;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;&lt;font&nbsp;size=-1&gt;Issues:&lt;/font&gt;&lt;/font&gt;&lt;/i&gt;&lt;/h4&gt;<br>
<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
&lt;i&gt;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;&lt;font&nbsp;size=-1&gt;A-6:&nbsp;RTTI&nbsp;representation.&lt;/font&gt;&lt;/font&gt;&lt;/i&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;i&gt;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;&lt;font&nbsp;size=-1&gt;A-6:&nbsp;Duplicate&nbsp;base&nbsp;structure&nbsp;representation.&lt;/font&gt;&lt;/font&gt;&lt;/i&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;<br>
&lt;i&gt;&lt;font&nbsp;color=&quot;#FF0000&quot;&gt;&lt;font&nbsp;size=-1&gt;B-2:&nbsp;Will&nbsp;contain&nbsp;one&nbsp;entry&nbsp;per<br>
return&nbsp;type&nbsp;for&nbsp;covariant&nbsp;returns.&lt;/font&gt;&lt;/font&gt;&lt;/i&gt;&lt;/li&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;hr&gt;<br>
&lt;h3&gt;<br>
&lt;font&nbsp;size=-1&gt;External&nbsp;Names&nbsp;(a.k.a.&nbsp;Mangling)&lt;/font&gt;&lt;/h3&gt;<br>
&lt;i&gt;&lt;font&nbsp;size=-1&gt;&lt;To&nbsp;be&nbsp;specified.&gt;&lt;/font&gt;&lt;/i&gt;<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
&lt;p&gt;&lt;i&gt;&lt;font&nbsp;size=-1&gt;Please&nbsp;send&nbsp;corrections&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;mailto:dehnert@sgi.com&quot;&gt;Jim<br>
Dehnert&lt;/a&gt;.&lt;/font&gt;&lt;/i&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
