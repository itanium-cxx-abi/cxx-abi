<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;9,&nbsp;2013&nbsp;at&nbsp;1:48&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;9,&nbsp;2013&nbsp;at&nbsp;1:46&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi!&lt;div&gt;&lt;br&gt;&lt;/div&gt;5.1.2&nbsp;says:&nbsp;&quot;For&nbsp;the&nbsp;purposes&nbsp;of&nbsp;mangling,&nbsp;the&nbsp;name&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;union&nbsp;is&nbsp;considered&nbsp;to&nbsp;be&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;first&nbsp;named&nbsp;data&nbsp;member&nbsp;found&nbsp;by&nbsp;a&nbsp;pre-order,&nbsp;depth-first,&nbsp;declaration-order&nbsp;walk&nbsp;of&nbsp;the&nbsp;data&nbsp;members&nbsp;of&nbsp;the&nbsp;anonymous&nbsp;union.&quot;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Experimentation&nbsp;shows&nbsp;that&nbsp;Clang,&nbsp;GCC,&nbsp;and&nbsp;EDG&nbsp;interpret&nbsp;this&nbsp;as&nbsp;applying&nbsp;to&nbsp;the&nbsp;implicit&nbsp;object&nbsp;of&nbsp;anonymous&nbsp;union&nbsp;type,&nbsp;not&nbsp;to&nbsp;the&nbsp;anonymous&nbsp;union&nbsp;(type)&nbsp;itself.&nbsp;If&nbsp;that&#39;s&nbsp;the&nbsp;intent,&nbsp;we&nbsp;should&nbsp;probably&nbsp;update&nbsp;the&nbsp;document&nbsp;to&nbsp;say&nbsp;that.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;5.1.6&nbsp;says:&nbsp;&quot;In&nbsp;case&nbsp;of&nbsp;unnamed&nbsp;local&nbsp;types&nbsp;(excluding&nbsp;unnamed&nbsp;types&nbsp;that&nbsp;have&nbsp;acquired&nbsp;a&nbsp;&quot;name&nbsp;for&nbsp;linkage&nbsp;purposes&quot;),&nbsp;the&nbsp;&quot;name&quot;&nbsp;the&nbsp;unqualified&nbsp;name&nbsp;is&nbsp;encoded&nbsp;as&nbsp;an&nbsp;&lt;unnamed-type-name&gt;&quot;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Sorry,&nbsp;I&nbsp;meant&nbsp;to&nbsp;quote&nbsp;this&nbsp;section&nbsp;of&nbsp;5.1.5&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&quot;Unnamed&nbsp;class,&nbsp;union,&nbsp;and&nbsp;enum&nbsp;types&nbsp;that&nbsp;aren&#39;t&nbsp;closure&nbsp;types,&nbsp;that&nbsp;haven&#39;t&nbsp;acquired&nbsp;a&nbsp;&quot;name&nbsp;for&nbsp;linkage&nbsp;purposes&quot;&nbsp;(through&nbsp;a&nbsp;typedef),&nbsp;&lt;b&gt;and&nbsp;that&nbsp;aren&#39;t&nbsp;anonymous&nbsp;union&nbsp;types&lt;/b&gt;,&nbsp;follow&nbsp;the&nbsp;same&nbsp;rule&nbsp;when&nbsp;they&nbsp;are&nbsp;defined&nbsp;in&nbsp;class&nbsp;scopes,&nbsp;with&nbsp;the&nbsp;underlying&nbsp;&lt;unqualified-name&gt;&nbsp;an&nbsp;&lt;unnamed-type-name&gt;&nbsp;of&nbsp;the&nbsp;form&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;&lt;unnamed-type-name&gt;&nbsp;::=&nbsp;Ut&nbsp;[&nbsp;&lt;nonnegative&nbsp;number&gt;&nbsp;]&nbsp;_&quot;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Thus,&nbsp;given:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;struct&nbsp;A&nbsp;{&nbsp;union&nbsp;{&nbsp;int&nbsp;n;&nbsp;};&nbsp;struct&nbsp;{}&nbsp;x;&nbsp;};&lt;/div&gt;&lt;div&gt;template&lt;int&nbsp;A::*&gt;&nbsp;struct&nbsp;X&nbsp;{};&lt;/div&gt;&lt;div&gt;void&nbsp;f(X&lt;&amp;A::n&gt;,&nbsp;decltype(A::x))&nbsp;{}&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...&nbsp;the&nbsp;mangling&nbsp;of&nbsp;&#39;f&#39;&nbsp;is _Z1f1XIXadL_ZN1A1n1nEEEENS0_Ut_E&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;I&nbsp;can&#39;t&nbsp;find&nbsp;any&nbsp;implementation&nbsp;that&nbsp;actually&nbsp;follows&nbsp;these&nbsp;rules.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Clang&nbsp;and&nbsp;GCC&nbsp;give&nbsp;the&nbsp;anonymous&nbsp;union&nbsp;an&nbsp;unnamed&nbsp;type&nbsp;mangling&nbsp;instead&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;union&nbsp;mangling,&nbsp;and&nbsp;give _Z1f1XIXadL_ZN1AUt_1nEEEENS0_Ut0_E&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;EDG&nbsp;follows&nbsp;the&nbsp;5.1.6&nbsp;rule&nbsp;but&nbsp;doesn&#39;t&nbsp;seem&nbsp;to&nbsp;implement&nbsp;the&nbsp;5.1.2&nbsp;rule,&nbsp;and&nbsp;instead&nbsp;gives _Z1f1XIXadL_ZN1A4__C11nEEEENS0_Ut_E&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&#39;s&nbsp;the&nbsp;purpose&nbsp;of&nbsp;the&nbsp;special&nbsp;case&nbsp;in&nbsp;5.1.2&nbsp;and&nbsp;5.1.6?&nbsp;The&nbsp;rules&nbsp;would&nbsp;be&nbsp;simpler&nbsp;and&nbsp;more&nbsp;uniform&nbsp;if&nbsp;we&nbsp;adopted&nbsp;the&nbsp;Clang&nbsp;and&nbsp;GCC&nbsp;behavior,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;seem&nbsp;to&nbsp;lose&nbsp;much&nbsp;by&nbsp;doing&nbsp;so.&nbsp;Thoughts?&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;It&nbsp;seems&nbsp;that&nbsp;the&nbsp;current&nbsp;behavior&nbsp;is:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Clang&nbsp;and&nbsp;GCC&nbsp;include&nbsp;anonymous&nbsp;unions&nbsp;in&nbsp;the&nbsp;unnamed&nbsp;type&nbsp;counting&nbsp;and&nbsp;mangling,&nbsp;ignoring&nbsp;the&nbsp;relevant&nbsp;part&nbsp;of&nbsp;5.1.5.&nbsp;This&nbsp;happens&nbsp;both&nbsp;within&nbsp;classes&nbsp;(as&nbsp;demonstrated&nbsp;above)&nbsp;and&nbsp;within&nbsp;functions:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt; &nbsp;template&lt;typename&nbsp;T&gt;&nbsp;int&nbsp;f(T&nbsp;*);&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt; &nbsp;void&nbsp;g()&nbsp;{&nbsp;union&nbsp;{&nbsp;int&nbsp;n&nbsp;=&nbsp;f(this);&nbsp;};&nbsp;}&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
EDG&nbsp;(and&nbsp;ICC)&nbsp;excludes&nbsp;anonymous&nbsp;unions&nbsp;from&nbsp;the&nbsp;unnamed&nbsp;type&nbsp;counting&nbsp;and&nbsp;mangling&nbsp;(per&nbsp;5.1.5),&nbsp;and&nbsp;instead&nbsp;uses&nbsp;some&nbsp;internal&nbsp;name&nbsp;(__C1,&nbsp;...)&nbsp;for&nbsp;the&nbsp;type.&lt;/div&gt;&lt;/div&gt;<br>

</tt>
