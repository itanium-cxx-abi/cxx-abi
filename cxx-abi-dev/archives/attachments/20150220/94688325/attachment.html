<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;Feb&nbsp;20,&nbsp;2015,&nbsp;at&nbsp;4:28&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@googlers.com&quot;&nbsp;class=&quot;&quot;&gt;richardsmith@googlers.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;20&nbsp;February&nbsp;2015&nbsp;at&nbsp;15:51,&nbsp;John&nbsp;McCall&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;class=&quot;&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&gt;&nbsp;On&nbsp;Feb&nbsp;19,&nbsp;2015,&nbsp;at&nbsp;11:44&nbsp;PM,&nbsp;Dennis&nbsp;Handly&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dhandly@cup.hp.com&quot;&nbsp;class=&quot;&quot;&gt;dhandly@cup.hp.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&gt;&nbsp;From:&nbsp;David&nbsp;Majnemer&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:david.majnemer@gmail.com&quot;&nbsp;class=&quot;&quot;&gt;david.majnemer@gmail.com&lt;/a&gt;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&gt;&nbsp;It&nbsp;seems&nbsp;that&nbsp;the&nbsp;ABI&nbsp;has&nbsp;no&nbsp;means&nbsp;to&nbsp;mangle&nbsp;the&nbsp;contents&nbsp;of&nbsp;string&nbsp;constants.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;Why&nbsp;is&nbsp;that&nbsp;needed?&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;The&nbsp;current&nbsp;scheme&nbsp;is&nbsp;to&nbsp;just&nbsp;number&nbsp;the&nbsp;constants&nbsp;in&nbsp;order.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;And&nbsp;that&nbsp;handles&nbsp;both&nbsp;strings&nbsp;and&nbsp;wide&nbsp;strings.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&gt;&nbsp;And&nbsp;by&nbsp;the&nbsp;ODR&nbsp;rule&nbsp;the&nbsp;inlines&nbsp;must&nbsp;be&nbsp;the&nbsp;same.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/span&gt;I&nbsp;think&nbsp;this&nbsp;is&nbsp;what&nbsp;David&nbsp;means&nbsp;by&nbsp;numbering&nbsp;like&nbsp;a&nbsp;reference&nbsp;temporary.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
To&nbsp;the&nbsp;extent&nbsp;that&nbsp;this&nbsp;is&nbsp;needed,&nbsp;I&nbsp;agree&nbsp;with&nbsp;you&nbsp;that&nbsp;that’s&nbsp;the&nbsp;right&nbsp;solution:&nbsp;string&nbsp;literals&nbsp;should&nbsp;be&nbsp;mangled&nbsp;in&nbsp;the&nbsp;same&nbsp;sequence&nbsp;as&nbsp;reference&nbsp;temporaries.&nbsp;&nbsp;(Which&nbsp;already&nbsp;applies&nbsp;to&nbsp;more&nbsp;than&nbsp;just&nbsp;reference&nbsp;temporaries&nbsp;anyway,&nbsp;since&nbsp;the&nbsp;same&nbsp;concept&nbsp;of&nbsp;lifetime&nbsp;extension&nbsp;applies&nbsp;to&nbsp;std::initializer_list&nbsp;temporaries.)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
I&nbsp;have&nbsp;some&nbsp;of&nbsp;the&nbsp;same&nbsp;concerns&nbsp;here&nbsp;as&nbsp;I&nbsp;do&nbsp;with&nbsp;guaranteeing&nbsp;the&nbsp;uniqueness&nbsp;of&nbsp;string&nbsp;literals&nbsp;within&nbsp;inline&nbsp;functions:&nbsp;I&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;language&nbsp;isn’t&nbsp;accidentally&nbsp;promising&nbsp;something&nbsp;that&nbsp;grotesquely&nbsp;affects&nbsp;performance&nbsp;far&nbsp;out&nbsp;of&nbsp;proportion&nbsp;to&nbsp;its&nbsp;utility&nbsp;to&nbsp;the&nbsp;programmer.&nbsp;&nbsp;It&nbsp;would&nbsp;be&nbsp;very&nbsp;unfortunate&nbsp;if&nbsp;we,&nbsp;say,&nbsp;introduced&nbsp;thousands&nbsp;of&nbsp;new&nbsp;global&nbsp;weak&nbsp;symbols&nbsp;just&nbsp;to&nbsp;unique&nbsp;the&nbsp;strings&nbsp;used&nbsp;by&nbsp;assertions.&nbsp;&nbsp;We&nbsp;can&nbsp;take&nbsp;things&nbsp;like&nbsp;this&nbsp;back&nbsp;to&nbsp;the&nbsp;committee&nbsp;if&nbsp;necessary.&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
But&nbsp;if&nbsp;we&nbsp;can&nbsp;restrict&nbsp;this&nbsp;guarantee&nbsp;to&nbsp;string&nbsp;literals&nbsp;that&nbsp;appear&nbsp;in&nbsp;reference-temporary-like&nbsp;positions&nbsp;in&nbsp;constexpr&nbsp;initializers,&nbsp;I&nbsp;think&nbsp;it’s&nbsp;reasonable&nbsp;enough.&lt;/blockquote&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;We&nbsp;can't.&nbsp;Consider:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;constexpr&nbsp;const&nbsp;char&nbsp;*f(const&nbsp;char&nbsp;*p)&nbsp;{&nbsp;return&nbsp;p;&nbsp;}&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;constexpr&nbsp;const&nbsp;char&nbsp;*g()&nbsp;{&nbsp;return&nbsp;&quot;foo&quot;;&nbsp;}&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;struct&nbsp;X&nbsp;{&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;constexpr&nbsp;static&nbsp;const&nbsp;char&nbsp;*p&nbsp;=&nbsp;&quot;foo&quot;,&nbsp;//&nbsp;ok&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;*q&nbsp;=&nbsp;f(&quot;foo&quot;),&nbsp;//&nbsp;not&nbsp;in&nbsp;a&nbsp;&quot;reference-temporary-like&quot;&nbsp;position&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;*r&nbsp;=&nbsp;g();&nbsp;//&nbsp;string&nbsp;literal&nbsp;is&nbsp;not&nbsp;even&nbsp;lexically&nbsp;within&nbsp;the&nbsp;initializer&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;};&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Yeah,&nbsp;I&nbsp;thought&nbsp;about&nbsp;this&nbsp;a&nbsp;bit&nbsp;too&nbsp;late.&nbsp;&nbsp;There&nbsp;are&nbsp;two&nbsp;ways&nbsp;to&nbsp;salvage&nbsp;the&nbsp;idea:&nbsp;mark&nbsp;string&nbsp;literals&nbsp;by&nbsp;position&nbsp;as&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;actual&nbsp;constexpr&nbsp;result,&nbsp;or&nbsp;just&nbsp;don’t&nbsp;promise&nbsp;anything&nbsp;in&nbsp;this&nbsp;case.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Another&nbsp;concern&nbsp;with&nbsp;widespread&nbsp;string-literal&nbsp;mangling&nbsp;that&nbsp;occurs&nbsp;to&nbsp;me&nbsp;is&nbsp;whether&nbsp;it&nbsp;will&nbsp;completely&nbsp;defeat&nbsp;ordinary&nbsp;string-literal&nbsp;sharing.&nbsp;&nbsp;To&nbsp;do&nbsp;this&nbsp;feature&nbsp;optimally,&nbsp;we&nbsp;would&nbsp;need…&nbsp;in&nbsp;ELF&nbsp;terms,&nbsp;what,&nbsp;a&nbsp;COMDAT&nbsp;alias&nbsp;(?)&nbsp;into&nbsp;the&nbsp;string&nbsp;literal&nbsp;section?&nbsp;&nbsp;&nbsp;This&nbsp;might&nbsp;be&nbsp;pushing&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;supported&nbsp;linker&nbsp;behavior&nbsp;a&nbsp;lot.&nbsp;&nbsp;If&nbsp;we&nbsp;have&nbsp;to&nbsp;emit&nbsp;separate,&nbsp;unmergeable&nbsp;string&nbsp;literal&nbsp;objects&nbsp;just&nbsp;because&nbsp;they&nbsp;were&nbsp;used&nbsp;in&nbsp;a&nbsp;constexpr,&nbsp;that&nbsp;would&nbsp;be&nbsp;a&nbsp;disaster.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;John.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
