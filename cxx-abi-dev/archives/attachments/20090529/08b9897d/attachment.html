<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;May&nbsp;29,&nbsp;2009,&nbsp;at&nbsp;11:07&nbsp;AM,&nbsp;Sean&nbsp;Perry&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;p&gt;The&nbsp;C&nbsp;linkage&nbsp;would&nbsp;be&nbsp;a&nbsp;problem&nbsp;on&nbsp;platforms&nbsp;that&nbsp;use&nbsp;a&nbsp;different&nbsp;calling.&nbsp;&nbsp;The&nbsp;compiler&nbsp;is&nbsp;going&nbsp;to&nbsp;generate&nbsp;code&nbsp;that&nbsp;assumes&nbsp;the&nbsp;functions&nbsp;pointed&nbsp;to&nbsp;by&nbsp;the&nbsp;virtual&nbsp;function&nbsp;table&nbsp;have&nbsp;C++&nbsp;linkage.&nbsp;&nbsp;These&nbsp;functions&nbsp;should&nbsp;have&nbsp;C++&nbsp;linkage&nbsp;too.&lt;br&gt;&lt;/p&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;thought&nbsp;crossed&nbsp;my&nbsp;mind,&nbsp;and&nbsp;then&nbsp;I&nbsp;dismissed&nbsp;it&nbsp;because&nbsp;__cxa_pure_virtual&nbsp;is&nbsp;already&nbsp;that&nbsp;way.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;the&nbsp;API&nbsp;functions&nbsp;should&nbsp;keep&nbsp;C&nbsp;linkage,&nbsp;but&nbsp;the&nbsp;vtable&nbsp;should&nbsp;be&nbsp;allowed&nbsp;to&nbsp;point&nbsp;to&nbsp;a&nbsp;wrapper&nbsp;for&nbsp;these&nbsp;functions&nbsp;with&nbsp;C++&nbsp;linkage.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;that&nbsp;work?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;Daveed&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;p&gt;&nbsp;&lt;br&gt;&nbsp;--&lt;br&gt;&nbsp;Sean&nbsp;Perry&lt;br&gt;&nbsp;Compiler&nbsp;Development&lt;br&gt;&nbsp;IBM&nbsp;Canada&nbsp;Lab&lt;br&gt;&nbsp;(905)-413-6031&nbsp;(tie&nbsp;313-6031),&nbsp;fax&nbsp;(905)-413-4839&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;span&gt;&lt;graycol.gif&gt;&lt;/span&gt;Dennis&nbsp;Handly&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dhandly@cup.hp.com&quot;&gt;dhandly@cup.hp.com&lt;/a&gt;&gt;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;table&nbsp;width=&quot;100%&quot;&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;&nbsp;&lt;tbody&gt;&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;style=&quot;background-image:url(cid:2__=0ABBFF56DFC106858f9e8a93df938@ca.ibm.com);&nbsp;background-repeat:&nbsp;no-repeat;&nbsp;&quot;&nbsp;width=&quot;40%&quot;&gt;&nbsp;&lt;ul&gt;&nbsp;&lt;ul&gt;&nbsp;&lt;ul&gt;&nbsp;&lt;ul&gt;&lt;b&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;Dennis&nbsp;Handly&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:dhandly@cup.hp.com&quot;&gt;dhandly@cup.hp.com&lt;/a&gt;&gt;&lt;/font&gt;&lt;/b&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;p&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;05/28/2009&nbsp;10:07&nbsp;PM&lt;/font&gt;&lt;/p&gt;&lt;/ul&gt;&nbsp;&lt;/ul&gt;&nbsp;&lt;/ul&gt;&nbsp;&lt;/ul&gt;&nbsp;&lt;/td&gt;&lt;td&nbsp;width=&quot;60%&quot;&gt;&nbsp;&lt;table&nbsp;width=&quot;100%&quot;&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;&nbsp;&lt;tbody&gt;&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;div&nbsp;align=&quot;right&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;To&lt;/font&gt;&lt;/div&gt;&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;a&nbsp;href=&quot;mailto:jason@redhat.com&quot;&gt;jason@redhat.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;mailto:mark@codesourcery.com&quot;&gt;mark@codesourcery.com&lt;/a&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&nbsp;&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;div&nbsp;align=&quot;right&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;cc&lt;/font&gt;&lt;/div&gt;&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;a&nbsp;href=&quot;mailto:cxx-abi-dev@codesourcery.com&quot;&gt;cxx-abi-dev@codesourcery.com&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=&quot;mailto:daveed@edg.com&quot;&gt;daveed@edg.com&lt;/a&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&nbsp;&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;1%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;div&nbsp;align=&quot;right&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;Subject&lt;/font&gt;&lt;/div&gt;&lt;/td&gt;&lt;td&nbsp;width=&quot;100%&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;br&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&gt;Re:&nbsp;[cxx-abi-dev]&nbsp;Deleted&nbsp;virtual&nbsp;functions&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&nbsp;&lt;/tbody&gt;&lt;/table&gt;&nbsp;&lt;table&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;&nbsp;&lt;tbody&gt;&lt;tr&nbsp;valign=&quot;top&quot;&gt;&lt;td&nbsp;width=&quot;58&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;/td&gt;&lt;td&nbsp;width=&quot;336&quot;&gt;&lt;span&gt;&lt;ecblank.gif&gt;&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&nbsp;&lt;/tbody&gt;&lt;/table&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;&nbsp;&lt;/tbody&gt;&lt;/table&gt;&nbsp;&lt;br&gt;&nbsp;&lt;tt&gt;Looks&nbsp;good.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&gt;From:&nbsp;David&nbsp;Vandevoorde&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:daveed@edg.com&quot;&gt;daveed@edg.com&lt;/a&gt;&gt;&lt;br&gt;&nbsp;&gt;I&nbsp;noticed&nbsp;that&nbsp;there&nbsp;isn't&nbsp;actually&nbsp;a&nbsp;requirement&nbsp;to&nbsp;point&nbsp;virtual&nbsp;&nbsp;&lt;br&gt;&nbsp;&gt;table&nbsp;entried&nbsp;for&nbsp;pure&nbsp;virtual&nbsp;functions&nbsp;at&nbsp;__cxa_pure_virtual.&nbsp;&nbsp;Is&nbsp;&nbsp;&lt;br&gt;&nbsp;&gt;that&nbsp;intentional&nbsp;or&nbsp;just&nbsp;sloppy&nbsp;wording?&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Well,&nbsp;why&nbsp;have&nbsp;__cxa_pure_virtual&nbsp;without&nbsp;using&nbsp;it?&nbsp;&nbsp;;-)&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;suggestion&nbsp;for&nbsp;the&nbsp;signature&nbsp;for&nbsp;__cxa_pure_virtual&nbsp;and&nbsp;the&nbsp;new&lt;br&gt;&nbsp;__cxa_deleted_virtual:&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;extern&nbsp;&quot;C&quot;&nbsp;void&nbsp;__cxa_deleted_virtual(void&nbsp;*this_ptr);&lt;br&gt;&nbsp;extern&nbsp;&quot;C&quot;&nbsp;void&nbsp;__cxa_pure_virtual(void&nbsp;*this_ptr);&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Where&nbsp;this_ptr&nbsp;can&nbsp;be&nbsp;cast&nbsp;to&nbsp;a&nbsp;dummy&nbsp;polymorphic&nbsp;class&nbsp;to&nbsp;get&nbsp;the&nbsp;class&lt;br&gt;&nbsp;name&nbsp;to&nbsp;print&nbsp;a&nbsp;nicer&nbsp;message:&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;//&nbsp;A&nbsp;dummy&nbsp;polymorphic&nbsp;class&nbsp;to&nbsp;make&nbsp;typeid()&nbsp;do&nbsp;the&nbsp;work&nbsp;below.&lt;br&gt;&nbsp;class&nbsp;pv_dummy&nbsp;{&lt;br&gt;&nbsp;public:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;dummy_func();&lt;br&gt;&nbsp;};&lt;br&gt;&nbsp;extern&nbsp;&quot;C&quot;&nbsp;{&lt;br&gt;&nbsp;extern&nbsp;void&nbsp;abort();&lt;br&gt;&nbsp;void&nbsp;__cxa_pure_virtual&nbsp;(void&nbsp;*this_ptr)&lt;br&gt;&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;pv_dummy&nbsp;*obj&nbsp;=&nbsp;(pv_dummy*)this_ptr;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*mangled_name&nbsp;=&nbsp;typeid(*obj).name();&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*demangled_name&nbsp;=&nbsp;abi::__cxa_demangle(mangled_name,&nbsp;0,&nbsp;0,&nbsp;0);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!demangled_name)&nbsp;&nbsp;//&nbsp;out&nbsp;of&nbsp;space?&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;demangled_name&nbsp;=&nbsp;mangled_name;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;aCC&nbsp;runtime:&nbsp;pure&nbsp;virtual&nbsp;function&nbsp;called&nbsp;for&nbsp;class&nbsp;\&quot;%s\&quot;.&lt;br&gt;&nbsp;\n&quot;,&nbsp;demangled_name);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;abort();&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;}&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;--Apple-Mail-17--1051914877&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filename=deleted_funcs.diffs&lt;br&gt;&nbsp;+&nbsp;&lt;li&gt;If&nbsp;C::f&nbsp;is&nbsp;a&nbsp;pure&nbsp;virtual&nbsp;function,&nbsp;the&nbsp;corresponding&nbsp;virtual&nbsp;table&lt;br&gt;&nbsp;+&nbsp;entry&nbsp;may&nbsp;point&nbsp;to&nbsp;__cxa_pure_virtual&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Did&nbsp;you&nbsp;want&nbsp;to&nbsp;explain&nbsp;why&nbsp;you&nbsp;used&nbsp;&quot;may&quot;?&lt;br&gt;&nbsp;Is&nbsp;this&nbsp;the&nbsp;case&nbsp;of&nbsp;declaring&nbsp;it&nbsp;pure&nbsp;but&nbsp;still&nbsp;having&nbsp;a&nbsp;definition?&lt;br&gt;&nbsp;(for&nbsp;the&nbsp;destructor)&lt;br&gt;&nbsp;&lt;/tt&gt;&lt;br&gt;&nbsp;&lt;/p&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
