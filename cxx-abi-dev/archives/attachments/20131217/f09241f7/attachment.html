<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Dec&nbsp;16,&nbsp;2013,&nbsp;at&nbsp;8:10&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Consider:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;void&nbsp;g(...);&lt;div&gt;&nbsp;&nbsp;template&lt;int...N&gt;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*f()&nbsp;{&nbsp;g(&quot;foo&quot;&nbsp;+&nbsp;N&nbsp;...);&nbsp;return&nbsp;&quot;bar&quot;;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;const&nbsp;char&nbsp;*p&nbsp;=&nbsp;f();&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&nbsp;const&nbsp;char&nbsp;*q&nbsp;=&nbsp;f&lt;0&gt;();&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;const&nbsp;char&nbsp;*r&nbsp;=&nbsp;f&lt;0,&nbsp;1&gt;();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;f&lt;&gt;,&nbsp;what&nbsp;is&nbsp;the&nbsp;mangling&nbsp;of&nbsp;the&nbsp;&quot;bar&quot;&nbsp;string&nbsp;literal?&nbsp;Is&nbsp;this&nbsp;the&nbsp;first&nbsp;string&nbsp;literal&nbsp;or&nbsp;the&nbsp;second?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;it&nbsp;has&nbsp;to&nbsp;be&nbsp;the&nbsp;second.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;The&nbsp;ABI&nbsp;document&nbsp;says&nbsp;&quot;In&nbsp;all&nbsp;cases&nbsp;the&nbsp;numbering&nbsp;order&nbsp;is&nbsp;strictly&nbsp;lexical&nbsp;order&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;token&nbsp;sequence&quot;,&nbsp;but&nbsp;it's&nbsp;not&nbsp;obvious&nbsp;what&nbsp;that&nbsp;would&nbsp;mean&nbsp;for&nbsp;a&nbsp;template&nbsp;instantiation&nbsp;that&nbsp;discards&nbsp;tokens,&nbsp;as&nbsp;this&nbsp;one&nbsp;does.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Why&nbsp;would&nbsp;it&nbsp;mean&nbsp;something&nbsp;different&nbsp;if&nbsp;you&nbsp;discard&nbsp;tokens?&nbsp;&nbsp;The&nbsp;internal&nbsp;representation&nbsp;probably&nbsp;still&nbsp;knows&nbsp;there&nbsp;was&nbsp;a&nbsp;string&nbsp;literal&nbsp;involved&nbsp;and&nbsp;could&nbsp;associate&nbsp;a&nbsp;discriminating&nbsp;sequence&nbsp;number&nbsp;with&nbsp;it,&nbsp;no?&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&nbsp;Now&nbsp;consider:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;template&lt;int...N&gt;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*h()&nbsp;{&nbsp;g([]{return&nbsp;&quot;foo&quot;;}()&nbsp;+&nbsp;N&nbsp;...);&nbsp;return&nbsp;&quot;bar&quot;;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;const&nbsp;char&nbsp;*p&nbsp;=&nbsp;h();&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;const&nbsp;char&nbsp;*q&nbsp;=&nbsp;h&lt;0&gt;();&lt;/div&gt;&lt;div&gt;<br>
&nbsp;&nbsp;const&nbsp;char&nbsp;*r&nbsp;=&nbsp;h&lt;0,&nbsp;1&gt;();&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;happens&nbsp;here?&nbsp;Does&nbsp;the&nbsp;string&nbsp;literal&nbsp;inside&nbsp;the&nbsp;lambda&nbsp;get&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;outer&nbsp;function&nbsp;as&nbsp;well&nbsp;as&nbsp;a&nbsp;number&nbsp;within&nbsp;the&nbsp;lambda?&nbsp;It&nbsp;appears&nbsp;within&nbsp;the&nbsp;original&nbsp;token&nbsp;sequence...&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree&nbsp;the&nbsp;spec&nbsp;misses&nbsp;this,&nbsp;but&nbsp;I&nbsp;think&nbsp;numbering&nbsp;should&nbsp;not&nbsp;include&nbsp;literals&nbsp;(or&nbsp;other&nbsp;entities)&nbsp;that&nbsp;are&nbsp;in&nbsp;a&nbsp;nested&nbsp;body&nbsp;function.&nbsp;&nbsp;I.e.,&nbsp;&quot;bar&quot;&nbsp;would&nbsp;be&nbsp;the&nbsp;first&nbsp;string&nbsp;literal&nbsp;in&nbsp;all&nbsp;instances&nbsp;of&nbsp;h.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;EDG&nbsp;is&nbsp;the&nbsp;only&nbsp;vendor&nbsp;I&nbsp;can&nbsp;find&nbsp;that&nbsp;provides&nbsp;manglings&nbsp;for&nbsp;string&nbsp;literals&nbsp;at&nbsp;all,&nbsp;and&nbsp;its&nbsp;results&nbsp;here&nbsp;are&nbsp;surprising.&nbsp;It&nbsp;provides&nbsp;these&nbsp;manglings&nbsp;for&nbsp;&quot;bar&quot;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;f&lt;&gt;:&nbsp;_ZZ1fIJEEPKcvEs_0&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;f&lt;0&gt;:&nbsp;_ZZ1fIJLi0EEEPKcvEs_0&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;f&lt;0,&nbsp;1&gt;:&nbsp;_ZZ1fIJLi0ELi1EEEPKcvEs_0&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;These&nbsp;suggest&nbsp;that&nbsp;EDG&nbsp;includes&nbsp;&quot;foo&quot;&nbsp;in&nbsp;the&nbsp;numbering,&nbsp;even&nbsp;though&nbsp;it&nbsp;is&nbsp;not&nbsp;actually&nbsp;part&nbsp;of&nbsp;f&lt;&gt;.&nbsp;But&nbsp;then:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;h&lt;&gt;:&nbsp;_ZZ1hIJEEPKcvEs_0&lt;br&gt;&nbsp;&nbsp;h&lt;0&gt;:&nbsp;_ZZ1hIJLi0EEEPKcvEs&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;h&lt;0,&nbsp;1&gt;:&nbsp;_ZZ1hIJLi0ELi1EEEPKcvEs&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;These&nbsp;seem&nbsp;very&nbsp;surprising.&nbsp;&quot;foo&quot;&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;numbering&nbsp;*only*&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;it&nbsp;doesn't&nbsp;actually&nbsp;appear&nbsp;in&nbsp;the&nbsp;instantiated&nbsp;function&nbsp;body.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;suspect&nbsp;that's&nbsp;just&nbsp;a&nbsp;bug.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Suggestion:&nbsp;change&nbsp;in&nbsp;5.1.6:&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&quot;In&nbsp;all&nbsp;cases&nbsp;the&nbsp;numbering&nbsp;order&nbsp;is&nbsp;strictly&nbsp;lexical&nbsp;order&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;token&nbsp;sequence&lt;ins&gt;,&nbsp;excluding&nbsp;any&nbsp;tokens&nbsp;that&nbsp;are&nbsp;part&nbsp;of&nbsp;the&nbsp;body&nbsp;of&nbsp;a&nbsp;nested&nbsp;entity&lt;/ins&gt;.&nbsp;All&nbsp;entities&nbsp;occurring&nbsp;in&nbsp;that&nbsp;sequence&nbsp;are&nbsp;to&nbsp;be&nbsp;numbered,&nbsp;even&nbsp;if&nbsp;subsequent&nbsp;optimization&nbsp;&lt;ins&gt;or&nbsp;(in&nbsp;the&nbsp;case&nbsp;of&nbsp;a&nbsp;string&nbsp;literal)&nbsp;expansion&nbsp;of&nbsp;an&nbsp;empty&nbsp;parameter&nbsp;pack&lt;/ins&gt;&nbsp;makes&nbsp;some&nbsp;of&nbsp;them&nbsp;unnecessary.&quot;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;sounds&nbsp;good.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;would&nbsp;make&nbsp;EDG&nbsp;correct,&nbsp;except&nbsp;for&nbsp;the&nbsp;h&lt;&gt;&nbsp;case,&nbsp;where&nbsp;the&nbsp;mangling&nbsp;would&nbsp;be&nbsp;_ZZ1hIJEEPKcvEs&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Another&nbsp;related&nbsp;issue&nbsp;is&nbsp;with&nbsp;user-defined&nbsp;literals.&nbsp;If&nbsp;123_x&nbsp;appears&nbsp;in&nbsp;an&nbsp;inline&nbsp;function,&nbsp;and&nbsp;implicitly&nbsp;calls&nbsp;operator&quot;&quot;_x(&quot;123&quot;),&nbsp;the&nbsp;implicit&nbsp;string&nbsp;literal&nbsp;should&nbsp;(presumably)&nbsp;be&nbsp;assigned&nbsp;a&nbsp;mangling&nbsp;number.&nbsp;If&nbsp;it&nbsp;calls&nbsp;operator&quot;&quot;&quot;_x(123ULL),&nbsp;a&nbsp;mangling&nbsp;number&nbsp;should&nbsp;presumably&nbsp;not&nbsp;be&nbsp;assigned.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Ah&nbsp;yes,&nbsp;nice&nbsp;catch.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Suggestion:&nbsp;insert&nbsp;after&nbsp;previously-quoted&nbsp;text&nbsp;from&nbsp;5.1.6:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;If&nbsp;a&nbsp;user-defined-literal&nbsp;implicitly&nbsp;passes&nbsp;a&nbsp;string&nbsp;literal&nbsp;to&nbsp;a&nbsp;literal&nbsp;operator,&nbsp;the&nbsp;user-defined-literal&nbsp;token&nbsp;is&nbsp;numbered&nbsp;as&nbsp;if&nbsp;it&nbsp;were&nbsp;a&nbsp;string&nbsp;literal&nbsp;token.&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hmmm,&nbsp;would&nbsp;it&nbsp;be&nbsp;better&nbsp;to&nbsp;number&nbsp;all&nbsp;user-defined&nbsp;literals&nbsp;without&nbsp;having&nbsp;to&nbsp;worry&nbsp;about&nbsp;how&nbsp;they'll&nbsp;be&nbsp;transformed?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;Daveed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
