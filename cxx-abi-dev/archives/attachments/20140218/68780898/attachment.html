<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;On&nbsp;Feb&nbsp;18,&nbsp;2014,&nbsp;at&nbsp;8:02&nbsp;AM,&nbsp;Marshall&nbsp;Clow&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mclow.lists@gmail.com&quot;&gt;mclow.lists@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Feb&nbsp;17,&nbsp;2014,&nbsp;at&nbsp;10:50&nbsp;AM,&nbsp;John&nbsp;McCall&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;11px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;On&nbsp;Feb&nbsp;15,&nbsp;2014,&nbsp;at&nbsp;11:05&nbsp;AM,&nbsp;Marshall&nbsp;Clow&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mclow.lists@gmail.com&quot;&gt;mclow.lists@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Specifically:&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;libc++&nbsp;&amp;&nbsp;libc++abi&nbsp;call&nbsp;the&nbsp;terminate&nbsp;handler&nbsp;that&nbsp;was&nbsp;active&nbsp;when&nbsp;the&nbsp;exception&nbsp;was&nbsp;created.&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;libstdc++&nbsp;and&nbsp;libsup++&nbsp;call&nbsp;the&nbsp;terminate&nbsp;handler&nbsp;that&nbsp;was&nbsp;installed&nbsp;when&nbsp;the&nbsp;exception&nbsp;was&nbsp;rethrown.&lt;br&gt;&lt;br&gt;Does&nbsp;the&nbsp;C++&nbsp;ABI&nbsp;document&nbsp;have&nbsp;anything&nbsp;to&nbsp;say&nbsp;about&nbsp;terminate&nbsp;handlers&nbsp;being&nbsp;updated&nbsp;while&nbsp;an&nbsp;exception&nbsp;is&nbsp;in&nbsp;flight?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;I&nbsp;would&nbsp;expect&nbsp;this&nbsp;to&nbsp;be&nbsp;controlled&nbsp;by&nbsp;the&nbsp;language&nbsp;standard,&nbsp;not&nbsp;by&nbsp;the&nbsp;ABI&nbsp;document.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;And&nbsp;yet&nbsp;it&nbsp;is&nbsp;spelled&nbsp;out&nbsp;in&nbsp;the&nbsp;ABI&nbsp;document&nbsp;in&nbsp;section&nbsp;2.2.2.1:&nbsp;(&lt;a&nbsp;href=&quot;http://mentorembedded.github.io/cxx-abi/abi-eh.html&quot;&gt;http://mentorembedded.github.io/cxx-abi/abi-eh.html&lt;/a&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;•&nbsp;The&nbsp;fields&nbsp;unexpectedHandler&nbsp;and&nbsp;terminateHandler&nbsp;contain&nbsp;pointers&nbsp;to&nbsp;the&nbsp;unexpected&nbsp;and&nbsp;terminate&nbsp;handlers&nbsp;at&nbsp;the&nbsp;point&nbsp;where&nbsp;the&nbsp;exception&nbsp;is&nbsp;thrown.&nbsp;The&nbsp;ISO&nbsp;C++&nbsp;Final&nbsp;Draft&nbsp;International&nbsp;Standard&nbsp;[lib.unexpected]&nbsp;(18.6.2.4)&nbsp;states&nbsp;that&nbsp;the&nbsp;handlers&nbsp;to&nbsp;be&nbsp;used&nbsp;are&nbsp;those&nbsp;active&nbsp;immediately&nbsp;after&nbsp;evaluating&nbsp;the&nbsp;throw&nbsp;argument.&nbsp;If&nbsp;destructors&nbsp;change&nbsp;the&nbsp;active&nbsp;handlers&nbsp;during&nbsp;unwinding,&nbsp;the&nbsp;new&nbsp;values&nbsp;are&nbsp;not&nbsp;used&nbsp;until&nbsp;unwinding&nbsp;is&nbsp;complete.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;To&nbsp;me,&nbsp;everything&nbsp;after&nbsp;the&nbsp;first&nbsp;sentence&nbsp;here&nbsp;is&nbsp;(1)&nbsp;explanatory&nbsp;and&nbsp;(2)&nbsp;deferring&nbsp;to&nbsp;the&nbsp;standard.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;11px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;Amusingly,&nbsp;the&nbsp;current&nbsp;standard&nbsp;is&nbsp;simply&nbsp;ungrammatical:&lt;br&gt;&nbsp;N3797&nbsp;[terminate]p1:&lt;br&gt;&nbsp;&nbsp;&nbsp;Called&nbsp;by&nbsp;the&nbsp;implementation&nbsp;when&nbsp;exception&nbsp;handling&nbsp;must&nbsp;be&nbsp;abandoned&lt;br&gt;&nbsp;&nbsp;&nbsp;for&nbsp;any&nbsp;of&nbsp;several&nbsp;reasons,&nbsp;in&nbsp;effect&nbsp;immediately&nbsp;after&nbsp;throwing&nbsp;the&nbsp;exception.&lt;br&gt;Clearly&nbsp;what’s&nbsp;“in&nbsp;effect”&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be&nbsp;the&nbsp;terminate_handler,&nbsp;but...&lt;br&gt;&lt;br&gt;As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell,&nbsp;this&nbsp;is&nbsp;a&nbsp;splice&nbsp;left&nbsp;over&nbsp;from&nbsp;a&nbsp;previous&nbsp;revision.&nbsp;&nbsp;e.g.&lt;br&gt;&nbsp;C++03&nbsp;[lib.terminate]p1:&lt;br&gt;&nbsp;&nbsp;&nbsp;Effect:&nbsp;Calls&nbsp;the&nbsp;terminate_handler&nbsp;function&nbsp;in&nbsp;effect&nbsp;immediately&nbsp;after&nbsp;evaluating&lt;br&gt;&nbsp;&nbsp;&nbsp;the&nbsp;throw-expression,&nbsp;if&nbsp;called&nbsp;by&nbsp;the&nbsp;implementation,&nbsp;or&nbsp;calls&nbsp;the&nbsp;current&lt;br&gt;&nbsp;&nbsp;&nbsp;terminate_handler&nbsp;function,&nbsp;if&nbsp;called&nbsp;by&nbsp;the&nbsp;program.&lt;br&gt;&lt;br&gt;Both&nbsp;standards&nbsp;are&nbsp;vague&nbsp;about&nbsp;*which*&nbsp;throw-expression&nbsp;is&nbsp;meant&nbsp;when&nbsp;more&lt;br&gt;than&nbsp;one&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;same&nbsp;exception&nbsp;object.&nbsp;&nbsp;If&nbsp;you&nbsp;can&nbsp;get&nbsp;the&lt;br&gt;committee&nbsp;to&nbsp;clarify,&nbsp;please&nbsp;ask&nbsp;them&nbsp;to&nbsp;consider&nbsp;what&nbsp;should&nbsp;happen&nbsp;with&lt;br&gt;std::rethrow_exception&nbsp;as&nbsp;well.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;This&nbsp;is&nbsp;LWG&nbsp;issue&nbsp;2088:&nbsp;&lt;a&nbsp;href=&quot;http://cplusplus.github.io/LWG/lwg-active.html#2088&quot;&gt;http://cplusplus.github.io/LWG/lwg-active.html#2088&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Apparently&nbsp;this&nbsp;was&nbsp;changed&nbsp;right&nbsp;before&nbsp;C++11&nbsp;was&nbsp;released&nbsp;(see&nbsp;N3242&nbsp;for&nbsp;the&nbsp;actual&nbsp;change),&nbsp;and&nbsp;it&nbsp;is&nbsp;(as&nbsp;you&nbsp;say)&nbsp;confused.&lt;/div&gt;&lt;div&gt;The&nbsp;editor’s&nbsp;comments&nbsp;in&nbsp;n3242&nbsp;reflect&nbsp;this&nbsp;confusion.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;what&nbsp;we&nbsp;have&nbsp;is&nbsp;that&nbsp;C++98/03&nbsp;specifies&nbsp;things&nbsp;one&nbsp;way,&nbsp;and&nbsp;C++11/14&nbsp;(arguably)&nbsp;a&nbsp;different&nbsp;way.&lt;/div&gt;&lt;div&gt;And&nbsp;libc++abi&nbsp;implements&nbsp;the&nbsp;C++03&nbsp;standard,&nbsp;and&nbsp;libsup++&nbsp;(4.8)&nbsp;implements&nbsp;the&nbsp;C++11&nbsp;standard.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;If&nbsp;the&nbsp;standard&nbsp;is&nbsp;now&nbsp;being&nbsp;changed&nbsp;to&nbsp;always&nbsp;use&nbsp;the&nbsp;current&nbsp;terminate_handler&nbsp;at&nbsp;the&nbsp;time&nbsp;that&nbsp;the&nbsp;terminate&nbsp;is&nbsp;triggered,&nbsp;then&nbsp;neither&nbsp;library&nbsp;is&nbsp;implementing&nbsp;it&nbsp;correctly,&nbsp;and&nbsp;in&nbsp;fact&nbsp;these&nbsp;fields&nbsp;in&nbsp;the&nbsp;exception&nbsp;info&nbsp;are&nbsp;now&nbsp;obsolete.&nbsp;&nbsp;That’s&nbsp;an&nbsp;explicit&nbsp;change&nbsp;in&nbsp;specified&nbsp;behavior,&nbsp;though,&nbsp;so&nbsp;I’m&nbsp;a&nbsp;little&nbsp;surprised&nbsp;by&nbsp;it.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;difference&nbsp;as&nbsp;you’ve&nbsp;described&nbsp;it&nbsp;is&nbsp;just&nbsp;that&nbsp;libsupc++&nbsp;is&nbsp;overwriting&nbsp;the&nbsp;handler&nbsp;fields&nbsp;on&nbsp;a&nbsp;rethrow&nbsp;(“throw;”),&nbsp;and&nbsp;libc++abi&nbsp;is&nbsp;not.&nbsp;&nbsp;CI&nbsp;2088&nbsp;actually&nbsp;doesn’t&nbsp;identify&nbsp;this&nbsp;as&nbsp;an&nbsp;ambiguity,&nbsp;but&nbsp;it&nbsp;seems&nbsp;to&nbsp;me&nbsp;to&nbsp;be&nbsp;the&nbsp;only&nbsp;truly&nbsp;unaddressed&nbsp;problem&nbsp;unless&nbsp;they’re&nbsp;really&nbsp;switching&nbsp;the&nbsp;semantics&nbsp;to&nbsp;always&nbsp;use&nbsp;the&nbsp;current&nbsp;handler.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;John.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
