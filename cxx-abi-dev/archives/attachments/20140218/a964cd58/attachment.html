<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=windows-1252&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Feb&nbsp;17,&nbsp;2014,&nbsp;at&nbsp;10:50&nbsp;AM,&nbsp;John&nbsp;McCall&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;11px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;On&nbsp;Feb&nbsp;15,&nbsp;2014,&nbsp;at&nbsp;11:05&nbsp;AM,&nbsp;Marshall&nbsp;Clow&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:mclow.lists@gmail.com&quot;&gt;mclow.lists@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Consider&nbsp;the&nbsp;following&nbsp;code&nbsp;(example&nbsp;from&nbsp;Stephen&nbsp;T.&nbsp;Lajavev)&lt;br&gt;&lt;br&gt;#include&nbsp;&lt;stdio.h&gt;&lt;br&gt;#include&nbsp;&lt;stdlib.h&gt;&lt;br&gt;#include&nbsp;&lt;exception&gt;&lt;br&gt;using&nbsp;namespace&nbsp;std;&lt;br&gt;&lt;br&gt;void&nbsp;MyTerminate()&nbsp;{&lt;br&gt;&nbsp;&nbsp;puts(&quot;MyTerminate()&quot;);&lt;br&gt;&nbsp;&nbsp;abort();&lt;br&gt;}&lt;br&gt;&lt;br&gt;int&nbsp;main()&nbsp;{&lt;br&gt;&nbsp;&nbsp;try&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;main()&nbsp;throwing&nbsp;int&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;5;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(int)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;int&nbsp;caught&nbsp;initially&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ifdef&nbsp;MEOW&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;calling&nbsp;set_terminate()&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_terminate(MyTerminate);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#endif&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;rethrowing&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;br&gt;&nbsp;&nbsp;}&nbsp;catch&nbsp;(int)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;puts(&quot;int&nbsp;caught&nbsp;again,&nbsp;calling&nbsp;terminate()&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminate();&lt;br&gt;&nbsp;&nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;[&nbsp;Tests&nbsp;on&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;Mavericks&nbsp;&nbsp;-&nbsp;g++11&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;“g++-4.8.2&nbsp;-std=c++11”&nbsp;]&lt;br&gt;&lt;br&gt;$&nbsp;clang++&nbsp;-std=c++11&nbsp;-stdlib=libc++&nbsp;-DMEOW&nbsp;meow.cpp&nbsp;&amp;&amp;&nbsp;./a.out&lt;br&gt;main()&nbsp;throwing&nbsp;int&lt;br&gt;int&nbsp;caught&nbsp;initially&lt;br&gt;calling&nbsp;set_terminate()&lt;br&gt;rethrowing&lt;br&gt;int&nbsp;caught&nbsp;again,&nbsp;calling&nbsp;terminate()&lt;br&gt;libc++abi.dylib:&nbsp;terminating&nbsp;with&nbsp;uncaught&nbsp;exception&nbsp;of&nbsp;type&nbsp;int&lt;br&gt;Abort&nbsp;trap:&nbsp;6&lt;br&gt;$&nbsp;g++11&nbsp;meow.cpp&nbsp;-DMEOW&nbsp;&amp;&amp;&nbsp;./a.out&lt;br&gt;main()&nbsp;throwing&nbsp;int&lt;br&gt;int&nbsp;caught&nbsp;initially&lt;br&gt;calling&nbsp;set_terminate()&lt;br&gt;rethrowing&lt;br&gt;int&nbsp;caught&nbsp;again,&nbsp;calling&nbsp;terminate()&lt;br&gt;MyTerminate()&lt;br&gt;Abort&nbsp;trap:&nbsp;6&lt;br&gt;$&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&nbsp;&lt;/span&gt;&lt;br&gt;&lt;br&gt;Specifically:&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;libc++&nbsp;&amp;&nbsp;libc++abi&nbsp;call&nbsp;the&nbsp;terminate&nbsp;handler&nbsp;that&nbsp;was&nbsp;active&nbsp;when&nbsp;the&nbsp;exception&nbsp;was&nbsp;created.&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;libstdc++&nbsp;and&nbsp;libsup++&nbsp;call&nbsp;the&nbsp;terminate&nbsp;handler&nbsp;that&nbsp;was&nbsp;installed&nbsp;when&nbsp;the&nbsp;exception&nbsp;was&nbsp;rethrown.&lt;br&gt;&lt;br&gt;Does&nbsp;the&nbsp;C++&nbsp;ABI&nbsp;document&nbsp;have&nbsp;anything&nbsp;to&nbsp;say&nbsp;about&nbsp;terminate&nbsp;handlers&nbsp;being&nbsp;updated&nbsp;while&nbsp;an&nbsp;exception&nbsp;is&nbsp;in&nbsp;flight?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;I&nbsp;would&nbsp;expect&nbsp;this&nbsp;to&nbsp;be&nbsp;controlled&nbsp;by&nbsp;the&nbsp;language&nbsp;standard,&nbsp;not&nbsp;by&nbsp;the&nbsp;ABI&nbsp;document.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;And&nbsp;yet&nbsp;it&nbsp;is&nbsp;spelled&nbsp;out&nbsp;in&nbsp;the&nbsp;ABI&nbsp;document&nbsp;in&nbsp;section&nbsp;2.2.2.1:&nbsp;(&lt;a&nbsp;href=&quot;http://mentorembedded.github.io/cxx-abi/abi-eh.html&quot;&gt;http://mentorembedded.github.io/cxx-abi/abi-eh.html&lt;/a&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;•&nbsp;The&nbsp;fields&nbsp;unexpectedHandler&nbsp;and&nbsp;terminateHandler&nbsp;contain&nbsp;pointers&nbsp;to&nbsp;the&nbsp;unexpected&nbsp;and&nbsp;terminate&nbsp;handlers&nbsp;at&nbsp;the&nbsp;point&nbsp;where&nbsp;the&nbsp;exception&nbsp;is&nbsp;thrown.&nbsp;The&nbsp;ISO&nbsp;C++&nbsp;Final&nbsp;Draft&nbsp;International&nbsp;Standard&nbsp;[lib.unexpected]&nbsp;(18.6.2.4)&nbsp;states&nbsp;that&nbsp;the&nbsp;handlers&nbsp;to&nbsp;be&nbsp;used&nbsp;are&nbsp;those&nbsp;active&nbsp;immediately&nbsp;after&nbsp;evaluating&nbsp;the&nbsp;throw&nbsp;argument.&nbsp;If&nbsp;destructors&nbsp;change&nbsp;the&nbsp;active&nbsp;handlers&nbsp;during&nbsp;unwinding,&nbsp;the&nbsp;new&nbsp;values&nbsp;are&nbsp;not&nbsp;used&nbsp;until&nbsp;unwinding&nbsp;is&nbsp;complete.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Of&nbsp;course,&nbsp;“the”&nbsp;FDIS&nbsp;refers&nbsp;to&nbsp;the&nbsp;2003&nbsp;one,&nbsp;and&nbsp;later,&nbsp;there&nbsp;was&nbsp;the&nbsp;2011&nbsp;one,&nbsp;and&nbsp;as&nbsp;of&nbsp;last&nbsp;week&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;not&nbsp;final)&nbsp;2014&nbsp;DIS.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;11px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;Amusingly,&nbsp;the&nbsp;current&nbsp;standard&nbsp;is&nbsp;simply&nbsp;ungrammatical:&lt;br&gt;&nbsp;N3797&nbsp;[terminate]p1:&lt;br&gt;&nbsp;&nbsp;&nbsp;Called&nbsp;by&nbsp;the&nbsp;implementation&nbsp;when&nbsp;exception&nbsp;handling&nbsp;must&nbsp;be&nbsp;abandoned&lt;br&gt;&nbsp;&nbsp;&nbsp;for&nbsp;any&nbsp;of&nbsp;several&nbsp;reasons,&nbsp;in&nbsp;effect&nbsp;immediately&nbsp;after&nbsp;throwing&nbsp;the&nbsp;exception.&lt;br&gt;Clearly&nbsp;what’s&nbsp;“in&nbsp;effect”&nbsp;is&nbsp;supposed&nbsp;to&nbsp;be&nbsp;the&nbsp;terminate_handler,&nbsp;but...&lt;br&gt;&lt;br&gt;As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell,&nbsp;this&nbsp;is&nbsp;a&nbsp;splice&nbsp;left&nbsp;over&nbsp;from&nbsp;a&nbsp;previous&nbsp;revision.&nbsp;&nbsp;e.g.&lt;br&gt;&nbsp;C++03&nbsp;[lib.terminate]p1:&lt;br&gt;&nbsp;&nbsp;&nbsp;Effect:&nbsp;Calls&nbsp;the&nbsp;terminate_handler&nbsp;function&nbsp;in&nbsp;effect&nbsp;immediately&nbsp;after&nbsp;evaluating&lt;br&gt;&nbsp;&nbsp;&nbsp;the&nbsp;throw-expression,&nbsp;if&nbsp;called&nbsp;by&nbsp;the&nbsp;implementation,&nbsp;or&nbsp;calls&nbsp;the&nbsp;current&lt;br&gt;&nbsp;&nbsp;&nbsp;terminate_handler&nbsp;function,&nbsp;if&nbsp;called&nbsp;by&nbsp;the&nbsp;program.&lt;br&gt;&lt;br&gt;Both&nbsp;standards&nbsp;are&nbsp;vague&nbsp;about&nbsp;*which*&nbsp;throw-expression&nbsp;is&nbsp;meant&nbsp;when&nbsp;more&lt;br&gt;than&nbsp;one&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;same&nbsp;exception&nbsp;object.&nbsp;&nbsp;If&nbsp;you&nbsp;can&nbsp;get&nbsp;the&lt;br&gt;committee&nbsp;to&nbsp;clarify,&nbsp;please&nbsp;ask&nbsp;them&nbsp;to&nbsp;consider&nbsp;what&nbsp;should&nbsp;happen&nbsp;with&lt;br&gt;std::rethrow_exception&nbsp;as&nbsp;well.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;This&nbsp;is&nbsp;LWG&nbsp;issue&nbsp;2088:&nbsp;&lt;a&nbsp;href=&quot;http://cplusplus.github.io/LWG/lwg-active.html#2088&quot;&gt;http://cplusplus.github.io/LWG/lwg-active.html#2088&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Apparently&nbsp;this&nbsp;was&nbsp;changed&nbsp;right&nbsp;before&nbsp;C++11&nbsp;was&nbsp;released&nbsp;(see&nbsp;N3242&nbsp;for&nbsp;the&nbsp;actual&nbsp;change),&nbsp;and&nbsp;it&nbsp;is&nbsp;(as&nbsp;you&nbsp;say)&nbsp;confused.&lt;/div&gt;&lt;div&gt;The&nbsp;editor’s&nbsp;comments&nbsp;in&nbsp;n3242&nbsp;reflect&nbsp;this&nbsp;confusion.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;what&nbsp;we&nbsp;have&nbsp;is&nbsp;that&nbsp;C++98/03&nbsp;specifies&nbsp;things&nbsp;one&nbsp;way,&nbsp;and&nbsp;C++11/14&nbsp;(arguably)&nbsp;a&nbsp;different&nbsp;way.&lt;/div&gt;&lt;div&gt;And&nbsp;libc++abi&nbsp;implements&nbsp;the&nbsp;C++03&nbsp;standard,&nbsp;and&nbsp;libsup++&nbsp;(4.8)&nbsp;implements&nbsp;the&nbsp;C++11&nbsp;standard.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;—&nbsp;Marshall&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
