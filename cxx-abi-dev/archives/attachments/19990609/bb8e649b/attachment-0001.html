<tt>
&lt;!doctype&nbsp;html&nbsp;public&nbsp;&quot;-//w3c//dtd&nbsp;html&nbsp;4.0&nbsp;transitional//en&quot;&gt;&lt;html&gt;&lt;head&gt;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;name=&quot;GENERATOR&quot;&nbsp;content=&quot;Mozilla/4.5&nbsp;[en]&nbsp;(X11;&nbsp;I;&nbsp;HP-UX&nbsp;B.10.20&nbsp;9000/715)&nbsp;[Netscape]&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;Virtual&nbsp;Tables&nbsp;in&nbsp;aCC&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;&lt;br&gt;This&nbsp;note&nbsp;describes&nbsp;the&nbsp;organization&nbsp;of&nbsp;&lt;i&gt;virtual&nbsp;tables&lt;/i&gt;&nbsp;(or&lt;i&gt;vtables&lt;/i&gt;)in&nbsp;aCC.&nbsp;These&nbsp;tables&nbsp;are&nbsp;used&nbsp;by&nbsp;the&nbsp;aCC&nbsp;object&nbsp;model&nbsp;for&nbsp;a&nbsp;variety&nbsp;ofpurposes:&lt;ol&gt;&lt;li&gt;Dispatching&nbsp;virtual&nbsp;function&nbsp;calls&lt;/li&gt;&lt;li&gt;Run-time&nbsp;type&nbsp;identification&nbsp;(RTTI)&nbsp;and&nbsp;dynamic&nbsp;casting&lt;/li&gt;&lt;li&gt;Location&nbsp;of&nbsp;virtual&nbsp;base&nbsp;classes&lt;/li&gt;&lt;/ol&gt;Each&nbsp;entry&nbsp;in&nbsp;a&nbsp;virtual&nbsp;table&nbsp;has&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;&lt;tt&gt;long&nbsp;int&lt;/tt&gt;&nbsp;and&nbsp;cancontain&nbsp;either&nbsp;an&nbsp;integer&nbsp;or&nbsp;a&nbsp;pointer.&lt;p&gt;Pointers&nbsp;to&nbsp;these&nbsp;tables&nbsp;are&nbsp;stored&nbsp;in&nbsp;objects&nbsp;as&nbsp;described&nbsp;in&nbsp;&lt;i&gt;&lt;a&nbsp;href=&quot;http://cllweb.cup.hp.com/acxx/aCC/Documentation/objectlayout.html&quot;&gt;TheLayout&nbsp;of&nbsp;Objects&nbsp;in&nbsp;aCC&lt;/a&gt;&lt;/i&gt;.&nbsp;In&nbsp;general,&nbsp;these&nbsp;pointers&nbsp;can&nbsp;pointto&nbsp;the&nbsp;middle&nbsp;of&nbsp;a&nbsp;table:&nbsp;we'll&nbsp;call&nbsp;this&nbsp;the&nbsp;&lt;i&gt;origin&lt;/i&gt;&nbsp;of&nbsp;the&nbsp;table.Entries&nbsp;at&nbsp;negative&nbsp;offsets&nbsp;of&nbsp;such&nbsp;an&nbsp;origin&nbsp;describe&nbsp;the&nbsp;layout&nbsp;of&nbsp;virtualbases&nbsp;in&nbsp;an&nbsp;object,&nbsp;while&nbsp;entries&nbsp;at&nbsp;non-negative&nbsp;offsets&nbsp;relate&nbsp;to&nbsp;virtualfunctions&nbsp;and&nbsp;type-information.&nbsp;The&nbsp;information&nbsp;at&nbsp;negative&nbsp;offsets&nbsp;ofthe&nbsp;origin&nbsp;of&nbsp;a&nbsp;table&nbsp;thus&nbsp;describes&nbsp;is&nbsp;relatively&nbsp;static&nbsp;since&nbsp;it&nbsp;thesame&nbsp;throughout&nbsp;the&nbsp;life-time&nbsp;of&nbsp;an&nbsp;object:&nbsp;it&nbsp;is&nbsp;determined&nbsp;by&nbsp;the&nbsp;typeof&nbsp;the&nbsp;complete&nbsp;object&nbsp;and&nbsp;does&nbsp;not&nbsp;change&nbsp;during&nbsp;construction&nbsp;and&nbsp;destruction.This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;information&nbsp;at&nbsp;non-negative&nbsp;offsets&nbsp;of&nbsp;the&nbsp;originof&nbsp;a&nbsp;table&nbsp;which&nbsp;describes&nbsp;the&nbsp;dynamic&nbsp;identity&nbsp;of&nbsp;an&nbsp;object:&nbsp;this&nbsp;identitychanges&nbsp;as&nbsp;the&nbsp;various&nbsp;parts&nbsp;of&nbsp;a&nbsp;complex&nbsp;object&nbsp;are&nbsp;constructed&nbsp;and&nbsp;destroyed.That&nbsp;``change''&nbsp;is&nbsp;achieved&nbsp;by&nbsp;having&nbsp;the&nbsp;object&nbsp;point&nbsp;to&nbsp;a&nbsp;sequence&nbsp;ofvirtual&nbsp;tables&nbsp;as&nbsp;it&nbsp;is&nbsp;constructed&nbsp;(and&nbsp;the&nbsp;reversed&nbsp;sequence&nbsp;as&nbsp;it&nbsp;isdestroyed).&nbsp;This&nbsp;sequence&nbsp;of&nbsp;tables&nbsp;is&nbsp;maintained&nbsp;in&nbsp;another&nbsp;static&nbsp;tablecalled&nbsp;&lt;i&gt;table&nbsp;of&nbsp;virtual&nbsp;tables&lt;/i&gt;&nbsp;or&nbsp;&lt;i&gt;VLDVTT&lt;/i&gt;.&lt;p&gt;Every&nbsp;complete&nbsp;object&nbsp;with&nbsp;virtual&nbsp;bases&nbsp;or&nbsp;virtual&nbsp;functions&nbsp;has&nbsp;atleast&nbsp;one&nbsp;pointer&nbsp;to&nbsp;a&nbsp;virtual&nbsp;table&nbsp;located&nbsp;in&nbsp;the&nbsp;first&nbsp;word&nbsp;of&nbsp;thatobject:&nbsp;the&nbsp;&lt;i&gt;primary&nbsp;vtable&lt;/i&gt;&nbsp;pointer.&nbsp;Other&nbsp;pointers&nbsp;to&nbsp;&lt;i&gt;secondaryvtables&lt;/i&gt;&nbsp;may&nbsp;also&nbsp;appear&nbsp;at&nbsp;positive&nbsp;offsets&nbsp;in&nbsp;the&nbsp;object&nbsp;if&nbsp;the&nbsp;objectuses&nbsp;multiple&nbsp;inheritance&nbsp;or&nbsp;virtual&nbsp;bases.&lt;h2&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;Identity&nbsp;Section&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;The&nbsp;entries&nbsp;at&nbsp;non-negative&nbsp;offsets&nbsp;of&nbsp;the&nbsp;origin&nbsp;of&nbsp;a&nbsp;virtual&nbsp;tableform&nbsp;the&nbsp;so-called&nbsp;&lt;i&gt;identity&nbsp;section&lt;/i&gt;&nbsp;of&nbsp;that&nbsp;table.&nbsp;These&nbsp;entriesare&nbsp;structured&nbsp;as&nbsp;follows:&lt;ul&gt;&lt;tt&gt;origin&nbsp;+&nbsp;0:&nbsp;zero&nbsp;(meant&nbsp;to&nbsp;be&nbsp;the&nbsp;meta-vtable&nbsp;pointer)&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;origin&nbsp;+&nbsp;1:&nbsp;offset&nbsp;from&nbsp;origin&nbsp;of&nbsp;complete&nbsp;object&nbsp;to&nbsp;this&nbsp;subobject(non-negative)&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;origin&nbsp;+&nbsp;2:&nbsp;pointer&nbsp;to&nbsp;std::type_info&nbsp;object&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;origin&nbsp;+&nbsp;3:&nbsp;pointer&nbsp;to&nbsp;duplicate&nbsp;and&nbsp;inaccessible&nbsp;base&nbsp;information&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;origin&nbsp;+&nbsp;4:&nbsp;plabel&nbsp;to&nbsp;virtual&nbsp;function&nbsp;or&nbsp;adjustor&nbsp;thunk&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;more&nbsp;such&nbsp;plabels&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;origin&nbsp;+&nbsp;N:&nbsp;zero&lt;/tt&gt;&lt;/ul&gt;The&nbsp;original&nbsp;design&nbsp;of&nbsp;aCC&nbsp;meant&nbsp;to&nbsp;have&nbsp;the&nbsp;first&nbsp;entry&nbsp;of&nbsp;the&nbsp;virtualtable&nbsp;point&nbsp;to&nbsp;a&nbsp;structure&nbsp;that&nbsp;would&nbsp;describe&nbsp;that&nbsp;table&nbsp;itself;&nbsp;however,this&nbsp;was&nbsp;not&nbsp;implemented&nbsp;and&nbsp;instead&nbsp;this&nbsp;entry&nbsp;is&nbsp;zero.&lt;p&gt;The&nbsp;second&nbsp;through&nbsp;fourth&nbsp;entry&nbsp;are&nbsp;used&nbsp;for&nbsp;RTTI.&nbsp;When&nbsp;applying&nbsp;theC++&nbsp;&lt;tt&gt;typeid&lt;/tt&gt;&nbsp;operator&nbsp;to&nbsp;a&nbsp;polymorphic&nbsp;object,&nbsp;the&nbsp;&lt;tt&gt;std::type_info&lt;/tt&gt;object&nbsp;pointed&nbsp;to&nbsp;by&nbsp;the&nbsp;third&nbsp;entry&nbsp;of&nbsp;the&nbsp;virtual&nbsp;table&nbsp;(&lt;tt&gt;origin&nbsp;+2&lt;/tt&gt;)&nbsp;is&nbsp;returned.&nbsp;This&nbsp;&lt;tt&gt;type_info&lt;/tt&gt;&nbsp;object&nbsp;also&nbsp;embeds&nbsp;a&nbsp;pointerto&nbsp;a&nbsp;table&nbsp;describing&nbsp;the&nbsp;base-classes&nbsp;for&nbsp;that&nbsp;type,&nbsp;which&nbsp;is&nbsp;useful&nbsp;bothfor&nbsp;the&nbsp;&lt;tt&gt;dynamic_cast&lt;/tt&gt;&nbsp;operator&nbsp;and&nbsp;for&nbsp;catching&nbsp;exceptions.&nbsp;Thebase-class&nbsp;table&nbsp;and&nbsp;&lt;tt&gt;type_info&lt;/tt&gt;&nbsp;structures&nbsp;are&nbsp;described&nbsp;elsewhere.&lt;p&gt;As&nbsp;it&nbsp;turns&nbsp;out,&nbsp;the&nbsp;base-class&nbsp;table&nbsp;and&nbsp;the&nbsp;&lt;tt&gt;type_info&lt;/tt&gt;&nbsp;structuresare&nbsp;not&nbsp;sufficient&nbsp;to&nbsp;implement&nbsp;the&nbsp;&lt;tt&gt;dynamic_cast&lt;/tt&gt;&nbsp;functionalityas&nbsp;required&nbsp;by&nbsp;the&nbsp;language&nbsp;definition.&nbsp;In&nbsp;particular,&nbsp;an&nbsp;additional&nbsp;mechanismis&nbsp;needed&nbsp;to&nbsp;find&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;complete&nbsp;object&nbsp;(in&nbsp;&lt;tt&gt;dynamic_cast&lt;void*&gt;&lt;/tt&gt;expressions)&nbsp;and&nbsp;another&nbsp;one&nbsp;to&nbsp;handle&nbsp;duplicate&nbsp;or&nbsp;inaccessible&nbsp;basesclasses&nbsp;(see&nbsp;further).&nbsp;The&nbsp;second&nbsp;entry&nbsp;provides&nbsp;a&nbsp;straightforward&nbsp;wayto&nbsp;recover&nbsp;the&nbsp;origin&nbsp;of&nbsp;an&nbsp;object,&nbsp;while&nbsp;the&nbsp;entry&nbsp;at&nbsp;&lt;tt&gt;origin&nbsp;+&nbsp;3&lt;/tt&gt;points&nbsp;to&nbsp;a&nbsp;structure&nbsp;that&nbsp;allows&nbsp;handling&nbsp;casting&nbsp;from/to&nbsp;duplicate&nbsp;orinaccessible&nbsp;bases.&lt;p&gt;Except&nbsp;for&nbsp;that&nbsp;last&nbsp;entry&nbsp;which&nbsp;is&nbsp;always&nbsp;zero,&nbsp;the&nbsp;remainder&nbsp;of&nbsp;thevtable&nbsp;contains&nbsp;plabels&nbsp;(pointers&nbsp;to&nbsp;the&nbsp;procedure,&nbsp;or&nbsp;if&nbsp;bit&nbsp;2^1&nbsp;is&nbsp;set,to&nbsp;a&nbsp;linkage&nbsp;table&nbsp;entry&nbsp;of&nbsp;that&nbsp;procedure)&nbsp;for&nbsp;the&nbsp;virtual&nbsp;functions&nbsp;definedor&nbsp;inherited&nbsp;by&nbsp;the&nbsp;class&nbsp;pointing&nbsp;to&nbsp;this&nbsp;virtual&nbsp;table.&nbsp;In&nbsp;the&nbsp;case&nbsp;ofmultiple&nbsp;inheritance&nbsp;where&nbsp;an&nbsp;inherited&nbsp;virtual&nbsp;function&nbsp;assumes&nbsp;a&nbsp;&lt;tt&gt;this&lt;/tt&gt;parameter&nbsp;that&nbsp;points&nbsp;to&nbsp;another&nbsp;part&nbsp;of&nbsp;the&nbsp;object,&nbsp;the&nbsp;adjustment&nbsp;ofthe&nbsp;&lt;tt&gt;this&lt;/tt&gt;-pointer&nbsp;is&nbsp;done&nbsp;by&nbsp;a&nbsp;stub&nbsp;called&nbsp;an&nbsp;&lt;i&gt;adjustor&nbsp;thunk&lt;/i&gt;:in&nbsp;that&nbsp;case,&nbsp;the&nbsp;plabel&nbsp;for&nbsp;that&nbsp;virtual&nbsp;function&nbsp;will&nbsp;point&nbsp;to&nbsp;that&nbsp;thunkrather&nbsp;than&nbsp;to&nbsp;the&nbsp;virtual&nbsp;function&nbsp;code&nbsp;itself.&lt;p&gt;For&nbsp;example:&lt;ul&gt;&lt;tt&gt;struct&nbsp;A&nbsp;{&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;a1();&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;};&lt;/tt&gt;&lt;p&gt;&lt;tt&gt;struct&nbsp;B&nbsp;{&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;b1();&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;};&lt;/tt&gt;&lt;p&gt;&lt;tt&gt;struct&nbsp;C:&nbsp;A,&nbsp;B&nbsp;{&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;b1();&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;}&nbsp;C_obj;&lt;/tt&gt;&lt;/ul&gt;The&nbsp;structure&nbsp;of&nbsp;&lt;tt&gt;C_obj&lt;/tt&gt;&nbsp;is&nbsp;as&nbsp;follows&nbsp;(see&nbsp;&lt;i&gt;&lt;a&nbsp;href=&quot;http://cllweb.cup.hp.com/acxx/aCC/Documentation/objectlayout.html&quot;&gt;TheLayout&nbsp;of&nbsp;Objects&nbsp;in&nbsp;aCC&lt;/a&gt;&lt;/i&gt;&nbsp;for&nbsp;details):&lt;ul&gt;&lt;tt&gt;&amp;C_obj&nbsp;+&nbsp;0:&nbsp;pointer&nbsp;to&nbsp;virtual&nbsp;table&nbsp;for&nbsp;C&nbsp;and&nbsp;A-in-C&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&amp;C_obj&nbsp;+&nbsp;4:&nbsp;pointer&nbsp;to&nbsp;virtual&nbsp;table&nbsp;for&nbsp;B-in-C&lt;/tt&gt;&lt;/ul&gt;If&nbsp;you&nbsp;have&nbsp;a&nbsp;pointer&nbsp;&lt;tt&gt;pb&lt;/tt&gt;&nbsp;to&nbsp;the&nbsp;&lt;tt&gt;B&lt;/tt&gt;&nbsp;subobject&nbsp;of&nbsp;&lt;tt&gt;C_obj&lt;/tt&gt;(i.e.,&nbsp;to&nbsp;&lt;tt&gt;&amp;C_obj&nbsp;+&nbsp;4&lt;/tt&gt;)and&nbsp;call&nbsp;&lt;tt&gt;pb-&gt;b1()&lt;/tt&gt;,&nbsp;the&nbsp;callmust&nbsp;be&nbsp;dispatched&nbsp;to&nbsp;&lt;tt&gt;C::b1&lt;/tt&gt;&nbsp;with&nbsp;&lt;tt&gt;this&nbsp;==&nbsp;pb&nbsp;-&nbsp;4&lt;/tt&gt;.&nbsp;Thisparameter&nbsp;adjustment&nbsp;(subtraction&nbsp;of&nbsp;4)&nbsp;is&nbsp;performed&nbsp;by&nbsp;the&nbsp;thunk.&lt;p&gt;Note&nbsp;that&nbsp;each&nbsp;virtual&nbsp;table&nbsp;only&nbsp;contains&nbsp;plabels&nbsp;for&nbsp;functions&nbsp;declaredin&nbsp;the&nbsp;subclass&nbsp;associated&nbsp;with&nbsp;that&nbsp;virtual&nbsp;table.&nbsp;Virtual&nbsp;tables&nbsp;associatedwith&nbsp;more&nbsp;than&nbsp;one&nbsp;class&nbsp;(because&nbsp;an&nbsp;object&nbsp;shares&nbsp;its&nbsp;virtual&nbsp;table&nbsp;pointerwith&nbsp;its&nbsp;primary&nbsp;base&nbsp;subobject)&nbsp;contains&nbsp;plabels&nbsp;for&nbsp;all&nbsp;the&nbsp;virtual&nbsp;memberfunctions&nbsp;declared&nbsp;in&nbsp;those&nbsp;classes&nbsp;(ordered&nbsp;from&nbsp;the&nbsp;deepest&nbsp;base&nbsp;classto&nbsp;the&nbsp;complete&nbsp;class).&nbsp;Within&nbsp;a&nbsp;subclass,&nbsp;plabels&nbsp;are&nbsp;ordered&nbsp;in&nbsp;the&nbsp;orderthe&nbsp;corresponding&nbsp;member&nbsp;functions&nbsp;were&nbsp;declared.&lt;br&gt;&nbsp;&lt;h2&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;Location&nbsp;of&nbsp;Bases&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;The&nbsp;location&nbsp;of&nbsp;non-virtual&nbsp;base&nbsp;subobjects&nbsp;inside&nbsp;an&nbsp;enclosingobject&nbsp;can&nbsp;be&nbsp;computed&nbsp;from&nbsp;the&nbsp;static&nbsp;type&nbsp;of&nbsp;that&nbsp;enclosing&nbsp;object.&nbsp;I.e.,the&nbsp;offset&nbsp;of&nbsp;the&nbsp;non-virtual&nbsp;subobject&nbsp;can&nbsp;be&nbsp;determined&nbsp;at&nbsp;compile-time.However,&nbsp;for&nbsp;virtual&nbsp;bases&nbsp;this&nbsp;location&nbsp;is&nbsp;determined&nbsp;by&nbsp;the&nbsp;complete,dynamic&nbsp;type&nbsp;of&nbsp;the&nbsp;object.&nbsp;Hence,&nbsp;there&nbsp;must&nbsp;be&nbsp;a&nbsp;mechanism&nbsp;to&nbsp;locateat&nbsp;run-time&nbsp;where&nbsp;a&nbsp;particular&nbsp;virtual&nbsp;base&nbsp;subobject&nbsp;is&nbsp;with&nbsp;respect&nbsp;toan&nbsp;enclosing&nbsp;object.&lt;p&gt;This&nbsp;information&nbsp;is&nbsp;stored&nbsp;at&nbsp;negative&nbsp;offsets&nbsp;from&nbsp;the&nbsp;origin&nbsp;of&nbsp;thevirtual&nbsp;table&nbsp;if&nbsp;that&nbsp;virtual&nbsp;table&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;class&nbsp;that&nbsp;hasvirtual&nbsp;bases.&nbsp;In&nbsp;that&nbsp;case,&nbsp;the&nbsp;entry&nbsp;at&nbsp;origin&nbsp;-&nbsp;1&nbsp;is&nbsp;zero.&nbsp;The&nbsp;entriesat&nbsp;origin&nbsp;-&nbsp;2&nbsp;to&nbsp;origin&nbsp;-&nbsp;M&nbsp;contain&nbsp;offsets&nbsp;(in&nbsp;bytes)&nbsp;to&nbsp;the&nbsp;virtual&nbsp;basesubobjects&nbsp;in&nbsp;a&nbsp;left-to-right,&nbsp;depth-first&nbsp;&lt;i&gt;postfix&nbsp;&lt;/i&gt;traversal&nbsp;ofthe&nbsp;hierarchy.&nbsp;Note&nbsp;that&nbsp;these&nbsp;offsets&nbsp;can&nbsp;be&nbsp;both&nbsp;negative&nbsp;and&nbsp;positive.Virtual&nbsp;tables&nbsp;with&nbsp;entries&nbsp;at&nbsp;negative&nbsp;offsets&nbsp;of&nbsp;the&nbsp;origin&nbsp;and&nbsp;virtualtables&nbsp;for&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;are&nbsp;called&nbsp;VLD&nbsp;virtual&nbsp;tables,&nbsp;whereVLD&nbsp;stands&nbsp;for&nbsp;&lt;i&gt;virtual-base&nbsp;location&nbsp;dependent&lt;/i&gt;.&lt;p&gt;Each&nbsp;base&nbsp;(virtual&nbsp;or&nbsp;not)&nbsp;has&nbsp;one&nbsp;or&nbsp;more&nbsp;&lt;i&gt;base-ordinals&lt;/i&gt;&nbsp;withrespect&nbsp;to&nbsp;an&nbsp;enclosing&nbsp;object:&nbsp;integers&nbsp;that&nbsp;identify&nbsp;a&nbsp;base&nbsp;subobjectwithin&nbsp;the&nbsp;designated&nbsp;enclosing&nbsp;object.&nbsp;The&nbsp;enclosing&nbsp;object&nbsp;itself&nbsp;isnumbered&nbsp;`0'&nbsp;(zero)&nbsp;and&nbsp;base&nbsp;classese&nbsp;are&nbsp;numbered&nbsp;using&nbsp;a&nbsp;left-to-right,depth-first&lt;i&gt;prefix&lt;/i&gt;traversal&nbsp;of&nbsp;the&nbsp;hierarchy.&nbsp;This&nbsp;traversal&nbsp;ignoresthe&nbsp;fact&nbsp;that&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;are&nbsp;shared&nbsp;and&nbsp;may&nbsp;therefore&nbsp;assignmore&nbsp;than&nbsp;one&nbsp;ordinal&nbsp;to&nbsp;a&nbsp;base-class:&nbsp;in&nbsp;those&nbsp;cases,&nbsp;the&nbsp;smallest&nbsp;assignedordinal&nbsp;is&nbsp;used.&nbsp;For&nbsp;example:&lt;ul&gt;&lt;tt&gt;struct&nbsp;P{&nbsp;virtual&nbsp;void&nbsp;f();&nbsp;};&lt;/tt&gt;&lt;p&gt;&lt;tt&gt;struct&nbsp;Q:&nbsp;virtual&nbsp;P{};&lt;/tt&gt;&lt;p&gt;&lt;tt&gt;struct&nbsp;R:&nbsp;virtual&nbsp;P{};&lt;/tt&gt;&lt;p&gt;&lt;tt&gt;struct&nbsp;S:&nbsp;P,&nbsp;Q,&nbsp;virtual&nbsp;R{};&lt;/tt&gt;&lt;/ul&gt;An&nbsp;object&nbsp;of&nbsp;class&nbsp;S&nbsp;would&nbsp;be&nbsp;organized&nbsp;along&nbsp;the&nbsp;lines&nbsp;of:&lt;ul&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;/v&nbsp;&nbsp;\v&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;P&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;R&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;\&nbsp;&nbsp;|&nbsp;&nbsp;/v&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;S&lt;/tt&gt;&lt;/ul&gt;With&nbsp;respect&nbsp;to&nbsp;S,&nbsp;the&nbsp;non-virtual&nbsp;base&nbsp;P&nbsp;would&nbsp;be&nbsp;assigned&nbsp;ordinal&nbsp;`1',the&nbsp;Q&nbsp;subobject&nbsp;would&nbsp;be&nbsp;`2',&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobject&nbsp;of&nbsp;type&nbsp;P&nbsp;wouldget&nbsp;numbers&nbsp;`3'&nbsp;(traversing&nbsp;from&nbsp;Q)&nbsp;and&nbsp;`5'&nbsp;(traversing&nbsp;from&nbsp;R)&nbsp;and&nbsp;R&nbsp;wouldbe&nbsp;number&nbsp;`4'.&lt;p&gt;The&nbsp;base-ordinal&nbsp;system&nbsp;is&nbsp;primarily&nbsp;used&nbsp;to&nbsp;encode&nbsp;unique&nbsp;names&nbsp;forthe&nbsp;various&nbsp;virtual&nbsp;tables&nbsp;produced&nbsp;by&nbsp;the&nbsp;compiler&nbsp;(i.e.,&nbsp;mangling).&lt;h2&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;Naming&nbsp;Virtual&nbsp;Tables&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;The&nbsp;construction&nbsp;of&nbsp;a&nbsp;single&nbsp;object&nbsp;may&nbsp;need&nbsp;dozens&nbsp;of&nbsp;virtual&nbsp;tableswith&nbsp;contents&nbsp;that&nbsp;differ&nbsp;from&nbsp;one&nbsp;another.&nbsp;Hence&nbsp;all&nbsp;these&nbsp;tables&nbsp;needto&nbsp;be&nbsp;accessible&nbsp;through&nbsp;unique&nbsp;names.&nbsp;Note&nbsp;that&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;vtable&nbsp;isalways&nbsp;associated&nbsp;with&nbsp;its&nbsp;first&nbsp;entry,&nbsp;which&nbsp;is&nbsp;not&nbsp;always&nbsp;the&nbsp;same&nbsp;asits&nbsp;&lt;i&gt;origin&nbsp;&lt;/i&gt;(specifically,&nbsp;when&nbsp;the&nbsp;table&nbsp;contain&nbsp;virtual&nbsp;base&nbsp;offsets).&lt;p&gt;A&nbsp;virtual&nbsp;table&nbsp;name&nbsp;is&nbsp;composed&nbsp;as&nbsp;follows:&lt;ul&gt;`&lt;tt&gt;[Vtable&lt;/tt&gt;'&nbsp;{`&lt;tt&gt;_&lt;/tt&gt;'&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;}&nbsp;{`&lt;tt&gt;.&lt;/tt&gt;'&lt;i&gt;identity&lt;/i&gt;}{`&lt;tt&gt;.&lt;/tt&gt;'&nbsp;&lt;i&gt;location&lt;/i&gt;}&nbsp;`&lt;tt&gt;]key:&lt;/tt&gt;'&nbsp;{&lt;i&gt;mangled-key-function&lt;/i&gt;}&lt;/ul&gt;Items&nbsp;in&nbsp;braces&nbsp;are&nbsp;optional,&nbsp;but&nbsp;there&nbsp;is&nbsp;always&nbsp;exactly&nbsp;one&nbsp;of&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;or&nbsp;&lt;i&gt;mangled-key-function&lt;/i&gt;.&nbsp;Items&nbsp;in&nbsp;quotes&nbsp;are&nbsp;inserted&nbsp;literallyin&nbsp;the&nbsp;name,&nbsp;without&nbsp;surrounding&nbsp;whitespace.&lt;p&gt;The&nbsp;&lt;i&gt;key-function&lt;/i&gt;&nbsp;of&nbsp;a&nbsp;class-type&nbsp;is&nbsp;the&nbsp;first&nbsp;non-inline&nbsp;virtualfunction&nbsp;declared&nbsp;in&nbsp;that&nbsp;type&nbsp;(i.e.,&nbsp;not&nbsp;just&nbsp;inherited).&nbsp;If&nbsp;a&nbsp;class&nbsp;hasa&nbsp;key-function,&nbsp;its&nbsp;virtual&nbsp;tables&nbsp;will&nbsp;be&nbsp;emitted&nbsp;in&nbsp;the&nbsp;translation&nbsp;unitthat&nbsp;contains&nbsp;the&nbsp;definition&nbsp;of&nbsp;the&nbsp;key-function&nbsp;and&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;virtualtables&nbsp;will&nbsp;have&nbsp;the&nbsp;form:&lt;ul&gt;`&lt;tt&gt;[Vtable&lt;/tt&gt;'&nbsp;{`&lt;tt&gt;.&lt;/tt&gt;'&nbsp;&lt;i&gt;identity&lt;/i&gt;}&nbsp;{`&lt;tt&gt;.&lt;/tt&gt;'&nbsp;&lt;i&gt;location&lt;/i&gt;}`&lt;tt&gt;]key:&lt;/tt&gt;'&nbsp;{&lt;i&gt;mangled-key-function&lt;/i&gt;}&lt;/ul&gt;Otherwise,&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;key-function,&nbsp;the&nbsp;vtables&nbsp;are&nbsp;emitted&nbsp;in&nbsp;eachtranslation&nbsp;unit&nbsp;that&nbsp;needs&nbsp;to&nbsp;access&nbsp;that&nbsp;name&nbsp;(the&nbsp;CTTI&nbsp;linkage&nbsp;mechanismeventually&nbsp;consolidates&nbsp;all&nbsp;those&nbsp;emitted&nbsp;copies&nbsp;into&nbsp;one).&nbsp;The&nbsp;name&nbsp;ofa&nbsp;vtable&nbsp;for&nbsp;a&nbsp;class&nbsp;without&nbsp;key-function&nbsp;(such&nbsp;as&nbsp;struct&nbsp;S&nbsp;above)&nbsp;hasthe&nbsp;form&lt;ul&gt;`&lt;tt&gt;[Vtable&lt;/tt&gt;'&nbsp;{`&lt;tt&gt;_&lt;/tt&gt;'&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;}&nbsp;{`&lt;tt&gt;.&lt;/tt&gt;'&lt;i&gt;identity&lt;/i&gt;}{`&lt;tt&gt;.&lt;/tt&gt;'&nbsp;&lt;i&gt;location&lt;/i&gt;}&nbsp;`&lt;tt&gt;]key:&lt;/tt&gt;'&lt;/ul&gt;where&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;&nbsp;is&nbsp;the&nbsp;mangled&nbsp;name&nbsp;of&nbsp;the&nbsp;class&nbsp;described&nbsp;bythis&nbsp;table.&lt;p&gt;Note&nbsp;that&nbsp;for&nbsp;virtual&nbsp;table&nbsp;pointers&nbsp;embedded&nbsp;inside&nbsp;virtual&nbsp;base&nbsp;subobjectsthe&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;&nbsp;or&nbsp;&lt;i&gt;mangled-key-function&lt;/i&gt;&nbsp;comes&nbsp;from&nbsp;the&nbsp;classtype&nbsp;that&nbsp;determines&nbsp;the&nbsp;structure&nbsp;of&nbsp;the&nbsp;object&nbsp;and&nbsp;not&nbsp;from&nbsp;the&nbsp;subobjecttype&nbsp;itself.&lt;p&gt;Once&nbsp;constructed,&nbsp;an&nbsp;object&nbsp;will&nbsp;have&nbsp;all&nbsp;its&nbsp;vtable&nbsp;pointers&nbsp;pointto&nbsp;vtables&nbsp;whose&nbsp;identity&nbsp;section&nbsp;has&nbsp;entries&nbsp;for&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;completeobject.&nbsp;These&nbsp;virtual&nbsp;tables&nbsp;do&nbsp;not&nbsp;contain&nbsp;the&nbsp;{`&lt;tt&gt;.&lt;/tt&gt;'&nbsp;&lt;i&gt;identity&lt;/i&gt;}component&nbsp;in&nbsp;their&nbsp;name.&nbsp;However,&nbsp;the&nbsp;C++&nbsp;language&nbsp;definition&nbsp;requiresthat&nbsp;during&nbsp;construction,&nbsp;the&nbsp;various&nbsp;subobjects&nbsp;exhibit&nbsp;the&nbsp;identity&nbsp;ofthe&nbsp;base&nbsp;class&nbsp;under&nbsp;construction.&nbsp;For&nbsp;subobjects&nbsp;that&nbsp;are&nbsp;part&nbsp;of&nbsp;virtualsubobjects,&nbsp;this&nbsp;requires&nbsp;specialized&nbsp;&lt;i&gt;construction&nbsp;vtables&lt;/i&gt;:&nbsp;theseencode&nbsp;the&nbsp;identity&nbsp;of&nbsp;a&nbsp;base-class,&nbsp;but&nbsp;the&nbsp;virtual&nbsp;base-layout&nbsp;withinthe&nbsp;complete&nbsp;object.&nbsp;Construction&nbsp;vtables&nbsp;are&nbsp;always&nbsp;VLD&nbsp;vtables.&nbsp;The&nbsp;&lt;i&gt;identity&lt;/i&gt;field&nbsp;of&nbsp;a&nbsp;construction&nbsp;vtable&nbsp;is&nbsp;encoded&nbsp;as&nbsp;the&nbsp;base-ordinal&nbsp;of&nbsp;the&nbsp;subobjectbeing&nbsp;constructed&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;complete&nbsp;object.&nbsp;For&nbsp;example,&nbsp;whilethe&nbsp;constructor&nbsp;of&nbsp;the&nbsp;class&nbsp;R&nbsp;above&nbsp;is&nbsp;building&nbsp;part&nbsp;of&nbsp;a&nbsp;complete&nbsp;objectof&nbsp;type&nbsp;S,&nbsp;the&nbsp;virtual&nbsp;base&nbsp;object&nbsp;of&nbsp;type&nbsp;P&nbsp;will&nbsp;have&nbsp;its&nbsp;first&nbsp;word&nbsp;pointto&nbsp;the&nbsp;construction&nbsp;vtable&nbsp;whose&nbsp;name&nbsp;is:&lt;ul&gt;&lt;tt&gt;[Vtable_1S.4.1]key:&lt;/tt&gt;&lt;/ul&gt;Indeed,&nbsp;S&nbsp;has&nbsp;no&nbsp;key-function&nbsp;(no&nbsp;virtual&nbsp;functions&nbsp;at&nbsp;all,&nbsp;in&nbsp;fact)&nbsp;andthe&nbsp;R&nbsp;subobject&nbsp;has&nbsp;base-ordinal&nbsp;`4'&nbsp;within&nbsp;S.&nbsp;The&nbsp;&lt;i&gt;location&nbsp;&lt;/i&gt;fieldin&nbsp;this&nbsp;name&nbsp;(`1'&nbsp;in&nbsp;this&nbsp;example)&nbsp;determines&nbsp;which&nbsp;subobject&nbsp;is&nbsp;pointingto&nbsp;this&nbsp;vtable.&nbsp;This&nbsp;location&nbsp;is&nbsp;encoded&nbsp;as&nbsp;the&nbsp;base-ordinal&nbsp;with&nbsp;respectto&nbsp;the&nbsp;subobject&nbsp;currently&nbsp;being&nbsp;constructed&nbsp;(the&nbsp;virtual&nbsp;subobject&nbsp;oftype&nbsp;P&nbsp;has&nbsp;ordinal&nbsp;`1'&nbsp;with&nbsp;respect&nbsp;to&nbsp;class&nbsp;R).&nbsp;Once&nbsp;the&nbsp;S&nbsp;object&nbsp;is&nbsp;fullyconstructed,&nbsp;this&nbsp;pointer&nbsp;will&nbsp;point&nbsp;to&nbsp;the&nbsp;virtual&nbsp;table&nbsp;whose&nbsp;name&nbsp;is:&lt;ul&gt;&lt;tt&gt;[Vtable_1S.3]key:&lt;/tt&gt;&lt;/ul&gt;because&nbsp;the&nbsp;virtual&nbsp;base&nbsp;P&nbsp;subobject&nbsp;has&nbsp;ordinal&nbsp;`3'&nbsp;with&nbsp;respect&nbsp;to&nbsp;thecomplete&nbsp;object&nbsp;of&nbsp;type&nbsp;S.&nbsp;The&nbsp;location&nbsp;field&nbsp;is&nbsp;omitted&nbsp;in&nbsp;the&nbsp;primaryvtable&nbsp;of&nbsp;a&nbsp;complete&nbsp;object.&nbsp;Hence,&nbsp;the&nbsp;first&nbsp;word&nbsp;of&nbsp;a&nbsp;completed&nbsp;S&nbsp;objectpoints&nbsp;to&nbsp;the&nbsp;table&nbsp;whose&nbsp;name&nbsp;is:&lt;ul&gt;&lt;tt&gt;[Vtable_1S]key:&lt;/tt&gt;&lt;/ul&gt;but&nbsp;the&nbsp;first&nbsp;word&nbsp;of&nbsp;the&nbsp;Q&nbsp;subobject&nbsp;during&nbsp;construction&nbsp;of&nbsp;a&nbsp;Q&nbsp;withinan&nbsp;S&nbsp;points&nbsp;to&nbsp;a&nbsp;table&nbsp;whose&nbsp;name&nbsp;is:&lt;ul&gt;&lt;tt&gt;[Vtable_1S.2.0]&lt;/tt&gt;&lt;/ul&gt;(the&nbsp;`0'&nbsp;cannot&nbsp;be&nbsp;omitted&nbsp;in&nbsp;table-names&nbsp;for&nbsp;incomplete&nbsp;objects&nbsp;sincewe&nbsp;wouldn't&nbsp;be&nbsp;able&nbsp;to&nbsp;distinguish&nbsp;between&nbsp;the&nbsp;&lt;i&gt;identity&nbsp;&lt;/i&gt;and&nbsp;&lt;i&gt;location&lt;/i&gt;fields.)&lt;br&gt;&nbsp;&lt;h2&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;VLDVTT:&nbsp;Virtual-base&nbsp;Location&nbsp;Dependent&nbsp;VirtualTables&nbsp;Table&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;If&nbsp;a&nbsp;class&nbsp;requires&nbsp;construction&nbsp;vtables,&nbsp;pointers&nbsp;to&nbsp;all&nbsp;the&nbsp;vtablesrequired&nbsp;for&nbsp;the&nbsp;construction&nbsp;of&nbsp;a&nbsp;complete&nbsp;object&nbsp;of&nbsp;that&nbsp;class&nbsp;will&nbsp;begrouped&nbsp;into&nbsp;a&nbsp;table&nbsp;called&nbsp;VLDVTT.&nbsp;The&nbsp;mangled&nbsp;name&nbsp;for&nbsp;such&nbsp;a&nbsp;VLDVTTrefers&nbsp;to&nbsp;its&nbsp;first&nbsp;entry&nbsp;and&nbsp;has&nbsp;the&nbsp;form:&lt;ul&gt;`&lt;tt&gt;[VLDVTT&lt;/tt&gt;'&nbsp;{`&lt;tt&gt;_&lt;/tt&gt;'&nbsp;&lt;i&gt;mangled-type-2&lt;/i&gt;}`]&lt;tt&gt;key:&lt;/tt&gt;'{&lt;i&gt;mangled-key-function&lt;/i&gt;}&lt;/ul&gt;As&nbsp;with&nbsp;the&nbsp;naming&nbsp;of&nbsp;vtables,&nbsp;exactly&nbsp;one&nbsp;of&nbsp;&lt;i&gt;mangled-type-2&lt;/i&gt;&nbsp;or&lt;i&gt;mangled-key-function&lt;/i&gt;is&nbsp;used,&nbsp;depending&nbsp;on&nbsp;whether&nbsp;the&nbsp;complete&nbsp;derivation&nbsp;has&nbsp;a&nbsp;key-functionor&nbsp;not.&nbsp;The&nbsp;field&nbsp;&lt;i&gt;mangled-type-2&lt;/i&gt;&nbsp;differs&nbsp;from&nbsp;the&nbsp;field&nbsp;&lt;i&gt;mangled-type&lt;/i&gt;in&nbsp;the&nbsp;naming&nbsp;of&nbsp;vtable&nbsp;names&nbsp;in&nbsp;that&lt;i&gt;mangled-type-2&lt;/i&gt;&nbsp;does&nbsp;not&nbsp;includeleading&nbsp;digits&nbsp;indicating&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;typename.&nbsp;For&nbsp;example,&nbsp;theVLDVTT&nbsp;for&nbsp;the&nbsp;class&nbsp;S&nbsp;above&nbsp;is&nbsp;mangled&nbsp;as:&lt;ul&gt;&lt;tt&gt;[VLDVTT_S]key:&lt;/tt&gt;&lt;/ul&gt;The&nbsp;table&nbsp;contains&nbsp;pointers&nbsp;to&nbsp;the&nbsp;origins&nbsp;of&nbsp;the&nbsp;various&nbsp;vtables&nbsp;usedfor&nbsp;the&nbsp;corresponding&nbsp;complete&nbsp;type,&nbsp;in&nbsp;the&nbsp;lexicographical&nbsp;order&nbsp;of&nbsp;the(implicit&nbsp;or&nbsp;explicit)&nbsp;pair&nbsp;{&lt;i&gt;identity&lt;/i&gt;,&nbsp;&lt;i&gt;location&lt;/i&gt;}&nbsp;E.g.,&nbsp;thecontents&nbsp;of&nbsp;&lt;tt&gt;[VLDVTT_S]key:&lt;/tt&gt;&nbsp;in&nbsp;HP-UX&nbsp;assembly&nbsp;notation&nbsp;are:&lt;ul&gt;&lt;tt&gt;[VLDVTT_S]key:&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.ALIGN&nbsp;8&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S]key:+12;&nbsp;=&nbsp;0xc&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.3]key:&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.4]key:+8;&nbsp;=&nbsp;0x8&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.2.0]key:+12;&nbsp;=&nbsp;0xc&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.2.1]key:&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.4.0]key:+8;&nbsp;=&nbsp;0x8&lt;/tt&gt;&lt;br&gt;&lt;tt&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.WORD&nbsp;[Vtable_1S.4.1]key:&lt;/tt&gt;&lt;/ul&gt;&lt;h2&gt;&lt;font&nbsp;face=&quot;Arial,Helvetica&quot;&gt;Demonstration&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;The&nbsp;program&nbsp;source&nbsp;pointed&nbsp;to&nbsp;by&nbsp;&lt;a&nbsp;href=&quot;http://cllweb.cup.hp.com/acxx/aCC/Documentation/vtables1.txt&quot;&gt;thislink&lt;/a&gt;&nbsp;should&nbsp;be&nbsp;compiled&nbsp;with&nbsp;`aCC&nbsp;-Wl,-E&nbsp;...'&nbsp;to&nbsp;make&nbsp;its&nbsp;symbols&nbsp;loadableat&nbsp;run-time.&nbsp;The&nbsp;program&nbsp;outputs&nbsp;an&nbsp;analysis&nbsp;of&nbsp;a&nbsp;complete&nbsp;object&nbsp;of&nbsp;typeS&nbsp;as&nbsp;described&nbsp;above.&lt;/body&gt;&lt;/html&gt;
</tt>
