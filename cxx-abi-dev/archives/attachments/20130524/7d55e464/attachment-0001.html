<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;May&nbsp;23,&nbsp;2013,&nbsp;at&nbsp;11:29&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;23,&nbsp;2013&nbsp;at&nbsp;10:41&nbsp;PM,&nbsp;John&nbsp;McCall&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;May&nbsp;23,&nbsp;2013,&nbsp;at&nbsp;10:23&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&gt;&nbsp;So...&nbsp;this&nbsp;problem&nbsp;was&nbsp;not&nbsp;really&nbsp;new&nbsp;in&nbsp;C++11.&nbsp;In&nbsp;C++98&nbsp;it&nbsp;can&nbsp;be&nbsp;witnessed&nbsp;for&nbsp;an&nbsp;inline&nbsp;function&nbsp;such&nbsp;as:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*get()&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;static&nbsp;const&nbsp;char&nbsp;*str&nbsp;=&nbsp;&quot;foo&quot;;&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&nbsp;return&nbsp;str;&lt;br&gt;<br>
&gt;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;How&nbsp;is&nbsp;this&nbsp;different&nbsp;from&nbsp;the&nbsp;following?&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*get_nostatic()&nbsp;{&nbsp;return&nbsp;&quot;foo&quot;;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
or&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*get_separate()&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*temp&nbsp;=&nbsp;&quot;foo&quot;;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;const&nbsp;char&nbsp;*str&nbsp;=&nbsp;tmp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;str;&lt;br&gt;<br>
&nbsp;&nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;find&nbsp;or&nbsp;add&nbsp;something&nbsp;in&nbsp;the&nbsp;standard&nbsp;which&nbsp;will&nbsp;allow&nbsp;us&nbsp;to&lt;br&gt;<br>
not&nbsp;export&nbsp;a&nbsp;symbol&nbsp;for&nbsp;every&nbsp;string&nbsp;literal(*)&nbsp;that&nbsp;happens&nbsp;to&nbsp;be&nbsp;used&lt;br&gt;<br>
in&nbsp;a&nbsp;function&nbsp;with&nbsp;weak&nbsp;linkage.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&gt;Finding&nbsp;failed.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;implications&nbsp;of&nbsp;the&nbsp;ODR,&nbsp;we&nbsp;have&nbsp;this:&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&gt;[dcl.fct.spec]p4:&nbsp;&quot;A&nbsp;string&nbsp;literal&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;an&nbsp;extern&nbsp;inline&nbsp;function&nbsp;is&nbsp;the&nbsp;same&nbsp;object&nbsp;in&nbsp;different&nbsp;translation&nbsp;units.&quot;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;This&nbsp;is&nbsp;a&nbsp;really&nbsp;terrible&nbsp;language&nbsp;requirement.&nbsp;&nbsp;Does&nbsp;anyone&nbsp;actually&nbsp;do&nbsp;what's&nbsp;necessary&nbsp;for&nbsp;this?&nbsp;&nbsp;I&nbsp;really&nbsp;can't&nbsp;imagine&nbsp;actually&nbsp;implementing&nbsp;it;&nbsp;&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;*ton*&nbsp;of&nbsp;new&nbsp;extern&nbsp;symbols.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;On&nbsp;the&nbsp;adding&nbsp;front,&nbsp;perhaps&nbsp;the&nbsp;simplest&nbsp;way&nbsp;to&nbsp;avoid&nbsp;generating&nbsp;such&nbsp;extra&nbsp;symbols&nbsp;(at&nbsp;least,&nbsp;in&nbsp;most&nbsp;cases)&nbsp;would&nbsp;be&nbsp;to&nbsp;specify&nbsp;that&nbsp;a&nbsp;string&nbsp;literal&nbsp;expression&nbsp;may&nbsp;produce&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;different&nbsp;(static&nbsp;storage&nbsp;duration)&nbsp;object&nbsp;each&nbsp;time&nbsp;it&nbsp;is&nbsp;evaluated.&nbsp;&nbsp;However,&nbsp;even&nbsp;if&nbsp;we&nbsp;allow&nbsp;that,&nbsp;I&nbsp;don't&nbsp;think&nbsp;it's&nbsp;reasonable&nbsp;for&nbsp;an&nbsp;unchanging&nbsp;static&nbsp;storage&nbsp;duration&nbsp;pointer&nbsp;or&nbsp;reference&nbsp;to&nbsp;point&nbsp;at&nbsp;different&nbsp;objects&nbsp;depending&nbsp;on&nbsp;who&nbsp;is&nbsp;asking.&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree;&nbsp;&nbsp;I&nbsp;just&nbsp;really&nbsp;don't&nbsp;want&nbsp;to&nbsp;have&nbsp;to&nbsp;export&nbsp;unique&nbsp;symbols&nbsp;for&nbsp;every&nbsp;logging&nbsp;statement&nbsp;in&nbsp;an&nbsp;inline&nbsp;function.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;let's&nbsp;see.&nbsp;&nbsp;I&nbsp;see&nbsp;two&nbsp;basic&nbsp;language&nbsp;designs&nbsp;and&nbsp;implementation&nbsp;strategies.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;&nbsp;The&nbsp;first&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;location&nbsp;of&nbsp;a&nbsp;string&nbsp;literal&nbsp;(function&nbsp;/&nbsp;initializer&nbsp;where&nbsp;it&nbsp;appears&nbsp;and&nbsp;its&nbsp;source&nbsp;order&nbsp;therewithin)&nbsp;is&nbsp;actually&nbsp;a&nbsp;crucial&nbsp;semantic&nbsp;property&nbsp;that&nbsp;compilers&nbsp;have&nbsp;to&nbsp;track/update&nbsp;through&nbsp;everything.&nbsp;&nbsp;(Source&nbsp;order&nbsp;becomes&nbsp;a&nbsp;really&nbsp;interesting&nbsp;question&nbsp;when&nbsp;you&nbsp;consider&nbsp;default&nbsp;argument&nbsp;expressions.)&nbsp;&nbsp;Not&nbsp;every&nbsp;string&nbsp;literal&nbsp;is&nbsp;blessed&nbsp;this&nbsp;way;&nbsp;&nbsp;just&nbsp;the&nbsp;ones&nbsp;that&nbsp;show&nbsp;up&nbsp;in&nbsp;(1)&nbsp;inline&nbsp;functions&nbsp;or&nbsp;(2)&nbsp;initializers&nbsp;of&nbsp;(weak-linkage)&nbsp;constexpr&nbsp;variables&nbsp;with&nbsp;static&nbsp;storage&nbsp;duration.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;major&nbsp;implementation&nbsp;pain,&nbsp;and&nbsp;it&nbsp;becomes&nbsp;a&nbsp;bizarre&nbsp;new&nbsp;pervasive&nbsp;cost&nbsp;of&nbsp;C++&nbsp;just&nbsp;to&nbsp;satisfy&nbsp;a&nbsp;requirement&nbsp;that&nbsp;very,&nbsp;very&nbsp;few&nbsp;people&nbsp;care&nbsp;about.&nbsp;&nbsp;Hooray.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;&nbsp;The&nbsp;second&nbsp;is&nbsp;that&nbsp;we&nbsp;somehow&nbsp;limit&nbsp;this&nbsp;problem&nbsp;to&nbsp;just&nbsp;initializing&nbsp;an&nbsp;object&nbsp;of&nbsp;static&nbsp;storage&nbsp;duration.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;There&nbsp;are&nbsp;three&nbsp;places&nbsp;where&nbsp;we&nbsp;can&nbsp;have&nbsp;initializers&nbsp;for&nbsp;the&nbsp;same&nbsp;object&nbsp;in&nbsp;different&nbsp;translation&nbsp;units:&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&nbsp;constexpr&nbsp;static&nbsp;data&nbsp;members&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&nbsp;static&nbsp;data&nbsp;members&nbsp;of&nbsp;a&nbsp;class&nbsp;template&lt;/div&gt;&lt;div&gt;&lt;div&gt;&nbsp;&nbsp;-&nbsp;static&nbsp;local&nbsp;variables&nbsp;in&nbsp;inline&nbsp;functions&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;constexpr&nbsp;and&nbsp;non-constexpr&nbsp;cases&nbsp;are&nbsp;subtly&nbsp;different.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;constexpr&nbsp;case,&nbsp;we&nbsp;know&nbsp;that&nbsp;everybody&nbsp;agrees&nbsp;that&nbsp;the&nbsp;initializer&nbsp;can&nbsp;be&nbsp;constant-evaluated,&nbsp;and&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;everybody&nbsp;evaluates&nbsp;it&nbsp;to&nbsp;the&nbsp;same&nbsp;constant.&nbsp;&nbsp;This&nbsp;gives&nbsp;us&nbsp;a&nbsp;number&nbsp;of&nbsp;ways&nbsp;to&nbsp;stably&nbsp;identify&nbsp;sub-objects&nbsp;in&nbsp;the&nbsp;variable.&nbsp;&nbsp;If&nbsp;we&nbsp;actually&nbsp;have&nbsp;to&nbsp;emit&nbsp;the&nbsp;definition,&nbsp;that's&nbsp;easy&nbsp;enough,&nbsp;too.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;non-constexpr&nbsp;case,&nbsp;we&nbsp;don't&nbsp;know&nbsp;that,&nbsp;and&nbsp;we&nbsp;have&nbsp;to&nbsp;compile&nbsp;the&nbsp;code&nbsp;as&nbsp;if&nbsp;there&nbsp;was&nbsp;a&nbsp;possibility&nbsp;that&nbsp;somebody&nbsp;might&nbsp;have&nbsp;emitted&nbsp;as&nbsp;a&nbsp;dynamic&nbsp;initializer.&nbsp;&nbsp;So&nbsp;I&nbsp;think&nbsp;we&nbsp;can't&nbsp;make&nbsp;any&nbsp;assumptions&nbsp;about&nbsp;string-literal&nbsp;pointer&nbsp;values&nbsp;stored&nbsp;in&nbsp;the&nbsp;variable;&nbsp;&nbsp;we&nbsp;always&nbsp;have&nbsp;to&nbsp;load&nbsp;them&nbsp;out,&nbsp;which&nbsp;is&nbsp;really&nbsp;unfortunate.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;this&nbsp;entire&nbsp;approach&nbsp;seems&nbsp;to&nbsp;make&nbsp;the&nbsp;presence&nbsp;of&nbsp;'constexpr'&nbsp;affect&nbsp;ABI.&nbsp;&nbsp;(It&nbsp;does&nbsp;get&nbsp;caught&nbsp;by&nbsp;ODR,&nbsp;so&nbsp;that's&nbsp;*legal*,&nbsp;but&nbsp;I&nbsp;don't&nbsp;know&nbsp;that&nbsp;it's&nbsp;*a&nbsp;good&nbsp;idea*.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It's&nbsp;also&nbsp;unclear&nbsp;what&nbsp;*parts*&nbsp;of&nbsp;any&nbsp;given&nbsp;initializer&nbsp;will&nbsp;be&nbsp;constant-initialized&nbsp;vs.&nbsp;dynamically-initialized;&nbsp;&nbsp;consider:&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*second(const&nbsp;char&nbsp;*a,&nbsp;const&nbsp;char&nbsp;*b)&nbsp;{&nbsp;return&nbsp;b;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;inline&nbsp;const&nbsp;char&nbsp;*ident(const&nbsp;char&nbsp;*s)&nbsp;{&nbsp;return&nbsp;s;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;...&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;inline&nbsp;void&nbsp;test()&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;const&nbsp;char&nbsp;*strs[]&nbsp;=&nbsp;{&nbsp;second(&quot;a&quot;,&nbsp;&quot;b&quot;),&nbsp;ident(&quot;c&quot;),&nbsp;&quot;d&quot;&nbsp;};&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;The&nbsp;only&nbsp;part&nbsp;that's&nbsp;&quot;guaranteed&quot;&nbsp;to&nbsp;be&nbsp;constant-initialized&nbsp;is&nbsp;the&nbsp;third&nbsp;element,&nbsp;but&nbsp;a&nbsp;compiler&nbsp;which&nbsp;does&nbsp;constant-initialize&nbsp;this&nbsp;can&nbsp;get&nbsp;both&nbsp;of&nbsp;the&nbsp;others.&nbsp;&nbsp;And&nbsp;note&nbsp;that&nbsp;the&nbsp;string&nbsp;literals&nbsp;we&nbsp;use&nbsp;aren't&nbsp;1-1&nbsp;with&nbsp;the&nbsp;string&nbsp;literals&nbsp;in&nbsp;the&nbsp;initializer;&nbsp;&nbsp;the&nbsp;uniquing&nbsp;scheme&nbsp;needs&nbsp;to&nbsp;be&nbsp;positional&nbsp;within&nbsp;the&nbsp;initialized&nbsp;object&nbsp;to&nbsp;ensure&nbsp;that&nbsp;different&nbsp;translation&nbsp;units&nbsp;use&nbsp;the&nbsp;same&nbsp;thing.&nbsp;&nbsp;(That&nbsp;is,&nbsp;&quot;d&quot;&nbsp;would&nbsp;have&nbsp;to&nbsp;mangled&nbsp;as&nbsp;&quot;_Z4testEv::strs[2]&quot;.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;the&nbsp;right&nbsp;solution&nbsp;is&nbsp;to:&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&nbsp;concede&nbsp;that&nbsp;(1)&nbsp;is&nbsp;the&nbsp;simpler&nbsp;language&nbsp;and&nbsp;implementation&nbsp;design&nbsp;but&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;-&nbsp;nonetheless&nbsp;refuse&nbsp;to&nbsp;implement&nbsp;it&nbsp;due&nbsp;to&nbsp;an&nbsp;insufficient&nbsp;indignant-user&nbsp;count&nbsp;(and&nbsp;a&nbsp;reasonable&nbsp;suspicion&nbsp;of&nbsp;seeing&nbsp;a&nbsp;higher&nbsp;indignant-user&nbsp;count&nbsp;if&nbsp;we&nbsp;did).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;practice,&nbsp;I&nbsp;believe&nbsp;most&nbsp;linkers&nbsp;will&nbsp;coalesce&nbsp;common&nbsp;string&nbsp;values&nbsp;within&nbsp;a&nbsp;linkage&nbsp;unit,&nbsp;which&nbsp;is&nbsp;all&nbsp;that&nbsp;even&nbsp;the&nbsp;few&nbsp;people&nbsp;who&nbsp;care&nbsp;about&nbsp;this&nbsp;actually&nbsp;want.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;John.&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
