<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Feb&nbsp;15,&nbsp;2013,&nbsp;at&nbsp;6:19&nbsp;PM,&nbsp;Richard&nbsp;Smith&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:richardsmith@google.com&quot;&gt;richardsmith@google.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Fri,&nbsp;Feb&nbsp;15,&nbsp;2013&nbsp;at&nbsp;5:38&nbsp;PM,&nbsp;John&nbsp;McCall&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rjmccall@apple.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rjmccall@apple.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;Richard&nbsp;Smith&nbsp;has&nbsp;pointed&nbsp;out&nbsp;to&nbsp;me&nbsp;that&nbsp;the&nbsp;ABI&nbsp;document&nbsp;currently&nbsp;states,&nbsp;right&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;section&nbsp;2.5:&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&nbsp;&nbsp;A&nbsp;virtual&nbsp;table&nbsp;(vtable)&nbsp;is&nbsp;a&nbsp;table&nbsp;of&nbsp;information&nbsp;used&nbsp;to&nbsp;dispatch&nbsp;virtual&nbsp;functions,&nbsp;to&nbsp;access&nbsp;virtual&nbsp;base&nbsp;class&nbsp;subobjects,&nbsp;and&nbsp;to&nbsp;access&nbsp;information&nbsp;for&nbsp;runtime&nbsp;type&nbsp;identification&nbsp;(RTTI).&nbsp;Each&nbsp;class&nbsp;that&nbsp;has&nbsp;virtual&nbsp;member&nbsp;functions&nbsp;or&nbsp;virtual&nbsp;bases&nbsp;has&nbsp;an&nbsp;associated&nbsp;set&nbsp;of&nbsp;virtual&nbsp;tables.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;virtual&nbsp;tables&nbsp;for&nbsp;a&nbsp;particular&nbsp;class,&nbsp;if&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;base&nbsp;class&nbsp;for&nbsp;other&nbsp;classes.&nbsp;However,&nbsp;the&nbsp;virtual&nbsp;table&nbsp;pointers&nbsp;within&nbsp;all&nbsp;the&nbsp;objects&nbsp;(instances)&nbsp;of&nbsp;a&nbsp;particular&nbsp;most-derived&nbsp;class&nbsp;point&nbsp;to&nbsp;the&nbsp;same&nbsp;set&nbsp;of&nbsp;virtual&nbsp;tables.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;last&nbsp;sentence&nbsp;could&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;strict&nbsp;requirement&nbsp;that&nbsp;all&nbsp;objects&nbsp;of&nbsp;a&nbsp;most-derived&nbsp;class&nbsp;use&nbsp;the&nbsp;same&nbsp;v-table,&nbsp;as&nbsp;opposed&nbsp;to&nbsp;potentially&nbsp;a&nbsp;private&nbsp;copy&nbsp;of&nbsp;that&nbsp;v-table.&lt;br&gt;<br>
&lt;br&gt;<br>
While&nbsp;it&nbsp;is&nbsp;obviously&nbsp;good&nbsp;to&nbsp;avoid&nbsp;redundant&nbsp;copies&nbsp;of&nbsp;a&nbsp;v-table&nbsp;in&nbsp;memory,&nbsp;an&nbsp;unconditional&nbsp;requirement&nbsp;to&nbsp;do&nbsp;so&nbsp;seems&nbsp;excessive.&nbsp;&nbsp;Uniquing&nbsp;a&nbsp;symbol&nbsp;with&nbsp;vague&nbsp;linkage&nbsp;across&nbsp;dynamic-library&nbsp;boundaries&nbsp;may&nbsp;require&nbsp;a&nbsp;significant&nbsp;amount&nbsp;of&nbsp;work,&nbsp;probably&nbsp;at&nbsp;load&nbsp;time&nbsp;but&nbsp;at&nbsp;best&nbsp;at&nbsp;the&nbsp;first&nbsp;use&nbsp;of&nbsp;the&nbsp;symbol&nbsp;(a&nbsp;sort&nbsp;of&nbsp;laziness&nbsp;which&nbsp;would&nbsp;carry&nbsp;its&nbsp;own&nbsp;disadvantages).&nbsp;&nbsp;This&nbsp;work&nbsp;is&nbsp;required&nbsp;for&nbsp;the&nbsp;RTTI&nbsp;symbol&nbsp;name&nbsp;(_ZTS*)&nbsp;in&nbsp;order&nbsp;to&nbsp;make&nbsp;RTTI&nbsp;comparison&nbsp;work,&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;otherwise&nbsp;mandatory&nbsp;for&nbsp;the&nbsp;RTTI&nbsp;object&nbsp;(_ZTI*)&nbsp;or&nbsp;v-tables&nbsp;(_ZTV*)&nbsp;or&nbsp;VTT&nbsp;(_ZTT*).&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&gt;It&nbsp;is&nbsp;currently&nbsp;mandatory&nbsp;for&nbsp;the&nbsp;_ZTI,&nbsp;per&nbsp;2.9.1:&lt;/div&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;br&gt;&quot;It&nbsp;is&nbsp;intended&nbsp;that&nbsp;two&nbsp;type_info&nbsp;pointers&nbsp;point&nbsp;to&nbsp;equivalent&nbsp;type&nbsp;descriptions&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;pointers&nbsp;are&nbsp;equal.&nbsp;An&nbsp;implementation&nbsp;must&nbsp;satisfy&nbsp;this&nbsp;constraint,&nbsp;e.g.&nbsp;by&nbsp;using&nbsp;symbol&nbsp;preemption,&nbsp;COMDAT&nbsp;sections,&nbsp;or&nbsp;other&nbsp;mechanisms.&quot;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;I&nbsp;didn't&nbsp;really&nbsp;mean&nbsp;to&nbsp;open&nbsp;that&nbsp;debate.&nbsp;&nbsp;The&nbsp;question&nbsp;of&nbsp;what&nbsp;exactly&nbsp;is&nbsp;merged&nbsp;about&nbsp;RTTI&nbsp;is&nbsp;very&nbsp;complicated,&nbsp;with&nbsp;widespread&nbsp;divergence&nbsp;from&nbsp;the&nbsp;plain&nbsp;rule&nbsp;in&nbsp;the&nbsp;ABI;&nbsp;&nbsp;in&nbsp;particular,&nbsp;neither&nbsp;GCC&nbsp;nor&nbsp;clang&nbsp;guarantees&nbsp;uniquing&nbsp;of&nbsp;_ZTI's,&nbsp;and&nbsp;GCC&nbsp;stopped&nbsp;even&nbsp;uniquing&nbsp;_ZTS's&nbsp;by&nbsp;default&nbsp;as&nbsp;of&nbsp;GCC&nbsp;4.5,&nbsp;using&nbsp;a&nbsp;new&nbsp;comparison&nbsp;scheme&nbsp;on&nbsp;all&nbsp;platforms&nbsp;(which,&nbsp;incidentally,&nbsp;I&nbsp;think&nbsp;would&nbsp;be&nbsp;worth&nbsp;documenting&nbsp;as&nbsp;an&nbsp;official&nbsp;alternative,&nbsp;if&nbsp;anyone&nbsp;from&nbsp;GCC&nbsp;would&nbsp;mind&nbsp;describing&nbsp;the&nbsp;rules&nbsp;they&nbsp;use).&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;point&nbsp;is&nbsp;just&nbsp;that&nbsp;AFAIK&nbsp;*nobody*&nbsp;has&nbsp;ever&nbsp;relied&nbsp;upon&nbsp;v-tables&nbsp;or&nbsp;VTTs&nbsp;being&nbsp;uniqued,&nbsp;and&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;clean&nbsp;up&nbsp;a&nbsp;bit&nbsp;of&nbsp;the&nbsp;ABI&nbsp;spec&nbsp;which&nbsp;seems&nbsp;to&nbsp;imply&nbsp;that&nbsp;they&nbsp;need&nbsp;to&nbsp;be.&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;John.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
