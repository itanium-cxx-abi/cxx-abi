<tt>
&lt;HTML&gt;<br>
<br>
&lt;HEAD&gt;<br>
&lt;title&gt;C++&nbsp;ABI&nbsp;Closed&nbsp;Issues&lt;/title&gt;<br>
<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=small-table.css&nbsp;type=&quot;text/css&quot;&gt;<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=code.css&nbsp;type=&quot;text/css&quot;&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;font&nbsp;size=6&gt;&lt;i&gt;&lt;b&gt;<br>
&lt;p&gt;<br>
C++&nbsp;ABI&nbsp;Closed&nbsp;Issues<br>
&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;<br>
<br>
&lt;font&nbsp;size=-1&gt;<br>
&lt;p&gt;<br>
&lt;i&gt;Revised&nbsp;17&nbsp;August&nbsp;1999&lt;/i&gt;<br>
<br>
&lt;/center&gt;<br>
<br>
&lt;/HEAD&gt;<br>
<br>
&lt;BODY&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Issue&nbsp;Status&nbsp;&lt;/h3&gt;<br>
<br>
In&nbsp;the&nbsp;following&nbsp;sections,<br>
the&nbsp;&lt;b&gt;&lt;i&gt;class&lt;/i&gt;&lt;/b&gt;&nbsp;of&nbsp;an&nbsp;issue&nbsp;attempts&nbsp;to&nbsp;classify&nbsp;it&nbsp;on&nbsp;the<br>
basis&nbsp;of&nbsp;what&nbsp;it&nbsp;likely&nbsp;affects.<br>
The&nbsp;identifiers&nbsp;used&nbsp;are:<br>
<br>
&lt;table&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Function&nbsp;call&nbsp;interface,&nbsp;i.e.&nbsp;call&nbsp;linkage&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Data&nbsp;layout&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;lib&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Runtime&nbsp;library&nbsp;support&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;lif&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Library&nbsp;interface,&nbsp;i.e.&nbsp;API&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;g&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Potential&nbsp;gABI&nbsp;impact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Potential&nbsp;psABI&nbsp;impact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;source&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Source&nbsp;code&nbsp;conventions&nbsp;(i.e.&nbsp;API,&nbsp;not&nbsp;ABI)&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;May&nbsp;affect&nbsp;how&nbsp;program&nbsp;construction&nbsp;tools&nbsp;interact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;A.&nbsp;&nbsp;Object&nbsp;Layout&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Vptr&nbsp;location&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;is&nbsp;the&nbsp;Vptr&nbsp;stored&nbsp;in&nbsp;an&nbsp;object&nbsp;(first&nbsp;or&nbsp;last&nbsp;are&nbsp;the&nbsp;usual&nbsp;answers).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990610&nbsp;All]&lt;/font&gt;<br>
Given&nbsp;the&nbsp;absence&nbsp;of&nbsp;addressing&nbsp;modes&nbsp;with&nbsp;displacements&nbsp;on&nbsp;IA-64,<br>
the&nbsp;consensus&nbsp;is&nbsp;to&nbsp;answer&nbsp;this&nbsp;question&nbsp;with&nbsp;&quot;first.&quot;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990617&nbsp;All]&lt;/font&gt;<br>
Given&nbsp;a&nbsp;Vptr&nbsp;and&nbsp;only&nbsp;non-polymorphic&nbsp;bases,<br>
which&nbsp;(Vptr&nbsp;or&nbsp;base)&nbsp;goes&nbsp;at&nbsp;offset&nbsp;0?<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;HP:&nbsp;Vptr&nbsp;at&nbsp;end,&nbsp;but&nbsp;IA-64&nbsp;is&nbsp;different&nbsp;because&nbsp;no&nbsp;load&nbsp;displacement<br>
&lt;li&gt;&nbsp;Sun:&nbsp;Vptr&nbsp;at&nbsp;0&nbsp;probably&nbsp;preferred<br>
&lt;li&gt;&nbsp;g++:&nbsp;Vptr&nbsp;at&nbsp;end&nbsp;today<br>
&lt;/ul&gt;<br>
&lt;p&gt;<br>
Tentative&nbsp;decision:&nbsp;&nbsp;Vptr&nbsp;always&nbsp;goes&nbsp;at&nbsp;beginning.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Accepted&nbsp;tentative&nbsp;decision.<br>
Rename,&nbsp;close&nbsp;this&nbsp;issue,&nbsp;and&nbsp;open&nbsp;separate&nbsp;issue&nbsp;(B-6)&nbsp;for&nbsp;Vtable&nbsp;layout.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Virtual&nbsp;base&nbsp;classes&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;are&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;placed&nbsp;in&nbsp;the&nbsp;class&nbsp;layout?<br>
How&nbsp;are&nbsp;data&nbsp;member&nbsp;accesses&nbsp;to&nbsp;them&nbsp;handled?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990610&nbsp;Matt]&lt;/font&gt;<br>
With&nbsp;regard&nbsp;to&nbsp;how&nbsp;data&nbsp;member&nbsp;accesses&nbsp;are&nbsp;handled,<br>
the&nbsp;choices&nbsp;are&nbsp;to&nbsp;store&nbsp;either&nbsp;a&nbsp;pointer&nbsp;or&nbsp;an&nbsp;offset&nbsp;in&nbsp;the&nbsp;Vtable.<br>
The&nbsp;concensus&nbsp;seems&nbsp;to&nbsp;be&nbsp;to&nbsp;prefer&nbsp;an&nbsp;offset.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990617&nbsp;All]&lt;/font&gt;<br>
Any&nbsp;number&nbsp;of&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;(rare)&nbsp;will&nbsp;be&nbsp;placed&nbsp;at<br>
offset&nbsp;zero.<br>
If&nbsp;there&nbsp;are&nbsp;no&nbsp;non-virtual&nbsp;polymorphic&nbsp;bases,<br>
the&nbsp;first&nbsp;virtual&nbsp;base&nbsp;subobject&nbsp;with&nbsp;a&nbsp;Vpointer&nbsp;will&nbsp;be&nbsp;placed&nbsp;at<br>
offset&nbsp;zero.<br>
Finally,&nbsp;all&nbsp;other&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;will&nbsp;be&nbsp;allocated&nbsp;at&nbsp;the<br>
end&nbsp;of&nbsp;the&nbsp;class,&nbsp;left-to-right,&nbsp;depth-first.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Define&nbsp;an&nbsp;empty&nbsp;object&nbsp;as&nbsp;one&nbsp;with&nbsp;no&nbsp;non-static,&nbsp;non-empty&nbsp;data&nbsp;members,<br>
no&nbsp;virtual&nbsp;functions,<br>
no&nbsp;virtual&nbsp;base&nbsp;classes,<br>
and&nbsp;no&nbsp;non-empty&nbsp;non-virtual&nbsp;base&nbsp;classes.<br>
Define&nbsp;a&nbsp;nearly&nbsp;empty&nbsp;object&nbsp;as&nbsp;one&nbsp;which&nbsp;contains&nbsp;only&nbsp;a&nbsp;Vptr.<br>
The&nbsp;above&nbsp;resolution&nbsp;is&nbsp;accepted,&nbsp;restated&nbsp;as&nbsp;follows:<br>
<br>
&lt;p&gt;<br>
Any&nbsp;number&nbsp;of&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;subobjects<br>
(rare,&nbsp;because&nbsp;they&nbsp;cannot&nbsp;have&nbsp;virtual&nbsp;functions&nbsp;or&nbsp;bases&nbsp;themselves)<br>
will&nbsp;be&nbsp;placed&nbsp;at&nbsp;offset&nbsp;zero,&nbsp;subject&nbsp;to&nbsp;the&nbsp;conflict&nbsp;rules&nbsp;in&nbsp;A-3<br>
(i.e.&nbsp;this&nbsp;cannot&nbsp;result&nbsp;in&nbsp;two&nbsp;objects&nbsp;of&nbsp;the&nbsp;same&nbsp;type&nbsp;at&nbsp;the&nbsp;same<br>
address).<br>
If&nbsp;there&nbsp;are&nbsp;no&nbsp;non-virtual&nbsp;polymorphic&nbsp;base&nbsp;subobjects,<br>
the&nbsp;first&nbsp;nearly&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;subobject&nbsp;will&nbsp;be&nbsp;placed&nbsp;at&nbsp;offset&nbsp;zero.<br>
Any&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;not&nbsp;thus&nbsp;placed&nbsp;at&nbsp;offset&nbsp;zero&nbsp;will&nbsp;be<br>
allocated&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;class,<br>
in&nbsp;left-to-right,&nbsp;depth-first&nbsp;declaration&nbsp;order.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Multiple&nbsp;inheritance&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Define&nbsp;the&nbsp;class&nbsp;layout&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;multiple&nbsp;base&nbsp;classes.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990617&nbsp;All]&lt;/font&gt;<br>
At&nbsp;offset&nbsp;zero&nbsp;is&nbsp;the&nbsp;Vptr&nbsp;whenever&nbsp;there&nbsp;is&nbsp;one,<br>
as&nbsp;well&nbsp;as&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;if&nbsp;any&nbsp;(see&nbsp;A-7).<br>
Also&nbsp;at&nbsp;offset&nbsp;zero&nbsp;is&nbsp;any&nbsp;number&nbsp;of&nbsp;empty&nbsp;base&nbsp;classes,<br>
as&nbsp;long&nbsp;as&nbsp;that&nbsp;does&nbsp;not&nbsp;place&nbsp;multiple&nbsp;subobjects&nbsp;of&nbsp;the&nbsp;same&nbsp;type&nbsp;at<br>
the&nbsp;same&nbsp;offset.<br>
If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;empty&nbsp;base&nbsp;classes&nbsp;such&nbsp;that&nbsp;placing&nbsp;two&nbsp;of&nbsp;them<br>
at&nbsp;offset&nbsp;zero&nbsp;would&nbsp;violate&nbsp;this&nbsp;constraint,&nbsp;the&nbsp;first&nbsp;is&nbsp;placed&nbsp;there.<br>
(First&nbsp;means&nbsp;in&nbsp;declaration&nbsp;order.)<br>
<br>
&lt;p&gt;<br>
All&nbsp;other&nbsp;non-virtual&nbsp;base&nbsp;classes&nbsp;are&nbsp;laid&nbsp;out&nbsp;in&nbsp;declaration&nbsp;order&nbsp;at<br>
the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;class.<br>
All&nbsp;other&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;will&nbsp;be&nbsp;allocated&nbsp;at&nbsp;the<br>
end&nbsp;of&nbsp;the&nbsp;class,&nbsp;left-to-right,&nbsp;depth-first.<br>
<br>
&lt;p&gt;<br>
The&nbsp;above&nbsp;ignores&nbsp;issues&nbsp;of&nbsp;padding&nbsp;for&nbsp;alignment,<br>
and&nbsp;possible&nbsp;reordering&nbsp;of&nbsp;class&nbsp;members&nbsp;to&nbsp;fit&nbsp;in&nbsp;padding&nbsp;areas.<br>
See&nbsp;issue&nbsp;A-9.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
There&nbsp;remains&nbsp;an&nbsp;issue&nbsp;concerning&nbsp;the&nbsp;selection&nbsp;of&nbsp;the&nbsp;primary&nbsp;base<br>
class&nbsp;(see&nbsp;A-7),&nbsp;but&nbsp;we&nbsp;are&nbsp;otherwise&nbsp;in&nbsp;agreement.<br>
We&nbsp;will&nbsp;attempt&nbsp;to&nbsp;close&nbsp;this&nbsp;on&nbsp;1&nbsp;July,&nbsp;modulo&nbsp;A-7.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
This&nbsp;issue&nbsp;is&nbsp;closed.<br>
A&nbsp;full&nbsp;description&nbsp;of&nbsp;the&nbsp;class&nbsp;layout&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;issue&nbsp;A-9.<br>
(At&nbsp;this&nbsp;time,&nbsp;A-7&nbsp;remains&nbsp;to&nbsp;be&nbsp;closed,<br>
waiting&nbsp;for&nbsp;the&nbsp;Taligent&nbsp;rationale.)<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Empty&nbsp;base&nbsp;classes&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;are&nbsp;empty&nbsp;base&nbsp;classes&nbsp;allocated?<br>
(An&nbsp;empty&nbsp;base&nbsp;class&nbsp;is&nbsp;one&nbsp;with&nbsp;no&nbsp;non-static&nbsp;data&nbsp;members,<br>
no&nbsp;virtual&nbsp;functions,&nbsp;no&nbsp;virtual&nbsp;base&nbsp;classes,<br>
and&nbsp;no&nbsp;non-empty&nbsp;non-virtual&nbsp;base&nbsp;classes.)<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Closed&nbsp;as&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;A-3.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-5&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Empty&nbsp;parameters&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
When&nbsp;passing&nbsp;a&nbsp;parameter&nbsp;with&nbsp;an&nbsp;empty&nbsp;class&nbsp;type&nbsp;by&nbsp;value,<br>
what&nbsp;is&nbsp;the&nbsp;convention?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990623&nbsp;SGI]&lt;/font&gt;<br>
We&nbsp;propose&nbsp;that&nbsp;no&nbsp;parameter&nbsp;slot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;such&nbsp;parameters,<br>
i.e.&nbsp;that&nbsp;no&nbsp;register&nbsp;be&nbsp;used,<br>
and&nbsp;that&nbsp;no&nbsp;space&nbsp;in&nbsp;the&nbsp;parameter&nbsp;memory&nbsp;sequence&nbsp;be&nbsp;used.<br>
This&nbsp;implies&nbsp;that&nbsp;the&nbsp;callee&nbsp;must&nbsp;allocate&nbsp;storage&nbsp;at&nbsp;a&nbsp;unique&nbsp;address<br>
if&nbsp;the&nbsp;address&nbsp;is&nbsp;taken&nbsp;(which&nbsp;we&nbsp;expect&nbsp;to&nbsp;be&nbsp;rare).<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
In&nbsp;addition&nbsp;to&nbsp;the&nbsp;address-taken&nbsp;case,<br>
care&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;object&nbsp;has&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor.<br>
HP&nbsp;observes&nbsp;that&nbsp;in&nbsp;(some?)&nbsp;such&nbsp;cases,<br>
they&nbsp;perform&nbsp;the&nbsp;construction&nbsp;at&nbsp;the&nbsp;call&nbsp;site&nbsp;and&nbsp;pass&nbsp;the&nbsp;object&nbsp;by<br>
reference.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990625&nbsp;SGI&nbsp;--&nbsp;Jim]&lt;/font&gt;<br>
I&nbsp;understand&nbsp;that&nbsp;the&nbsp;Standard&nbsp;explicitly&nbsp;allows&nbsp;elimination&nbsp;of<br>
even&nbsp;non-trivial&nbsp;copy&nbsp;construction&nbsp;in&nbsp;some&nbsp;cases.<br>
Is&nbsp;this&nbsp;one&nbsp;of&nbsp;them?&nbsp;&nbsp;Where&nbsp;should&nbsp;I&nbsp;look?<br>
Also,&nbsp;of&nbsp;course,&nbsp;varargs&nbsp;processing&nbsp;for&nbsp;elided&nbsp;empty&nbsp;parameters&nbsp;would<br>
need&nbsp;to&nbsp;be&nbsp;careful.<br>
<br>
&lt;p&gt;<br>
I&nbsp;have&nbsp;opened&nbsp;a&nbsp;new&nbsp;issue&nbsp;(C-7)&nbsp;for&nbsp;passing&nbsp;copy-constructed<br>
parameters&nbsp;by&nbsp;reference.<br>
Since&nbsp;doing&nbsp;so&nbsp;would&nbsp;turn&nbsp;an&nbsp;empty&nbsp;value&nbsp;parameter<br>
into&nbsp;a&nbsp;non-empty&nbsp;reference&nbsp;parameter,<br>
this&nbsp;issue&nbsp;can&nbsp;ignore&nbsp;such&nbsp;cases.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
An&nbsp;empty&nbsp;parameter&nbsp;will&nbsp;not&nbsp;occupy&nbsp;a&nbsp;slot&nbsp;in&nbsp;the&nbsp;parameter&nbsp;sequence<br>
unless:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;its&nbsp;type&nbsp;is&nbsp;a&nbsp;class&nbsp;with&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor;&nbsp;or<br>
&lt;li&gt;&nbsp;it&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;variable&nbsp;part&nbsp;of&nbsp;a&nbsp;varargs&nbsp;parameter&nbsp;list.<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
Daveed&nbsp;and&nbsp;Matt&nbsp;will&nbsp;pursue&nbsp;the&nbsp;question&nbsp;of&nbsp;when&nbsp;copy&nbsp;constructors&nbsp;may<br>
be&nbsp;ignored&nbsp;for&nbsp;parameters&nbsp;with&nbsp;the&nbsp;Core&nbsp;committee,<br>
and&nbsp;if&nbsp;they&nbsp;identify&nbsp;cases&nbsp;where&nbsp;the&nbsp;constructors&nbsp;may&nbsp;clearly&nbsp;be<br>
omitted,&nbsp;those&nbsp;(empty)&nbsp;parameters&nbsp;will&nbsp;also&nbsp;be&nbsp;elided.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Vptr&nbsp;sharing&nbsp;with&nbsp;primary&nbsp;base&nbsp;class&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990729&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;is&nbsp;in&nbsp;general&nbsp;possible&nbsp;to&nbsp;share&nbsp;the&nbsp;virtual&nbsp;pointer&nbsp;with&nbsp;a<br>
polymorphic&nbsp;base&nbsp;class&nbsp;(the&nbsp;&lt;i&gt;primary&lt;/i&gt;&nbsp;base&nbsp;class).<br>
Which&nbsp;base&nbsp;class&nbsp;do&nbsp;we&nbsp;use&nbsp;for&nbsp;this?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Share&nbsp;with&nbsp;the&nbsp;first&nbsp;non-virtual&nbsp;polymorphic&nbsp;base&nbsp;class,<br>
or&nbsp;if&nbsp;none&nbsp;with&nbsp;the&nbsp;first&nbsp;nearly&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;class.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990617&nbsp;All]&lt;/font&gt;<br>
It&nbsp;will&nbsp;be&nbsp;shared&nbsp;with&nbsp;the&nbsp;first&nbsp;polymorphic&nbsp;non-virtual&nbsp;base&nbsp;class,<br>
or&nbsp;if&nbsp;none,&nbsp;with&nbsp;the&nbsp;first&nbsp;nearly&nbsp;empty&nbsp;polymorphic&nbsp;virtual&nbsp;base&nbsp;class.<br>
(See&nbsp;A-2&nbsp;for&nbsp;the&nbsp;definition&nbsp;of&nbsp;&lt;i&gt;nearly&nbsp;empty&lt;/i&gt;.)<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
HP&nbsp;noted&nbsp;that&nbsp;Taligent&nbsp;chooses&nbsp;a&nbsp;base&nbsp;class&nbsp;with&nbsp;virtual&nbsp;bases&nbsp;before<br>
one&nbsp;without&nbsp;as&nbsp;the&nbsp;primary&nbsp;base&nbsp;class),<br>
probably&nbsp;to&nbsp;avoid&nbsp;additional&nbsp;&quot;this&quot;&nbsp;pointer&nbsp;adjustments.<br>
SGI&nbsp;observed&nbsp;that&nbsp;such&nbsp;a&nbsp;rule&nbsp;would&nbsp;prevent&nbsp;users&nbsp;from&nbsp;controlling&nbsp;the<br>
choice&nbsp;by&nbsp;their&nbsp;ordering&nbsp;of&nbsp;the&nbsp;base&nbsp;classes&nbsp;in&nbsp;the&nbsp;declaration.<br>
The&nbsp;bias&nbsp;of&nbsp;the&nbsp;group&nbsp;remains&nbsp;the&nbsp;above&nbsp;resolution,<br>
but&nbsp;HP&nbsp;will&nbsp;attempt&nbsp;to&nbsp;find&nbsp;the&nbsp;Taligent&nbsp;rationale&nbsp;before&nbsp;this&nbsp;is&nbsp;decided.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;All]&lt;/font&gt;<br>
Close&nbsp;with&nbsp;the&nbsp;agree&nbsp;resolution.<br>
If&nbsp;a&nbsp;convincing&nbsp;Taligent&nbsp;rationale&nbsp;is&nbsp;found,&nbsp;we&nbsp;can&nbsp;reconsider.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;(Virtual)&nbsp;base&nbsp;class&nbsp;alignment&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
A&nbsp;(virtual)&nbsp;base&nbsp;class&nbsp;may&nbsp;have&nbsp;a&nbsp;larger&nbsp;alignment&nbsp;constraint&nbsp;than&nbsp;a<br>
derived&nbsp;class.<br>
Do&nbsp;we&nbsp;agree&nbsp;to&nbsp;extend&nbsp;the&nbsp;alignment&nbsp;constraint&nbsp;to&nbsp;the&nbsp;derived&nbsp;class?<br>
(An&nbsp;alternative&nbsp;for&nbsp;virtual&nbsp;bases:<br>
allow&nbsp;the&nbsp;virtual&nbsp;base&nbsp;to&nbsp;move&nbsp;in&nbsp;the&nbsp;complete&nbsp;object.)<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990623&nbsp;SGI]&lt;/font&gt;<br>
We&nbsp;propose&nbsp;that&nbsp;the&nbsp;alignment&nbsp;of&nbsp;a&nbsp;class&nbsp;be&nbsp;the&nbsp;maximum&nbsp;alignment&nbsp;of<br>
its&nbsp;virtual&nbsp;and&nbsp;non-virtual&nbsp;base&nbsp;classes,<br>
non-static&nbsp;data&nbsp;members,&nbsp;and&nbsp;Vptr&nbsp;if&nbsp;any.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Above&nbsp;proposal&nbsp;accepted.<br>
(SGI&nbsp;observation:<br>
the&nbsp;size&nbsp;of&nbsp;the&nbsp;class&nbsp;is&nbsp;rounded&nbsp;up&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;this&nbsp;alignment,<br>
per&nbsp;the&nbsp;underlying&nbsp;psABI&nbsp;rules.)<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;&lt;a&nbsp;name=A9&gt;A-9&lt;/a&gt;&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sorting&nbsp;fields&nbsp;as&nbsp;allowed&nbsp;by&nbsp;[class.mem]/12&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;standard&nbsp;constrains&nbsp;ordering&nbsp;of&nbsp;class&nbsp;members&nbsp;in&nbsp;memory&nbsp;only&nbsp;if<br>
they&nbsp;are&nbsp;not&nbsp;separated&nbsp;by&nbsp;an&nbsp;access&nbsp;clause.<br>
Do&nbsp;we&nbsp;use&nbsp;an&nbsp;access&nbsp;clause&nbsp;as&nbsp;an&nbsp;opportunity&nbsp;to&nbsp;fill&nbsp;the&nbsp;gaps&nbsp;left&nbsp;by&nbsp;padding?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
See&nbsp;separate&nbsp;writeup&nbsp;of&nbsp;&lt;a&nbsp;href=abi-layout.html&gt;Data&nbsp;Layout&lt;/a&gt;.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990610&nbsp;all]&lt;/font&gt;<br>
Some&nbsp;participants&nbsp;want&nbsp;to&nbsp;avoid&nbsp;attempts&nbsp;to&nbsp;reorder&nbsp;members&nbsp;differently<br>
than&nbsp;the&nbsp;underlying&nbsp;C&nbsp;struct&nbsp;ABI&nbsp;rules.<br>
Others&nbsp;think&nbsp;there&nbsp;may&nbsp;be&nbsp;benefit&nbsp;in&nbsp;reordering&nbsp;later&nbsp;access&nbsp;sections<br>
to&nbsp;fill&nbsp;holes&nbsp;in&nbsp;earlier&nbsp;ones,&nbsp;or&nbsp;even&nbsp;in&nbsp;base&nbsp;classes.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990617&nbsp;all]&lt;/font&gt;<br>
There&nbsp;are&nbsp;several&nbsp;potential&nbsp;reordering&nbsp;questions,&nbsp;more&nbsp;or&nbsp;less&nbsp;independent:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;Do&nbsp;we&nbsp;reorder&nbsp;whole&nbsp;access&nbsp;regions&nbsp;relative&nbsp;to&nbsp;one&nbsp;another?<br>
&lt;li&gt;&nbsp;Do&nbsp;we&nbsp;attempt&nbsp;to&nbsp;fill&nbsp;padding&nbsp;in&nbsp;earlier&nbsp;access&nbsp;regions&nbsp;with<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;members&nbsp;from&nbsp;later&nbsp;regions?<br>
&lt;li&gt;&nbsp;Do&nbsp;we&nbsp;fill&nbsp;the&nbsp;tail&nbsp;padding&nbsp;of&nbsp;non-POD&nbsp;base&nbsp;classes&nbsp;with&nbsp;members&nbsp;from<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;class?<br>
&lt;li&gt;&nbsp;Do&nbsp;we&nbsp;attempt&nbsp;to&nbsp;fill&nbsp;interior&nbsp;padding&nbsp;of&nbsp;non-POD&nbsp;base&nbsp;classes&nbsp;with&nbsp;later<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;members?<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
There&nbsp;is&nbsp;no&nbsp;apparent&nbsp;support&nbsp;for&nbsp;(1),<br>
since&nbsp;no&nbsp;simple&nbsp;heuristic&nbsp;has&nbsp;been&nbsp;identified&nbsp;with&nbsp;obvious&nbsp;benefits.<br>
There&nbsp;is&nbsp;interest&nbsp;in&nbsp;(2),&nbsp;based&nbsp;on&nbsp;a&nbsp;simple&nbsp;heuristic&nbsp;which&nbsp;might<br>
sometimes&nbsp;help&nbsp;and&nbsp;will&nbsp;never&nbsp;hurt.<br>
However,&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;that&nbsp;it&nbsp;will&nbsp;help&nbsp;much,<br>
and&nbsp;Sun&nbsp;objects&nbsp;on&nbsp;grounds&nbsp;that&nbsp;they&nbsp;prefer&nbsp;to&nbsp;match&nbsp;C&nbsp;struct&nbsp;layout.<br>
Unless&nbsp;someone&nbsp;is&nbsp;interested&nbsp;enough&nbsp;to&nbsp;implement&nbsp;and&nbsp;run&nbsp;experiments,<br>
this&nbsp;will&nbsp;be&nbsp;hard&nbsp;to&nbsp;agree&nbsp;upon.<br>
G++&nbsp;has&nbsp;implemented&nbsp;(3)&nbsp;as&nbsp;an&nbsp;option,<br>
based&nbsp;on&nbsp;specific&nbsp;user&nbsp;complaints.<br>
It&nbsp;clearly&nbsp;helps&nbsp;HP's&nbsp;example&nbsp;of&nbsp;a&nbsp;base&nbsp;class&nbsp;containing&nbsp;a&nbsp;word&nbsp;and&nbsp;flag,<br>
with&nbsp;a&nbsp;derived&nbsp;class&nbsp;adding&nbsp;more&nbsp;flags.<br>
Idea&nbsp;(4)&nbsp;has&nbsp;more&nbsp;problems,&nbsp;including&nbsp;some&nbsp;non-intuitive&nbsp;(to&nbsp;users)&nbsp;layouts,<br>
and&nbsp;possibly&nbsp;complicating&nbsp;the&nbsp;selection&nbsp;of&nbsp;bitwise&nbsp;copy&nbsp;in&nbsp;the&nbsp;compiler.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;all]&lt;/font&gt;<br>
We&nbsp;will&nbsp;not&nbsp;do&nbsp;(1),&nbsp;(2),&nbsp;or&nbsp;(4).&nbsp;&nbsp;We&nbsp;will&nbsp;do&nbsp;(3).<br>
Specifically,&nbsp;allocation&nbsp;will&nbsp;be&nbsp;in&nbsp;modified&nbsp;declaration&nbsp;order&nbsp;as&nbsp;follows:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;Vptr&nbsp;if&nbsp;any,&nbsp;and&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;per&nbsp;A-7.<br>
&lt;li&gt;&nbsp;Any&nbsp;empty&nbsp;base&nbsp;classes&nbsp;allocated&nbsp;at&nbsp;offset&nbsp;zero&nbsp;per&nbsp;A-3.<br>
&lt;li&gt;&nbsp;Any&nbsp;remaining&nbsp;non-virtual&nbsp;base&nbsp;classes.<br>
&lt;li&gt;&nbsp;Any&nbsp;non-static&nbsp;data&nbsp;members.<br>
&lt;li&gt;&nbsp;Any&nbsp;remaining&nbsp;virtual&nbsp;base&nbsp;classes.<br>
&lt;/ol&gt;<br>
Each&nbsp;subobject&nbsp;allocated&nbsp;is&nbsp;placed&nbsp;at&nbsp;the&nbsp;next&nbsp;available&nbsp;position&nbsp;that<br>
satisfies&nbsp;its&nbsp;alignment&nbsp;constraints,&nbsp;as&nbsp;in&nbsp;the&nbsp;underlying&nbsp;psABI.<br>
This&nbsp;is&nbsp;interpreted&nbsp;with&nbsp;the&nbsp;following&nbsp;special&nbsp;cases:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;The&nbsp;&quot;next&nbsp;available&nbsp;position&quot;&nbsp;after&nbsp;a&nbsp;non-POD&nbsp;class&nbsp;subobject<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(base&nbsp;class&nbsp;or&nbsp;data&nbsp;member)&nbsp;with&nbsp;tail&nbsp;padding&nbsp;is&nbsp;at&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beginning&nbsp;of&nbsp;the&nbsp;tail&nbsp;padding,&nbsp;not&nbsp;after&nbsp;it.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(For&nbsp;POD&nbsp;objects,&nbsp;the&nbsp;tail&nbsp;padding&nbsp;is&nbsp;not&nbsp;&quot;available.&quot;)<br>
&lt;li&gt;&nbsp;Empty&nbsp;classes&nbsp;are&nbsp;considered&nbsp;to&nbsp;have&nbsp;alignment&nbsp;and&nbsp;size&nbsp;1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consisting&nbsp;solely&nbsp;of&nbsp;one&nbsp;byte&nbsp;of&nbsp;tail&nbsp;padding.<br>
&lt;li&gt;&nbsp;Placement&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;tail&nbsp;padding&nbsp;of&nbsp;an&nbsp;empty&nbsp;class&nbsp;must&nbsp;avoid<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placing&nbsp;multiple&nbsp;subobjects&nbsp;of&nbsp;the&nbsp;same&nbsp;type&nbsp;at&nbsp;the&nbsp;same<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;address.<br>
&lt;/ol&gt;<br>
After&nbsp;allocation&nbsp;is&nbsp;complete,<br>
the&nbsp;size&nbsp;is&nbsp;rounded&nbsp;up&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;alignment&nbsp;(with&nbsp;tail&nbsp;padding).<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990722&nbsp;all]&lt;/font&gt;<br>
The&nbsp;precise&nbsp;placement&nbsp;of&nbsp;empty&nbsp;bases&nbsp;when&nbsp;they&nbsp;don't&nbsp;fit&nbsp;at&nbsp;offset&nbsp;zero<br>
remains&nbsp;imprecise&nbsp;in&nbsp;the&nbsp;above.<br>
Accordingly,&nbsp;a&nbsp;precise&nbsp;layout&nbsp;algorithm&nbsp;is&nbsp;described&nbsp;in<br>
a&nbsp;separate&nbsp;writeup&nbsp;of&nbsp;&lt;a&nbsp;href=abi-layout.html&gt;Data&nbsp;Layout&lt;/a&gt;.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;all]&lt;/font&gt;<br>
The&nbsp;layout&nbsp;writeup&nbsp;was&nbsp;accepted,<br>
with&nbsp;the&nbsp;first&nbsp;choice&nbsp;for&nbsp;empty&nbsp;base&nbsp;placement.<br>
That&nbsp;is,&nbsp;if&nbsp;placement&nbsp;at&nbsp;offset&nbsp;zero&nbsp;doesn't&nbsp;work,<br>
it&nbsp;will&nbsp;be&nbsp;placed&nbsp;like&nbsp;a&nbsp;normal&nbsp;base/member.<br>
The&nbsp;concensus&nbsp;was&nbsp;that&nbsp;this&nbsp;won't&nbsp;happen&nbsp;often,<br>
and&nbsp;such&nbsp;bases&nbsp;will&nbsp;often&nbsp;overlap&nbsp;with&nbsp;the&nbsp;preceding&nbsp;tail&nbsp;padding&nbsp;or<br>
following&nbsp;components&nbsp;anyway.<br>
Jim&nbsp;will&nbsp;modify&nbsp;the&nbsp;writeup&nbsp;accordingly.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-10&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Class&nbsp;parameters&nbsp;in&nbsp;registers&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990710&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;C&nbsp;ABI&nbsp;specifies&nbsp;that&nbsp;structs&nbsp;are&nbsp;passed&nbsp;in&nbsp;registers.<br>
Does&nbsp;this&nbsp;apply&nbsp;to&nbsp;small&nbsp;non-POD&nbsp;C++&nbsp;objects&nbsp;passed&nbsp;by&nbsp;value?<br>
What&nbsp;about&nbsp;the&nbsp;copy&nbsp;constructor&nbsp;and&nbsp;&lt;code&gt;this&lt;/code&gt;&nbsp;pointer&nbsp;in&nbsp;that&nbsp;case?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;all]&lt;/font&gt;<br>
A&nbsp;separate&nbsp;issue&nbsp;(C-7)&nbsp;deals&nbsp;with&nbsp;cases&nbsp;where&nbsp;a&nbsp;non-trivial&nbsp;copy<br>
constructor&nbsp;is&nbsp;required;&nbsp;we&nbsp;ignore&nbsp;those&nbsp;cases&nbsp;here.<br>
Our&nbsp;conclusion&nbsp;is&nbsp;that,&nbsp;without&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor,<br>
we&nbsp;need&nbsp;not&nbsp;be&nbsp;concerned&nbsp;about&nbsp;the&nbsp;class&nbsp;object&nbsp;moving&nbsp;in&nbsp;the&nbsp;process<br>
of&nbsp;being&nbsp;passed,&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;use&nbsp;a&nbsp;mechanism&nbsp;different&nbsp;from<br>
the&nbsp;base&nbsp;ABI&nbsp;C&nbsp;struct&nbsp;mechanism.<br>
At&nbsp;the&nbsp;same&nbsp;time,&nbsp;if&nbsp;we&nbsp;do&nbsp;use&nbsp;the&nbsp;underlying&nbsp;C&nbsp;struct&nbsp;mechanism,<br>
the&nbsp;user&nbsp;has&nbsp;complete&nbsp;control&nbsp;of&nbsp;the&nbsp;passing&nbsp;technique,<br>
by&nbsp;choosing&nbsp;whether&nbsp;to&nbsp;pass&nbsp;by&nbsp;value&nbsp;or&nbsp;reference/pointer.<br>
<br>
&lt;p&gt;<br>
Therefore,&nbsp;except&nbsp;in&nbsp;cases&nbsp;identified&nbsp;by&nbsp;issue&nbsp;C-7&nbsp;for&nbsp;different&nbsp;treatment,<br>
class&nbsp;parameters&nbsp;will&nbsp;be&nbsp;passed&nbsp;using&nbsp;the&nbsp;underlying&nbsp;C&nbsp;struct&nbsp;protocol.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A11&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-11&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Pointers&nbsp;to&nbsp;member&nbsp;functions&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Cygnus&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990812&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;should&nbsp;pointers&nbsp;to&nbsp;member&nbsp;functions&nbsp;be&nbsp;represented?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
As&nbsp;a&nbsp;pair&nbsp;of&nbsp;values,&nbsp;described&nbsp;below.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;All]&lt;/font&gt;<br>
Jason&nbsp;described&nbsp;the&nbsp;g++&nbsp;implementation,&nbsp;which&nbsp;is&nbsp;a&nbsp;three-member&nbsp;struct:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;The&nbsp;adjustment&nbsp;to&nbsp;&lt;i&gt;this&lt;/i&gt;.<br>
&lt;li&gt;&nbsp;The&nbsp;Vtable&nbsp;index&nbsp;plus&nbsp;one&nbsp;of&nbsp;the&nbsp;function,&nbsp;or&nbsp;-1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Zero&nbsp;is&nbsp;a&nbsp;NULL&nbsp;pointer.)<br>
&lt;li&gt;&nbsp;If&nbsp;(2)&nbsp;is&nbsp;an&nbsp;index,&nbsp;the&nbsp;offset&nbsp;from&nbsp;the&nbsp;full&nbsp;object&nbsp;to&nbsp;the&nbsp;member<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function's&nbsp;Vtable.&nbsp;&nbsp;If&nbsp;-1,&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;function&nbsp;(non-virtual).<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
A&nbsp;concern&nbsp;about&nbsp;covariant&nbsp;returns&nbsp;was&nbsp;raised.<br>
It&nbsp;was&nbsp;observed&nbsp;that,&nbsp;given&nbsp;our&nbsp;decision&nbsp;to&nbsp;use&nbsp;distinct&nbsp;Vtable&nbsp;entries<br>
for&nbsp;distinct&nbsp;return&nbsp;types,&nbsp;no&nbsp;further&nbsp;concern&nbsp;is&nbsp;required&nbsp;here.<br>
Others&nbsp;will&nbsp;describe&nbsp;their&nbsp;representations.<br>
IBM&nbsp;has&nbsp;an&nbsp;alternative,&nbsp;but&nbsp;it&nbsp;is&nbsp;believed&nbsp;to&nbsp;be&nbsp;patented&nbsp;by&nbsp;Microsoft.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
It&nbsp;is&nbsp;agreed&nbsp;that&nbsp;a&nbsp;two-element&nbsp;struct&nbsp;will&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a<br>
member&nbsp;function,&nbsp;with&nbsp;elements&nbsp;as&nbsp;follows:<br>
<br>
&lt;dl&gt;<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;ptr&lt;/code&gt;:<br>
&lt;dd&gt;&nbsp;For&nbsp;a&nbsp;non-virtual&nbsp;function,&nbsp;this&nbsp;field&nbsp;is&nbsp;a&nbsp;simple&nbsp;function&nbsp;pointer.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Under&nbsp;current&nbsp;base&nbsp;IA-64&nbsp;psABI&nbsp;conventions,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;GP/function&nbsp;address&nbsp;pair.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;a&nbsp;virtual&nbsp;function,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;is&nbsp;1&nbsp;plus&nbsp;twice&nbsp;the&nbsp;Vtable&nbsp;offset&nbsp;of&nbsp;the&nbsp;function.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;value&nbsp;zero&nbsp;is&nbsp;a&nbsp;NULL&nbsp;pointer.<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;adj&lt;/code&gt;:<br>
&lt;dd&gt;&nbsp;The&nbsp;required&nbsp;adjustment&nbsp;to&nbsp;&lt;i&gt;this&lt;/i&gt;.<br>
&lt;/dl&gt;<br>
<br>
&lt;p&gt;<br>
Although&nbsp;we&nbsp;agreed&nbsp;to&nbsp;close&nbsp;this,&nbsp;SGI&nbsp;suggests&nbsp;a&nbsp;minor&nbsp;modification.<br>
Since&nbsp;the&nbsp;Vtable&nbsp;offset&nbsp;of&nbsp;a&nbsp;virtual&nbsp;function&nbsp;will&nbsp;always&nbsp;be&nbsp;even,<br>
we&nbsp;suggest&nbsp;that&nbsp;it&nbsp;not&nbsp;be&nbsp;doubled&nbsp;before&nbsp;adding&nbsp;1.<br>
This&nbsp;is&nbsp;because&nbsp;shifts&nbsp;are&nbsp;more&nbsp;restricted&nbsp;on&nbsp;many&nbsp;processors&nbsp;than<br>
other&nbsp;integer&nbsp;ALU&nbsp;operations&nbsp;(shifters&nbsp;are&nbsp;large&nbsp;structures),<br>
so&nbsp;an&nbsp;XOR&nbsp;or&nbsp;NAND&nbsp;will&nbsp;often&nbsp;be&nbsp;cheaper&nbsp;than&nbsp;a&nbsp;right&nbsp;shift.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990812&nbsp;All]&lt;/font&gt;<br>
Close&nbsp;this&nbsp;issue&nbsp;with&nbsp;the&nbsp;suggested&nbsp;modification.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-12&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Merging&nbsp;secondary&nbsp;vtables&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sun&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990610&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Sun&nbsp;merges&nbsp;the&nbsp;secondary&nbsp;Vtables&nbsp;for&nbsp;a&nbsp;class&nbsp;(i.e.&nbsp;those&nbsp;for<br>
non-primary&nbsp;base&nbsp;classes)&nbsp;with&nbsp;the&nbsp;primary&nbsp;Vtable&nbsp;by&nbsp;appending&nbsp;them.<br>
This&nbsp;allows&nbsp;their&nbsp;reference&nbsp;via&nbsp;the&nbsp;primary&nbsp;Vtable&nbsp;entry&nbsp;symbol,<br>
minimizing&nbsp;the&nbsp;number&nbsp;of&nbsp;external&nbsp;symbols&nbsp;required&nbsp;in&nbsp;linking,<br>
in&nbsp;the&nbsp;GOT,&nbsp;etc.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Concatenate&nbsp;the&nbsp;Vtables&nbsp;associated&nbsp;with&nbsp;a&nbsp;class&nbsp;in&nbsp;the&nbsp;same&nbsp;order<br>
that&nbsp;the&nbsp;corresponding&nbsp;base&nbsp;subobjects&nbsp;are&nbsp;allocated&nbsp;in&nbsp;the&nbsp;object.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;Michael&nbsp;Lam]&lt;/font&gt;<br>
Michael&nbsp;will&nbsp;check&nbsp;what&nbsp;the&nbsp;Sun&nbsp;ABI&nbsp;treatment&nbsp;is&nbsp;and&nbsp;report&nbsp;back.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;All]&lt;/font&gt;<br>
A&nbsp;separate&nbsp;issue&nbsp;raised&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;A-7&nbsp;is&nbsp;whether&nbsp;to&nbsp;include<br>
Vfunc&nbsp;pointers&nbsp;in&nbsp;the&nbsp;primary&nbsp;Vtable&nbsp;for&nbsp;functions&nbsp;defined&nbsp;only&nbsp;in&nbsp;the<br>
base&nbsp;classes&nbsp;and&nbsp;not&nbsp;overridden.<br>
If&nbsp;the&nbsp;primary&nbsp;and&nbsp;secondary&nbsp;Vtables&nbsp;are&nbsp;concatenated,<br>
this&nbsp;is&nbsp;no&nbsp;longer&nbsp;an&nbsp;issue,<br>
since&nbsp;all&nbsp;can&nbsp;be&nbsp;referenced&nbsp;from&nbsp;the&nbsp;primary&nbsp;Vptr.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
All&nbsp;of&nbsp;the&nbsp;Vtables&nbsp;associated&nbsp;with&nbsp;a&nbsp;class&nbsp;will&nbsp;be&nbsp;concatenated,<br>
and&nbsp;a&nbsp;single&nbsp;external&nbsp;symbol&nbsp;used<br>
(to&nbsp;be&nbsp;identified&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;mangling&nbsp;issue&nbsp;F-1).<br>
The&nbsp;order&nbsp;of&nbsp;the&nbsp;tables&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;order&nbsp;of&nbsp;base&nbsp;class<br>
subobjects&nbsp;in&nbsp;an&nbsp;object&nbsp;of&nbsp;the&nbsp;class,<br>
i.e.&nbsp;first&nbsp;the&nbsp;primary&nbsp;Vtable,<br>
then&nbsp;the&nbsp;non-virtual&nbsp;base&nbsp;classes&nbsp;in&nbsp;declaration&nbsp;order,<br>
and&nbsp;finally&nbsp;the&nbsp;virtual&nbsp;base&nbsp;classes&nbsp;in&nbsp;depth-first&nbsp;declaration&nbsp;order.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-13&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Parameter&nbsp;struct&nbsp;field&nbsp;promotion&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;is&nbsp;possible&nbsp;to&nbsp;pass&nbsp;small&nbsp;classes&nbsp;either&nbsp;as&nbsp;memory&nbsp;images,<br>
as&nbsp;is&nbsp;specified&nbsp;by&nbsp;the&nbsp;base&nbsp;ABI&nbsp;for&nbsp;C&nbsp;structs,<br>
or&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;parameters,&nbsp;one&nbsp;for&nbsp;each&nbsp;member.<br>
Which&nbsp;should&nbsp;be&nbsp;done,&nbsp;and&nbsp;if&nbsp;the&nbsp;latter,<br>
what&nbsp;are&nbsp;the&nbsp;rules&nbsp;for&nbsp;identifying&nbsp;&quot;small&quot;&nbsp;classes?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
No&nbsp;special&nbsp;treatment&nbsp;will&nbsp;be&nbsp;specified&nbsp;by&nbsp;the&nbsp;ABI.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;all]&lt;/font&gt;<br>
Define&nbsp;no&nbsp;special&nbsp;treatment&nbsp;for&nbsp;this&nbsp;case&nbsp;in&nbsp;the&nbsp;ABI.<br>
A&nbsp;translator&nbsp;with&nbsp;control&nbsp;over&nbsp;both&nbsp;caller&nbsp;and&nbsp;callee&nbsp;may&nbsp;choose&nbsp;to&nbsp;optimize.<br>
<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;class=small&gt;&nbsp;&lt;td&gt;&nbsp;A-14&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Pointers&nbsp;to&nbsp;data&nbsp;members&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990729&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;should&nbsp;pointers&nbsp;to&nbsp;data&nbsp;members&nbsp;be&nbsp;represented?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Represented&nbsp;as&nbsp;one&nbsp;plus&nbsp;the&nbsp;offset&nbsp;from&nbsp;the&nbsp;base&nbsp;address.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;SGI]&lt;/font&gt;<br>
We&nbsp;suggest&nbsp;an&nbsp;offset&nbsp;from&nbsp;the&nbsp;base&nbsp;address&nbsp;of&nbsp;the&nbsp;class,<br>
represented&nbsp;as&nbsp;a&nbsp;&lt;code&gt;ptrdiff_t&lt;/code&gt;.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
Such&nbsp;pointers&nbsp;are&nbsp;represented&nbsp;as&nbsp;one&nbsp;plus&nbsp;the&nbsp;offset&nbsp;from&nbsp;the&nbsp;base<br>
address&nbsp;of&nbsp;the&nbsp;class,&nbsp;as&nbsp;a&nbsp;&lt;code&gt;ptrdiff_t&lt;/code&gt;.<br>
NULL&nbsp;pointers&nbsp;are&nbsp;zero.<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;B.&nbsp;&nbsp;Virtual&nbsp;Function&nbsp;Handling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;B-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Covariant&nbsp;return&nbsp;types&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990722&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
There&nbsp;are&nbsp;several&nbsp;methods&nbsp;for&nbsp;adjusting&nbsp;the&nbsp;'this'&nbsp;pointer&nbsp;of&nbsp;the<br>
returned&nbsp;value&nbsp;for&nbsp;member&nbsp;functions&nbsp;with&nbsp;covariant&nbsp;return&nbsp;types.<br>
We&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;this&nbsp;is&nbsp;done.<br>
Return&nbsp;thunks&nbsp;might&nbsp;be&nbsp;especially&nbsp;costly&nbsp;on&nbsp;IA64,<br>
so&nbsp;a&nbsp;solution&nbsp;based&nbsp;on&nbsp;returning&nbsp;multiple&nbsp;pointers&nbsp;may&nbsp;prove&nbsp;more&nbsp;interesting.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Provide&nbsp;a&nbsp;separate&nbsp;Vtable&nbsp;entry&nbsp;for&nbsp;each&nbsp;return&nbsp;type.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990610&nbsp;Matt]&lt;/font&gt;<br>
One&nbsp;possibility&nbsp;is&nbsp;to&nbsp;have&nbsp;two&nbsp;Vtable&nbsp;entries,<br>
which&nbsp;might&nbsp;point&nbsp;to&nbsp;different&nbsp;functions,&nbsp;different&nbsp;entrypoints,<br>
or&nbsp;a&nbsp;real&nbsp;entrypoint&nbsp;and&nbsp;a&nbsp;thunk.<br>
Another&nbsp;is&nbsp;to&nbsp;return&nbsp;two&nbsp;result&nbsp;pointers&nbsp;(base/derived),<br>
and&nbsp;have&nbsp;the&nbsp;caller&nbsp;select&nbsp;the&nbsp;right&nbsp;one.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990715&nbsp;All]&lt;/font&gt;<br>
Daveed&nbsp;presented&nbsp;his&nbsp;multiple-return-value&nbsp;scheme,<br>
including&nbsp;an&nbsp;example&nbsp;that&nbsp;involved&nbsp;virtual&nbsp;base&nbsp;classes,<br>
return&nbsp;values&nbsp;that&nbsp;are&nbsp;pointers&nbsp;to&nbsp;nonpolymorphic&nbsp;classes,<br>
and&nbsp;other&nbsp;equally&nbsp;horrible&nbsp;things.<br>
<br>
&lt;p&gt;<br>
Consensus:&nbsp;we&nbsp;need&nbsp;to&nbsp;get&nbsp;the&nbsp;horrible&nbsp;cases&nbsp;correct,<br>
but&nbsp;speed&nbsp;only&nbsp;matters&nbsp;in&nbsp;the&nbsp;simple&nbsp;case.<br>
The&nbsp;simple&nbsp;case:&nbsp;class&nbsp;B&nbsp;has&nbsp;a&nbsp;virtual&nbsp;function&nbsp;f&nbsp;returning&nbsp;a&nbsp;B1*<br>
and&nbsp;class&nbsp;D&nbsp;has&nbsp;a&nbsp;virtual&nbsp;function&nbsp;f&nbsp;returning&nbsp;a&nbsp;D1*,<br>
where&nbsp;all&nbsp;four&nbsp;classes&nbsp;are&nbsp;polymorphic,<br>
B&nbsp;is&nbsp;a&nbsp;primary&nbsp;base&nbsp;of&nbsp;D,&nbsp;and&nbsp;B1&nbsp;is&nbsp;a&nbsp;primary&nbsp;base&nbsp;of&nbsp;D1.<br>
(The&nbsp;really&nbsp;important&nbsp;case&nbsp;is&nbsp;where&nbsp;B1&nbsp;is&nbsp;B&nbsp;and&nbsp;D1&nbsp;is&nbsp;D,<br>
but&nbsp;that&nbsp;simplification&nbsp;doesn't&nbsp;make&nbsp;any&nbsp;difference.)<br>
<br>
&lt;p&gt;<br>
Jason:&nbsp;Would&nbsp;the&nbsp;usual&nbsp;multiple-entry-point&nbsp;scheme&nbsp;work&nbsp;just&nbsp;as&nbsp;well?<br>
That&nbsp;is,&nbsp;would&nbsp;it&nbsp;be&nbsp;just&nbsp;as&nbsp;fast&nbsp;as&nbsp;Daveed's&nbsp;scheme&nbsp;in&nbsp;the&nbsp;simple&nbsp;case,<br>
and&nbsp;still&nbsp;preserve&nbsp;enough&nbsp;information&nbsp;for&nbsp;the&nbsp;more&nbsp;complicated&nbsp;cases?<br>
It&nbsp;appears&nbsp;so,&nbsp;but&nbsp;we&nbsp;don't&nbsp;have&nbsp;a&nbsp;proof.<br>
Jason&nbsp;will&nbsp;try&nbsp;to&nbsp;provide&nbsp;one.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990716&nbsp;Cygnus&nbsp;--&nbsp;Jason]&lt;/font&gt;<br>
Proof?<br>
You&nbsp;always&nbsp;know&nbsp;what&nbsp;types&nbsp;a&nbsp;given&nbsp;override&nbsp;must&nbsp;be&nbsp;able&nbsp;to&nbsp;return,<br>
and&nbsp;you&nbsp;know&nbsp;how&nbsp;to&nbsp;convert&nbsp;from&nbsp;the&nbsp;return&nbsp;type&nbsp;to&nbsp;those&nbsp;base&nbsp;types.<br>
You&nbsp;know&nbsp;from&nbsp;the&nbsp;entry&nbsp;point&nbsp;which&nbsp;type&nbsp;is&nbsp;desired.<br>
Seems&nbsp;pretty&nbsp;straightforward&nbsp;to&nbsp;me.<br>
<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990716&nbsp;Cygnus&nbsp;--&nbsp;Jason]&lt;/font&gt;<br>
The&nbsp;alternative&nbsp;I&nbsp;was&nbsp;talking&nbsp;about&nbsp;yesterday&nbsp;goes&nbsp;something&nbsp;like&nbsp;this:<br>
<br>
&lt;p&gt;<br>
When&nbsp;we&nbsp;have&nbsp;a&nbsp;non-trivial&nbsp;covariant&nbsp;return&nbsp;situation,<br>
we&nbsp;create&nbsp;a&nbsp;new&nbsp;entry&nbsp;in&nbsp;the&nbsp;vtable&nbsp;for&nbsp;the&nbsp;new&nbsp;return&nbsp;type.<br>
The&nbsp;caller&nbsp;chooses&nbsp;which&nbsp;vtable&nbsp;entry&nbsp;to&nbsp;use&nbsp;based&nbsp;on&nbsp;the&nbsp;type&nbsp;they&nbsp;want.<br>
<br>
&lt;p&gt;<br>
This&nbsp;could&nbsp;be&nbsp;implemented&nbsp;several&nbsp;ways,<br>
at&nbsp;the&nbsp;discretion&nbsp;of&nbsp;the&nbsp;vendor:<br>
<br>
&lt;ol&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Multiple&nbsp;entry&nbsp;points&nbsp;to&nbsp;one&nbsp;function,<br>
with&nbsp;an&nbsp;internal&nbsp;flag&nbsp;indicating&nbsp;which&nbsp;type&nbsp;to&nbsp;return.<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Thunks&nbsp;which&nbsp;intercept&nbsp;the&nbsp;function's&nbsp;return&nbsp;and&nbsp;modify&nbsp;the&nbsp;return&nbsp;value.<br>
Note&nbsp;that&nbsp;unlike&nbsp;the&nbsp;case&nbsp;of&nbsp;calling&nbsp;virtual&nbsp;functions,<br>
for&nbsp;covariant&nbsp;returns&nbsp;we&nbsp;always&nbsp;know&nbsp;which&nbsp;adjustments&nbsp;will&nbsp;be&nbsp;needed,<br>
so&nbsp;we&nbsp;don't&nbsp;have&nbsp;to&nbsp;pay&nbsp;for&nbsp;a&nbsp;long&nbsp;branch.<br>
We&nbsp;do,&nbsp;however,&nbsp;lose&nbsp;the&nbsp;1-1&nbsp;correspondence&nbsp;between&nbsp;calls&nbsp;and&nbsp;returns,<br>
which&nbsp;apparently&nbsp;affects&nbsp;performance&nbsp;on&nbsp;the&nbsp;Pentium&nbsp;Pro.<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Function&nbsp;duplication.<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;advantage&nbsp;of&nbsp;this&nbsp;approach&nbsp;to&nbsp;the&nbsp;complex&nbsp;case&nbsp;is&nbsp;that&nbsp;we&nbsp;don't&nbsp;have&nbsp;to<br>
do&nbsp;a&nbsp;dynamic_cast&nbsp;when&nbsp;faced&nbsp;with&nbsp;multiple&nbsp;levels&nbsp;of&nbsp;virtual&nbsp;derivation.<br>
It&nbsp;is&nbsp;also&nbsp;strictly&nbsp;simpler;<br>
Daveed's&nbsp;model&nbsp;already&nbsp;requires&nbsp;something&nbsp;like<br>
this&nbsp;in&nbsp;cases&nbsp;of&nbsp;multiple&nbsp;inheritance.<br>
<br>
&lt;p&gt;<br>
Of&nbsp;course,&nbsp;we&nbsp;can&nbsp;always&nbsp;mix&nbsp;and&nbsp;match;<br>
we&nbsp;could&nbsp;choose&nbsp;to&nbsp;only&nbsp;do&nbsp;this&nbsp;in&nbsp;cases&nbsp;of&nbsp;virtual&nbsp;inheritance,<br>
or&nbsp;use&nbsp;Daveed's&nbsp;proposal&nbsp;and&nbsp;do&nbsp;this&nbsp;only&nbsp;in<br>
cases&nbsp;of&nbsp;repeated&nbsp;virtual&nbsp;inheritance.<br>
In&nbsp;that&nbsp;case,&nbsp;the&nbsp;multiple&nbsp;returns<br>
would&nbsp;just&nbsp;be&nbsp;an&nbsp;optimization&nbsp;for&nbsp;the&nbsp;single&nbsp;virtual&nbsp;inheritance&nbsp;case.<br>
<br>
&lt;p&gt;<br>
Since&nbsp;we&nbsp;don't&nbsp;seem&nbsp;to&nbsp;care&nbsp;about&nbsp;the&nbsp;performance&nbsp;of<br>
anything&nbsp;but&nbsp;single&nbsp;nonvirtual&nbsp;inheritance,<br>
it&nbsp;seems&nbsp;simpler&nbsp;not&nbsp;to&nbsp;bother&nbsp;with&nbsp;multiple&nbsp;returns.<br>
<br>
&lt;p&gt;<br>
The&nbsp;remaining&nbsp;question&nbsp;is&nbsp;how&nbsp;to&nbsp;handle&nbsp;the&nbsp;case&nbsp;of&nbsp;nontrivial<br>
nonvirtual&nbsp;inheritance:<br>
do&nbsp;we&nbsp;use&nbsp;multiple&nbsp;slots&nbsp;or&nbsp;have&nbsp;the&nbsp;caller&nbsp;do&nbsp;the&nbsp;adjustment?<br>
My&nbsp;inclination&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;caller&nbsp;adjust.<br>
<br>
&lt;p&gt;<br>
WRT&nbsp;patents,<br>
the&nbsp;idea&nbsp;of&nbsp;having&nbsp;the&nbsp;function&nbsp;return&nbsp;the&nbsp;base-most&nbsp;class&nbsp;and&nbsp;having<br>
the&nbsp;caller&nbsp;adjust&nbsp;is&nbsp;parallel&nbsp;to&nbsp;the&nbsp;patented&nbsp;Microsoft&nbsp;scheme&nbsp;whereby<br>
they&nbsp;pass&nbsp;the&nbsp;base-most&nbsp;class&nbsp;as&nbsp;the&nbsp;'this'&nbsp;argument&nbsp;to&nbsp;virtual&nbsp;functions,<br>
but&nbsp;the&nbsp;word&nbsp;'return'&nbsp;does&nbsp;not&nbsp;appear&nbsp;anywhere&nbsp;in&nbsp;the&nbsp;patent,<br>
so&nbsp;it&nbsp;seems&nbsp;safe.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990722&nbsp;All]&lt;/font&gt;<br>
The&nbsp;group&nbsp;was&nbsp;generally&nbsp;agreed&nbsp;that&nbsp;the&nbsp;simplicity&nbsp;of&nbsp;multiple&nbsp;entries<br>
in&nbsp;the&nbsp;vtable&nbsp;outweighed&nbsp;any&nbsp;space/performance&nbsp;advantage&nbsp;of&nbsp;more<br>
complex&nbsp;schemes&nbsp;(e.g.&nbsp;the&nbsp;method&nbsp;Daveed&nbsp;described&nbsp;on&nbsp;15&nbsp;July).<br>
Discussion&nbsp;focussed&nbsp;on&nbsp;whether&nbsp;it&nbsp;is&nbsp;worthwhile&nbsp;to&nbsp;eliminate&nbsp;some&nbsp;of<br>
the&nbsp;entries&nbsp;in&nbsp;cases&nbsp;where&nbsp;they&nbsp;are&nbsp;unnecessary&nbsp;because&nbsp;the&nbsp;caller<br>
knows&nbsp;the&nbsp;required&nbsp;conversion,<br>
namely&nbsp;when&nbsp;the&nbsp;return&nbsp;type&nbsp;has&nbsp;a&nbsp;unique&nbsp;non-virtual&nbsp;subobject&nbsp;of&nbsp;the<br>
original&nbsp;return&nbsp;type.<br>
<br>
&lt;p&gt;<br>
Agreement&nbsp;was&nbsp;reached&nbsp;to&nbsp;avoid&nbsp;the&nbsp;complication&nbsp;of&nbsp;eliminating&nbsp;some&nbsp;of<br>
the&nbsp;Vtable&nbsp;entries.<br>
Thus,&nbsp;the&nbsp;Vtable&nbsp;will&nbsp;have&nbsp;one&nbsp;entry&nbsp;for&nbsp;each&nbsp;accessible&nbsp;return&nbsp;type&nbsp;of<br>
a&nbsp;covariant&nbsp;virtual&nbsp;function.<br>
These&nbsp;may&nbsp;be&nbsp;implemented&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;ways,<br>
e.g.&nbsp;duplicated&nbsp;functions,&nbsp;separate&nbsp;entrypoints,&nbsp;or&nbsp;stubs,<br>
and&nbsp;the&nbsp;ABI&nbsp;need&nbsp;not&nbsp;specify&nbsp;the&nbsp;choice.<br>
The&nbsp;location&nbsp;of&nbsp;the&nbsp;Vtable&nbsp;entries&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;separate&nbsp;Vtable<br>
layout&nbsp;issue&nbsp;B-6.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;B-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Allowed&nbsp;caching&nbsp;of&nbsp;vtable&nbsp;contents&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;contents&nbsp;of&nbsp;the&nbsp;vtable&nbsp;can&nbsp;sometimes&nbsp;be&nbsp;modified,<br>
but&nbsp;the&nbsp;concensus&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;nonetheless&nbsp;always&nbsp;allowed&nbsp;to&nbsp;&quot;cache&quot;&nbsp;elements,<br>
i.e.&nbsp;to&nbsp;retain&nbsp;them&nbsp;in&nbsp;registers&nbsp;and&nbsp;reuse&nbsp;them,<br>
whenever&nbsp;it&nbsp;is&nbsp;really&nbsp;useful.<br>
However,&nbsp;this&nbsp;may&nbsp;sometimes&nbsp;break&nbsp;&quot;beyond&nbsp;the&nbsp;standard&quot;&nbsp;code,<br>
such&nbsp;as&nbsp;code&nbsp;loading&nbsp;a&nbsp;shared&nbsp;library&nbsp;that&nbsp;replaces&nbsp;a&nbsp;virtual&nbsp;function.<br>
Can&nbsp;we&nbsp;all&nbsp;agree&nbsp;when&nbsp;caching&nbsp;is&nbsp;allowed?&nbsp;<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
Caching&nbsp;is&nbsp;allowed.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990604&nbsp;HP&nbsp;--&nbsp;Christophe]&lt;/font&gt;<br>
Mike&nbsp;(Ball)&nbsp;gave&nbsp;me&nbsp;what&nbsp;I&nbsp;believe&nbsp;is&nbsp;an&nbsp;excellent&nbsp;definition&nbsp;of&nbsp;&nbsp;<br>
when&nbsp;caching&nbsp;is&nbsp;allowed.&nbsp;&nbsp;I'd&nbsp;like&nbsp;him&nbsp;to&nbsp;present&nbsp;it.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
Christophe&nbsp;explained&nbsp;that&nbsp;the&nbsp;rule&nbsp;is&nbsp;simply&nbsp;that,<br>
within&nbsp;a&nbsp;call&nbsp;to&nbsp;a&nbsp;member&nbsp;function&nbsp;of&nbsp;the&nbsp;class,<br>
the&nbsp;class&nbsp;Vtable&nbsp;may&nbsp;not&nbsp;be&nbsp;modified.<br>
Between&nbsp;such&nbsp;calls,&nbsp;no&nbsp;assumption&nbsp;may&nbsp;be&nbsp;made.<br>
With&nbsp;this&nbsp;observation,&nbsp;the&nbsp;issue&nbsp;is&nbsp;closed.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990812&nbsp;All]&lt;/font&gt;<br>
The&nbsp;rule&nbsp;is&nbsp;even&nbsp;simpler.<br>
Once&nbsp;a&nbsp;program&nbsp;changes&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;pointer's&nbsp;target,<br>
the&nbsp;pointer&nbsp;is&nbsp;invalidated,&nbsp;and&nbsp;its&nbsp;value&nbsp;may&nbsp;not&nbsp;be&nbsp;reused.<br>
Therefore,&nbsp;a&nbsp;code&nbsp;sequence&nbsp;which&nbsp;repeatedly&nbsp;refers&nbsp;to&nbsp;the&nbsp;same&nbsp;pointer<br>
value&nbsp;is&nbsp;invalid&nbsp;if&nbsp;the&nbsp;pointee's&nbsp;vtable&nbsp;has&nbsp;been&nbsp;changed.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;B-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Function&nbsp;descriptors&nbsp;in&nbsp;vtable&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
For&nbsp;a&nbsp;runtime&nbsp;architecture&nbsp;where&nbsp;the&nbsp;caller&nbsp;is&nbsp;expected&nbsp;to&nbsp;load&nbsp;the&nbsp;GP<br>
of&nbsp;the&nbsp;callee&nbsp;(if&nbsp;it&nbsp;is&nbsp;in,&nbsp;or&nbsp;may&nbsp;be&nbsp;in,&nbsp;a&nbsp;different&nbsp;DSO),&nbsp;e.g.&nbsp;HP/UX,<br>
what&nbsp;should&nbsp;vtable&nbsp;entries&nbsp;contain?<br>
One&nbsp;possibility&nbsp;is&nbsp;to&nbsp;put&nbsp;a&nbsp;function&nbsp;address/GP&nbsp;pair&nbsp;in&nbsp;the&nbsp;vtable.<br>
Another&nbsp;is&nbsp;to&nbsp;include&nbsp;only&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;thunk&nbsp;which&nbsp;loads&nbsp;the&nbsp;GP<br>
before&nbsp;doing&nbsp;the&nbsp;actual&nbsp;call.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
The&nbsp;Vtable&nbsp;will&nbsp;contain&nbsp;a&nbsp;function&nbsp;address/GP&nbsp;pair.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Note&nbsp;that&nbsp;putting&nbsp;GP&nbsp;in&nbsp;the&nbsp;Vtable&nbsp;prevents&nbsp;putting&nbsp;it&nbsp;in&nbsp;shared&nbsp;memory.<br>
See&nbsp;B-7.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
It&nbsp;was&nbsp;decided&nbsp;that&nbsp;special&nbsp;representations&nbsp;to&nbsp;accomodate&nbsp;shared&nbsp;memory<br>
would&nbsp;be&nbsp;expensive&nbsp;and&nbsp;therefore&nbsp;undesirable.<br>
Therefore,&nbsp;the&nbsp;decision&nbsp;is&nbsp;to&nbsp;put&nbsp;the&nbsp;function&nbsp;address/GP&nbsp;pair&nbsp;in&nbsp;the<br>
vtable,&nbsp;avoiding&nbsp;the&nbsp;cost&nbsp;of&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;in&nbsp;using&nbsp;it.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;B-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Objects&nbsp;and&nbsp;Vtables&nbsp;in&nbsp;shared&nbsp;memory&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;allocate&nbsp;objects&nbsp;in&nbsp;shared&nbsp;memory?<br>
For&nbsp;polymorphic&nbsp;objects,&nbsp;this&nbsp;implies&nbsp;that&nbsp;the&nbsp;Vtable&nbsp;must&nbsp;also&nbsp;be<br>
in&nbsp;shared&nbsp;memory.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
No&nbsp;special&nbsp;representation&nbsp;is&nbsp;useful&nbsp;in&nbsp;support&nbsp;of&nbsp;shared&nbsp;memory.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;All]&lt;/font&gt;<br>
Note&nbsp;that&nbsp;putting&nbsp;GP&nbsp;in&nbsp;the&nbsp;Vtable&nbsp;prevents&nbsp;putting&nbsp;it&nbsp;in&nbsp;shared&nbsp;memory.<br>
This&nbsp;interacts&nbsp;with&nbsp;B-4.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;HP&nbsp;--&nbsp;Cary]&lt;/font&gt;<br>
For&nbsp;a&nbsp;C++&nbsp;object&nbsp;to&nbsp;be&nbsp;placed&nbsp;into&nbsp;shared&nbsp;memory,<br>
its&nbsp;vtable&nbsp;pointer&nbsp;must&nbsp;be&nbsp;valid&nbsp;in&nbsp;all&nbsp;processes<br>
that&nbsp;are&nbsp;sharing&nbsp;that&nbsp;object.<br>
<br>
&lt;ol&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
If&nbsp;the&nbsp;vtable&nbsp;can&nbsp;be&nbsp;placed&nbsp;in&nbsp;text,&nbsp;that&nbsp;would&nbsp;be&nbsp;fine,<br>
but&nbsp;the&nbsp;vtable&nbsp;contains&nbsp;function&nbsp;pointers&nbsp;(or&nbsp;descriptors)<br>
that&nbsp;require&nbsp;runtime&nbsp;relocation,&nbsp;so&nbsp;it&nbsp;must&nbsp;be&nbsp;in&nbsp;data.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
We&nbsp;can&nbsp;place&nbsp;the&nbsp;vtables&nbsp;in&nbsp;shared&nbsp;memory,<br>
but&nbsp;only&nbsp;if&nbsp;the&nbsp;function&nbsp;pointers/descriptors&nbsp;are&nbsp;valid&nbsp;in&nbsp;all&nbsp;processes.<br>
The&nbsp;entry&nbsp;point&nbsp;addresses,&nbsp;which&nbsp;refer&nbsp;to&nbsp;shared&nbsp;text,&nbsp;should&nbsp;be&nbsp;shareable,<br>
but&nbsp;the&nbsp;gp&nbsp;values&nbsp;may&nbsp;not&nbsp;be&nbsp;identical&nbsp;for&nbsp;all&nbsp;processes.<br>
(RTTI&nbsp;pointers&nbsp;are&nbsp;also&nbsp;an&nbsp;issue,<br>
and&nbsp;could&nbsp;be&nbsp;solved&nbsp;by&nbsp;putting&nbsp;the&nbsp;RTTI&nbsp;information&nbsp;in&nbsp;shared&nbsp;memory&nbsp;as&nbsp;well.)<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
We&nbsp;can&nbsp;place&nbsp;the&nbsp;vtables&nbsp;in&nbsp;private&nbsp;memory,<br>
provided&nbsp;they&nbsp;are&nbsp;at&nbsp;the&nbsp;same&nbsp;address&nbsp;in&nbsp;all&nbsp;processes.<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
One&nbsp;way&nbsp;or&nbsp;another,<br>
we&nbsp;need&nbsp;a&nbsp;way&nbsp;of&nbsp;ensuring&nbsp;that&nbsp;a&nbsp;pointer&nbsp;from&nbsp;shared&nbsp;<br>
memory&nbsp;to&nbsp;private&nbsp;memory&nbsp;is&nbsp;valid&nbsp;in&nbsp;all&nbsp;processes,<br>
which&nbsp;means&nbsp;that&nbsp;we&nbsp;will&nbsp;need&nbsp;a&nbsp;means&nbsp;to&nbsp;ensure&nbsp;that&nbsp;certain&nbsp;shared<br>
library&nbsp;data&nbsp;segments&nbsp;can&nbsp;get&nbsp;mapped&nbsp;at&nbsp;the&nbsp;same&nbsp;address&nbsp;in&nbsp;all<br>
processes&nbsp;that&nbsp;load&nbsp;those&nbsp;certain&nbsp;libraries.<br>
<br>
&lt;p&gt;<br>
My&nbsp;wild&nbsp;idea&nbsp;a&nbsp;few&nbsp;years&nbsp;ago&nbsp;was&nbsp;to&nbsp;put&nbsp;the&nbsp;vtables&nbsp;in&nbsp;shared&nbsp;memory<br>
(by&nbsp;allocating&nbsp;and&nbsp;building&nbsp;them&nbsp;at&nbsp;load&nbsp;time,&nbsp;as&nbsp;Taligent&nbsp;did),<br>
and&nbsp;store&nbsp;a&nbsp;shared&nbsp;library&nbsp;index&nbsp;in&nbsp;place&nbsp;of&nbsp;the&nbsp;gp&nbsp;value<br>
in&nbsp;each&nbsp;function&nbsp;descriptor.<br>
Each&nbsp;process&nbsp;would&nbsp;have&nbsp;its&nbsp;own&nbsp;table&nbsp;of&nbsp;gp&nbsp;values,<br>
indexed&nbsp;by&nbsp;this&nbsp;shared&nbsp;library&nbsp;index,<br>
but&nbsp;the&nbsp;index&nbsp;space&nbsp;would&nbsp;be&nbsp;managed&nbsp;system-wide.<br>
The&nbsp;C++&nbsp;runtime&nbsp;library&nbsp;would&nbsp;have&nbsp;been&nbsp;responsible&nbsp;for&nbsp;allocating<br>
a&nbsp;new&nbsp;index&nbsp;for&nbsp;each&nbsp;unique&nbsp;C++&nbsp;shared&nbsp;library&nbsp;loaded&nbsp;on&nbsp;the&nbsp;system,<br>
then&nbsp;storing&nbsp;the&nbsp;process-local&nbsp;copy&nbsp;of&nbsp;the&nbsp;gp&nbsp;pointer&nbsp;in&nbsp;the&nbsp;<br>
appropriate&nbsp;slot&nbsp;of&nbsp;the&nbsp;table.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990628&nbsp;SGI&nbsp;--&nbsp;Jim]&lt;/font&gt;<br>
Note&nbsp;a&nbsp;further&nbsp;problem&nbsp;with&nbsp;vtables&nbsp;in&nbsp;shared&nbsp;memory&nbsp;(Cary's&nbsp;point&nbsp;2).<br>
If&nbsp;a&nbsp;virtual&nbsp;function&nbsp;comes&nbsp;from&nbsp;another&nbsp;DSO,<br>
it&nbsp;may&nbsp;be&nbsp;pre-empted&nbsp;differently&nbsp;in&nbsp;different&nbsp;programs.<br>
Hence,&nbsp;the&nbsp;function&nbsp;pointer&nbsp;itself&nbsp;is&nbsp;a&nbsp;problem&nbsp;even&nbsp;if&nbsp;the&nbsp;GP&nbsp;isn't.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
An&nbsp;extensive&nbsp;discussion&nbsp;boiled&nbsp;down&nbsp;to&nbsp;a&nbsp;few&nbsp;points:<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;The&nbsp;primary&nbsp;issue&nbsp;is&nbsp;objects&nbsp;in&nbsp;shared&nbsp;memory&nbsp;--<br>
&nbsp;&nbsp;&nbsp;&nbsp;vtables&nbsp;aren't&nbsp;interesting&nbsp;in&nbsp;themselves,&nbsp;but&nbsp;rather&nbsp;because<br>
&nbsp;&nbsp;&nbsp;&nbsp;putting&nbsp;the&nbsp;object&nbsp;in&nbsp;shared&nbsp;memory&nbsp;implies&nbsp;having&nbsp;the&nbsp;vtable&nbsp;at<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;same&nbsp;address&nbsp;in&nbsp;all&nbsp;sharing&nbsp;processes.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;Many&nbsp;of&nbsp;us&nbsp;have&nbsp;a&nbsp;few&nbsp;customers&nbsp;asking&nbsp;for&nbsp;this.<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;is&nbsp;not&nbsp;clear&nbsp;just&nbsp;how&nbsp;extensive&nbsp;a&nbsp;facility&nbsp;they&nbsp;need,<br>
&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;how&nbsp;automatic&nbsp;it&nbsp;needs&nbsp;to&nbsp;be.<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;should&nbsp;attempt&nbsp;to&nbsp;gauge&nbsp;the&nbsp;need.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;Noone&nbsp;thinks&nbsp;we&nbsp;should&nbsp;penalize&nbsp;the&nbsp;non-shared&nbsp;case&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;rare&nbsp;instances&nbsp;of&nbsp;shared&nbsp;demand.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;It&nbsp;is&nbsp;questionable&nbsp;whether&nbsp;we&nbsp;can&nbsp;define&nbsp;an&nbsp;ABI&nbsp;mechanism<br>
&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;will&nbsp;work&nbsp;on&nbsp;all&nbsp;of&nbsp;our&nbsp;systems,<br>
&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;we'd&nbsp;like&nbsp;not&nbsp;to&nbsp;preclude&nbsp;OS-specific&nbsp;extensions&nbsp;to&nbsp;do<br>
&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;if&nbsp;we&nbsp;can't.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;One&nbsp;possible&nbsp;approach&nbsp;would&nbsp;be&nbsp;an&nbsp;API&nbsp;allowing&nbsp;a&nbsp;user&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;place&nbsp;an&nbsp;object&nbsp;in&nbsp;shared&nbsp;memory,<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;then&nbsp;&quot;install&quot;&nbsp;it&nbsp;by&nbsp;setting&nbsp;its&nbsp;vtable&nbsp;pointers,<br>
&nbsp;&nbsp;&nbsp;&nbsp;possibly&nbsp;to&nbsp;copies&nbsp;also&nbsp;placed&nbsp;in&nbsp;the&nbsp;same&nbsp;shared&nbsp;memory.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;A&nbsp;more&nbsp;automatic&nbsp;approach&nbsp;would&nbsp;be&nbsp;something&nbsp;which&nbsp;allocated<br>
&nbsp;&nbsp;&nbsp;&nbsp;certain&nbsp;objects/vtables&nbsp;to&nbsp;shared&nbsp;memory,<br>
&nbsp;&nbsp;&nbsp;&nbsp;gave&nbsp;up&nbsp;at&nbsp;link&nbsp;time&nbsp;if&nbsp;not&nbsp;all&nbsp;pointers&nbsp;were&nbsp;internal&nbsp;to&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;being&nbsp;linked,<br>
&nbsp;&nbsp;&nbsp;&nbsp;attempted&nbsp;to&nbsp;place&nbsp;the&nbsp;relevant&nbsp;segments&nbsp;at&nbsp;the&nbsp;same&nbsp;runtime<br>
&nbsp;&nbsp;&nbsp;&nbsp;addresses&nbsp;to&nbsp;allow&nbsp;sharing,<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;gave&nbsp;up&nbsp;on&nbsp;sharing&nbsp;if&nbsp;this&nbsp;was&nbsp;not&nbsp;possible.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Such&nbsp;an&nbsp;approach&nbsp;would&nbsp;perhaps&nbsp;still&nbsp;require&nbsp;some&nbsp;care&nbsp;on&nbsp;the&nbsp;part<br>
&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;user&nbsp;to&nbsp;prevent&nbsp;problematic&nbsp;runtime&nbsp;situations.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
These&nbsp;ideas&nbsp;are&nbsp;very&nbsp;fuzzy.<br>
Participants&nbsp;should&nbsp;think&nbsp;about&nbsp;the&nbsp;need&nbsp;and&nbsp;possibilities&nbsp;and&nbsp;attempt<br>
to&nbsp;identify&nbsp;more&nbsp;concrete&nbsp;approaches.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
It&nbsp;was&nbsp;determined&nbsp;(largely&nbsp;based&nbsp;on&nbsp;consideration&nbsp;by&nbsp;Jason)<br>
that&nbsp;the&nbsp;only&nbsp;practical&nbsp;approach&nbsp;to&nbsp;putting&nbsp;objects&nbsp;in&nbsp;shared&nbsp;memory<br>
is&nbsp;to&nbsp;force&nbsp;the&nbsp;objects,&nbsp;Vtables,&nbsp;functions,&nbsp;etc.&nbsp;to&nbsp;the&nbsp;same&nbsp;addresses<br>
in&nbsp;the&nbsp;various&nbsp;processes&nbsp;involved.<br>
If&nbsp;this&nbsp;is&nbsp;done,&nbsp;data&nbsp;representation&nbsp;issues&nbsp;are&nbsp;irrelevant.<br>
Therefore,&nbsp;this&nbsp;issue&nbsp;is&nbsp;closed&nbsp;as&nbsp;moot.<br>
<br>
&lt;p&gt;<br>
Note&nbsp;that&nbsp;the&nbsp;base&nbsp;psABI&nbsp;defines&nbsp;a&nbsp;flag,&nbsp;EF_IA_64_ABSOLUTE,<br>
which&nbsp;forces&nbsp;an&nbsp;executable&nbsp;object&nbsp;to&nbsp;the&nbsp;addresses&nbsp;specified&nbsp;in&nbsp;ELF,<br>
so&nbsp;at&nbsp;least&nbsp;one&nbsp;method&nbsp;of&nbsp;representing&nbsp;this&nbsp;is&nbsp;already&nbsp;available.<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;C.&nbsp;&nbsp;Object&nbsp;Construction/Destruction&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;C-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Passing&nbsp;value&nbsp;parameters&nbsp;by&nbsp;reference&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;All&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;may&nbsp;be&nbsp;desirable&nbsp;in&nbsp;some&nbsp;cases&nbsp;where&nbsp;a&nbsp;type&nbsp;has&nbsp;a&nbsp;non-trivial<br>
copy&nbsp;constructor&nbsp;to&nbsp;pass&nbsp;value&nbsp;parameters&nbsp;of&nbsp;that&nbsp;type&nbsp;by&nbsp;performing<br>
the&nbsp;copy&nbsp;at&nbsp;the&nbsp;call&nbsp;site&nbsp;and&nbsp;passing&nbsp;a&nbsp;reference.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
Whenever&nbsp;a&nbsp;class&nbsp;type&nbsp;has&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor,<br>
pass&nbsp;value&nbsp;parameters&nbsp;of&nbsp;that&nbsp;type&nbsp;by&nbsp;performing<br>
the&nbsp;copy&nbsp;at&nbsp;the&nbsp;call&nbsp;site&nbsp;and&nbsp;passing&nbsp;a&nbsp;reference.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
Daveed&nbsp;and&nbsp;Matt&nbsp;will&nbsp;attempt&nbsp;to&nbsp;pin&nbsp;down&nbsp;the&nbsp;copy&nbsp;requirements&nbsp;with&nbsp;the<br>
Core&nbsp;committee,&nbsp;i.e.&nbsp;when&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor&nbsp;may&nbsp;be&nbsp;elided.<br>
The&nbsp;relevant&nbsp;Standard&nbsp;requirement&nbsp;is&nbsp;12.8/15,<br>
and&nbsp;there&nbsp;is&nbsp;an&nbsp;open&nbsp;defect&nbsp;report&nbsp;related&nbsp;to&nbsp;this&nbsp;question.<br>
For&nbsp;cases&nbsp;where&nbsp;the&nbsp;ctor&nbsp;may&nbsp;not&nbsp;be&nbsp;elided,<br>
we&nbsp;expect&nbsp;to&nbsp;perform&nbsp;the&nbsp;copy&nbsp;at&nbsp;the&nbsp;call&nbsp;site,<br>
and&nbsp;pass&nbsp;a&nbsp;reference.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;All]&lt;/font&gt;<br>
Matt&nbsp;will&nbsp;produce&nbsp;a&nbsp;clear&nbsp;proposal&nbsp;for&nbsp;when&nbsp;the&nbsp;ABI&nbsp;will&nbsp;elide&nbsp;the<br>
constructor&nbsp;(and&nbsp;therefore&nbsp;pass&nbsp;the&nbsp;class&nbsp;object&nbsp;like&nbsp;a&nbsp;normal&nbsp;C&nbsp;struct),<br>
based&nbsp;on&nbsp;the&nbsp;Standard's&nbsp;exceptions.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
There&nbsp;are&nbsp;no&nbsp;cases&nbsp;where&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor&nbsp;can&nbsp;be&nbsp;simply<br>
elided&nbsp;for&nbsp;all&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;parameter.<br>
Therefore,&nbsp;we&nbsp;shall&nbsp;use&nbsp;the&nbsp;consistent&nbsp;convention&nbsp;that,<br>
if&nbsp;a&nbsp;value&nbsp;parameter's&nbsp;(class)&nbsp;type&nbsp;has&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor,<br>
the&nbsp;caller&nbsp;will&nbsp;allocate&nbsp;space&nbsp;for&nbsp;it,&nbsp;perform&nbsp;the&nbsp;copy,<br>
and&nbsp;pass&nbsp;a&nbsp;reference.<br>
<br>
&lt;p&gt;<br>
Note&nbsp;that&nbsp;the&nbsp;standard&nbsp;does&nbsp;allow&nbsp;the&nbsp;caller,<br>
if&nbsp;the&nbsp;value&nbsp;being&nbsp;passed&nbsp;is&nbsp;a&nbsp;temporary,<br>
to&nbsp;construct&nbsp;the&nbsp;temporary&nbsp;directly&nbsp;into&nbsp;the&nbsp;parameter&nbsp;memory<br>
and&nbsp;elide&nbsp;the&nbsp;copy&nbsp;constructor&nbsp;call.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;C-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Returning&nbsp;classes&nbsp;with&nbsp;non-trival&nbsp;copy&nbsp;constructors&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;All&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990625&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990722&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;do&nbsp;we&nbsp;return&nbsp;classes&nbsp;with&nbsp;non-trivial&nbsp;copy&nbsp;constructors?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
The&nbsp;caller&nbsp;allocates&nbsp;space,<br>
and&nbsp;passes&nbsp;a&nbsp;pointer&nbsp;as&nbsp;an&nbsp;implicit&nbsp;first&nbsp;parameter<br>
(prior&nbsp;to&nbsp;the&nbsp;implicit&nbsp;&lt;i&gt;this&lt;/i&gt;&nbsp;parameter).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;D.&nbsp;&nbsp;Exception&nbsp;Handling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;E.&nbsp;&nbsp;Template&nbsp;Instantiation&nbsp;Model&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;F.&nbsp;&nbsp;Name&nbsp;Mangling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;G.&nbsp;&nbsp;Miscellaneous&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;H.&nbsp;&nbsp;Library&nbsp;Interface&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
<br>
&lt;p&gt;<br>
Please&nbsp;send&nbsp;corrections&nbsp;to&nbsp;&lt;a&nbsp;href=mailto:dehnert@sgi.com&gt;Jim&nbsp;Dehnert&lt;/a&gt;.<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
