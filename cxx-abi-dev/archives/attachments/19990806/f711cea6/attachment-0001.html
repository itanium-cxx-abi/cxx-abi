<tt>
&lt;HTML&gt;<br>
<br>
&lt;HEAD&gt;<br>
&lt;title&gt;C++&nbsp;ABI&nbsp;Open&nbsp;Issues&lt;/title&gt;<br>
<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=small-table.css&nbsp;type=&quot;text/css&quot;&gt;<br>
&lt;link&nbsp;rel=stylesheet&nbsp;href=code.css&nbsp;type=&quot;text/css&quot;&gt;<br>
<br>
&lt;hr&gt;<br>
<br>
&lt;font&nbsp;size=6&gt;&lt;i&gt;&lt;b&gt;<br>
&lt;p&gt;<br>
C++&nbsp;ABI&nbsp;Open&nbsp;Issues<br>
&lt;/b&gt;&lt;/i&gt;&lt;/font&gt;<br>
<br>
&lt;font&nbsp;size=-1&gt;<br>
&lt;p&gt;<br>
&lt;i&gt;Revised&nbsp;6&nbsp;August&nbsp;1999&lt;/i&gt;<br>
<br>
&lt;/center&gt;<br>
<br>
&lt;/HEAD&gt;<br>
<br>
&lt;BODY&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Revisions&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805]&lt;/font&gt;<br>
Closed&nbsp;A-12,&nbsp;A-14,&nbsp;B-3,&nbsp;B-4,&nbsp;B-7,&nbsp;C-7.<br>
Additions&nbsp;to&nbsp;&lt;a&nbsp;href=#A6&gt;A-6&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=#A11&gt;A-11&lt;/a&gt;,<br>
&lt;a&nbsp;href=#B1&gt;B-1&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=#B6&gt;B-6&lt;/a&gt;,&nbsp;&lt;a&nbsp;href=#F1&gt;F-1&lt;/a&gt;.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729]&lt;/font&gt;<br>
Closed&nbsp;A-7.<br>
Additions&nbsp;to&nbsp;A-11,&nbsp;A-12,&nbsp;C-2.<br>
Summary&nbsp;added&nbsp;for&nbsp;A-12.<br>
New&nbsp;issue&nbsp;A-14.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990727]&lt;/font&gt;<br>
Closed&nbsp;B-2,&nbsp;C-8.<br>
Additions&nbsp;to&nbsp;A-9&nbsp;(closed),&nbsp;C-2.<br>
Summaries&nbsp;added&nbsp;for&nbsp;C-4,&nbsp;C-6,&nbsp;D-1&nbsp;to&nbsp;D-4.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990720]&lt;/font&gt;<br>
Additions&nbsp;to&nbsp;B-2,&nbsp;B-5,&nbsp;C-2,&nbsp;D-1.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701]&lt;/font&gt;<br>
Closed&nbsp;A-3,&nbsp;A-5,&nbsp;A-10,&nbsp;A-13.<br>
Additions&nbsp;to&nbsp;A-6,&nbsp;B-6,&nbsp;B-7,&nbsp;B-8,&nbsp;C-2,&nbsp;C-7.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990625]&lt;/font&gt;<br>
Closed&nbsp;A-1,&nbsp;A-2,&nbsp;A-4,&nbsp;A-8,&nbsp;A-9.<br>
Additions&nbsp;to&nbsp;A-3,&nbsp;A-5,&nbsp;A-7,&nbsp;B-4,&nbsp;B-5,&nbsp;B-7,&nbsp;G-3,&nbsp;G-4.<br>
New&nbsp;issues&nbsp;B-6,&nbsp;B-7,&nbsp;B-8,&nbsp;C-7,&nbsp;C-8.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990616]&lt;/font&gt;<br>
Added&nbsp;HP&nbsp;summaries.<br>
Added&nbsp;sketchy&nbsp;notes&nbsp;from&nbsp;990610&nbsp;discussions&nbsp;(A&nbsp;and&nbsp;B&nbsp;issues).<br>
A-10&nbsp;was&nbsp;intended&nbsp;by&nbsp;HP&nbsp;as&nbsp;something&nbsp;different&nbsp;than&nbsp;I&nbsp;described,<br>
so&nbsp;it&nbsp;was&nbsp;renamed,&nbsp;and&nbsp;a&nbsp;new&nbsp;issue&nbsp;A-13&nbsp;opened&nbsp;as&nbsp;an&nbsp;SGI&nbsp;issue.<br>
HP&nbsp;did&nbsp;not&nbsp;submit&nbsp;A-12,&nbsp;so&nbsp;relabeled&nbsp;as&nbsp;Sun's&nbsp;(is&nbsp;that&nbsp;right?).<br>
Added&nbsp;library&nbsp;interface&nbsp;issues,&nbsp;H-1&nbsp;and&nbsp;H-2.<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Definitions&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;issues&nbsp;below&nbsp;make&nbsp;use&nbsp;of&nbsp;the&nbsp;following&nbsp;definitions:<br>
<br>
&lt;dl&gt;<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;i&gt;empty&nbsp;class&lt;/i&gt;&nbsp;&lt;/dt&gt;<br>
&lt;dd&gt;<br>
A&nbsp;class&nbsp;with&nbsp;no&nbsp;non-static&nbsp;data&nbsp;members,<br>
no&nbsp;virtual&nbsp;functions,&nbsp;no&nbsp;virtual&nbsp;base&nbsp;classes,<br>
and&nbsp;no&nbsp;non-empty&nbsp;non-virtual&nbsp;base&nbsp;classes.)<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;i&gt;nearly&nbsp;empty&nbsp;class&lt;/i&gt;&nbsp;&lt;/dt&gt;<br>
&lt;dd&gt;<br>
A&nbsp;class,&nbsp;the&nbsp;objects&nbsp;of&nbsp;which&nbsp;contain&nbsp;only&nbsp;a&nbsp;Vptr.<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;i&gt;vague&nbsp;linkage&lt;/i&gt;&nbsp;&lt;/dt&gt;<br>
&lt;dd&gt;<br>
The&nbsp;treatment&nbsp;of&nbsp;entities&nbsp;--<br>
e.g.&nbsp;inline&nbsp;functions,&nbsp;templates,&nbsp;vtables&nbsp;--<br>
with&nbsp;external&nbsp;linkage&nbsp;that&nbsp;can&nbsp;be<br>
defined&nbsp;in&nbsp;multiple&nbsp;translation&nbsp;units,<br>
while&nbsp;the&nbsp;ODR&nbsp;requires&nbsp;that&nbsp;the&nbsp;program<br>
behave&nbsp;as&nbsp;if&nbsp;there&nbsp;were&nbsp;only&nbsp;a&nbsp;single&nbsp;definition.<br>
<br>
&lt;/dl&gt;<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Issue&nbsp;Status&nbsp;&lt;/h3&gt;<br>
<br>
In&nbsp;the&nbsp;following&nbsp;sections,<br>
the&nbsp;&lt;b&gt;&lt;i&gt;class&lt;/i&gt;&lt;/b&gt;&nbsp;of&nbsp;an&nbsp;issue&nbsp;attempts&nbsp;to&nbsp;classify&nbsp;it&nbsp;on&nbsp;the<br>
basis&nbsp;of&nbsp;what&nbsp;it&nbsp;likely&nbsp;affects.<br>
The&nbsp;identifiers&nbsp;used&nbsp;are:<br>
<br>
&lt;table&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Function&nbsp;call&nbsp;interface,&nbsp;i.e.&nbsp;call&nbsp;linkage&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Data&nbsp;layout&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;lib&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Runtime&nbsp;library&nbsp;support&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;lif&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Library&nbsp;interface,&nbsp;i.e.&nbsp;API&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;g&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Potential&nbsp;gABI&nbsp;impact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Potential&nbsp;psABI&nbsp;impact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;source&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Source&nbsp;code&nbsp;conventions&nbsp;(i.e.&nbsp;API,&nbsp;not&nbsp;ABI)&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;May&nbsp;affect&nbsp;how&nbsp;program&nbsp;construction&nbsp;tools&nbsp;interact&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Object&nbsp;Layout&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Vptr&nbsp;location&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;is&nbsp;the&nbsp;Vptr&nbsp;stored&nbsp;in&nbsp;an&nbsp;object&nbsp;(first&nbsp;or&nbsp;last&nbsp;are&nbsp;the&nbsp;usual&nbsp;answers).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
First.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Virtual&nbsp;base&nbsp;classes&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;are&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;placed&nbsp;in&nbsp;the&nbsp;class&nbsp;layout?<br>
How&nbsp;are&nbsp;data&nbsp;member&nbsp;accesses&nbsp;to&nbsp;them&nbsp;handled?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Virtual&nbsp;base&nbsp;subobjects&nbsp;are&nbsp;normally&nbsp;placed&nbsp;at&nbsp;the&nbsp;end&nbsp;(see&nbsp;issue&nbsp;A-9).<br>
The&nbsp;Vtable&nbsp;will&nbsp;contain&nbsp;an&nbsp;offset&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;base&nbsp;object<br>
for&nbsp;use&nbsp;by&nbsp;member&nbsp;accesses&nbsp;to&nbsp;them&nbsp;(see&nbsp;issue&nbsp;B-6).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Multiple&nbsp;inheritance&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Define&nbsp;the&nbsp;class&nbsp;layout&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;multiple&nbsp;base&nbsp;classes.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
See&nbsp;the&nbsp;class&nbsp;layout&nbsp;description&nbsp;in&nbsp;closed&nbsp;issue&nbsp;A-9.<br>
Briefly,&nbsp;empty&nbsp;bases&nbsp;will&nbsp;normally&nbsp;go&nbsp;at&nbsp;offset&nbsp;zero,<br>
non-virtual&nbsp;base&nbsp;classes&nbsp;at&nbsp;the&nbsp;beginning,<br>
and&nbsp;virtual&nbsp;base&nbsp;classes&nbsp;at&nbsp;the&nbsp;end.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Empty&nbsp;base&nbsp;classes&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Where&nbsp;are&nbsp;empty&nbsp;base&nbsp;classes&nbsp;allocated?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
At&nbsp;offset&nbsp;zero&nbsp;if&nbsp;possible.&nbsp;&nbsp;See&nbsp;A-9.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-5&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Empty&nbsp;parameters&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
When&nbsp;passing&nbsp;a&nbsp;parameter&nbsp;with&nbsp;an&nbsp;empty&nbsp;class&nbsp;type&nbsp;by&nbsp;value,<br>
what&nbsp;is&nbsp;the&nbsp;convention?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Except&nbsp;for&nbsp;cases&nbsp;of&nbsp;non-trivial&nbsp;copy&nbsp;constructors&nbsp;(see&nbsp;C-7),<br>
and&nbsp;parameters&nbsp;in&nbsp;the&nbsp;variable&nbsp;part&nbsp;of&nbsp;varargs&nbsp;lists,<br>
no&nbsp;parameter&nbsp;slot&nbsp;will&nbsp;be&nbsp;allocated&nbsp;to&nbsp;empty&nbsp;parameters.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A6&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-6&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;RTTI&nbsp;.o&nbsp;representation&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;call&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Define&nbsp;the&nbsp;data&nbsp;structure&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;RTTI,&nbsp;that&nbsp;is:<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;for&nbsp;user&nbsp;&lt;code&gt;type_info&lt;/code&gt;&nbsp;calls;<br>
&lt;li&gt;&nbsp;for&nbsp;dynamic_cast&nbsp;implementation;&nbsp;and<br>
&lt;li&gt;&nbsp;for&nbsp;exception-handling.<br>
&lt;/ul&gt;<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
Daveed&nbsp;will&nbsp;put&nbsp;together&nbsp;a&nbsp;proposal&nbsp;by&nbsp;the&nbsp;15th&nbsp;(action&nbsp;#13);<br>
the&nbsp;group&nbsp;will&nbsp;discuss&nbsp;it&nbsp;on&nbsp;the&nbsp;22nd.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
Daveed&nbsp;should&nbsp;have&nbsp;his&nbsp;proposal&nbsp;together&nbsp;for&nbsp;discussion.<br>
Michael&nbsp;Lam&nbsp;will&nbsp;look&nbsp;into&nbsp;the&nbsp;Sun&nbsp;dynamic&nbsp;cast&nbsp;algorithm.<br>
<br>
&lt;p&gt;<br>
It&nbsp;was&nbsp;noted&nbsp;that&nbsp;appropriate&nbsp;name&nbsp;selection&nbsp;along&nbsp;with&nbsp;the&nbsp;normal<br>
DSO&nbsp;global&nbsp;name&nbsp;resolution&nbsp;should&nbsp;be&nbsp;sufficient&nbsp;to&nbsp;produce&nbsp;a&nbsp;unique<br>
address&nbsp;for&nbsp;each&nbsp;class'&nbsp;RTTI&nbsp;struct,<br>
which&nbsp;address&nbsp;would&nbsp;then&nbsp;be&nbsp;a&nbsp;suitable&nbsp;identifier&nbsp;for&nbsp;comparisons.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Vptr&nbsp;sharing&nbsp;with&nbsp;primary&nbsp;base&nbsp;class&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990729&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;is&nbsp;in&nbsp;general&nbsp;possible&nbsp;to&nbsp;share&nbsp;the&nbsp;virtual&nbsp;pointer&nbsp;with&nbsp;a<br>
polymorphic&nbsp;base&nbsp;class&nbsp;(the&nbsp;&lt;i&gt;primary&lt;/i&gt;&nbsp;base&nbsp;class).<br>
Which&nbsp;base&nbsp;class&nbsp;do&nbsp;we&nbsp;use&nbsp;for&nbsp;this?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Share&nbsp;with&nbsp;the&nbsp;first&nbsp;non-virtual&nbsp;polymorphic&nbsp;base&nbsp;class,<br>
or&nbsp;if&nbsp;none&nbsp;with&nbsp;the&nbsp;first&nbsp;nearly&nbsp;empty&nbsp;virtual&nbsp;base&nbsp;class.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;(Virtual)&nbsp;base&nbsp;class&nbsp;alignment&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
A&nbsp;(virtual)&nbsp;base&nbsp;class&nbsp;may&nbsp;have&nbsp;a&nbsp;larger&nbsp;alignment&nbsp;constraint&nbsp;than&nbsp;a<br>
derived&nbsp;class.<br>
Do&nbsp;we&nbsp;agree&nbsp;to&nbsp;extend&nbsp;the&nbsp;alignment&nbsp;constraint&nbsp;to&nbsp;the&nbsp;derived&nbsp;class?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
The&nbsp;derived&nbsp;class&nbsp;will&nbsp;have&nbsp;at&nbsp;least&nbsp;the&nbsp;alignment&nbsp;of&nbsp;any&nbsp;base&nbsp;class.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-9&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sorting&nbsp;fields&nbsp;as&nbsp;allowed&nbsp;by&nbsp;[class.mem]/12&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;standard&nbsp;constrains&nbsp;ordering&nbsp;of&nbsp;class&nbsp;members&nbsp;in&nbsp;memory&nbsp;only&nbsp;if<br>
they&nbsp;are&nbsp;not&nbsp;separated&nbsp;by&nbsp;an&nbsp;access&nbsp;clause.<br>
Do&nbsp;we&nbsp;use&nbsp;an&nbsp;access&nbsp;clause&nbsp;as&nbsp;an&nbsp;opportunity&nbsp;to&nbsp;fill&nbsp;the&nbsp;gaps&nbsp;left&nbsp;by&nbsp;padding?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
See&nbsp;&lt;a&nbsp;href=cxx-closed.html#A9&gt;closed&nbsp;issue&nbsp;list&lt;/a&gt;.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990722&nbsp;all]&lt;/font&gt;<br>
The&nbsp;precise&nbsp;placement&nbsp;of&nbsp;empty&nbsp;bases&nbsp;when&nbsp;they&nbsp;don't&nbsp;fit&nbsp;at&nbsp;offset&nbsp;zero<br>
remained&nbsp;imprecise&nbsp;in&nbsp;the&nbsp;original&nbsp;description.<br>
Accordingly,&nbsp;a&nbsp;precise&nbsp;layout&nbsp;algorithm&nbsp;is&nbsp;described&nbsp;in<br>
a&nbsp;separate&nbsp;writeup&nbsp;of&nbsp;&lt;a&nbsp;href=abi-layout.html&gt;Data&nbsp;Layout&lt;/a&gt;.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-10&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Class&nbsp;parameters&nbsp;in&nbsp;registers&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;C&nbsp;ABI&nbsp;specifies&nbsp;that&nbsp;small&nbsp;structs&nbsp;are&nbsp;passed&nbsp;in&nbsp;registers.<br>
Does&nbsp;this&nbsp;apply&nbsp;to&nbsp;small&nbsp;non-POD&nbsp;C++&nbsp;objects&nbsp;passed&nbsp;by&nbsp;value?<br>
What&nbsp;about&nbsp;the&nbsp;copy&nbsp;constructor&nbsp;and&nbsp;&lt;code&gt;this&lt;/code&gt;&nbsp;pointer&nbsp;in&nbsp;that&nbsp;case?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Non-POD&nbsp;C++&nbsp;objects&nbsp;are&nbsp;passed&nbsp;like&nbsp;C&nbsp;structs,<br>
except&nbsp;for&nbsp;cases&nbsp;with&nbsp;non-trivial&nbsp;copy&nbsp;constructors&nbsp;identified&nbsp;in&nbsp;C-7.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A11&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-11&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Pointers&nbsp;to&nbsp;member&nbsp;functions&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Cygnus&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;should&nbsp;pointers&nbsp;to&nbsp;member&nbsp;functions&nbsp;be&nbsp;represented?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;All]&lt;/font&gt;<br>
Jason&nbsp;described&nbsp;the&nbsp;g++&nbsp;implementation,&nbsp;which&nbsp;is&nbsp;a&nbsp;three-member&nbsp;struct:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;The&nbsp;adjustment&nbsp;to&nbsp;&lt;i&gt;this&lt;/i&gt;.<br>
&lt;li&gt;&nbsp;The&nbsp;Vtable&nbsp;index&nbsp;plus&nbsp;one&nbsp;of&nbsp;the&nbsp;function,&nbsp;or&nbsp;-1.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Zero&nbsp;is&nbsp;a&nbsp;NULL&nbsp;pointer.)<br>
&lt;li&gt;&nbsp;If&nbsp;(2)&nbsp;is&nbsp;an&nbsp;index,&nbsp;the&nbsp;offset&nbsp;from&nbsp;the&nbsp;full&nbsp;object&nbsp;to&nbsp;the&nbsp;member<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function's&nbsp;Vtable.&nbsp;&nbsp;If&nbsp;-1,&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;function&nbsp;(non-virtual).<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
A&nbsp;concern&nbsp;about&nbsp;covariant&nbsp;returns&nbsp;was&nbsp;raised.<br>
It&nbsp;was&nbsp;observed&nbsp;that,&nbsp;given&nbsp;our&nbsp;decision&nbsp;to&nbsp;use&nbsp;distinct&nbsp;Vtable&nbsp;entries<br>
for&nbsp;distinct&nbsp;return&nbsp;types,&nbsp;no&nbsp;further&nbsp;concern&nbsp;is&nbsp;required&nbsp;here.<br>
Others&nbsp;will&nbsp;describe&nbsp;their&nbsp;representations.<br>
IBM&nbsp;has&nbsp;an&nbsp;alternative,&nbsp;but&nbsp;it&nbsp;is&nbsp;believed&nbsp;to&nbsp;be&nbsp;patented&nbsp;by&nbsp;Microsoft.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
It&nbsp;is&nbsp;agreed&nbsp;that&nbsp;a&nbsp;two-element&nbsp;struct&nbsp;will&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a<br>
member&nbsp;function,&nbsp;with&nbsp;elements&nbsp;as&nbsp;follows:<br>
<br>
&lt;dl&gt;<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;ptr&lt;/code&gt;:<br>
&lt;dd&gt;&nbsp;For&nbsp;a&nbsp;non-virtual&nbsp;function,&nbsp;this&nbsp;field&nbsp;is&nbsp;a&nbsp;simple&nbsp;function&nbsp;pointer.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Under&nbsp;current&nbsp;base&nbsp;IA-64&nbsp;psABI&nbsp;conventions,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;GP/function&nbsp;address&nbsp;pair.)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;a&nbsp;virtual&nbsp;function,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;is&nbsp;1&nbsp;plus&nbsp;twice&nbsp;the&nbsp;Vtable&nbsp;offset&nbsp;of&nbsp;the&nbsp;function.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;value&nbsp;zero&nbsp;is&nbsp;a&nbsp;NULL&nbsp;pointer.<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;adj&lt;/code&gt;:<br>
&lt;dd&gt;&nbsp;The&nbsp;required&nbsp;adjustment&nbsp;to&nbsp;&lt;i&gt;this&lt;/i&gt;.<br>
&lt;/dl&gt;<br>
<br>
&lt;p&gt;<br>
Although&nbsp;we&nbsp;agreed&nbsp;to&nbsp;close&nbsp;this,&nbsp;SGI&nbsp;suggests&nbsp;a&nbsp;minor&nbsp;modification.<br>
Since&nbsp;the&nbsp;Vtable&nbsp;offset&nbsp;of&nbsp;a&nbsp;virtual&nbsp;function&nbsp;will&nbsp;always&nbsp;be&nbsp;even,<br>
we&nbsp;suggest&nbsp;that&nbsp;it&nbsp;not&nbsp;be&nbsp;doubled&nbsp;before&nbsp;adding&nbsp;1.<br>
This&nbsp;is&nbsp;because&nbsp;shifts&nbsp;are&nbsp;more&nbsp;restricted&nbsp;on&nbsp;many&nbsp;processors&nbsp;than<br>
other&nbsp;integer&nbsp;ALU&nbsp;operations&nbsp;(shifters&nbsp;are&nbsp;large&nbsp;structures),<br>
so&nbsp;an&nbsp;XOR&nbsp;or&nbsp;NAND&nbsp;will&nbsp;often&nbsp;be&nbsp;cheaper&nbsp;than&nbsp;a&nbsp;right&nbsp;shift.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=A12&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-12&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Merging&nbsp;secondary&nbsp;vtables&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sun&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990610&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Sun&nbsp;merges&nbsp;the&nbsp;secondary&nbsp;Vtables&nbsp;for&nbsp;a&nbsp;class&nbsp;(i.e.&nbsp;those&nbsp;for<br>
non-primary&nbsp;base&nbsp;classes)&nbsp;with&nbsp;the&nbsp;primary&nbsp;Vtable&nbsp;by&nbsp;appending&nbsp;them.<br>
This&nbsp;allows&nbsp;their&nbsp;reference&nbsp;via&nbsp;the&nbsp;primary&nbsp;Vtable&nbsp;entry&nbsp;symbol,<br>
minimizing&nbsp;the&nbsp;number&nbsp;of&nbsp;external&nbsp;symbols&nbsp;required&nbsp;in&nbsp;linking,<br>
in&nbsp;the&nbsp;GOT,&nbsp;etc.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Concatenate&nbsp;the&nbsp;Vtables&nbsp;associated&nbsp;with&nbsp;a&nbsp;class&nbsp;in&nbsp;the&nbsp;same&nbsp;order<br>
that&nbsp;the&nbsp;corresponding&nbsp;base&nbsp;subobjects&nbsp;are&nbsp;allocated&nbsp;in&nbsp;the&nbsp;object.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;td&gt;&nbsp;A-13&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Parameter&nbsp;struct&nbsp;field&nbsp;promotion&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990701&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;is&nbsp;possible&nbsp;to&nbsp;pass&nbsp;small&nbsp;classes&nbsp;either&nbsp;as&nbsp;memory&nbsp;images,<br>
as&nbsp;is&nbsp;specified&nbsp;by&nbsp;the&nbsp;base&nbsp;ABI&nbsp;for&nbsp;C&nbsp;structs,<br>
or&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;parameters,&nbsp;one&nbsp;for&nbsp;each&nbsp;member.<br>
Which&nbsp;should&nbsp;be&nbsp;done,&nbsp;and&nbsp;if&nbsp;the&nbsp;latter,<br>
what&nbsp;are&nbsp;the&nbsp;rules&nbsp;for&nbsp;identifying&nbsp;&quot;small&quot;&nbsp;classes?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
No&nbsp;special&nbsp;treatment&nbsp;will&nbsp;be&nbsp;specified&nbsp;by&nbsp;the&nbsp;ABI.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&nbsp;class=small&gt;&nbsp;&lt;a&nbsp;name=A14&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;A-14&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Pointers&nbsp;to&nbsp;data&nbsp;members&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990729&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;should&nbsp;pointers&nbsp;to&nbsp;data&nbsp;members&nbsp;be&nbsp;represented?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Represented&nbsp;as&nbsp;one&nbsp;plus&nbsp;the&nbsp;offset&nbsp;from&nbsp;the&nbsp;base&nbsp;address.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Virtual&nbsp;Function&nbsp;Handling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Adjustment&nbsp;of&nbsp;&quot;this&quot;&nbsp;pointer&nbsp;(e.g.&nbsp;thunks)&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
There&nbsp;are&nbsp;several&nbsp;methods&nbsp;for&nbsp;adjusting&nbsp;the&nbsp;&lt;i&gt;this&lt;/i&gt;&nbsp;pointer<br>
for&nbsp;a&nbsp;member&nbsp;function&nbsp;call,<br>
including&nbsp;thunks&nbsp;or&nbsp;offsets&nbsp;located&nbsp;in&nbsp;the&nbsp;vtable.<br>
We&nbsp;need&nbsp;to&nbsp;agree&nbsp;on&nbsp;the&nbsp;mechanism&nbsp;used,<br>
and&nbsp;on&nbsp;the&nbsp;location&nbsp;of&nbsp;offsets,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed.<br>
To&nbsp;maximize&nbsp;performance&nbsp;on&nbsp;IA64,<br>
a&nbsp;slightly&nbsp;unusual&nbsp;approach&nbsp;such&nbsp;as&nbsp;using&nbsp;secondary&nbsp;entry&nbsp;points<br>
to&nbsp;perform&nbsp;the&nbsp;adjustment&nbsp;may&nbsp;actually&nbsp;prove&nbsp;interesting.&nbsp;<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990623&nbsp;HP&nbsp;--&nbsp;Christophe]&lt;/font&gt;<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;Open&nbsp;Issues&nbsp;Relevant&nbsp;To&nbsp;This&nbsp;Discussion&lt;/h4&gt;<br>
<br>
&lt;ol&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Keeping&nbsp;all&nbsp;of&nbsp;a&nbsp;class&nbsp;in&nbsp;a&nbsp;single&nbsp;load&nbsp;module.<br>
The&nbsp;vtable&nbsp;contains&nbsp;the&nbsp;target&nbsp;address&nbsp;and&nbsp;one&nbsp;copy&nbsp;of&nbsp;the&nbsp;target&nbsp;GP.<br>
This&nbsp;implies&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;text,&nbsp;and&nbsp;that&nbsp;it&nbsp;is&nbsp;generated&nbsp;by&nbsp;dld.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Detailed&nbsp;layout&nbsp;of&nbsp;the&nbsp;virtual&nbsp;table.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
How&nbsp;can&nbsp;we&nbsp;share&nbsp;class&nbsp;offsets?<br>
<br>
&lt;/ol&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;&nbsp;1.&nbsp;Scope&nbsp;and&nbsp;&quot;State&nbsp;of&nbsp;the&nbsp;Art&quot;&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;following&nbsp;proposal&nbsp;applies&nbsp;only&nbsp;to&nbsp;calls&nbsp;to&nbsp;virtual&nbsp;functions&nbsp;&nbsp;<br>
when&nbsp;a&nbsp;this&nbsp;pointer&nbsp;adjustment&nbsp;is&nbsp;required&nbsp;from&nbsp;a&nbsp;base&nbsp;class&nbsp;to&nbsp;a&nbsp;&nbsp;<br>
derived&nbsp;class.<br>
Essentially,&nbsp;this&nbsp;means&nbsp;multiple&nbsp;inheritance,&nbsp;and&nbsp;the&nbsp;&nbsp;<br>
existence&nbsp;of&nbsp;two&nbsp;or&nbsp;more&nbsp;virtual&nbsp;table&nbsp;pointers&nbsp;(vptr)<br>
in&nbsp;the&nbsp;complete&nbsp;object.<br>
The&nbsp;multiple&nbsp;vptrs&nbsp;are&nbsp;required&nbsp;so&nbsp;that&nbsp;the&nbsp;layout&nbsp;&nbsp;<br>
of&nbsp;all&nbsp;bases&nbsp;is&nbsp;unchanged&nbsp;in&nbsp;the&nbsp;complete&nbsp;object.<br>
There&nbsp;will&nbsp;be&nbsp;one&nbsp;additional&nbsp;vptr&nbsp;for&nbsp;each&nbsp;base&nbsp;class&nbsp;which&nbsp;already<br>
required&nbsp;a&nbsp;vptr,&nbsp;&nbsp;<br>
but&nbsp;cannot&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;whole&nbsp;object&nbsp;so&nbsp;that&nbsp;it&nbsp;shares&nbsp;its&nbsp;vptr&nbsp;&nbsp;<br>
with&nbsp;the&nbsp;whole&nbsp;object.<br>
Note:&nbsp;when&nbsp;the&nbsp;vptr&nbsp;is&nbsp;shared,<br>
the&nbsp;base&nbsp;class&nbsp;&nbsp;is&nbsp;said&nbsp;to&nbsp;be&nbsp;the&nbsp;&quot;primary&nbsp;base&nbsp;class&quot;,<br>
and&nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;such&nbsp;class.<br>
<br>
&lt;p&gt;<br>
For&nbsp;the&nbsp;primary&nbsp;base&nbsp;class,&nbsp;no&nbsp;pointer&nbsp;adjustment&nbsp;is&nbsp;needed.<br>
For&nbsp;all&nbsp;&nbsp;other&nbsp;bases,&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;whole&nbsp;object&nbsp;is&nbsp;not&nbsp;a&nbsp;pointer<br>
to&nbsp;the&nbsp;base&nbsp;class,<br>
so&nbsp;whenever&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;base&nbsp;class&nbsp;is&nbsp;needed,&nbsp;&nbsp;<br>
adjustment&nbsp;will&nbsp;occur.<br>
<br>
&lt;p&gt;<br>
In&nbsp;particular,&nbsp;when&nbsp;calling&nbsp;a&nbsp;virtual&nbsp;function,<br>
one&nbsp;does&nbsp;not&nbsp;know&nbsp;in&nbsp;advance&nbsp;in&nbsp;which&nbsp;class&nbsp;the&nbsp;function&nbsp;was&nbsp;actually&nbsp;defined.<br>
Depending&nbsp;on&nbsp;the&nbsp;actual&nbsp;class&nbsp;of&nbsp;the&nbsp;object&nbsp;pointed&nbsp;to,<br>
pointer&nbsp;adjustment&nbsp;may&nbsp;be&nbsp;needed&nbsp;or&nbsp;not,<br>
and&nbsp;the&nbsp;pointer&nbsp;adjustment&nbsp;value&nbsp;may&nbsp;vary&nbsp;from&nbsp;class&nbsp;to&nbsp;class.<br>
The&nbsp;existing&nbsp;solution&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;vtable&nbsp;point&nbsp;not&nbsp;to&nbsp;the&nbsp;function&nbsp;itself,<br>
but&nbsp;to&nbsp;a&nbsp;&quot;thunk&quot;&nbsp;which&nbsp;does&nbsp;pointer&nbsp;adjustment&nbsp;when&nbsp;needed,<br>
and&nbsp;then&nbsp;jumps&nbsp;to&nbsp;the&nbsp;actual&nbsp;function.&nbsp;&nbsp;<br>
Another&nbsp;possibility&nbsp;is&nbsp;to&nbsp;have&nbsp;an&nbsp;offset&nbsp;in&nbsp;the&nbsp;vtable,<br>
which&nbsp;is&nbsp;used&nbsp;by&nbsp;the&nbsp;called&nbsp;function.<br>
However,&nbsp;more&nbsp;often&nbsp;than&nbsp;not,&nbsp;this&nbsp;implies&nbsp;adding&nbsp;zero.<br>
<br>
&lt;p&gt;<br>
Virtual&nbsp;bases&nbsp;make&nbsp;things&nbsp;slightly&nbsp;more&nbsp;complicated.<br>
In&nbsp;that&nbsp;case,&nbsp;the&nbsp;data&nbsp;layout&nbsp;is&nbsp;such&nbsp;that&nbsp;there&nbsp;is&nbsp;only<br>
one&nbsp;instance&nbsp;of&nbsp;the&nbsp;virtual&nbsp;base&nbsp;in&nbsp;the&nbsp;whole&nbsp;object.<br>
Therefore,&nbsp;the&nbsp;offset&nbsp;from&nbsp;a&nbsp;this&nbsp;&nbsp;<br>
pointer&nbsp;to&nbsp;a&nbsp;same&nbsp;virtual&nbsp;base&nbsp;may&nbsp;change&nbsp;along&nbsp;the&nbsp;inheritance&nbsp;tree.&nbsp;&nbsp;<br>
This&nbsp;is&nbsp;solved&nbsp;by&nbsp;placing&nbsp;an&nbsp;offset&nbsp;in&nbsp;the&nbsp;virtual&nbsp;table,<br>
which&nbsp;is&nbsp;used&nbsp;to&nbsp;adjust&nbsp;the&nbsp;this&nbsp;pointer&nbsp;to&nbsp;the&nbsp;virtual&nbsp;base.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;&nbsp;2.&nbsp;Proposal&nbsp;and&nbsp;Rationale&nbsp;&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
My&nbsp;proposal&nbsp;is&nbsp;to&nbsp;replace&nbsp;thunks&nbsp;with&nbsp;offsets,<br>
with&nbsp;two&nbsp;additional&nbsp;tricks:<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
Give&nbsp;a&nbsp;virtual&nbsp;function&nbsp;two&nbsp;entry&nbsp;points,<br>
so&nbsp;as&nbsp;to&nbsp;bypass&nbsp;the&nbsp;adjustment&nbsp;when&nbsp;it's&nbsp;known&nbsp;to&nbsp;be&nbsp;zero.<br>
&lt;li&gt;<br>
Moving&nbsp;the&nbsp;adjustment&nbsp;at&nbsp;call-site,<br>
where&nbsp;it&nbsp;can&nbsp;be&nbsp;scheduled&nbsp;more&nbsp;easily,<br>
using&nbsp;a&nbsp;&quot;reasonable&quot;&nbsp;value,<br>
so&nbsp;that&nbsp;the&nbsp;adjustment&nbsp;is&nbsp;bypassed&nbsp;even&nbsp;more&nbsp;often.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;thunks&nbsp;are&nbsp;believed&nbsp;to&nbsp;cost&nbsp;more&nbsp;on&nbsp;IA64&nbsp;than&nbsp;they&nbsp;would&nbsp;on&nbsp;&nbsp;<br>
other&nbsp;platforms.<br>
The&nbsp;reason&nbsp;is&nbsp;that&nbsp;they&nbsp;are&nbsp;small&nbsp;islands&nbsp;of&nbsp;code&nbsp;spread&nbsp;throughout&nbsp;the&nbsp;code,<br>
where&nbsp;you&nbsp;cannot&nbsp;guarantee&nbsp;any&nbsp;cache&nbsp;locality.<br>
Since&nbsp;they&nbsp;immediately&nbsp;follow&nbsp;an&nbsp;indirect&nbsp;branch,<br>
chances&nbsp;are&nbsp;we&nbsp;will&nbsp;always&nbsp;encounter&nbsp;both&nbsp;a&nbsp;branch&nbsp;misprediction&nbsp;and&nbsp;a&nbsp;&nbsp;<br>
I-cache&nbsp;miss&nbsp;in&nbsp;a&nbsp;row.<br>
<br>
&lt;p&gt;<br>
On&nbsp;the&nbsp;other&nbsp;hand,<br>
a&nbsp;virtual&nbsp;function&nbsp;call&nbsp;starts&nbsp;by&nbsp;reading&nbsp;the&nbsp;virtual&nbsp;function&nbsp;address.<br>
Reading&nbsp;the&nbsp;offset&nbsp;immediately&nbsp;thereafter&nbsp;should&nbsp;almost&nbsp;never&nbsp;cause&nbsp;a<br>
D-cache&nbsp;miss&nbsp;(cache&nbsp;locality&nbsp;should&nbsp;be&nbsp;good).<br>
More&nbsp;often&nbsp;than&nbsp;not,&nbsp;no&nbsp;adjustment&nbsp;is&nbsp;needed,<br>
or&nbsp;the&nbsp;adjustment&nbsp;will&nbsp;be&nbsp;done&nbsp;at&nbsp;call&nbsp;site&nbsp;correctly.<br>
In&nbsp;the&nbsp;worst&nbsp;case&nbsp;scenario,&nbsp;we&nbsp;perform&nbsp;two&nbsp;adjustments,<br>
one&nbsp;static&nbsp;at&nbsp;call&nbsp;site,&nbsp;and&nbsp;one&nbsp;dynamic&nbsp;in&nbsp;the&nbsp;callee,<br>
but&nbsp;this&nbsp;case&nbsp;should&nbsp;be&nbsp;really&nbsp;infrequent.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;&nbsp;3.&nbsp;New&nbsp;Calling&nbsp;Convention&nbsp;&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;new&nbsp;calling&nbsp;convention&nbsp;requires&nbsp;that&nbsp;the&nbsp;'this'&nbsp;pointer&nbsp;on&nbsp;entry&nbsp;&nbsp;<br>
points&nbsp;to&nbsp;the&nbsp;class&nbsp;for&nbsp;which&nbsp;the&nbsp;virtual&nbsp;function&nbsp;is&nbsp;just&nbsp;defined.&nbsp;&nbsp;<br>
That&nbsp;is,&nbsp;for&nbsp;A::f(),<br>
the&nbsp;pointer&nbsp;is&nbsp;an&nbsp;A*&nbsp;when&nbsp;the&nbsp;main&nbsp;entry&nbsp;of&nbsp;the&nbsp;function&nbsp;is&nbsp;reached.<br>
If&nbsp;the&nbsp;actual&nbsp;pointer&nbsp;is&nbsp;not&nbsp;an&nbsp;A*,<br>
then&nbsp;an&nbsp;adjusting&nbsp;entry&nbsp;point&nbsp;is&nbsp;used,<br>
which&nbsp;immediately&nbsp;precedes&nbsp;the&nbsp;function.<br>
<br>
&lt;p&gt;<br>
In&nbsp;the&nbsp;following,&nbsp;we&nbsp;will&nbsp;assume&nbsp;the&nbsp;following&nbsp;examples:<br>
&lt;p&gt;<br>
&lt;code&gt;&lt;pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;A&nbsp;{&nbsp;virtual&nbsp;void&nbsp;f();&nbsp;};<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;B&nbsp;{&nbsp;virtual&nbsp;void&nbsp;g();&nbsp;};<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;C:&nbsp;A,&nbsp;B&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;D&nbsp;:&nbsp;C&nbsp;{&nbsp;virtual&nbsp;void&nbsp;f();&nbsp;virtual&nbsp;void&nbsp;g();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;E:&nbsp;Other,&nbsp;C&nbsp;{&nbsp;virtual&nbsp;void&nbsp;f();&nbsp;virtual&nbsp;void&nbsp;g();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;F:&nbsp;D,&nbsp;E&nbsp;{&nbsp;virtual&nbsp;void&nbsp;f();&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Cf(C&nbsp;*c)&nbsp;{&nbsp;c-&gt;f();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Cg(C&nbsp;*c)&nbsp;{&nbsp;c-&gt;g();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Df(D*&nbsp;d)&nbsp;{&nbsp;d-&gt;f();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Dg(D*&nbsp;d)&nbsp;{&nbsp;d-&gt;g();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Ef(E*&nbsp;e)&nbsp;{&nbsp;e-&gt;f();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Eg(E*&nbsp;e)&nbsp;{&nbsp;e-&gt;g();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Ff(F&nbsp;*ff)&nbsp;{&nbsp;ff-&gt;f();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;call_Fg(F&nbsp;*ff)&nbsp;{&nbsp;ff-&gt;g();&nbsp;}&nbsp;//&nbsp;Invalid:&nbsp;ambiguous<br>
&lt;/pre&gt;&lt;/code&gt;<br>
<br>
&lt;dl&gt;<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;a)&nbsp;Call&nbsp;site:<br>
&lt;dd&gt;<br>
The&nbsp;caller&nbsp;performs&nbsp;adjustment&nbsp;to&nbsp;match&nbsp;the&nbsp;class&nbsp;of&nbsp;the&nbsp;last&nbsp;&nbsp;<br>
overrider&nbsp;of&nbsp;the&nbsp;given&nbsp;function.<br>
<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;call_Cf&nbsp;will&nbsp;assume&nbsp;that&nbsp;the&nbsp;pointer&nbsp;needs&nbsp;to&nbsp;be&nbsp;cast&nbsp;to&nbsp;an&nbsp;A*,&nbsp;&nbsp;<br>
since&nbsp;C::f&nbsp;is&nbsp;actually&nbsp;A::f.&nbsp;Since&nbsp;A&nbsp;is&nbsp;the&nbsp;primary&nbsp;base&nbsp;class,&nbsp;no&nbsp;&nbsp;<br>
adjustment&nbsp;is&nbsp;done&nbsp;at&nbsp;call&nbsp;site.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;call_Cg&nbsp;is&nbsp;similar,&nbsp;but&nbsp;assumes&nbsp;that&nbsp;the&nbsp;actual&nbsp;type&nbsp;is&nbsp;a&nbsp;B*,&nbsp;and&nbsp;&nbsp;<br>
performs&nbsp;the&nbsp;adjustment,&nbsp;since&nbsp;B&nbsp;is&nbsp;not&nbsp;the&nbsp;primary&nbsp;base&nbsp;class.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;call_Df&nbsp;and&nbsp;call_Dg&nbsp;will&nbsp;assume&nbsp;that&nbsp;the&nbsp;pointer&nbsp;needs&nbsp;to&nbsp;be&nbsp;cast&nbsp;&nbsp;<br>
to&nbsp;a&nbsp;D*,&nbsp;which&nbsp;is&nbsp;where&nbsp;D::f&nbsp;is&nbsp;defined.&nbsp;No&nbsp;adjustment&nbsp;is&nbsp;performed&nbsp;&nbsp;<br>
at&nbsp;call&nbsp;site.<br>
&lt;/ul&gt;<br>
&lt;/dd&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;b)&nbsp;Callee<br>
&lt;dd&gt;<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;A::f&nbsp;and&nbsp;B::g&nbsp;are&nbsp;defined&nbsp;in&nbsp;classes&nbsp;where&nbsp;there&nbsp;is&nbsp;a&nbsp;single&nbsp;vptr.&nbsp;&nbsp;<br>
They&nbsp;don't&nbsp;define&nbsp;a&nbsp;secondary&nbsp;entry&nbsp;point.&nbsp;Because&nbsp;of&nbsp;call-site&nbsp;&nbsp;<br>
conventions,&nbsp;they&nbsp;expect&nbsp;to&nbsp;always&nbsp;be&nbsp;called&nbsp;with&nbsp;the&nbsp;correct&nbsp;type.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;D::f&nbsp;is&nbsp;defined&nbsp;in&nbsp;a&nbsp;class&nbsp;where&nbsp;there&nbsp;is&nbsp;more&nbsp;than&nbsp;one&nbsp;vptr,&nbsp;so&nbsp;&nbsp;<br>
it&nbsp;needs&nbsp;a&nbsp;secondary&nbsp;entry&nbsp;point&nbsp;and&nbsp;an&nbsp;entry&nbsp;'convert_to_D'&nbsp;in&nbsp;the&nbsp;&nbsp;<br>
vtable.&nbsp;That's&nbsp;because&nbsp;it&nbsp;can&nbsp;be&nbsp;potentially&nbsp;called&nbsp;with&nbsp;either&nbsp;an&nbsp;A*&nbsp;&nbsp;<br>
or&nbsp;a&nbsp;B*.&nbsp;There&nbsp;are&nbsp;two&nbsp;vtables,&nbsp;one&nbsp;for&nbsp;A&nbsp;in&nbsp;D,&nbsp;one&nbsp;for&nbsp;B&nbsp;in&nbsp;D.&nbsp;The&nbsp;&nbsp;<br>
D::f&nbsp;entry&nbsp;in&nbsp;A&nbsp;in&nbsp;D&nbsp;points&nbsp;to&nbsp;the&nbsp;non-adjusting&nbsp;entry&nbsp;point,&nbsp;since&nbsp;A&nbsp;&nbsp;<br>
shares&nbsp;its&nbsp;vptr.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;D::g&nbsp;requires&nbsp;a&nbsp;secondary&nbsp;entry&nbsp;point,&nbsp;that&nbsp;will&nbsp;read&nbsp;the&nbsp;same&nbsp;&nbsp;<br>
offset&nbsp;'convert_to_D'&nbsp;from&nbsp;the&nbsp;vtable.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;E&nbsp;also&nbsp;will&nbsp;require&nbsp;a&nbsp;'convert_to_E'&nbsp;entry&nbsp;in&nbsp;the&nbsp;vtable,&nbsp;but&nbsp;this&nbsp;&nbsp;<br>
time,&nbsp;the&nbsp;vtable&nbsp;for&nbsp;A&nbsp;in&nbsp;C&nbsp;will&nbsp;have&nbsp;to&nbsp;point&nbsp;to&nbsp;an&nbsp;adjusting&nbsp;entry&nbsp;&nbsp;<br>
point,&nbsp;since&nbsp;A&nbsp;no&nbsp;longer&nbsp;shares&nbsp;the&nbsp;vptr&nbsp;with&nbsp;E&nbsp;(assuming&nbsp;Other&nbsp;has&nbsp;&nbsp;<br>
a&nbsp;vptr).&nbsp;This&nbsp;vtable&nbsp;is&nbsp;also&nbsp;the&nbsp;vtable&nbsp;of&nbsp;C&nbsp;in&nbsp;E.<br>
&lt;/ul&gt;<br>
&lt;/dd&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;c)&nbsp;Offsets&nbsp;in&nbsp;the&nbsp;vtable<br>
&lt;dd&gt;<br>
Offsets&nbsp;have&nbsp;to&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;vtable&nbsp;at&nbsp;a&nbsp;position&nbsp;which&nbsp;does&nbsp;not&nbsp;&nbsp;<br>
conflict&nbsp;with&nbsp;any&nbsp;offset&nbsp;in&nbsp;the&nbsp;inheritance&nbsp;tree.<br>
<br>
&lt;p&gt;<br>
convert_to_D&nbsp;and&nbsp;convert_to_E&nbsp;are&nbsp;likely&nbsp;to&nbsp;be&nbsp;at&nbsp;the&nbsp;same&nbsp;offset&nbsp;in&nbsp;&nbsp;<br>
the&nbsp;vtable.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;problem,&nbsp;even&nbsp;if&nbsp;D&nbsp;and&nbsp;E&nbsp;are&nbsp;used&nbsp;in&nbsp;the&nbsp;&nbsp;<br>
same&nbsp;class,&nbsp;such&nbsp;as&nbsp;F,&nbsp;because&nbsp;this&nbsp;is&nbsp;the&nbsp;same&nbsp;offset&nbsp;in&nbsp;different&nbsp;&nbsp;<br>
vtables.<br>
<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;call_Fg&nbsp;is&nbsp;invalid,&nbsp;because&nbsp;it&nbsp;is&nbsp;ambiguous.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;A&nbsp;notation&nbsp;such&nbsp;as&nbsp;((E*)&nbsp;ff)-&gt;g()&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;disambiguate,&nbsp;but&nbsp;&nbsp;<br>
in&nbsp;that&nbsp;case,&nbsp;we&nbsp;don't&nbsp;use&nbsp;the&nbsp;same&nbsp;vtable&nbsp;(either&nbsp;the&nbsp;E&nbsp;in&nbsp;F&nbsp;or&nbsp;D&nbsp;&nbsp;<br>
in&nbsp;F&nbsp;vtable).&nbsp;The&nbsp;E&nbsp;in&nbsp;F&nbsp;vtable&nbsp;uses&nbsp;that&nbsp;offset&nbsp;as&nbsp;'convert_to_E',&nbsp;&nbsp;<br>
whereas&nbsp;the&nbsp;D&nbsp;in&nbsp;F&nbsp;vtable&nbsp;uses&nbsp;that&nbsp;offset&nbsp;as&nbsp;'convert_to_D'.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;Similarly,&nbsp;call_Cf&nbsp;called&nbsp;with&nbsp;an&nbsp;F&nbsp;object&nbsp;will&nbsp;actually&nbsp;be&nbsp;called&nbsp;&nbsp;<br>
with&nbsp;the&nbsp;E&nbsp;in&nbsp;F&nbsp;or&nbsp;D&nbsp;in&nbsp;F,&nbsp;which&nbsp;disambiguates&nbsp;which&nbsp;C&nbsp;is&nbsp;actually&nbsp;&nbsp;<br>
used.&nbsp;The&nbsp;actual&nbsp;C*&nbsp;passed&nbsp;will&nbsp;have&nbsp;been&nbsp;adjusted&nbsp;by&nbsp;the&nbsp;caller&nbsp;&nbsp;<br>
unambiguously,&nbsp;or&nbsp;the&nbsp;call&nbsp;will&nbsp;be&nbsp;invalid.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;For&nbsp;functions&nbsp;overriden&nbsp;in&nbsp;F,&nbsp;an&nbsp;entry&nbsp;'convert_to_F'&nbsp;is&nbsp;created&nbsp;&nbsp;<br>
anyway.&nbsp;This&nbsp;entry&nbsp;will&nbsp;not&nbsp;overlap&nbsp;with&nbsp;either&nbsp;convert_to_E&nbsp;or&nbsp;&nbsp;<br>
convert_to_D.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;fact&nbsp;that&nbsp;an&nbsp;offset&nbsp;is&nbsp;reserved&nbsp;does&nbsp;not&nbsp;mean&nbsp;that&nbsp;it&nbsp;is&nbsp;&nbsp;<br>
actually&nbsp;used.&nbsp;A&nbsp;vtable&nbsp;need&nbsp;to&nbsp;contain&nbsp;the&nbsp;offset&nbsp;only&nbsp;if&nbsp;it&nbsp;refers&nbsp;&nbsp;<br>
to&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;use&nbsp;it.&nbsp;An&nbsp;offset&nbsp;of&nbsp;0&nbsp;is&nbsp;not&nbsp;needed,&nbsp;since&nbsp;&nbsp;<br>
the&nbsp;function&nbsp;pointer&nbsp;will&nbsp;point&nbsp;to&nbsp;the&nbsp;non-adjusting&nbsp;entry&nbsp;point&nbsp;in&nbsp;&nbsp;<br>
that&nbsp;case.<br>
&lt;/dd&gt;<br>
<br>
&lt;/dl&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;&nbsp;4.&nbsp;Cases&nbsp;where&nbsp;adjustment&nbsp;is&nbsp;performed&nbsp;&lt;/h4&gt;<br>
<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;For&nbsp;call_Cf:&nbsp;No&nbsp;adjustment&nbsp;is&nbsp;done&nbsp;at&nbsp;call&nbsp;site.&nbsp;No&nbsp;adjustment&nbsp;is&nbsp;&nbsp;<br>
done&nbsp;at&nbsp;callee&nbsp;site&nbsp;if&nbsp;the&nbsp;dynamic&nbsp;type&nbsp;is&nbsp;C,&nbsp;&nbsp;or&nbsp;D,&nbsp;or&nbsp;D&nbsp;in&nbsp;F&nbsp;(that&nbsp;&nbsp;<br>
is,&nbsp;F&nbsp;casted&nbsp;to&nbsp;an&nbsp;E).<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;&nbsp;For&nbsp;call_Cg:&nbsp;Adjustment&nbsp;to&nbsp;B*&nbsp;is&nbsp;done&nbsp;at&nbsp;call-site.&nbsp;No&nbsp;further&nbsp;&nbsp;<br>
adjustment&nbsp;is&nbsp;needed&nbsp;if&nbsp;the&nbsp;dynamic&nbsp;type&nbsp;is&nbsp;C,&nbsp;D,&nbsp;or&nbsp;D&nbsp;in&nbsp;F.&nbsp;On&nbsp;the&nbsp;&nbsp;<br>
other&nbsp;hand,&nbsp;a&nbsp;second&nbsp;adjustment&nbsp;may&nbsp;happen&nbsp;for&nbsp;an&nbsp;E&nbsp;or&nbsp;E&nbsp;in&nbsp;F,&nbsp;&nbsp;<br>
because&nbsp;C&nbsp;is&nbsp;not&nbsp;their&nbsp;primary&nbsp;base.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
In&nbsp;other&nbsp;words,&nbsp;adjustment&nbsp;is&nbsp;made&nbsp;only&nbsp;when&nbsp;necessary,&nbsp;and&nbsp;at&nbsp;a&nbsp;&nbsp;<br>
place&nbsp;where&nbsp;it&nbsp;is&nbsp;better&nbsp;scheduled&nbsp;than&nbsp;with&nbsp;thunks.&nbsp;The&nbsp;only&nbsp;bad&nbsp;&nbsp;<br>
case&nbsp;is&nbsp;double&nbsp;adjustment&nbsp;for&nbsp;call_Cg&nbsp;called&nbsp;with&nbsp;an&nbsp;E*.&nbsp;This&nbsp;case&nbsp;&nbsp;<br>
can&nbsp;probably&nbsp;be&nbsp;considered&nbsp;rare&nbsp;enough,&nbsp;compared&nbsp;to&nbsp;calls&nbsp;such&nbsp;as&nbsp;&nbsp;<br>
call_Cg&nbsp;called&nbsp;with&nbsp;a&nbsp;C*,&nbsp;where&nbsp;we&nbsp;now&nbsp;actually&nbsp;do&nbsp;the&nbsp;adjustment&nbsp;at&nbsp;&nbsp;<br>
the&nbsp;call-site.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;&nbsp;5.&nbsp;Comparing&nbsp;the&nbsp;code&nbsp;trails&nbsp;&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
Currently,&nbsp;the&nbsp;sequence&nbsp;for&nbsp;a&nbsp;virtual&nbsp;function&nbsp;call&nbsp;in&nbsp;a&nbsp;shared&nbsp;&nbsp;<br>
library&nbsp;will&nbsp;look&nbsp;as&nbsp;follows.&nbsp;I'm&nbsp;assuming&nbsp;+DD64,&nbsp;there&nbsp;would&nbsp;be&nbsp;some&nbsp;&nbsp;<br>
additional&nbsp;addp4&nbsp;in&nbsp;+DD32.&nbsp;The&nbsp;trail&nbsp;below&nbsp;is&nbsp;the&nbsp;dynamic&nbsp;execution&nbsp;&nbsp;<br>
sequence.&nbsp;In&nbsp;bold&nbsp;and&nbsp;between&nbsp;#if/#endif,&nbsp;the&nbsp;affected&nbsp;code.<br>
<br>
&lt;p&gt;<br>
&lt;code&gt;&lt;pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Compute&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;vptr&nbsp;in&nbsp;the&nbsp;object,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;from&nbsp;the&nbsp;this&nbsp;pointer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Optional,&nbsp;since&nbsp;vptroffset&nbsp;is&nbsp;often&nbsp;0.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;also&nbsp;adjusts&nbsp;to&nbsp;the&nbsp;class&nbsp;of&nbsp;the&nbsp;final&nbsp;overrider<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rthis=vptroffset_of_final_overrider,Rthis<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Load&nbsp;the&nbsp;vptr&nbsp;in&nbsp;a&nbsp;register<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ld8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rvptr=[Rthis]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Add&nbsp;the&nbsp;offset&nbsp;to&nbsp;get&nbsp;to&nbsp;the&nbsp;function&nbsp;descriptor&nbsp;pointer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;in&nbsp;the&nbsp;vtable.&nbsp;&nbsp;Never&nbsp;zero,&nbsp;this&nbsp;instruction&nbsp;is&nbsp;always&nbsp;generated<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rfndescr=fndescroffset,Rvptr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;(Assuming&nbsp;inlined&nbsp;stub)&nbsp;Load&nbsp;the&nbsp;function&nbsp;address&nbsp;and&nbsp;new&nbsp;GP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ld8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rfnaddr=[Rfndescr],8<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Load&nbsp;the&nbsp;new&nbsp;GP<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ld8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GP=[Rfndescr]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BRn=Rfnaddr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Perform&nbsp;the&nbsp;actual&nbsp;branch&nbsp;to&nbsp;the&nbsp;target<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;For&nbsp;prediction&nbsp;to&nbsp;occur&nbsp;correctly&nbsp;on&nbsp;McKinley,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;at&nbsp;least&nbsp;5&nbsp;cycles&nbsp;between&nbsp;the&nbsp;mov&nbsp;to&nbsp;BR&nbsp;above&nbsp;and&nbsp;the&nbsp;use<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;of&nbsp;the&nbsp;BR.&nbsp;&nbsp;Up&nbsp;to&nbsp;16&nbsp;bundles...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;is&nbsp;very&nbsp;unlikely&nbsp;to&nbsp;be&nbsp;possible&nbsp;in&nbsp;most&nbsp;actual&nbsp;code,&nbsp;so...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...&nbsp;Branch&nbsp;misprediction&nbsp;almost&nbsp;always,&nbsp;followed&nbsp;by<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...&nbsp;I-Cache&nbsp;miss&nbsp;almost&nbsp;always&nbsp;if&nbsp;jumping&nbsp;to&nbsp;a&nbsp;thunk<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;br.call&nbsp;B0=BRn<br>
<br>
#if&nbsp;OLD_ADJUST<br>
thunk_A::f_from_a_B:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;If&nbsp;the&nbsp;'adjustment_from_B_to_A&nbsp;is&nbsp;the&nbsp;'adjustment_to_A'&nbsp;above,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;then&nbsp;in&nbsp;the&nbsp;new&nbsp;case,&nbsp;the&nbsp;vtable&nbsp;directly&nbsp;points&nbsp;to&nbsp;A::f<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rthis,adjustment_from_B_to_A<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;we&nbsp;can&nbsp;probably&nbsp;generate&nbsp;a&nbsp;PC-relative&nbsp;branch&nbsp;here<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;It&nbsp;is&nbsp;unclear&nbsp;whether&nbsp;we&nbsp;would&nbsp;correctly&nbsp;predict&nbsp;that&nbsp;branch<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;(since&nbsp;it&nbsp;is&nbsp;assumed&nbsp;that&nbsp;we&nbsp;arrive&nbsp;here&nbsp;immediately&nbsp;following<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;a&nbsp;misprediction&nbsp;at&nbsp;call&nbsp;site)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;br&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A::f<br>
#endif&nbsp;//&nbsp;OLD_ADJUST<br>
<br>
//&nbsp;This&nbsp;occurs&nbsp;less&nbsp;often&nbsp;than&nbsp;OLD_ADJUST<br>
//&nbsp;(it&nbsp;does&nbsp;not&nbsp;happen&nbsp;when&nbsp;call-site&nbsp;adjustment&nbsp;is&nbsp;correct)<br>
#if&nbsp;NEW_ADJUST<br>
adjusting_entry_A::f<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Can't&nbsp;be&nbsp;executed&nbsp;in&nbsp;less&nbsp;than&nbsp;3&nbsp;cycles?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rvptr=class_adjustment_offset,Rvptr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;loads&nbsp;data&nbsp;which&nbsp;is&nbsp;close&nbsp;to&nbsp;the&nbsp;fn&nbsp;descriptor,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;so&nbsp;it's&nbsp;likely&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;D-cache<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ld8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rvptr=[Rvptr]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rthis=Rthis,Rvptr<br>
#endif<br>
<br>
A::f:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;alloc&nbsp;&nbsp;&nbsp;...<br>
&lt;/pre&gt;&lt;/code&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Covariant&nbsp;return&nbsp;types&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990722&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
There&nbsp;are&nbsp;several&nbsp;methods&nbsp;for&nbsp;adjusting&nbsp;the&nbsp;'this'&nbsp;pointer&nbsp;of&nbsp;the<br>
returned&nbsp;value&nbsp;for&nbsp;member&nbsp;functions&nbsp;with&nbsp;covariant&nbsp;return&nbsp;types.<br>
We&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;this&nbsp;is&nbsp;done.<br>
Return&nbsp;thunks&nbsp;might&nbsp;be&nbsp;especially&nbsp;costly&nbsp;on&nbsp;IA64,<br>
so&nbsp;a&nbsp;solution&nbsp;based&nbsp;on&nbsp;returning&nbsp;multiple&nbsp;pointers&nbsp;may&nbsp;prove&nbsp;more&nbsp;interesting.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
Provide&nbsp;a&nbsp;separate&nbsp;Vtable&nbsp;entry&nbsp;for&nbsp;each&nbsp;return&nbsp;type.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Allowed&nbsp;caching&nbsp;of&nbsp;vtable&nbsp;contents&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;contents&nbsp;of&nbsp;the&nbsp;vtable&nbsp;can&nbsp;sometimes&nbsp;be&nbsp;modified,<br>
but&nbsp;the&nbsp;concensus&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;nonetheless&nbsp;always&nbsp;allowed&nbsp;to&nbsp;&quot;cache&quot;&nbsp;elements,<br>
i.e.&nbsp;to&nbsp;retain&nbsp;them&nbsp;in&nbsp;registers&nbsp;and&nbsp;reuse&nbsp;them,<br>
whenever&nbsp;it&nbsp;is&nbsp;really&nbsp;useful.<br>
However,&nbsp;this&nbsp;may&nbsp;sometimes&nbsp;break&nbsp;&quot;beyond&nbsp;the&nbsp;standard&quot;&nbsp;code,<br>
such&nbsp;as&nbsp;code&nbsp;loading&nbsp;a&nbsp;shared&nbsp;library&nbsp;that&nbsp;replaces&nbsp;a&nbsp;virtual&nbsp;function.<br>
Can&nbsp;we&nbsp;all&nbsp;agree&nbsp;when&nbsp;caching&nbsp;is&nbsp;allowed?&nbsp;<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
Caching&nbsp;is&nbsp;allowed&nbsp;within&nbsp;a&nbsp;member&nbsp;function.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B4&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Function&nbsp;descriptors&nbsp;in&nbsp;vtable&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
For&nbsp;a&nbsp;runtime&nbsp;architecture&nbsp;where&nbsp;the&nbsp;caller&nbsp;is&nbsp;expected&nbsp;to&nbsp;load&nbsp;the&nbsp;GP<br>
of&nbsp;the&nbsp;callee&nbsp;(if&nbsp;it&nbsp;is&nbsp;in,&nbsp;or&nbsp;may&nbsp;be&nbsp;in,&nbsp;a&nbsp;different&nbsp;DSO),&nbsp;e.g.&nbsp;HP/UX,<br>
what&nbsp;should&nbsp;vtable&nbsp;entries&nbsp;contain?<br>
One&nbsp;possibility&nbsp;is&nbsp;to&nbsp;put&nbsp;a&nbsp;function&nbsp;address/GP&nbsp;pair&nbsp;in&nbsp;the&nbsp;vtable.<br>
Another&nbsp;is&nbsp;to&nbsp;include&nbsp;only&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;thunk&nbsp;which&nbsp;loads&nbsp;the&nbsp;GP<br>
before&nbsp;doing&nbsp;the&nbsp;actual&nbsp;call.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
The&nbsp;Vtable&nbsp;will&nbsp;contain&nbsp;a&nbsp;function&nbsp;address/GP&nbsp;pair.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B5&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-5&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Where&nbsp;are&nbsp;vtables&nbsp;emitted?&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
In&nbsp;C++,&nbsp;there&nbsp;are&nbsp;various&nbsp;things&nbsp;with&nbsp;external&nbsp;linkage&nbsp;that&nbsp;can&nbsp;be<br>
defined&nbsp;in&nbsp;multiple&nbsp;translation&nbsp;units,<br>
while&nbsp;the&nbsp;ODR&nbsp;requires&nbsp;that&nbsp;the&nbsp;program<br>
behave&nbsp;as&nbsp;if&nbsp;there&nbsp;were&nbsp;only&nbsp;a&nbsp;single&nbsp;definition.<br>
&gt;From&nbsp;the&nbsp;user's&nbsp;standpoint,&nbsp;this&nbsp;applies&nbsp;to&nbsp;inlines&nbsp;and&nbsp;templates.<br>
&gt;From&nbsp;the&nbsp;implementation's&nbsp;perspective,<br>
it&nbsp;also&nbsp;applies&nbsp;to&nbsp;things&nbsp;like&nbsp;vtables&nbsp;and&nbsp;RTTI&nbsp;info.<br>
(We&nbsp;call&nbsp;this&nbsp;&lt;i&gt;vague&nbsp;linkage&lt;/i&gt;.)<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;Cygnus&nbsp;--&nbsp;Jason]&lt;/font&gt;<br>
There&nbsp;are&nbsp;several&nbsp;ways&nbsp;of&nbsp;dealing&nbsp;with&nbsp;vague&nbsp;linkage&nbsp;items:<br>
&lt;ol&gt;<br>
&lt;li&gt;&nbsp;Emit&nbsp;them&nbsp;everywhere&nbsp;and&nbsp;only&nbsp;use&nbsp;one.<br>
&lt;li&gt;&nbsp;Use&nbsp;some&nbsp;heuristic&nbsp;to&nbsp;decide&nbsp;where&nbsp;to&nbsp;emit&nbsp;them.<br>
&lt;li&gt;&nbsp;Use&nbsp;a&nbsp;database&nbsp;to&nbsp;decide&nbsp;where&nbsp;to&nbsp;emit&nbsp;them.<br>
&lt;li&gt;&nbsp;Generate&nbsp;them&nbsp;at&nbsp;link&nbsp;time.<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
#3&nbsp;and&nbsp;#4&nbsp;are&nbsp;feasible&nbsp;for&nbsp;templates,<br>
but&nbsp;I&nbsp;consider&nbsp;them&nbsp;too&nbsp;heavyweight&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;other&nbsp;things.<br>
<br>
&lt;p&gt;<br>
The&nbsp;typical&nbsp;heuristic&nbsp;for&nbsp;#2&nbsp;is&nbsp;&quot;with&nbsp;the&nbsp;first&nbsp;non-inline,<br>
non-abstract&nbsp;virtual&nbsp;function&nbsp;in&nbsp;the&nbsp;class&quot;.<br>
This&nbsp;works&nbsp;pretty&nbsp;well,<br>
but&nbsp;fails&nbsp;for&nbsp;classes&nbsp;that&nbsp;have&nbsp;no&nbsp;such&nbsp;virtual&nbsp;function,<br>
and&nbsp;for&nbsp;non-member&nbsp;inlines.<br>
Worse,&nbsp;the&nbsp;heuristic&nbsp;may&nbsp;produce&nbsp;different&nbsp;results&nbsp;in&nbsp;different<br>
translation&nbsp;units,<br>
as&nbsp;a&nbsp;method&nbsp;could&nbsp;be&nbsp;defined&nbsp;inline&nbsp;after&nbsp;being&nbsp;declared&nbsp;non-inline<br>
in&nbsp;the&nbsp;class&nbsp;body.<br>
So&nbsp;we&nbsp;have&nbsp;to&nbsp;handle&nbsp;multiple&nbsp;copies&nbsp;in&nbsp;some&nbsp;cases&nbsp;anyway.<br>
<br>
&lt;p&gt;<br>
The&nbsp;way&nbsp;to&nbsp;handle&nbsp;this&nbsp;in&nbsp;standard&nbsp;ELF&nbsp;is&nbsp;weak&nbsp;symbols.<br>
If&nbsp;all&nbsp;definitions&nbsp;are&nbsp;marked&nbsp;weak,<br>
the&nbsp;linker&nbsp;will&nbsp;choose&nbsp;one<br>
and&nbsp;the&nbsp;others&nbsp;will&nbsp;just&nbsp;sit&nbsp;there&nbsp;taking&nbsp;up&nbsp;space.<br>
<br>
&lt;p&gt;<br>
Christophe&nbsp;mentioned&nbsp;the&nbsp;other&nbsp;day&nbsp;that&nbsp;the&nbsp;HP&nbsp;compiler&nbsp;used&nbsp;the<br>
typical&nbsp;heuristic&nbsp;above,<br>
and&nbsp;handled&nbsp;the&nbsp;case&nbsp;of&nbsp;different&nbsp;results&nbsp;by&nbsp;encoding&nbsp;the<br>
key&nbsp;function&nbsp;in&nbsp;the&nbsp;vtable&nbsp;name.<br>
But&nbsp;this&nbsp;seems&nbsp;unnecessary&nbsp;when&nbsp;we&nbsp;can&nbsp;just&nbsp;choose&nbsp;one&nbsp;of&nbsp;multiple&nbsp;defns.<br>
<br>
&lt;p&gt;<br>
A&nbsp;better&nbsp;solution&nbsp;than&nbsp;weak&nbsp;symbols&nbsp;alone&nbsp;would&nbsp;be&nbsp;to&nbsp;set&nbsp;things&nbsp;up&nbsp;so<br>
that&nbsp;the&nbsp;linker&nbsp;will&nbsp;discard&nbsp;the&nbsp;extra&nbsp;copies.<br>
Various&nbsp;existing&nbsp;implementations&nbsp;of&nbsp;this&nbsp;are:<br>
<br>
&lt;ol&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;Microsoft&nbsp;PE/COFF&nbsp;defn&nbsp;includes&nbsp;support&nbsp;for&nbsp;COMDAT&nbsp;sections,<br>
which&nbsp;key&nbsp;off&nbsp;of&nbsp;the&nbsp;first&nbsp;symbol&nbsp;defined.<br>
One&nbsp;copy&nbsp;is&nbsp;chosen,&nbsp;others&nbsp;are&nbsp;discarded.<br>
You&nbsp;can&nbsp;specify&nbsp;conditions&nbsp;to&nbsp;the&nbsp;linker<br>
(must&nbsp;have&nbsp;same&nbsp;contents,&nbsp;must&nbsp;have&nbsp;same&nbsp;size).<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;IBM&nbsp;XCOFF&nbsp;platform&nbsp;includes&nbsp;a&nbsp;garbage-collecting&nbsp;linker;<br>
sections&nbsp;that&nbsp;are&nbsp;not&nbsp;referenced&nbsp;in&nbsp;a&nbsp;sweep&nbsp;from&nbsp;main&nbsp;are&nbsp;discarded.<br>
In&nbsp;xlC,&nbsp;template&nbsp;instantiations&nbsp;are&nbsp;emitted&nbsp;in&nbsp;separate&nbsp;sections,<br>
with&nbsp;encoded&nbsp;names;<br>
at&nbsp;link&nbsp;time,&nbsp;one&nbsp;copy&nbsp;is&nbsp;renamed&nbsp;to&nbsp;the&nbsp;real&nbsp;mangled&nbsp;name,<br>
and&nbsp;the&nbsp;others&nbsp;are&nbsp;discarded&nbsp;by&nbsp;garbage&nbsp;collection.<br>
&lt;/ol&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;GNU&nbsp;ELF&nbsp;toolchain&nbsp;does&nbsp;a&nbsp;variant&nbsp;of&nbsp;#1&nbsp;here;<br>
any&nbsp;sections&nbsp;with&nbsp;names&nbsp;beginning&nbsp;with&nbsp;&quot;.gnu.linkonce.&quot;<br>
are&nbsp;treated&nbsp;as&nbsp;COMDAT&nbsp;sections.<br>
It&nbsp;seems&nbsp;more&nbsp;sensible&nbsp;to&nbsp;me&nbsp;to&nbsp;key&nbsp;off&nbsp;of&nbsp;the&nbsp;section&nbsp;name<br>
than&nbsp;the&nbsp;first&nbsp;symbol&nbsp;name&nbsp;as&nbsp;in&nbsp;PE.<br>
<br>
&lt;p&gt;<br>
The&nbsp;GNU&nbsp;linker&nbsp;recently&nbsp;added&nbsp;support&nbsp;for&nbsp;garbage&nbsp;collection,<br>
and&nbsp;I've&nbsp;been&nbsp;thinking&nbsp;about&nbsp;changing&nbsp;our&nbsp;handling&nbsp;of&nbsp;vague<br>
linkage&nbsp;to&nbsp;make&nbsp;use&nbsp;of&nbsp;it,&nbsp;but&nbsp;haven't.<br>
<br>
&lt;p&gt;<br>
I&nbsp;propose&nbsp;that&nbsp;the&nbsp;ia64&nbsp;base&nbsp;ABI&nbsp;be&nbsp;extended&nbsp;to<br>
provide&nbsp;for&nbsp;either&nbsp;COMDAT&nbsp;sections&nbsp;or&nbsp;garbage&nbsp;collection,<br>
and&nbsp;that&nbsp;we&nbsp;use&nbsp;that&nbsp;support&nbsp;for&nbsp;vague&nbsp;linkage.<br>
<br>
&lt;p&gt;<br>
I&nbsp;further&nbsp;propose&nbsp;that&nbsp;we&nbsp;not&nbsp;use&nbsp;heuristics&nbsp;to<br>
cut&nbsp;down&nbsp;the&nbsp;number&nbsp;of&nbsp;copies&nbsp;ahead&nbsp;of&nbsp;time;<br>
they&nbsp;usually&nbsp;work&nbsp;fine,&nbsp;but&nbsp;can&nbsp;cause&nbsp;problems&nbsp;in&nbsp;some&nbsp;situations,<br>
such&nbsp;as&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;class's&nbsp;members&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;symbol&nbsp;space.<br>
Does&nbsp;the&nbsp;ia64&nbsp;ABI&nbsp;provide&nbsp;for&nbsp;controlling&nbsp;which&nbsp;symbols<br>
are&nbsp;exported&nbsp;from&nbsp;a&nbsp;shared&nbsp;library?<br>
<br>
&lt;p&gt;<br>
A&nbsp;side&nbsp;issue:&nbsp;What&nbsp;do&nbsp;we&nbsp;want&nbsp;to&nbsp;do&nbsp;with<br>
dynamically-initialized&nbsp;variables?<br>
The&nbsp;same&nbsp;thing,&nbsp;or&nbsp;use&nbsp;COMMON?<br>
I&nbsp;propose&nbsp;COMMON.<br>
<br>
&lt;p&gt;<br>
See&nbsp;also&nbsp;G-3,&nbsp;for&nbsp;vague&nbsp;linkage&nbsp;of&nbsp;inlined&nbsp;routines&nbsp;and&nbsp;their&nbsp;static&nbsp;variables.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;SGI&nbsp;summarizing&nbsp;others]&lt;/font&gt;<br>
HP&nbsp;uses&nbsp;COMDAT&nbsp;for&nbsp;many&nbsp;cases,&nbsp;keying&nbsp;from&nbsp;the&nbsp;symbol&nbsp;names.<br>
HP&nbsp;also&nbsp;uses&nbsp;some&nbsp;heuristics.<br>
HP&nbsp;observes&nbsp;that&nbsp;IA-64&nbsp;objects&nbsp;will&nbsp;already&nbsp;be&nbsp;large.<br>
&gt;From&nbsp;the&nbsp;base&nbsp;ABI&nbsp;discussions,<br>
any&nbsp;use&nbsp;of&nbsp;WEAK&nbsp;or&nbsp;COMMON&nbsp;symbols&nbsp;will&nbsp;need&nbsp;to&nbsp;take&nbsp;care&nbsp;not&nbsp;to&nbsp;depend<br>
on&nbsp;vendor-specific&nbsp;treatment.<br>
<br>
&lt;p&gt;<br>
Defining&nbsp;a&nbsp;COMDAT&nbsp;mechanism&nbsp;doesn't&nbsp;preclude&nbsp;using&nbsp;heuristics&nbsp;to&nbsp;avoid<br>
some&nbsp;copies&nbsp;up&nbsp;front.<br>
A&nbsp;COMDAT&nbsp;mechanism&nbsp;should&nbsp;also&nbsp;specify&nbsp;how&nbsp;to&nbsp;get&nbsp;rid&nbsp;of&nbsp;associated<br>
sections&nbsp;like&nbsp;debugging&nbsp;info,&nbsp;unless&nbsp;the&nbsp;identical&nbsp;mechanism&nbsp;works.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990629&nbsp;HP&nbsp;--&nbsp;Christophe]&lt;/font&gt;<br>
First,&nbsp;the&nbsp;&quot;usual&quot;&nbsp;heuristic<br>
(which&nbsp;is&nbsp;usual&nbsp;because&nbsp;it&nbsp;dates&nbsp;back&nbsp;to&nbsp;Cfront)<br>
is&nbsp;to&nbsp;emit&nbsp;vtables&nbsp;in&nbsp;the&nbsp;translation&nbsp;unit&nbsp;that&nbsp;contains&nbsp;&nbsp;<br>
the&nbsp;definition&nbsp;of&nbsp;the&nbsp;first&nbsp;non&nbsp;inline,&nbsp;non&nbsp;pure&nbsp;virtual&nbsp;function.&nbsp;&nbsp;<br>
That&nbsp;is,&nbsp;for:<br>
&lt;pre&gt;&lt;code&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;X&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;a();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;f()&nbsp;{&nbsp;return;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;g()&nbsp;=&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;h();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;i();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>
&lt;/code&gt;&lt;/pre&gt;<br>
the&nbsp;vtable&nbsp;is&nbsp;emitted&nbsp;only&nbsp;in&nbsp;the&nbsp;TU&nbsp;that&nbsp;contains&nbsp;the&nbsp;definition&nbsp;of&nbsp;h().<br>
<br>
&lt;p&gt;<br>
This&nbsp;breaks&nbsp;and&nbsp;becomes&nbsp;non-portable&nbsp;if:<br>
&lt;ul&gt;<br>
&lt;li&gt;There&nbsp;is&nbsp;no&nbsp;such&nbsp;thing.&nbsp;In&nbsp;that&nbsp;case,<br>
&nbsp;&nbsp;&nbsp;&nbsp;you&nbsp;generally&nbsp;emit&nbsp;duplicate&nbsp;versions&nbsp;of&nbsp;vtables<br>
&lt;li&gt;There&nbsp;is&nbsp;a&nbsp;&quot;change&nbsp;of&nbsp;mind&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;such&nbsp;as&nbsp;having&nbsp;the&nbsp;above&nbsp;class&nbsp;followed&nbsp;by:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;&lt;p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;dd&gt;inline&nbsp;void&nbsp;X::h()&nbsp;{&nbsp;f();&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/code&gt;<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
Now,&nbsp;the&nbsp;COMDAT&nbsp;issue&nbsp;is&nbsp;as&nbsp;follows:<br>
a&nbsp;COMDAT&nbsp;section&nbsp;is,&nbsp;in&nbsp;some&nbsp;cases,&nbsp;slightly&nbsp;more&nbsp;difficult&nbsp;to&nbsp;handle<br>
(at&nbsp;least,&nbsp;that's&nbsp;the&nbsp;impression&nbsp;Jason&nbsp;gave&nbsp;me).<br>
For&nbsp;statics&nbsp;with&nbsp;runtime&nbsp;initialization,&nbsp;&nbsp;<br>
what&nbsp;you&nbsp;can&nbsp;do&nbsp;is&nbsp;reserve&nbsp;COMMON&nbsp;space&nbsp;('easier'),<br>
then&nbsp;initialize&nbsp;that&nbsp;space&nbsp;at&nbsp;runtime.<br>
As&nbsp;I&nbsp;said,&nbsp;the&nbsp;problem&nbsp;is&nbsp;if&nbsp;two&nbsp;compilers&nbsp;disagree&nbsp;on&nbsp;whether&nbsp;this<br>
is&nbsp;a&nbsp;runtime&nbsp;or&nbsp;a&nbsp;compile&nbsp;time&nbsp;initialization,&nbsp;such&nbsp;as&nbsp;in&nbsp;:<br>
&lt;pre&gt;&lt;code&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;f()&nbsp;{&nbsp;return&nbsp;1;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;x&nbsp;=&nbsp;f();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Static&nbsp;(COMDAT)&nbsp;or&nbsp;Dynamic&nbsp;(COMMON)&nbsp;initialization?<br>
&lt;/code&gt;&lt;/pre&gt;<br>
<br>
&lt;p&gt;<br>
So&nbsp;I&nbsp;personally&nbsp;recommend&nbsp;that&nbsp;we&nbsp;put&nbsp;everything&nbsp;in&nbsp;COMDAT.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990715&nbsp;All]&lt;/font&gt;<br>
Consensus&nbsp;so&nbsp;far:&nbsp;use&nbsp;a&nbsp;heuristic&nbsp;for&nbsp;vtable&nbsp;and&nbsp;typeinfo&nbsp;emission,<br>
based&nbsp;on&nbsp;the&nbsp;definition&nbsp;of&nbsp;the&nbsp;key&nbsp;function.<br>
(The&nbsp;first&nbsp;virtual&nbsp;function&nbsp;that&nbsp;is&nbsp;not<br>
declared&nbsp;inline&nbsp;in&nbsp;the&nbsp;class&nbsp;definition.)<br>
The&nbsp;vtable&nbsp;must&nbsp;be&nbsp;emitted&nbsp;where&nbsp;the&nbsp;key&nbsp;function&nbsp;is&nbsp;defined,<br>
it&nbsp;may&nbsp;also&nbsp;be&nbsp;emitted&nbsp;in&nbsp;other&nbsp;translation&nbsp;units&nbsp;as&nbsp;well.<br>
If&nbsp;there&nbsp;is&nbsp;no&nbsp;key&nbsp;function&nbsp;then&nbsp;the&nbsp;vtable&nbsp;must&nbsp;be&nbsp;emitted&nbsp;in&nbsp;any<br>
translation&nbsp;unit&nbsp;that&nbsp;refers&nbsp;to&nbsp;the&nbsp;vtable&nbsp;in&nbsp;any&nbsp;way.<br>
<br>
&lt;p&gt;<br>
Implication:&nbsp;the&nbsp;linker&nbsp;must&nbsp;be&nbsp;prepared&nbsp;to&nbsp;discard&nbsp;duplicate&nbsp;vtables.<br>
We&nbsp;want&nbsp;to&nbsp;use&nbsp;COMDAT&nbsp;sections&nbsp;for&nbsp;this<br>
(and&nbsp;for&nbsp;other&nbsp;entities&nbsp;with&nbsp;vague&nbsp;linkage.)<br>
<br>
&lt;p&gt;<br>
Open&nbsp;issue:&nbsp;the&nbsp;elf&nbsp;format&nbsp;allows&nbsp;only&nbsp;16&nbsp;bits&nbsp;for&nbsp;section&nbsp;identifiers,<br>
and&nbsp;typically&nbsp;two&nbsp;of&nbsp;those&nbsp;bits&nbsp;are&nbsp;already&nbsp;taken&nbsp;up&nbsp;for&nbsp;other&nbsp;things.<br>
So&nbsp;we've&nbsp;only&nbsp;got&nbsp;16k&nbsp;sections&nbsp;available,<br>
which&nbsp;is&nbsp;unacceptable&nbsp;if&nbsp;we're&nbsp;creating&nbsp;lots&nbsp;of&nbsp;small&nbsp;sections.<br>
<br>
&lt;p&gt;<br>
Jason&nbsp;-&nbsp;COMDATs&nbsp;disappear&nbsp;into&nbsp;text&nbsp;and&nbsp;data&nbsp;at&nbsp;link&nbsp;time,<br>
so&nbsp;the&nbsp;issue&nbsp;is&nbsp;really&nbsp;only&nbsp;serious&nbsp;if&nbsp;we've&nbsp;got&nbsp;more&nbsp;than&nbsp;16k&nbsp;vtables<br>
(or&nbsp;template&nbsp;instantiations,&nbsp;etc.)<br>
in&nbsp;a&nbsp;single&nbsp;translation&nbsp;unit.<br>
<br>
&lt;p&gt;<br>
Daveed&nbsp;-&nbsp;HP&nbsp;has&nbsp;gotten&nbsp;around&nbsp;this&nbsp;problem&nbsp;by&nbsp;hacking&nbsp;their&nbsp;ELF&nbsp;files<br>
to&nbsp;steal&nbsp;another&nbsp;8&nbsp;bits&nbsp;from&nbsp;somewhere&nbsp;else.<br>
<br>
&lt;p&gt;<br>
Jack&nbsp;-&nbsp;a&nbsp;new&nbsp;kind&nbsp;of&nbsp;section&nbsp;table&nbsp;could&nbsp;be&nbsp;a&nbsp;viable&nbsp;solution.<br>
However,&nbsp;it&nbsp;would&nbsp;break&nbsp;everything&nbsp;if&nbsp;we&nbsp;did&nbsp;it&nbsp;for&nbsp;ia32.<br>
Is&nbsp;a&nbsp;solution&nbsp;that&nbsp;only&nbsp;works&nbsp;on&nbsp;ia64&nbsp;acceptable?<br>
Note&nbsp;also&nbsp;that&nbsp;the&nbsp;elf&nbsp;section&nbsp;table&nbsp;has&nbsp;its&nbsp;own&nbsp;string&nbsp;table,<br>
which&nbsp;we&nbsp;wouldn't&nbsp;be&nbsp;able&nbsp;to&nbsp;share&nbsp;with&nbsp;the&nbsp;new&nbsp;kind&nbsp;of&nbsp;section&nbsp;table.<br>
Index&nbsp;and&nbsp;link&nbsp;fields&nbsp;often&nbsp;point&nbsp;into&nbsp;section&nbsp;table,<br>
we&nbsp;would&nbsp;have&nbsp;to&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;deal&nbsp;with&nbsp;this.<br>
(Jack&nbsp;is&nbsp;not&nbsp;opposed&nbsp;to&nbsp;the&nbsp;idea&nbsp;of&nbsp;an&nbsp;alternate&nbsp;section&nbsp;table,<br>
he&nbsp;is&nbsp;just&nbsp;pointing&nbsp;out&nbsp;some&nbsp;of&nbsp;the&nbsp;issues&nbsp;we&nbsp;will&nbsp;have&nbsp;to&nbsp;resolve.)<br>
<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B6&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-6&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Virtual&nbsp;function&nbsp;table&nbsp;layout&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
What&nbsp;is&nbsp;the&nbsp;layout&nbsp;of&nbsp;the&nbsp;Vtable?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624]&lt;/font&gt;<br>
Issue&nbsp;split&nbsp;from&nbsp;A-1.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990630&nbsp;HP&nbsp;-&nbsp;Christophe]&lt;/font&gt;<br>
<br>
&lt;p&gt;<br>
Here&nbsp;is&nbsp;a&nbsp;short&nbsp;description&nbsp;of&nbsp;the&nbsp;virtual&nbsp;tables&nbsp;layout.&nbsp;This&nbsp;is<br>
mostly&nbsp;taken&nbsp;out&nbsp;of&nbsp;the&nbsp;existing&nbsp;Taligent&nbsp;runtime.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;Virtual&nbsp;tables&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
Virtual&nbsp;tables&nbsp;(vtables)&nbsp;are&nbsp;used&nbsp;to&nbsp;dispatch&nbsp;virtual&nbsp;functions,&nbsp;to&nbsp;&nbsp;<br>
access&nbsp;virtual&nbsp;base&nbsp;class&nbsp;subobjects,&nbsp;and&nbsp;to&nbsp;access&nbsp;information&nbsp;for&nbsp;&nbsp;<br>
runtime&nbsp;type&nbsp;identification&nbsp;(RTTI).&nbsp;Each&nbsp;class&nbsp;that&nbsp;has&nbsp;virtual<br>
member&nbsp;functions&nbsp;or&nbsp;virtual&nbsp;bases&nbsp;has&nbsp;an&nbsp;associated&nbsp;set&nbsp;of&nbsp;vtables.&nbsp;&nbsp;<br>
The&nbsp;vtable&nbsp;pointers&nbsp;within&nbsp;all&nbsp;the&nbsp;objects&nbsp;(instances)&nbsp;of&nbsp;a&nbsp;class<br>
point&nbsp;to&nbsp;the&nbsp;same&nbsp;set&nbsp;of&nbsp;vtables.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;Vtable&nbsp;layout&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
Each&nbsp;vtable&nbsp;consists&nbsp;of&nbsp;the&nbsp;following&nbsp;parts,&nbsp;in&nbsp;the&nbsp;order&nbsp;listed.<br>
All&nbsp;offsets&nbsp;in&nbsp;a&nbsp;vtable&nbsp;are&nbsp;of&nbsp;type&nbsp;ptrdiff_t.<br>
<br>
&lt;p&gt;<br>
&quot;Virtual&nbsp;base&nbsp;offsets&quot;&nbsp;are&nbsp;used&nbsp;to&nbsp;access&nbsp;the&nbsp;virtual&nbsp;bases&nbsp;of&nbsp;an<br>
object&nbsp;and&nbsp;to&nbsp;non&nbsp;virtual&nbsp;bases&nbsp;when&nbsp;pointer&nbsp;adjustment&nbsp;is&nbsp;required&nbsp;&nbsp;<br>
for&nbsp;some&nbsp;overriden&nbsp;virtual&nbsp;function.&nbsp;Each&nbsp;entry&nbsp;is&nbsp;a&nbsp;displacement&nbsp;to&nbsp;&nbsp;<br>
a&nbsp;virtual&nbsp;base&nbsp;subobject&nbsp;from&nbsp;the&nbsp;location&nbsp;within&nbsp;the&nbsp;object&nbsp;of&nbsp;the&nbsp;&nbsp;<br>
vtable&nbsp;pointer&nbsp;that&nbsp;addresses&nbsp;this&nbsp;vtable.&nbsp;These&nbsp;entries&nbsp;are&nbsp;only<br>
necessary&nbsp;if&nbsp;the&nbsp;class&nbsp;directly&nbsp;or&nbsp;indirectly&nbsp;inherits&nbsp;from&nbsp;virtual&nbsp;&nbsp;<br>
base&nbsp;classes,&nbsp;or&nbsp;if&nbsp;it&nbsp;overrides&nbsp;a&nbsp;virtual&nbsp;function&nbsp;defined&nbsp;in&nbsp;a&nbsp;base&nbsp;&nbsp;<br>
class&nbsp;and&nbsp;if&nbsp;&nbsp;adjustment&nbsp;from&nbsp;the&nbsp;based&nbsp;to&nbsp;the&nbsp;derived&nbsp;class&nbsp;is<br>
needed.&nbsp;The&nbsp;values&nbsp;can&nbsp;be&nbsp;positive&nbsp;or&nbsp;negative.<br>
<br>
&lt;p&gt;<br>
&quot;Offset&nbsp;to&nbsp;top&quot;&nbsp;holds&nbsp;the&nbsp;displacement&nbsp;to&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;object&nbsp;from&nbsp;&nbsp;<br>
the&nbsp;location&nbsp;within&nbsp;the&nbsp;object&nbsp;of&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;that&nbsp;addresses&nbsp;&nbsp;<br>
this&nbsp;vtable.&nbsp;A&nbsp;negative&nbsp;value&nbsp;indicates&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;is&nbsp;part&nbsp;of&nbsp;&nbsp;<br>
an&nbsp;embedded&nbsp;base&nbsp;class&nbsp;subobject;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;zero.&nbsp;The&nbsp;offset<br>
provides&nbsp;a&nbsp;way&nbsp;to&nbsp;find&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;object&nbsp;from&nbsp;any&nbsp;base&nbsp;subobject&nbsp;&nbsp;<br>
with&nbsp;a&nbsp;vtable<br>
pointer.&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;dynamic_cast&lt;void*&gt;&nbsp;in&nbsp;particular.<br>
The&nbsp;virtual&nbsp;pointer&nbsp;points&nbsp;to&nbsp;the&nbsp;&quot;offset&nbsp;to&nbsp;top&quot;&nbsp;field.<br>
<br>
&lt;p&gt;<br>
&quot;Typeinfo&nbsp;pointer&quot;&nbsp;points&nbsp;to&nbsp;the&nbsp;typeinfo&nbsp;object&nbsp;used&nbsp;for&nbsp;RTTI.&nbsp;All&nbsp;&nbsp;<br>
entries&nbsp;in&nbsp;each&nbsp;of&nbsp;the&nbsp;vtables&nbsp;for&nbsp;a&nbsp;given&nbsp;class&nbsp;point&nbsp;to&nbsp;the&nbsp;same<br>
typeinfo&nbsp;object.<br>
<br>
&lt;p&gt;<br>
&quot;Duplicate&nbsp;base&nbsp;information&nbsp;pointer&quot;&nbsp;points&nbsp;to&nbsp;a&nbsp;table&nbsp;used&nbsp;to<br>
perform&nbsp;runtime&nbsp;disambiguation&nbsp;of&nbsp;duplicate&nbsp;base&nbsp;classes&nbsp;for&nbsp;dynamic&nbsp;&nbsp;<br>
casts.&nbsp;The&nbsp;entries&nbsp;in&nbsp;each&nbsp;of&nbsp;the&nbsp;vtables&nbsp;for&nbsp;a&nbsp;given&nbsp;class&nbsp;do&nbsp;not<br>
all&nbsp;point&nbsp;to&nbsp;the&nbsp;same&nbsp;table&nbsp;of&nbsp;duplicate&nbsp;base&nbsp;information.<br>
<br>
&lt;p&gt;<br>
Function&nbsp;pointers&nbsp;are&nbsp;used&nbsp;for&nbsp;virtual&nbsp;function&nbsp;dispatch.&nbsp;Each<br>
pointer&nbsp;holds&nbsp;either&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;virtual&nbsp;function&nbsp;of&nbsp;the&nbsp;class,&nbsp;&nbsp;<br>
or&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;secondary&nbsp;entry&nbsp;point&nbsp;that&nbsp;performs&nbsp;certain<br>
adjustments&nbsp;before&nbsp;transferring&nbsp;control&nbsp;to&nbsp;a&nbsp;virtual&nbsp;function.&nbsp;[To&nbsp;be&nbsp;&nbsp;<br>
discussed]&nbsp;In&nbsp;the&nbsp;case&nbsp;of&nbsp;shared&nbsp;library&nbsp;builds,&nbsp;[Solution&nbsp;1]&nbsp;a<br>
function&nbsp;pointer&nbsp;entry&nbsp;contains&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;function&nbsp;descriptor,&nbsp;&nbsp;<br>
which&nbsp;contains&nbsp;the&nbsp;target&nbsp;GP&nbsp;value&nbsp;and&nbsp;the&nbsp;actual&nbsp;function&nbsp;address<br>
[Solution&nbsp;2]&nbsp;a&nbsp;function&nbsp;pointer&nbsp;entry&nbsp;contains&nbsp;two&nbsp;words:&nbsp;the&nbsp;value&nbsp;&nbsp;<br>
of&nbsp;the&nbsp;target&nbsp;GP&nbsp;value&nbsp;and&nbsp;the&nbsp;actual&nbsp;function&nbsp;address&nbsp;[Solution&nbsp;3]&nbsp;a&nbsp;&nbsp;<br>
function&nbsp;pointer&nbsp;points&nbsp;to&nbsp;an&nbsp;import&nbsp;table&nbsp;generated&nbsp;by&nbsp;the&nbsp;dynamic&nbsp;&nbsp;<br>
loader,&nbsp;which&nbsp;will&nbsp;transfer&nbsp;control&nbsp;to&nbsp;the&nbsp;target&nbsp;function.<br>
<br>
&lt;p&gt;<br>
The&nbsp;function&nbsp;pointers&nbsp;are&nbsp;grouped&nbsp;so&nbsp;that&nbsp;the&nbsp;entries&nbsp;for&nbsp;all<br>
virtual&nbsp;functions&nbsp;introduced&nbsp;by&nbsp;a&nbsp;base&nbsp;class&nbsp;are&nbsp;kept&nbsp;together,&nbsp;in<br>
declaration&nbsp;order.&nbsp;Function&nbsp;pointers&nbsp;from&nbsp;a&nbsp;derived&nbsp;class&nbsp;immediately&nbsp;&nbsp;<br>
follow&nbsp;those&nbsp;for&nbsp;the&nbsp;base&nbsp;class.&nbsp;The&nbsp;order&nbsp;of&nbsp;function&nbsp;pointers<br>
therefore&nbsp;depends&nbsp;on&nbsp;the&nbsp;static&nbsp;type&nbsp;of&nbsp;subobject&nbsp;whose&nbsp;vtable<br>
pointer&nbsp;points&nbsp;to&nbsp;that&nbsp;virtual&nbsp;table.<br>
<br>
&lt;p&gt;<br>
A&nbsp;vtable&nbsp;pointer&nbsp;in&nbsp;an&nbsp;object&nbsp;addresses&nbsp;the&nbsp;&quot;offset&nbsp;to&nbsp;top&quot;&nbsp;field<br>
of&nbsp;a&nbsp;vtable.&nbsp;This&nbsp;location&nbsp;is&nbsp;known&nbsp;as&nbsp;the&nbsp;address&nbsp;point&nbsp;of&nbsp;the<br>
vtable.&nbsp;Note&nbsp;that&nbsp;the&nbsp;virtual&nbsp;base&nbsp;offsets&nbsp;are&nbsp;at&nbsp;negative<br>
displacements&nbsp;from&nbsp;the&nbsp;address&nbsp;point.<br>
<br>
&lt;p&gt;<br>
The&nbsp;typeinfo&nbsp;and&nbsp;duplicate&nbsp;base&nbsp;information&nbsp;are&nbsp;covered&nbsp;in&nbsp;separate&nbsp;&nbsp;<br>
discussions.<br>
<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;Types&nbsp;of&nbsp;vtables&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;following&nbsp;categories&nbsp;describe&nbsp;the&nbsp;rules&nbsp;for&nbsp;how&nbsp;vtables&nbsp;of&nbsp;a<br>
class&nbsp;are&nbsp;constructed&nbsp;from&nbsp;the&nbsp;vtables&nbsp;of&nbsp;its&nbsp;bases.<br>
<br>
&lt;p&gt;<br>
&lt;b&gt;Category&nbsp;1&lt;/b&gt;<br>
<br>
&lt;p&gt;<br>
This&nbsp;category&nbsp;is&nbsp;for&nbsp;a&nbsp;class&nbsp;that&nbsp;inherits&nbsp;no&nbsp;base&nbsp;classes.&nbsp;If&nbsp;the<br>
class&nbsp;declares&nbsp;no&nbsp;virtual&nbsp;functions,&nbsp;then&nbsp;it&nbsp;has&nbsp;no&nbsp;vtable,&nbsp;and&nbsp;its&nbsp;&nbsp;<br>
objects&nbsp;have&nbsp;no&nbsp;vtable&nbsp;pointers.<br>
<br>
If&nbsp;the&nbsp;class&nbsp;declares&nbsp;virtual&nbsp;functions,&nbsp;then&nbsp;it&nbsp;has&nbsp;a&nbsp;single&nbsp;vtable&nbsp;&nbsp;<br>
containing&nbsp;RTTI&nbsp;fields&nbsp;followed&nbsp;by&nbsp;function&nbsp;pointer&nbsp;entries.&nbsp;There&nbsp;&nbsp;<br>
is&nbsp;one&nbsp;function&nbsp;pointer&nbsp;entry&nbsp;for&nbsp;each&nbsp;virtual&nbsp;function&nbsp;declared&nbsp;in&nbsp;&nbsp;<br>
the&nbsp;class.&nbsp;The&nbsp;vtable&nbsp;pointer&nbsp;in&nbsp;an&nbsp;object&nbsp;of&nbsp;the&nbsp;class&nbsp;addresses<br>
this&nbsp;vtable.<br>
<br>
&lt;p&gt;<br>
&lt;b&gt;Category&nbsp;2&lt;/b&gt;<br>
<br>
&lt;p&gt;<br>
This&nbsp;category&nbsp;is&nbsp;for&nbsp;a&nbsp;class&nbsp;that&nbsp;inherits&nbsp;only&nbsp;non-virtual&nbsp;base<br>
classes,&nbsp;and&nbsp;the&nbsp;non-&nbsp;virtual&nbsp;base&nbsp;classes&nbsp;have&nbsp;no&nbsp;base&nbsp;classes,&nbsp;and&nbsp;&nbsp;<br>
there&nbsp;is&nbsp;no&nbsp;adjustment&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;overriden&nbsp;virtual&nbsp;functions.<br>
<br>
&lt;p&gt;<br>
If&nbsp;none&nbsp;of&nbsp;the&nbsp;base&nbsp;classes&nbsp;have&nbsp;vtables,&nbsp;a&nbsp;vtable&nbsp;is&nbsp;constructed<br>
for&nbsp;the&nbsp;class&nbsp;according&nbsp;to&nbsp;the&nbsp;same&nbsp;rules&nbsp;as&nbsp;in&nbsp;Category&nbsp;1.&nbsp;Otherwise&nbsp;&nbsp;<br>
the&nbsp;class&nbsp;has&nbsp;a&nbsp;vtable&nbsp;for&nbsp;each&nbsp;base&nbsp;class&nbsp;that&nbsp;has&nbsp;a&nbsp;vtable.&nbsp;The<br>
class's&nbsp;vtables&nbsp;are&nbsp;constructed&nbsp;from&nbsp;copies&nbsp;of&nbsp;the&nbsp;base&nbsp;class<br>
vtables.&nbsp;The&nbsp;entries&nbsp;are&nbsp;the&nbsp;same,&nbsp;except:<br>
&lt;ul&gt;<br>
&lt;li&gt;The&nbsp;RTTI&nbsp;fields&nbsp;contain&nbsp;information&nbsp;for&nbsp;the&nbsp;class,&nbsp;rather&nbsp;than<br>
for&nbsp;the&nbsp;base&nbsp;class.<br>
&lt;p&gt;<br>
&lt;li&gt;The&nbsp;function&nbsp;pointer&nbsp;entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;inherited&nbsp;from&nbsp;&nbsp;<br>
the&nbsp;base&nbsp;class&nbsp;and<br>
overridden&nbsp;by&nbsp;this&nbsp;class&nbsp;are&nbsp;replaced&nbsp;with&nbsp;the&nbsp;addresses&nbsp;of&nbsp;the<br>
overridden&nbsp;functions<br>
(or&nbsp;the&nbsp;corresponding&nbsp;adjustor&nbsp;secondary&nbsp;entry&nbsp;points),<br>
&lt;p&gt;<br>
&lt;li&gt;At&nbsp;negative&nbsp;offsets,&nbsp;offsets&nbsp;to&nbsp;the&nbsp;base&nbsp;classes&nbsp;are&nbsp;generated&nbsp;if&nbsp;&nbsp;<br>
used&nbsp;by&nbsp;adjustor&nbsp;secondary&nbsp;entry&nbsp;points.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
Informally,&nbsp;each&nbsp;of&nbsp;these&nbsp;vtables&nbsp;has&nbsp;a&nbsp;name&nbsp;in&nbsp;the&nbsp;form<br>
Base-in-Derived&nbsp;vtable,&nbsp;where&nbsp;Base&nbsp;is&nbsp;a&nbsp;base&nbsp;class&nbsp;and&nbsp;Derived&nbsp;is&nbsp;the&nbsp;&nbsp;<br>
derived&nbsp;class.&nbsp;Each&nbsp;vtable&nbsp;pointer&nbsp;in&nbsp;an&nbsp;object&nbsp;addresses&nbsp;one&nbsp;of<br>
these&nbsp;vtables&nbsp;for&nbsp;the&nbsp;class.&nbsp;The&nbsp;vtable&nbsp;pointer&nbsp;of&nbsp;an&nbsp;A&nbsp;subobject<br>
within&nbsp;a&nbsp;B&nbsp;object&nbsp;would&nbsp;address&nbsp;the&nbsp;A-in-B&nbsp;vtable.<br>
<br>
&lt;p&gt;<br>
The&nbsp;vtable&nbsp;copied&nbsp;from&nbsp;the&nbsp;primary&nbsp;base&nbsp;class&nbsp;is&nbsp;also&nbsp;called&nbsp;the<br>
primary&nbsp;vtable;&nbsp;it&nbsp;is&nbsp;addressed&nbsp;by&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;&nbsp;<br>
the&nbsp;object.&nbsp;The&nbsp;other&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class&nbsp;are&nbsp;called&nbsp;secondary<br>
vtables;&nbsp;they&nbsp;are&nbsp;addressed&nbsp;by&nbsp;vtable&nbsp;pointers&nbsp;inside&nbsp;the&nbsp;object.<br>
<br>
<br>
&lt;p&gt;<br>
Aside&nbsp;from&nbsp;the&nbsp;function&nbsp;pointer&nbsp;entries&nbsp;that&nbsp;correspond&nbsp;to&nbsp;those&nbsp;of&nbsp;&nbsp;<br>
the&nbsp;primary&nbsp;base&nbsp;class,&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;holds&nbsp;the&nbsp;following<br>
additional&nbsp;entries&nbsp;at&nbsp;its&nbsp;tail:<br>
-&nbsp;Entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;introduced&nbsp;by&nbsp;this&nbsp;class<br>
-&nbsp;Entries&nbsp;for&nbsp;overridden&nbsp;virtual&nbsp;functions&nbsp;not&nbsp;already&nbsp;in&nbsp;the<br>
vtable.&nbsp;(These&nbsp;are&nbsp;also&nbsp;called&nbsp;replicated&nbsp;entries&nbsp;because&nbsp;they&nbsp;are<br>
already&nbsp;in&nbsp;the&nbsp;secondary&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class.)&nbsp;[I&nbsp;wonder&nbsp;if&nbsp;this&nbsp;is&nbsp;&nbsp;<br>
actually&nbsp;needed,&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;consequence&nbsp;of&nbsp;RRBC]<br>
<br>
&lt;p&gt;<br>
The&nbsp;primary&nbsp;vtable,&nbsp;therefore,&nbsp;has&nbsp;the&nbsp;base&nbsp;class&nbsp;functions<br>
appearing&nbsp;before&nbsp;the&nbsp;derived<br>
class&nbsp;functions.&nbsp;The&nbsp;primary&nbsp;vtable&nbsp;can&nbsp;be&nbsp;viewed&nbsp;as&nbsp;two&nbsp;vtables<br>
accessed&nbsp;from&nbsp;a&nbsp;shared<br>
vtable&nbsp;pointer.<br>
<br>
<br>
&lt;p&gt;<br>
Note&nbsp;Another&nbsp;benefit&nbsp;of&nbsp;replicating&nbsp;virtual&nbsp;function&nbsp;entries&nbsp;is<br>
that&nbsp;it&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;this&nbsp;pointer&nbsp;adjustments&nbsp;during&nbsp;virtual&nbsp;&nbsp;<br>
calls.&nbsp;Without&nbsp;replication,&nbsp;there&nbsp;would&nbsp;be&nbsp;more&nbsp;cases&nbsp;where&nbsp;the&nbsp;this&nbsp;&nbsp;<br>
pointer&nbsp;would&nbsp;have&nbsp;to&nbsp;be&nbsp;adjusted&nbsp;to&nbsp;access&nbsp;a&nbsp;secondary&nbsp;vtable&nbsp;prior&nbsp;&nbsp;<br>
to&nbsp;the&nbsp;call.&nbsp;These&nbsp;additional&nbsp;cases&nbsp;would&nbsp;be&nbsp;exactly&nbsp;those&nbsp;where&nbsp;the&nbsp;&nbsp;<br>
function&nbsp;is&nbsp;overridden&nbsp;in&nbsp;the&nbsp;derived&nbsp;class,&nbsp;implying&nbsp;an&nbsp;additional&nbsp;&nbsp;<br>
thunk&nbsp;adjustment&nbsp;back&nbsp;to&nbsp;the&nbsp;original&nbsp;pointer.&nbsp;Thus&nbsp;replication&nbsp;saves&nbsp;&nbsp;<br>
two&nbsp;adjustments&nbsp;for&nbsp;each&nbsp;virtual&nbsp;call&nbsp;to&nbsp;an&nbsp;overridden&nbsp;function<br>
introduced&nbsp;by&nbsp;a&nbsp;non-primary&nbsp;base&nbsp;class.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;b&gt;Category&nbsp;3&lt;/b&gt;<br>
<br>
&lt;p&gt;<br>
This&nbsp;category&nbsp;is&nbsp;for&nbsp;a&nbsp;class&nbsp;that&nbsp;inherits&nbsp;only&nbsp;virtual&nbsp;base<br>
classes,&nbsp;and&nbsp;the&nbsp;virtual&nbsp;base&nbsp;classes&nbsp;have&nbsp;no&nbsp;base&nbsp;classes.<br>
<br>
&lt;p&gt;<br>
The&nbsp;class&nbsp;has&nbsp;a&nbsp;vtable&nbsp;for&nbsp;each&nbsp;virtual&nbsp;base&nbsp;class&nbsp;that&nbsp;has&nbsp;a<br>
vtable.&nbsp;These&nbsp;are&nbsp;all&nbsp;secondary&nbsp;vtables&nbsp;and&nbsp;are&nbsp;constructed&nbsp;from<br>
copies&nbsp;of&nbsp;the&nbsp;base&nbsp;class&nbsp;vtables&nbsp;according&nbsp;to&nbsp;the&nbsp;same&nbsp;rules&nbsp;as&nbsp;in<br>
Category&nbsp;2.&nbsp;The&nbsp;vtable&nbsp;pointers&nbsp;of&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;within&nbsp;&nbsp;<br>
the&nbsp;object&nbsp;address&nbsp;these&nbsp;vtables.<br>
<br>
&lt;p&gt;<br>
The&nbsp;class&nbsp;also&nbsp;has&nbsp;a&nbsp;vtable&nbsp;that&nbsp;is&nbsp;not&nbsp;copied&nbsp;from&nbsp;the&nbsp;virtual&nbsp;base&nbsp;&nbsp;<br>
class&nbsp;vtables.&nbsp;This&nbsp;vtable&nbsp;is&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;of&nbsp;the&nbsp;class&nbsp;and<br>
addressed&nbsp;by&nbsp;the&nbsp;vtable&nbsp;pointer&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;object,&nbsp;which&nbsp;is<br>
not&nbsp;shared.&nbsp;It&nbsp;holds&nbsp;the&nbsp;following&nbsp;function&nbsp;pointer&nbsp;entries:<br>
&lt;ul&gt;<br>
&lt;li&gt;<br>
Entries&nbsp;for&nbsp;virtual&nbsp;functions&nbsp;introduced&nbsp;by&nbsp;this&nbsp;class<br>
&lt;li&gt;<br>
Entries&nbsp;for&nbsp;overridden&nbsp;virtual&nbsp;functions.&nbsp;(These&nbsp;are&nbsp;also&nbsp;called<br>
replicated&nbsp;entries,&nbsp;because&nbsp;they&nbsp;are&nbsp;already&nbsp;in&nbsp;the&nbsp;secondary&nbsp;vtables&nbsp;&nbsp;<br>
of&nbsp;the&nbsp;class)<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;primary&nbsp;vtable&nbsp;also&nbsp;has&nbsp;virtual&nbsp;base&nbsp;offset&nbsp;entries&nbsp;to&nbsp;allow<br>
finding&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects.&nbsp;There&nbsp;is&nbsp;one&nbsp;virtual&nbsp;base<br>
offset&nbsp;entry&nbsp;for&nbsp;each&nbsp;virtual&nbsp;base&nbsp;class.&nbsp;For&nbsp;a&nbsp;class&nbsp;that&nbsp;inherits&nbsp;&nbsp;<br>
only&nbsp;virtual&nbsp;bases,&nbsp;the&nbsp;entries&nbsp;are&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;&nbsp;<br>
virtual&nbsp;bases&nbsp;appear&nbsp;in&nbsp;the&nbsp;class&nbsp;declaration,&nbsp;that&nbsp;is,&nbsp;the&nbsp;entry<br>
for&nbsp;the&nbsp;leftmost&nbsp;virtual&nbsp;base&nbsp;is<br>
closest&nbsp;to&nbsp;the&nbsp;address&nbsp;point&nbsp;of&nbsp;the&nbsp;vtable.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;b&gt;Category&nbsp;4&lt;/b&gt;<br>
<br>
&lt;p&gt;<br>
This&nbsp;category&nbsp;is&nbsp;for&nbsp;a&nbsp;class&nbsp;that&nbsp;directly&nbsp;or&nbsp;indirectly&nbsp;inherits<br>
base&nbsp;classes&nbsp;that&nbsp;are&nbsp;either&nbsp;virtual&nbsp;or&nbsp;non-virtual.<br>
<br>
&lt;p&gt;<br>
The&nbsp;rules&nbsp;for&nbsp;constructing&nbsp;vtables&nbsp;of&nbsp;the&nbsp;class&nbsp;are&nbsp;a&nbsp;combination&nbsp;of&nbsp;&nbsp;<br>
the&nbsp;rules&nbsp;from&nbsp;Categories&nbsp;2&nbsp;and&nbsp;3,&nbsp;and&nbsp;for&nbsp;the&nbsp;most&nbsp;part&nbsp;can&nbsp;be<br>
determined&nbsp;inductively.&nbsp;However&nbsp;the&nbsp;rules&nbsp;for&nbsp;placing&nbsp;virtual&nbsp;base<br>
offset&nbsp;entries&nbsp;in&nbsp;the&nbsp;vtables&nbsp;requires&nbsp;elaboration.<br>
<br>
&lt;p&gt;<br>
The&nbsp;primary&nbsp;vtable&nbsp;has&nbsp;virtual&nbsp;base&nbsp;offset&nbsp;entries&nbsp;for&nbsp;all&nbsp;virtual<br>
bases&nbsp;directly&nbsp;or&nbsp;indirectly&nbsp;inherited&nbsp;by&nbsp;the&nbsp;class.&nbsp;Each&nbsp;secondary&nbsp;&nbsp;<br>
vtable&nbsp;has&nbsp;entries&nbsp;only&nbsp;for&nbsp;virtual&nbsp;bases&nbsp;visible&nbsp;to&nbsp;the<br>
corresponding&nbsp;base&nbsp;class.&nbsp;The&nbsp;entries&nbsp;in&nbsp;the&nbsp;primary&nbsp;vtable&nbsp;are<br>
ordered&nbsp;so&nbsp;that&nbsp;entries&nbsp;for&nbsp;virtual&nbsp;bases&nbsp;visible&nbsp;to&nbsp;the&nbsp;primary&nbsp;base&nbsp;&nbsp;<br>
class&nbsp;appear&nbsp;below&nbsp;entries&nbsp;for&nbsp;virtual&nbsp;bases&nbsp;only&nbsp;visible&nbsp;to&nbsp;this<br>
class.<br>
<br>
&lt;p&gt;<br>
For&nbsp;virtual&nbsp;bases&nbsp;only&nbsp;visible&nbsp;to&nbsp;this&nbsp;class,&nbsp;the&nbsp;entries&nbsp;are&nbsp;in&nbsp;the&nbsp;&nbsp;<br>
reverse&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;virtual&nbsp;bases&nbsp;are&nbsp;encountered&nbsp;in&nbsp;a<br>
depth-first,&nbsp;left-to-right&nbsp;traversal&nbsp;of&nbsp;the&nbsp;inheritance&nbsp;graph&nbsp;formed&nbsp;&nbsp;<br>
by&nbsp;the&nbsp;class&nbsp;definitions.&nbsp;Note<br>
that&nbsp;this&nbsp;does&nbsp;not&nbsp;follow&nbsp;the&nbsp;order&nbsp;that&nbsp;virtual&nbsp;bases&nbsp;are&nbsp;placed&nbsp;in&nbsp;&nbsp;<br>
the&nbsp;object.<br>
<br>
<br>
<br>
&lt;p&gt;<br>
&lt;h4&gt;Vtables&nbsp;for&nbsp;partially&nbsp;constructed&nbsp;objects&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
In&nbsp;some&nbsp;situations,&nbsp;a&nbsp;special&nbsp;vtable,&nbsp;called&nbsp;a&nbsp;construction&nbsp;vtable<br>
is&nbsp;used&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;base&nbsp;class&nbsp;constructors&nbsp;and<br>
destructors.&nbsp;These&nbsp;vtables&nbsp;are&nbsp;for&nbsp;specific&nbsp;cases&nbsp;of&nbsp;virtual<br>
inheritance.<br>
<br>
&lt;p&gt;<br>
During&nbsp;the&nbsp;construction&nbsp;of&nbsp;a&nbsp;class&nbsp;object,&nbsp;the&nbsp;object&nbsp;assumes&nbsp;the<br>
type&nbsp;of&nbsp;each&nbsp;of&nbsp;its&nbsp;base&nbsp;classes,&nbsp;as&nbsp;each&nbsp;base&nbsp;class&nbsp;subobject&nbsp;is<br>
constructed.&nbsp;RTTI&nbsp;queries&nbsp;in&nbsp;the&nbsp;base&nbsp;class&nbsp;constructor&nbsp;will&nbsp;return&nbsp;&nbsp;<br>
the&nbsp;type&nbsp;of&nbsp;the&nbsp;base&nbsp;class,&nbsp;and&nbsp;virtual&nbsp;calls&nbsp;will&nbsp;resolve&nbsp;to&nbsp;member&nbsp;&nbsp;<br>
functions&nbsp;of&nbsp;the&nbsp;base&nbsp;class&nbsp;rather&nbsp;than&nbsp;the&nbsp;complete&nbsp;class.&nbsp;Normally,&nbsp;&nbsp;<br>
this&nbsp;behavior&nbsp;is&nbsp;accomplished&nbsp;by&nbsp;setting,&nbsp;in&nbsp;the&nbsp;base&nbsp;class<br>
constructor,&nbsp;the&nbsp;object's&nbsp;vtable&nbsp;pointers&nbsp;to&nbsp;the&nbsp;addresses&nbsp;of&nbsp;the<br>
vtables&nbsp;for&nbsp;the&nbsp;base&nbsp;class.<br>
<br>
&lt;p&gt;<br>
However,&nbsp;if&nbsp;the&nbsp;base&nbsp;class&nbsp;has&nbsp;direct&nbsp;or&nbsp;indirect&nbsp;virtual&nbsp;bases,&nbsp;the&nbsp;&nbsp;<br>
vtable&nbsp;pointers&nbsp;have&nbsp;to&nbsp;be&nbsp;set&nbsp;to&nbsp;the&nbsp;addresses&nbsp;of&nbsp;construction<br>
vtables.&nbsp;This&nbsp;is&nbsp;because&nbsp;the&nbsp;normal&nbsp;base&nbsp;class&nbsp;vtables&nbsp;may&nbsp;not&nbsp;hold&nbsp;&nbsp;<br>
the&nbsp;correct&nbsp;virtual&nbsp;base&nbsp;index&nbsp;values&nbsp;to&nbsp;access&nbsp;the&nbsp;virtual&nbsp;bases&nbsp;of&nbsp;&nbsp;<br>
the&nbsp;object&nbsp;under&nbsp;construction,&nbsp;and&nbsp;adjustment&nbsp;addressed&nbsp;by&nbsp;these<br>
vtables&nbsp;may&nbsp;hold<br>
the&nbsp;wrong&nbsp;this&nbsp;parameter&nbsp;adjustment&nbsp;if&nbsp;the&nbsp;adjustment&nbsp;is&nbsp;to&nbsp;cast<br>
from&nbsp;a&nbsp;virtual&nbsp;base&nbsp;to&nbsp;another&nbsp;part&nbsp;of&nbsp;the&nbsp;object.&nbsp;The&nbsp;problem&nbsp;is<br>
that&nbsp;a&nbsp;complete&nbsp;object&nbsp;of&nbsp;a&nbsp;base&nbsp;class&nbsp;and&nbsp;a&nbsp;complete&nbsp;object&nbsp;of&nbsp;a<br>
derived&nbsp;class&nbsp;do&nbsp;not&nbsp;have&nbsp;virtual&nbsp;bases&nbsp;at&nbsp;the&nbsp;same&nbsp;offsets.<br>
<br>
&lt;p&gt;<br>
A&nbsp;construction&nbsp;vtable&nbsp;holds&nbsp;the&nbsp;virtual&nbsp;function&nbsp;addresses&nbsp;and&nbsp;the<br>
RTTI&nbsp;information&nbsp;associated&nbsp;with&nbsp;the&nbsp;base&nbsp;class&nbsp;and&nbsp;the&nbsp;virtual&nbsp;base&nbsp;&nbsp;<br>
indexes&nbsp;and&nbsp;the&nbsp;addresses&nbsp;of&nbsp;adjustor&nbsp;entry&nbsp;points&nbsp;with&nbsp;this<br>
parameter&nbsp;adjustments&nbsp;associated&nbsp;with&nbsp;objects&nbsp;of&nbsp;the&nbsp;complete&nbsp;class.<br>
<br>
&lt;p&gt;<br>
To&nbsp;ensure&nbsp;that&nbsp;the&nbsp;vtable&nbsp;pointers&nbsp;are&nbsp;set&nbsp;to&nbsp;the&nbsp;appropriate<br>
vtables&nbsp;during&nbsp;base&nbsp;class&nbsp;construction,&nbsp;a&nbsp;table&nbsp;of&nbsp;vtable&nbsp;pointers,&nbsp;&nbsp;<br>
called&nbsp;the&nbsp;VTT,&nbsp;which&nbsp;holds&nbsp;the&nbsp;addresses&nbsp;of&nbsp;construction&nbsp;and<br>
non-construction&nbsp;vtables&nbsp;is&nbsp;generated&nbsp;for&nbsp;the&nbsp;complete&nbsp;class.&nbsp;The<br>
constructor&nbsp;for&nbsp;the&nbsp;complete&nbsp;class&nbsp;passes&nbsp;to&nbsp;each&nbsp;base&nbsp;class<br>
constructor&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;place&nbsp;in&nbsp;the&nbsp;VTT&nbsp;where&nbsp;the&nbsp;&nbsp;<br>
base&nbsp;class&nbsp;constructor&nbsp;can&nbsp;find&nbsp;its&nbsp;set&nbsp;of&nbsp;vtables.&nbsp;Construction<br>
vtables&nbsp;are&nbsp;used&nbsp;in&nbsp;a&nbsp;similar&nbsp;way&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;base&nbsp;class&nbsp;&nbsp;<br>
destructors.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
The&nbsp;above&nbsp;arrived&nbsp;to&nbsp;late&nbsp;for&nbsp;everyone&nbsp;to&nbsp;read&nbsp;it&nbsp;carefully.<br>
It&nbsp;was&nbsp;agreed&nbsp;that&nbsp;we&nbsp;would&nbsp;consider&nbsp;it&nbsp;outside&nbsp;the&nbsp;meetings,<br>
discuss&nbsp;any&nbsp;issues&nbsp;noted&nbsp;by&nbsp;email,<br>
and&nbsp;attempt&nbsp;to&nbsp;close&nbsp;on&nbsp;22&nbsp;July.<br>
(Christophe&nbsp;is&nbsp;on&nbsp;vacation&nbsp;until&nbsp;that&nbsp;week,<br>
and&nbsp;Daveed&nbsp;leaves&nbsp;on&nbsp;vacation&nbsp;the&nbsp;next&nbsp;week.)<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990805&nbsp;All]&lt;/font&gt;<br>
We&nbsp;need&nbsp;a&nbsp;specific&nbsp;proposed&nbsp;representation&nbsp;for&nbsp;COMDAT.<br>
IBM's&nbsp;version&nbsp;is&nbsp;restricted&nbsp;to&nbsp;one&nbsp;symbol&nbsp;per&nbsp;section.<br>
Jim&nbsp;will&nbsp;look&nbsp;for&nbsp;Microsoft's&nbsp;PECOFF&nbsp;definition.<br>
Anyone&nbsp;else&nbsp;with&nbsp;a&nbsp;usable&nbsp;definition&nbsp;should&nbsp;send&nbsp;it.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B7&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Objects&nbsp;and&nbsp;Vtables&nbsp;in&nbsp;shared&nbsp;memory&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;allocate&nbsp;objects&nbsp;in&nbsp;shared&nbsp;memory?<br>
For&nbsp;polymorphic&nbsp;objects,&nbsp;this&nbsp;implies&nbsp;that&nbsp;the&nbsp;Vtable&nbsp;must&nbsp;also&nbsp;be<br>
in&nbsp;shared&nbsp;memory.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
No&nbsp;special&nbsp;representation&nbsp;is&nbsp;useful&nbsp;in&nbsp;support&nbsp;of&nbsp;shared&nbsp;memory.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=B8&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;B-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;dynamic_cast&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;data&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990628&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
What&nbsp;information&nbsp;to&nbsp;we&nbsp;put&nbsp;in&nbsp;the&nbsp;vtable&nbsp;to&nbsp;enable&nbsp;(a)&nbsp;dynamic_cast<br>
from&nbsp;pointer-to-base&nbsp;to&nbsp;pointer-to-derived&nbsp;(including&nbsp;detection&nbsp;of<br>
ambiguous&nbsp;base&nbsp;classes)&nbsp;and&nbsp;(b)&nbsp;dynamic_cast&nbsp;to&nbsp;void*?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;All]&lt;/font&gt;<br>
This&nbsp;should&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;proposal&nbsp;Daveed&nbsp;will&nbsp;put&nbsp;together<br>
by&nbsp;the&nbsp;15th&nbsp;(action&nbsp;#13);&nbsp;the&nbsp;group&nbsp;will&nbsp;discuss&nbsp;it&nbsp;on&nbsp;the&nbsp;22nd.<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Object&nbsp;Construction/Destruction&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Interaction&nbsp;with&nbsp;.init/.fini&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lif&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Static&nbsp;objects&nbsp;with&nbsp;dynamic&nbsp;constructors&nbsp;must&nbsp;be&nbsp;constructed&nbsp;at<br>
intialization&nbsp;time.<br>
This&nbsp;is&nbsp;done&nbsp;via&nbsp;the&nbsp;executable&nbsp;object&nbsp;initialization&nbsp;functions&nbsp;that<br>
are&nbsp;identified&nbsp;(in&nbsp;ELF)&nbsp;by&nbsp;the&nbsp;DT_INIT&nbsp;and&nbsp;DT_INITARRAY&nbsp;dynamic&nbsp;tags.<br>
How&nbsp;should&nbsp;the&nbsp;compiler&nbsp;identify&nbsp;the&nbsp;constructors&nbsp;to&nbsp;be&nbsp;called&nbsp;in&nbsp;this&nbsp;way?<br>
One&nbsp;traditional&nbsp;mechanism&nbsp;is&nbsp;to&nbsp;put&nbsp;calls&nbsp;in&nbsp;a&nbsp;.init&nbsp;section.<br>
Another,&nbsp;used&nbsp;by&nbsp;HP,&nbsp;is&nbsp;to&nbsp;put&nbsp;function&nbsp;addresses&nbsp;in&nbsp;a&nbsp;.initarray&nbsp;section.<br>
&lt;p&gt;<br>
The&nbsp;dual&nbsp;question&nbsp;arises&nbsp;for&nbsp;static&nbsp;object&nbsp;destructors.<br>
Again,&nbsp;the&nbsp;extant&nbsp;mechanisms&nbsp;include&nbsp;putting&nbsp;calls&nbsp;in&nbsp;a&nbsp;.fini&nbsp;section,<br>
or&nbsp;putting&nbsp;function&nbsp;addresses&nbsp;in&nbsp;a&nbsp;.finiarray&nbsp;section.<br>
&lt;p&gt;<br>
Finally,&nbsp;which&nbsp;mechanism&nbsp;(DT_INIT&nbsp;or&nbsp;DT_INITARRAY,&nbsp;or&nbsp;the&nbsp;FINI&nbsp;versions)<br>
should&nbsp;be&nbsp;used&nbsp;in&nbsp;linked&nbsp;objects?<br>
The&nbsp;gABI,&nbsp;and&nbsp;the&nbsp;IA-64&nbsp;psABI,&nbsp;will&nbsp;support&nbsp;both,<br>
with&nbsp;DT_INIT&nbsp;being&nbsp;executed&nbsp;before&nbsp;the&nbsp;DT_INITARRAY&nbsp;elements.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Order&nbsp;of&nbsp;ctors/dtors&nbsp;w.r.t.&nbsp;link&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lif&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Given&nbsp;that&nbsp;the&nbsp;compiler&nbsp;has&nbsp;identified&nbsp;constructor/destructor&nbsp;calls&nbsp;for<br>
static&nbsp;objects&nbsp;in&nbsp;each&nbsp;relocatable&nbsp;object,&nbsp;in&nbsp;what&nbsp;order&nbsp;should&nbsp;the<br>
static&nbsp;linker&nbsp;combine&nbsp;them&nbsp;in&nbsp;the&nbsp;linked&nbsp;executable&nbsp;object?<br>
(The&nbsp;initialization&nbsp;order&nbsp;determines&nbsp;the&nbsp;finalization&nbsp;order,<br>
as&nbsp;its&nbsp;opposite.)<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990610&nbsp;All]&lt;/font&gt;<br>
Meeting&nbsp;concensus&nbsp;is&nbsp;that&nbsp;the&nbsp;desirable&nbsp;order&nbsp;is&nbsp;right&nbsp;to&nbsp;left&nbsp;on&nbsp;the<br>
link&nbsp;command&nbsp;line,&nbsp;i.e.&nbsp;last&nbsp;listed&nbsp;relocatable&nbsp;object&nbsp;is&nbsp;initialized<br>
first.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990701&nbsp;SGI]&lt;/font&gt;<br>
We&nbsp;propose&nbsp;that&nbsp;global&nbsp;constructors&nbsp;be&nbsp;handled&nbsp;as&nbsp;follows:<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;compiler&nbsp;shall&nbsp;emit&nbsp;global&nbsp;constructor&nbsp;calls&nbsp;as&nbsp;one&nbsp;or&nbsp;more&nbsp;entries<br>
in&nbsp;an&nbsp;SHF_INIT_ARRAY&nbsp;section.<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;linker&nbsp;shall&nbsp;combine&nbsp;them&nbsp;according&nbsp;to&nbsp;the&nbsp;rules&nbsp;of&nbsp;the&nbsp;base&nbsp;gABI,<br>
namely&nbsp;as&nbsp;a&nbsp;concatenated&nbsp;array&nbsp;of&nbsp;entries,&nbsp;in&nbsp;link&nbsp;argument&nbsp;order,<br>
pointed&nbsp;to&nbsp;by&nbsp;a&nbsp;DT_INIT_ARRAY&nbsp;tag.<br>
(The&nbsp;linker&nbsp;may&nbsp;intersperse&nbsp;entries&nbsp;from&nbsp;command&nbsp;line&nbsp;flags&nbsp;or&nbsp;modules<br>
from&nbsp;other&nbsp;languages,&nbsp;but&nbsp;that&nbsp;is&nbsp;beyond&nbsp;the&nbsp;C++&nbsp;ABI&nbsp;scope.)<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
This&nbsp;does&nbsp;not&nbsp;address&nbsp;the&nbsp;global&nbsp;destructor&nbsp;problem.<br>
That&nbsp;solution&nbsp;needs&nbsp;to&nbsp;deal&nbsp;not&nbsp;only&nbsp;with&nbsp;the&nbsp;global&nbsp;objects&nbsp;seen&nbsp;by<br>
the&nbsp;compiler,&nbsp;but&nbsp;also&nbsp;interspersed&nbsp;local&nbsp;static&nbsp;objects.<br>
This&nbsp;treatment&nbsp;seems&nbsp;to&nbsp;be&nbsp;tied&nbsp;up&nbsp;in&nbsp;the&nbsp;question&nbsp;of&nbsp;how&nbsp;early<br>
unloading&nbsp;of&nbsp;DSOs&nbsp;is&nbsp;handled,&nbsp;and&nbsp;the&nbsp;data&nbsp;structure&nbsp;used&nbsp;for&nbsp;that<br>
purpose&nbsp;(issue&nbsp;C-3).<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990715&nbsp;All]&lt;/font&gt;<br>
Cygnus&nbsp;scheme:<br>
priorities&nbsp;are&nbsp;16-bit&nbsp;unsigned&nbsp;integers,&nbsp;lower&nbsp;numbers&nbsp;are&nbsp;higher&nbsp;priority.<br>
In&nbsp;each&nbsp;translation&nbsp;unit,<br>
there's&nbsp;a&nbsp;single&nbsp;initialization&nbsp;function&nbsp;for&nbsp;each&nbsp;priority.<br>
Anything&nbsp;that's&nbsp;prioritized&nbsp;has&nbsp;a&nbsp;higher&nbsp;priority&nbsp;than&nbsp;anything&nbsp;that<br>
isn't&nbsp;explicitly&nbsp;assigned&nbsp;a&nbsp;priority.<br>
<br>
&lt;p&gt;<br>
IBM&nbsp;scheme:<br>
priorities&nbsp;are&nbsp;32-bit&nbsp;signed&nbsp;integers,&nbsp;higher&nbsp;numbers&nbsp;are&nbsp;higher&nbsp;priority.<br>
Something&nbsp;that&nbsp;isn't&nbsp;explicitly&nbsp;assigned&nbsp;a&nbsp;priority&nbsp;effectively<br>
gets&nbsp;a&nbsp;priority&nbsp;of&nbsp;0.<br>
<br>
&lt;p&gt;<br>
Consensus:<br>
nobody&nbsp;is&nbsp;sure&nbsp;that&nbsp;negative&nbsp;priorities&nbsp;are&nbsp;very&nbsp;important,<br>
but&nbsp;also&nbsp;nobody&nbsp;can&nbsp;think&nbsp;of&nbsp;a&nbsp;reason&nbsp;not&nbsp;to&nbsp;allow&nbsp;them.<br>
We&nbsp;accept&nbsp;the&nbsp;idea&nbsp;that&nbsp;priorities&nbsp;are&nbsp;32-bit&nbsp;signed&nbsp;integers.<br>
On&nbsp;a&nbsp;source&nbsp;level&nbsp;Cygnus&nbsp;will&nbsp;keep&nbsp;lower&nbsp;numbers&nbsp;as&nbsp;higher&nbsp;priority,<br>
but&nbsp;that's&nbsp;a&nbsp;source&nbsp;issue,&nbsp;not&nbsp;an&nbsp;ABI&nbsp;issue.<br>
<br>
&lt;p&gt;<br>
Status:&nbsp;No&nbsp;real&nbsp;technical&nbsp;issues,<br>
we&nbsp;have&nbsp;consensus&nbsp;on&nbsp;everything&nbsp;that&nbsp;matters.<br>
We&nbsp;need&nbsp;to&nbsp;write&nbsp;up&nbsp;the&nbsp;finicky&nbsp;details.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990722&nbsp;all]&lt;/font&gt;<br>
It&nbsp;was&nbsp;decided&nbsp;to&nbsp;follow&nbsp;the&nbsp;IBM&nbsp;approach,&nbsp;including:<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;The&nbsp;source&nbsp;pragma&nbsp;will&nbsp;use&nbsp;a&nbsp;32-bit&nbsp;signed&nbsp;priority.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;default&nbsp;will&nbsp;map&nbsp;to&nbsp;0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;larger&nbsp;numbers&nbsp;are&nbsp;lower&nbsp;priority.<br>
<br>
&lt;li&gt;&nbsp;Priorities&nbsp;MIN_INT&nbsp;..&nbsp;MIN_INT+1000&nbsp;are&nbsp;reserved&nbsp;to&nbsp;the&nbsp;implementation.<br>
<br>
&lt;li&gt;&nbsp;The&nbsp;object&nbsp;representation&nbsp;will&nbsp;use&nbsp;a&nbsp;32-bit&nbsp;unsigned&nbsp;priority,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obtained&nbsp;from&nbsp;the&nbsp;source&nbsp;priority&nbsp;by&nbsp;subtracting&nbsp;INT_MIN.<br>
<br>
&lt;li&gt;&nbsp;Initialization&nbsp;priorities&nbsp;are&nbsp;only&nbsp;relevant&nbsp;within&nbsp;a&nbsp;DSO.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Between&nbsp;DSOs,&nbsp;the&nbsp;normal&nbsp;ELF&nbsp;ordering&nbsp;based&nbsp;on&nbsp;object&nbsp;order&nbsp;applies.<br>
<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
To&nbsp;be&nbsp;resolved&nbsp;are&nbsp;the&nbsp;precise&nbsp;source&nbsp;pragma&nbsp;definition&nbsp;(possibly&nbsp;IBM's),<br>
and&nbsp;the&nbsp;ELF&nbsp;file&nbsp;representation.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;all]&lt;/font&gt;<br>
SGI&nbsp;suggested&nbsp;an&nbsp;object&nbsp;representation&nbsp;involving&nbsp;(in&nbsp;relocatables)<br>
a&nbsp;new&nbsp;section&nbsp;type,&nbsp;containing&nbsp;pairs&nbsp;&lt;priority,&nbsp;entry&nbsp;address&gt;.<br>
The&nbsp;linker&nbsp;would&nbsp;merge&nbsp;all&nbsp;such&nbsp;sections,<br>
include&nbsp;any&nbsp;initialization&nbsp;entries&nbsp;specified&nbsp;by&nbsp;other&nbsp;means,<br>
and&nbsp;leave&nbsp;one&nbsp;or&nbsp;more&nbsp;DT_INITARRAY&nbsp;entries&nbsp;for&nbsp;normal&nbsp;runtime<br>
initialization,&nbsp;either&nbsp;building&nbsp;a&nbsp;routine&nbsp;to&nbsp;call&nbsp;the&nbsp;entries,<br>
or&nbsp;referencing&nbsp;a&nbsp;standard&nbsp;runtime&nbsp;routine.<br>
<br>
&lt;p&gt;<br>
IBM&nbsp;noted&nbsp;that&nbsp;they&nbsp;combine&nbsp;their&nbsp;equivalent&nbsp;data&nbsp;structures&nbsp;in&nbsp;the<br>
linker,&nbsp;but&nbsp;don't&nbsp;sort&nbsp;them,&nbsp;leaving&nbsp;that&nbsp;to&nbsp;a&nbsp;runtime&nbsp;routine.<br>
This&nbsp;can&nbsp;be&nbsp;done&nbsp;without&nbsp;explicit&nbsp;linker&nbsp;support,<br>
but&nbsp;involves&nbsp;runtime&nbsp;overhead.<br>
<br>
&lt;p&gt;<br>
Cygnus&nbsp;suggested&nbsp;that&nbsp;if&nbsp;we&nbsp;are&nbsp;going&nbsp;to&nbsp;require&nbsp;linker&nbsp;sorting,<br>
we&nbsp;should&nbsp;make&nbsp;the&nbsp;facility&nbsp;more&nbsp;general.<br>
<br>
&lt;p&gt;<br>
Jim&nbsp;will&nbsp;write&nbsp;up&nbsp;a&nbsp;more&nbsp;precise&nbsp;proposal.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990804&nbsp;SGI&nbsp;--&nbsp;Jim]&lt;/font&gt;<br>
&lt;h4&gt;&nbsp;Proposal&nbsp;&lt;/h4&gt;<br>
<br>
&lt;p&gt;<br>
My&nbsp;objectives&nbsp;are:<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;Simple&nbsp;representation&nbsp;in&nbsp;relocatable&nbsp;objects.<br>
&lt;li&gt;&nbsp;No&nbsp;new&nbsp;representation&nbsp;in&nbsp;executable&nbsp;objects.<br>
&lt;li&gt;&nbsp;Simple&nbsp;static&nbsp;linker&nbsp;processing&nbsp;(general&nbsp;if&nbsp;possible).<br>
&lt;li&gt;&nbsp;Minimal&nbsp;unnecessary&nbsp;runtime&nbsp;cost.<br>
&lt;li&gt;&nbsp;Minimal&nbsp;library&nbsp;interface.<br>
&lt;li&gt;&nbsp;Integration&nbsp;with&nbsp;other&nbsp;initialization&nbsp;(at&nbsp;source&nbsp;priority&nbsp;zero).<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
&lt;h5&gt;&nbsp;Object&nbsp;File&nbsp;Representation&nbsp;&lt;/h5&gt;<br>
<br>
&lt;p&gt;<br>
Define&nbsp;a&nbsp;new&nbsp;section&nbsp;type,&nbsp;e.g.&nbsp;&lt;code&gt;&lt;b&gt;SHT_CXX_PRIORITY_INIT&lt;/b&gt;&lt;/code&gt;.<br>
Its&nbsp;elements&nbsp;are&nbsp;structs:<br>
&lt;code&gt;&lt;pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typedef&nbsp;struct&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElfXX_Word&nbsp;&nbsp;&nbsp;&nbsp;pi_pri;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElfXX_Addr&nbsp;&nbsp;&nbsp;&nbsp;pi_addr;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;ElfXX_Cxx_Priority_Init;<br>
&lt;/pre&gt;&lt;/code&gt;<br>
The&nbsp;semantics&nbsp;are&nbsp;that&nbsp;&lt;code&gt;pi_addr&lt;/code&gt;&nbsp;is&nbsp;a&nbsp;function&nbsp;pointer,<br>
with&nbsp;an&nbsp;&lt;code&gt;unsigned&nbsp;int&lt;/code&gt;&nbsp;priority&nbsp;parameter,<br>
which&nbsp;performs&nbsp;some&nbsp;initialization&nbsp;at&nbsp;priority&nbsp;&lt;code&gt;pi_pri&lt;/code&gt;.<br>
Each&nbsp;of&nbsp;these&nbsp;functions&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the&nbsp;GP&nbsp;of&nbsp;the<br>
executable&nbsp;object&nbsp;containing&nbsp;the&nbsp;table.<br>
The&nbsp;section&nbsp;header&nbsp;field&nbsp;&lt;code&gt;sh_entsize&lt;/code&gt;&nbsp;is&nbsp;8&nbsp;for&nbsp;ELF-32,<br>
or&nbsp;16&nbsp;for&nbsp;ELF-64.<br>
<br>
&lt;p&gt;<br>
&lt;h5&gt;&nbsp;Runtime&nbsp;Library&nbsp;Support&nbsp;&lt;/h5&gt;<br>
<br>
&lt;p&gt;<br>
Each&nbsp;implementation&nbsp;shall&nbsp;provide&nbsp;a&nbsp;runtime&nbsp;library&nbsp;function&nbsp;with<br>
prototype:<br>
&lt;code&gt;&lt;center&gt;<br>
void&nbsp;__cxx_priority_init&nbsp;(&nbsp;ElfXX_Cxx_Priority_Init&nbsp;*pi,&nbsp;int&nbsp;cnt&nbsp;);<br>
&lt;/center&gt;&lt;/code&gt;<br>
It&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;&lt;code&gt;cnt&lt;/code&gt;-element<br>
(sub-)vector&nbsp;of&nbsp;the&nbsp;priority&nbsp;initialization&nbsp;entries,<br>
and&nbsp;will&nbsp;call&nbsp;each&nbsp;of&nbsp;them&nbsp;in&nbsp;order.<br>
It&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the&nbsp;GP&nbsp;of&nbsp;the&nbsp;initialization&nbsp;entries.<br>
<br>
&lt;p&gt;<br>
&lt;h5&gt;&nbsp;Linker&nbsp;Processing&nbsp;&lt;/h5&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;linker&nbsp;must&nbsp;take&nbsp;the&nbsp;collection&nbsp;of&nbsp;SHT_CXX_PRIORITY_INIT&nbsp;section<br>
entries&nbsp;from&nbsp;the&nbsp;relocatable&nbsp;object&nbsp;files&nbsp;being&nbsp;linked,<br>
and&nbsp;other&nbsp;initialization&nbsp;tasks&nbsp;specified&nbsp;in&nbsp;other&nbsp;ways<br>
(and&nbsp;treated&nbsp;as&nbsp;source&nbsp;priority&nbsp;0&nbsp;or&nbsp;object&nbsp;priority&nbsp;-MIN_INT),<br>
and&nbsp;produce&nbsp;an&nbsp;executable&nbsp;object&nbsp;file&nbsp;which&nbsp;executes&nbsp;the&nbsp;initialization<br>
tasks&nbsp;in&nbsp;priority&nbsp;order&nbsp;using&nbsp;only&nbsp;&lt;code&gt;DT_INIT&lt;/code&gt;,<br>
&lt;code&gt;DT_INIT_ARRAY&lt;/code&gt;,&nbsp;and&nbsp;&lt;code&gt;__cxx_priority_init&lt;/code&gt;.<br>
Priority&nbsp;order&nbsp;is&nbsp;first&nbsp;according&nbsp;to&nbsp;the&nbsp;priority&nbsp;of&nbsp;the&nbsp;task,<br>
and&nbsp;then&nbsp;according&nbsp;to&nbsp;the&nbsp;order&nbsp;of&nbsp;relocatable&nbsp;objects&nbsp;and&nbsp;options<br>
in&nbsp;the&nbsp;link&nbsp;command.<br>
The&nbsp;order&nbsp;of&nbsp;tasks&nbsp;specified&nbsp;by&nbsp;other&nbsp;methods,<br>
relative&nbsp;to&nbsp;SHT_CXX_PRIORITY_INIT&nbsp;tasks&nbsp;of&nbsp;priority&nbsp;zero,<br>
is&nbsp;implementation&nbsp;defined.<br>
There&nbsp;are&nbsp;several&nbsp;possible&nbsp;implementations.&nbsp;&nbsp;Two&nbsp;extremes&nbsp;are:<br>
<br>
&lt;ul&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;linker&nbsp;sorts&nbsp;the&nbsp;SHT_CXX_PRIORITY_INIT&nbsp;sections&nbsp;together.<br>
If&nbsp;it&nbsp;inserts&nbsp;entries&nbsp;for&nbsp;initialization&nbsp;tasks&nbsp;specified&nbsp;in&nbsp;other&nbsp;ways,<br>
it&nbsp;may&nbsp;make&nbsp;a&nbsp;single&nbsp;DT_INIT_ARRAY&nbsp;entry&nbsp;pointing&nbsp;to&nbsp;__cxx_priority_init.<br>
If&nbsp;not,&nbsp;it&nbsp;must&nbsp;break&nbsp;it&nbsp;into&nbsp;subranges,<br>
interspersing&nbsp;DT_INIT_ARRAY&nbsp;entries&nbsp;for&nbsp;the&nbsp;other&nbsp;tasks&nbsp;with&nbsp;entries<br>
for&nbsp;the&nbsp;SHT_CXX_PRIORITY_INIT&nbsp;entries.<br>
(This&nbsp;implementation&nbsp;will&nbsp;minimize&nbsp;runtime&nbsp;overhead.)<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
The&nbsp;linker&nbsp;simply&nbsp;appends&nbsp;the&nbsp;SHT_CXX_PRIORITY_INIT&nbsp;sections.<br>
It&nbsp;inserts&nbsp;DT_INIT_ARRAY&nbsp;entries&nbsp;before&nbsp;and&nbsp;after&nbsp;the&nbsp;entries&nbsp;for&nbsp;other<br>
initialization&nbsp;tasks&nbsp;which&nbsp;sort&nbsp;this&nbsp;vector&nbsp;and&nbsp;then&nbsp;execute&nbsp;the<br>
negative-priority&nbsp;calls&nbsp;on&nbsp;the&nbsp;first&nbsp;call,<br>
and&nbsp;the&nbsp;positive-priority&nbsp;ones&nbsp;on&nbsp;the&nbsp;second&nbsp;call.<br>
(I&nbsp;believe&nbsp;this&nbsp;is&nbsp;much&nbsp;like&nbsp;today's&nbsp;IBM&nbsp;implementation.)<br>
However,&nbsp;to&nbsp;be&nbsp;conforming,&nbsp;the&nbsp;routine&nbsp;which&nbsp;performs&nbsp;these&nbsp;tasks<br>
must&nbsp;be&nbsp;linked&nbsp;with&nbsp;the&nbsp;resulting&nbsp;executable&nbsp;object,<br>
or&nbsp;shippable&nbsp;with&nbsp;it&nbsp;as&nbsp;an&nbsp;associated&nbsp;DSO.<br>
<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
Note&nbsp;that&nbsp;if&nbsp;one&nbsp;is&nbsp;linking&nbsp;ELF-32&nbsp;objects&nbsp;into&nbsp;a&nbsp;64-bit&nbsp;program,<br>
the&nbsp;entries&nbsp;must&nbsp;be&nbsp;expanded&nbsp;as&nbsp;part&nbsp;of&nbsp;this&nbsp;process.<br>
<br>
&lt;p&gt;<br>
&lt;h5&gt;&nbsp;Sorting&nbsp;Sections&nbsp;&lt;/h5&gt;<br>
<br>
&lt;p&gt;<br>
Jason&nbsp;suggested&nbsp;that&nbsp;if&nbsp;we&nbsp;base&nbsp;this&nbsp;feature&nbsp;on&nbsp;sorting&nbsp;sections,<br>
we&nbsp;should&nbsp;provide&nbsp;a&nbsp;general&nbsp;mechanism.<br>
Following&nbsp;is&nbsp;a&nbsp;proposal&nbsp;for&nbsp;that&nbsp;purpose.<br>
<br>
&lt;p&gt;<br>
Define&nbsp;a&nbsp;new&nbsp;section&nbsp;header&nbsp;flag,&nbsp;&lt;code&gt;SHF_SORT&lt;/code&gt;.<br>
If&nbsp;present,&nbsp;the&nbsp;linker&nbsp;is&nbsp;required&nbsp;to&nbsp;sort&nbsp;the&nbsp;elements&nbsp;of&nbsp;the<br>
concatenated&nbsp;sections&nbsp;of&nbsp;the&nbsp;same&nbsp;type,<br>
where&nbsp;the&nbsp;elements&nbsp;are&nbsp;determined&nbsp;by&nbsp;&lt;code&gt;sh_entsize&lt;/code&gt;.<br>
The&nbsp;sort&nbsp;is&nbsp;controlled&nbsp;by&nbsp;fields&nbsp;in&nbsp;&lt;code&gt;sh_info&lt;/code&gt;:<br>
<br>
&lt;dl&gt;<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;#define&nbsp;SH_INFO_KEYSIZE(info)&nbsp;(info&nbsp;&amp;&nbsp;0xff)&lt;/code&gt;<br>
&lt;br&gt;&lt;dd&gt;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;size&nbsp;of&nbsp;the&nbsp;sort&nbsp;key&nbsp;(bytes).<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;#define&nbsp;SH_INFO_KEYSTART(info)&nbsp;((info&gt;&gt;8)&nbsp;&amp;&nbsp;0xff)&lt;/code&gt;<br>
&lt;br&gt;&lt;dd&gt;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;start&nbsp;byte&nbsp;of&nbsp;the&nbsp;sort&nbsp;key&nbsp;within&nbsp;element,&nbsp;from&nbsp;0.<br>
&lt;p&gt;<br>
&lt;dt&gt;&nbsp;&lt;code&gt;#define&nbsp;SH_INFO_SORTKIND(info)&nbsp;((info&gt;&gt;16)&nbsp;&amp;&nbsp;0xf)&lt;/code&gt;<br>
&lt;br&gt;&lt;dd&gt;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;kind&nbsp;of&nbsp;sort&nbsp;data:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;for&nbsp;unsigned&nbsp;integer,&nbsp;1&nbsp;for&nbsp;signed&nbsp;integer.<br>
<br>
&lt;/dl&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;sort&nbsp;must&nbsp;be&nbsp;stable.<br>
The&nbsp;sort&nbsp;key&nbsp;must&nbsp;be&nbsp;naturally&nbsp;aligned.<br>
<br>
&lt;p&gt;<br>
Other&nbsp;conceivable&nbsp;options&nbsp;would&nbsp;be&nbsp;to&nbsp;allow&nbsp;sorting&nbsp;strings<br>
(like&nbsp;SHF_MERGE,&nbsp;this&nbsp;would&nbsp;be&nbsp;indicated&nbsp;by&nbsp;setting&nbsp;SHF_STRING<br>
and&nbsp;putting&nbsp;the&nbsp;character&nbsp;size&nbsp;in&nbsp;&lt;code&gt;sh_entsize&lt;/code&gt;),<br>
or&nbsp;floating&nbsp;point&nbsp;data.<br>
Also,&nbsp;note&nbsp;that&nbsp;if&nbsp;we&nbsp;don't&nbsp;anticipate&nbsp;using&nbsp;such&nbsp;a&nbsp;general&nbsp;mechanism,<br>
it&nbsp;becomes&nbsp;possible&nbsp;to&nbsp;avoid&nbsp;padding&nbsp;words&nbsp;in&nbsp;the&nbsp;ELF-64&nbsp;format&nbsp;by<br>
separating&nbsp;the&nbsp;priority&nbsp;and&nbsp;address&nbsp;vectors.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Order&nbsp;of&nbsp;ctors/dtors&nbsp;w.r.t.&nbsp;DSOs&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Given&nbsp;the&nbsp;constructor/destructor&nbsp;calls&nbsp;for&nbsp;each&nbsp;executable&nbsp;object<br>
comprising&nbsp;a&nbsp;program,&nbsp;what&nbsp;is&nbsp;the&nbsp;order&nbsp;of&nbsp;execution&nbsp;between&nbsp;objects?<br>
For&nbsp;constructors,&nbsp;there&nbsp;is&nbsp;not&nbsp;much&nbsp;question:<br>
unless&nbsp;we&nbsp;choose&nbsp;some&nbsp;explicit&nbsp;means&nbsp;of&nbsp;control,<br>
file-scope&nbsp;objects&nbsp;will&nbsp;be&nbsp;initialized&nbsp;by&nbsp;the&nbsp;DT_INIT/DT_INITARRAY<br>
functions&nbsp;in&nbsp;the&nbsp;order&nbsp;determined&nbsp;by&nbsp;the&nbsp;base&nbsp;ABI&nbsp;order&nbsp;rules,<br>
and&nbsp;local&nbsp;objects&nbsp;will&nbsp;be&nbsp;initialized&nbsp;in&nbsp;the&nbsp;order&nbsp;their&nbsp;containing<br>
scopes&nbsp;are&nbsp;entered.<br>
&lt;p&gt;<br>
For&nbsp;destructors,&nbsp;the&nbsp;Standard&nbsp;requires&nbsp;opposite-order&nbsp;destruction,<br>
which&nbsp;implies&nbsp;a&nbsp;runtime&nbsp;structure&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;order.<br>
Furthermore,&nbsp;the&nbsp;potential&nbsp;for&nbsp;dynamic&nbsp;unloading&nbsp;of&nbsp;a&nbsp;DSO<br>
(e.g.&nbsp;by&nbsp;dlclose)<br>
requires&nbsp;a&nbsp;mechanism&nbsp;for&nbsp;early&nbsp;destruction&nbsp;of&nbsp;a&nbsp;subset.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C4&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Calling&nbsp;vfuncs&nbsp;in&nbsp;ctors/dtors&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Cygnus&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
When&nbsp;calling&nbsp;a&nbsp;virtual&nbsp;function&nbsp;from&nbsp;the&nbsp;constructor/destructor&nbsp;of&nbsp;a<br>
base&nbsp;subobject,<br>
the&nbsp;version&nbsp;specific&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;is&nbsp;required,<br>
unlike&nbsp;the&nbsp;typical&nbsp;case&nbsp;when&nbsp;calling&nbsp;such&nbsp;a&nbsp;vfunc&nbsp;for&nbsp;the&nbsp;full&nbsp;object<br>
from&nbsp;some&nbsp;other&nbsp;context.<br>
Since&nbsp;the&nbsp;pointer&nbsp;for&nbsp;that&nbsp;vfunc&nbsp;in&nbsp;the&nbsp;full&nbsp;object's&nbsp;vtable<br>
(or&nbsp;even&nbsp;the&nbsp;subobject's&nbsp;sub-vtable)&nbsp;is&nbsp;the&nbsp;full&nbsp;object&nbsp;version,<br>
some&nbsp;other&nbsp;means&nbsp;is&nbsp;required&nbsp;for&nbsp;accessing&nbsp;the&nbsp;correct&nbsp;vfunc.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C5&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-5&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Calling&nbsp;destructors&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sun&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
What&nbsp;is&nbsp;the&nbsp;calling&nbsp;convention&nbsp;for&nbsp;destructors?<br>
Do&nbsp;virtual&nbsp;destructors&nbsp;require&nbsp;special&nbsp;treatment?<br>
Is&nbsp;delete()&nbsp;integrated&nbsp;with&nbsp;the&nbsp;destructor&nbsp;call&nbsp;or&nbsp;separate?<br>
How&nbsp;is&nbsp;delete()&nbsp;handled&nbsp;when&nbsp;invoked&nbsp;on&nbsp;a&nbsp;base&nbsp;subobject?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990729&nbsp;all]&lt;/font&gt;<br>
Some&nbsp;implementations&nbsp;combine&nbsp;destructors&nbsp;with&nbsp;deletion,<br>
checking&nbsp;a&nbsp;flag&nbsp;in&nbsp;the&nbsp;destructor&nbsp;to&nbsp;determine&nbsp;whether&nbsp;to&nbsp;delete.<br>
This&nbsp;produces&nbsp;somewhat&nbsp;less&nbsp;code,<br>
especially&nbsp;if&nbsp;there&nbsp;are&nbsp;many&nbsp;delete()&nbsp;calls.<br>
However,&nbsp;it&nbsp;adds&nbsp;overhead&nbsp;to&nbsp;any&nbsp;destructor&nbsp;which&nbsp;does&nbsp;not&nbsp;require<br>
deletion,&nbsp;e.g.&nbsp;base&nbsp;and&nbsp;member&nbsp;objects,&nbsp;automatic&nbsp;objects.<br>
There&nbsp;is&nbsp;some&nbsp;concern&nbsp;that&nbsp;a&nbsp;runtime&nbsp;test&nbsp;is&nbsp;sometimes&nbsp;required,<br>
but&nbsp;noone&nbsp;has&nbsp;yet&nbsp;identified&nbsp;why.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C6&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-6&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Extra&nbsp;parameters&nbsp;to&nbsp;ctors/dtors&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Cygnus&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
When&nbsp;calling&nbsp;constructors&nbsp;and&nbsp;destructors&nbsp;for&nbsp;classes&nbsp;with&nbsp;virtual&nbsp;bases,<br>
information&nbsp;about&nbsp;the&nbsp;virtual&nbsp;base&nbsp;subobjects&nbsp;in&nbsp;the&nbsp;full&nbsp;class<br>
must&nbsp;be&nbsp;transmitted&nbsp;somehow&nbsp;to&nbsp;the&nbsp;ctor/dtor.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C7&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Passing&nbsp;value&nbsp;parameters&nbsp;by&nbsp;reference&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;All&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990624&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990805&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
It&nbsp;may&nbsp;be&nbsp;desirable&nbsp;in&nbsp;some&nbsp;cases&nbsp;where&nbsp;a&nbsp;type&nbsp;has&nbsp;a&nbsp;non-trivial<br>
copy&nbsp;constructor&nbsp;to&nbsp;pass&nbsp;value&nbsp;parameters&nbsp;of&nbsp;that&nbsp;type&nbsp;by&nbsp;performing<br>
the&nbsp;copy&nbsp;at&nbsp;the&nbsp;call&nbsp;site&nbsp;and&nbsp;passing&nbsp;a&nbsp;reference.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;&nbsp;Resolution&nbsp;&lt;/b&gt;:<br>
Whenever&nbsp;a&nbsp;class&nbsp;type&nbsp;has&nbsp;a&nbsp;non-trivial&nbsp;copy&nbsp;constructor,<br>
pass&nbsp;value&nbsp;parameters&nbsp;of&nbsp;that&nbsp;type&nbsp;by&nbsp;performing<br>
the&nbsp;copy&nbsp;at&nbsp;the&nbsp;call&nbsp;site&nbsp;and&nbsp;passing&nbsp;a&nbsp;reference.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=C8&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;C-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Returning&nbsp;classes&nbsp;with&nbsp;non-trival&nbsp;copy&nbsp;constructors&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;closed&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;All&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990625&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990722&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
How&nbsp;do&nbsp;we&nbsp;return&nbsp;classes&nbsp;with&nbsp;non-trivial&nbsp;copy&nbsp;constructors?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Resolution&lt;/b&gt;:<br>
The&nbsp;caller&nbsp;allocates&nbsp;space,<br>
and&nbsp;passes&nbsp;a&nbsp;pointer&nbsp;as&nbsp;an&nbsp;implicit&nbsp;first&nbsp;parameter<br>
(prior&nbsp;to&nbsp;the&nbsp;implicit&nbsp;&lt;i&gt;this&lt;/i&gt;&nbsp;parameter).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Exception&nbsp;Handling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Language-specific&nbsp;data&nbsp;area&nbsp;format&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;IA-64&nbsp;runtime&nbsp;conventions&nbsp;describe&nbsp;language-independent&nbsp;descriptors<br>
for&nbsp;restoring&nbsp;registers&nbsp;when&nbsp;unwinding&nbsp;the&nbsp;stack.<br>
The&nbsp;do&nbsp;not&nbsp;specify&nbsp;how&nbsp;C++&nbsp;performs&nbsp;language-specific&nbsp;unwinding&nbsp;for<br>
exception&nbsp;handling,&nbsp;i.e.&nbsp;locating&nbsp;a&nbsp;handler&nbsp;and&nbsp;destroying&nbsp;automatic<br>
objects.<br>
Note&nbsp;that&nbsp;this&nbsp;can&nbsp;be&nbsp;handled&nbsp;by&nbsp;agreeing&nbsp;on&nbsp;common&nbsp;descriptors,<br>
or&nbsp;by&nbsp;agreeing&nbsp;on&nbsp;per-frame&nbsp;personality&nbsp;routines&nbsp;with&nbsp;common&nbsp;APIs.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990715&nbsp;Cygnus&nbsp;--&nbsp;Jason]&lt;/font&gt;<br>
The&nbsp;languge-specific&nbsp;part&nbsp;of&nbsp;the&nbsp;EH&nbsp;stack&nbsp;in&nbsp;g++&nbsp;contains&nbsp;these<br>
elements:<br>
<br>
&lt;p&gt;<br>
&lt;code&gt;&lt;pre&gt;<br>
void&nbsp;*value;&nbsp;//&nbsp;pointer&nbsp;to&nbsp;the&nbsp;thrown&nbsp;object,&nbsp;or&nbsp;the&nbsp;thrown&nbsp;value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;itself&nbsp;if&nbsp;a&nbsp;pointer<br>
void&nbsp;*type;&nbsp;&nbsp;//&nbsp;pointer&nbsp;to&nbsp;the&nbsp;type_info&nbsp;node&nbsp;for&nbsp;the&nbsp;thrown&nbsp;object<br>
void&nbsp;(*cleanup)(void&nbsp;*,&nbsp;int)&nbsp;//&nbsp;pointer&nbsp;to&nbsp;the&nbsp;dtor&nbsp;for&nbsp;the&nbsp;object<br>
bool&nbsp;caught;&nbsp;//&nbsp;has&nbsp;this&nbsp;exception&nbsp;been&nbsp;caught&nbsp;since&nbsp;its&nbsp;last&nbsp;throw?<br>
long&nbsp;handlers;&nbsp;//&nbsp;how&nbsp;many&nbsp;catch&nbsp;handlers&nbsp;are&nbsp;active&nbsp;for&nbsp;this&nbsp;exception<br>
&lt;/code&gt;&lt;/pre&gt;<br>
<br>
&lt;p&gt;<br>
Both&nbsp;'caught'&nbsp;and&nbsp;'handlers'&nbsp;are&nbsp;needed&nbsp;to&nbsp;handle&nbsp;rethrowing&nbsp;and<br>
catching&nbsp;within&nbsp;a&nbsp;catch&nbsp;block.<br>
<br>
&lt;p&gt;<br>
Language&nbsp;interaction&nbsp;is&nbsp;handled&nbsp;by&nbsp;recording&nbsp;the&nbsp;language&nbsp;of&nbsp;both&nbsp;the<br>
exception&nbsp;region&nbsp;and&nbsp;the&nbsp;thrown&nbsp;exception.&nbsp;&nbsp;Each&nbsp;thrown&nbsp;exception&nbsp;also<br>
includes&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;language-specific&nbsp;matching&nbsp;function&nbsp;which&nbsp;is<br>
called&nbsp;to&nbsp;compare&nbsp;the&nbsp;types&nbsp;of&nbsp;the&nbsp;exception&nbsp;and&nbsp;handler.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Unwind&nbsp;personality&nbsp;routines&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;IA-64&nbsp;runtime&nbsp;conventions&nbsp;provide&nbsp;for&nbsp;a&nbsp;personality&nbsp;routine<br>
pointer&nbsp;for&nbsp;language-specific&nbsp;actions&nbsp;when&nbsp;unwinding&nbsp;the&nbsp;stack.<br>
They&nbsp;do&nbsp;not&nbsp;specify&nbsp;its&nbsp;interface.<br>
There&nbsp;are&nbsp;typically&nbsp;two&nbsp;required&nbsp;actions&nbsp;for&nbsp;C++:<br>
locating&nbsp;a&nbsp;handler&nbsp;(non-destructively)<br>
and&nbsp;destroying&nbsp;automatic&nbsp;objects&nbsp;while&nbsp;unwinding.<br>
This&nbsp;issue&nbsp;involves&nbsp;specification&nbsp;of&nbsp;the&nbsp;API&nbsp;(see&nbsp;also&nbsp;D-3).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Unwind&nbsp;process&nbsp;clarification&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;IA-64&nbsp;runtime&nbsp;conventions&nbsp;provide&nbsp;for&nbsp;a&nbsp;personality&nbsp;routine<br>
pointer&nbsp;for&nbsp;language-specific&nbsp;actions&nbsp;when&nbsp;unwinding&nbsp;the&nbsp;stack.<br>
However,&nbsp;they&nbsp;are&nbsp;quite&nbsp;muddy&nbsp;about&nbsp;the&nbsp;precise&nbsp;sequence&nbsp;of&nbsp;calls.<br>
This&nbsp;issue&nbsp;involves&nbsp;specification&nbsp;of&nbsp;unwind&nbsp;process&nbsp;(see&nbsp;also&nbsp;D-2).<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D4&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Unwind&nbsp;routines&nbsp;nested?&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;IA-64&nbsp;runtime&nbsp;conventions&nbsp;call&nbsp;for&nbsp;the&nbsp;unwind&nbsp;personality&nbsp;routine<br>
to&nbsp;behave&nbsp;like&nbsp;a&nbsp;routine&nbsp;nested&nbsp;in&nbsp;the&nbsp;routine&nbsp;raising&nbsp;an&nbsp;exception.<br>
Is&nbsp;that&nbsp;the&nbsp;preferred&nbsp;definition?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D5&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-5&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Interaction&nbsp;with&nbsp;other&nbsp;languages&nbsp;(e.g.&nbsp;Java)&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;IA64&nbsp;exceptions&nbsp;handling&nbsp;framework&nbsp;is&nbsp;largely&nbsp;language&nbsp;independent.<br>
What&nbsp;is&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;a&nbsp;C++&nbsp;runtime&nbsp;receiving,&nbsp;for&nbsp;instance,<br>
an&nbsp;exception&nbsp;thrown&nbsp;from&nbsp;Java?<br>
Does&nbsp;it&nbsp;call&nbsp;terminate()?<br>
Does&nbsp;it&nbsp;allow&nbsp;the&nbsp;exception&nbsp;to&nbsp;pass&nbsp;through&nbsp;C++&nbsp;code&nbsp;with&nbsp;destructors<br>
if&nbsp;there&nbsp;is&nbsp;no&nbsp;catch&nbsp;clause?<br>
Does&nbsp;it&nbsp;allow&nbsp;the&nbsp;exception&nbsp;to&nbsp;be&nbsp;caught&nbsp;in&nbsp;a&nbsp;catch(...)&nbsp;provided&nbsp;this<br>
catch(...)&nbsp;ends&nbsp;with&nbsp;a&nbsp;rethrow?<br>
Does&nbsp;it&nbsp;allow&nbsp;even&nbsp;more?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D6&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-6&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Allow&nbsp;resumption&nbsp;in&nbsp;other&nbsp;languages?&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;exception&nbsp;handling&nbsp;framework&nbsp;requires&nbsp;the&nbsp;interaction&nbsp;of&nbsp;the<br>
runtime&nbsp;of&nbsp;all&nbsp;the&nbsp;languages&nbsp;&quot;on&nbsp;the&nbsp;stack&quot;&nbsp;during&nbsp;exception&nbsp;processing.<br>
Some&nbsp;of&nbsp;these&nbsp;languages&nbsp;may&nbsp;have&nbsp;very&nbsp;different&nbsp;exception&nbsp;handling&nbsp;semantics.<br>
What&nbsp;are&nbsp;the&nbsp;constraints&nbsp;we&nbsp;impose&nbsp;on&nbsp;the&nbsp;C++&nbsp;exception&nbsp;handling&nbsp;runtime<br>
to&nbsp;preserve&nbsp;the&nbsp;relative&nbsp;language&nbsp;neutrality&nbsp;of&nbsp;the&nbsp;EH&nbsp;framework?<br>
Example:&nbsp;do&nbsp;we&nbsp;allow&nbsp;a&nbsp;handler&nbsp;to&nbsp;cleanup&nbsp;and&nbsp;resume&nbsp;at&nbsp;the&nbsp;point<br>
where&nbsp;the&nbsp;exception&nbsp;was&nbsp;thrown?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D7&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-7&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Interaction&nbsp;with&nbsp;signals&nbsp;or&nbsp;asynch&nbsp;events&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;Standard&nbsp;says&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;anything&nbsp;other&nbsp;than<br>
&quot;pure&nbsp;C&nbsp;code&quot;&nbsp;(POF)&nbsp;is&nbsp;implementation&nbsp;defined,<br>
and&nbsp;warns&nbsp;(in&nbsp;a&nbsp;note)&nbsp;against&nbsp;using&nbsp;EH&nbsp;in&nbsp;a&nbsp;signal&nbsp;handler.<br>
We&nbsp;should&nbsp;define&nbsp;what&nbsp;is&nbsp;supported,<br>
possibly&nbsp;explicitly&nbsp;stating&nbsp;that&nbsp;signal&nbsp;handler&nbsp;code&nbsp;must&nbsp;be&nbsp;a&nbsp;POF.<br>
We&nbsp;could&nbsp;allow&nbsp;any&nbsp;feature&nbsp;but&nbsp;exception&nbsp;handling&nbsp;to&nbsp;be&nbsp;used.<br>
We&nbsp;could&nbsp;allow&nbsp;some&nbsp;EH&nbsp;routines&nbsp;to&nbsp;be&nbsp;called<br>
(for&nbsp;instance,&nbsp;&lt;code&gt;uncaught_exception()&lt;/code&gt;).<br>
Or&nbsp;we&nbsp;could&nbsp;allow&nbsp;even&nbsp;an&nbsp;exception&nbsp;to&nbsp;be&nbsp;thrown,<br>
if&nbsp;it&nbsp;does&nbsp;not&nbsp;exit&nbsp;the&nbsp;handler.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=D8&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;D-8&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Interaction&nbsp;with&nbsp;threads&nbsp;packages&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lib&nbsp;ps&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
What&nbsp;happens&nbsp;when&nbsp;an&nbsp;exception&nbsp;is&nbsp;not&nbsp;caught&nbsp;in&nbsp;the&nbsp;thread&nbsp;where&nbsp;raised?<br>
What&nbsp;does&nbsp;uncaught_exception()&nbsp;return&nbsp;if&nbsp;another&nbsp;thread&nbsp;is&nbsp;currently<br>
processing&nbsp;an&nbsp;exception?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Template&nbsp;Instantiation&nbsp;Model&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
<br>
&lt;tr&gt;&nbsp;&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;th&gt;&nbsp;E&nbsp;&lt;/th&gt;<br>
&lt;th&nbsp;colspan=6&gt;&nbsp;Template&nbsp;Instantiation&nbsp;Model&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=E1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;E-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;When&nbsp;does&nbsp;instantiation&nbsp;occur?&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
There&nbsp;are&nbsp;two&nbsp;principal&nbsp;models&nbsp;for&nbsp;instantiation.<br>
The&nbsp;&lt;i&gt;early&nbsp;instantiation&lt;/i&gt;&nbsp;(or&nbsp;Borland)&nbsp;model&nbsp;performs&nbsp;all<br>
instantiation&nbsp;at&nbsp;compile&nbsp;time,<br>
potentially&nbsp;resulting&nbsp;in&nbsp;extra&nbsp;copies&nbsp;which&nbsp;are&nbsp;removed&nbsp;at&nbsp;link&nbsp;time.<br>
The&nbsp;&lt;i&gt;pre-link&nbsp;instantiation&lt;/i&gt;&nbsp;model&nbsp;identifies&nbsp;the&nbsp;required<br>
instantiations&nbsp;prior&nbsp;to&nbsp;linking&nbsp;and&nbsp;instantiates&nbsp;them&nbsp;via&nbsp;a&nbsp;special<br>
compile&nbsp;step.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=E2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;E-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Separate&nbsp;compilation&nbsp;model&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
[SGI]<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=E3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;E-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Template&nbsp;repository&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Independent&nbsp;of&nbsp;the&nbsp;template&nbsp;instantiation&nbsp;model,<br>
we&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;whatever&nbsp;template&nbsp;persistent&nbsp;storage&nbsp;is&nbsp;used<br>
by&nbsp;one&nbsp;vendor&nbsp;does&nbsp;not&nbsp;interact&nbsp;negatively&nbsp;with&nbsp;other&nbsp;vendors'&nbsp;mechanisms.<br>
Issues:<br>
&nbsp;&nbsp;(1)&nbsp;Avoiding&nbsp;conflict&nbsp;on&nbsp;the&nbsp;name&nbsp;of&nbsp;any&nbsp;repository.<br>
&nbsp;&nbsp;(2)&nbsp;If&nbsp;.o&nbsp;files&nbsp;are&nbsp;used,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;describe&nbsp;how&nbsp;this&nbsp;information&nbsp;is&nbsp;to&nbsp;be&nbsp;preserved,&nbsp;ignored,&nbsp;etc.<br>
&nbsp;&nbsp;(3)&nbsp;Evaluate&nbsp;if&nbsp;tools&nbsp;such&nbsp;as&nbsp;make,&nbsp;ld,&nbsp;ar,&nbsp;or&nbsp;others,&nbsp;can<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;because&nbsp;.o&nbsp;files&nbsp;get&nbsp;written&nbsp;at&nbsp;unexpected&nbsp;times.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Name&nbsp;Mangling&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=F1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;F-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Mangling&nbsp;convention&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
What&nbsp;rules&nbsp;shall&nbsp;be&nbsp;used&nbsp;for&nbsp;mangling&nbsp;names,<br>
i.e.&nbsp;for&nbsp;encoding&nbsp;the&nbsp;information&nbsp;other&nbsp;than&nbsp;the&nbsp;source-level&nbsp;object<br>
name&nbsp;necessary&nbsp;to&nbsp;resolve&nbsp;overloading?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990806&nbsp;SGI&nbsp;--&nbsp;Jim]&lt;/font&gt;<br>
Naming&nbsp;to&nbsp;be&nbsp;resolved&nbsp;under&nbsp;this&nbsp;issue&nbsp;includes:<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;Global&nbsp;and&nbsp;member&nbsp;operator&nbsp;names<br>
&lt;li&gt;&nbsp;Global&nbsp;and&nbsp;member&nbsp;function&nbsp;names<br>
&lt;li&gt;&nbsp;Vtable&nbsp;names&nbsp;(primary&nbsp;and&nbsp;initialization)<br>
&lt;li&gt;&nbsp;RTTI&nbsp;struct&nbsp;names<br>
&lt;li&gt;&nbsp;Template&nbsp;instance&nbsp;names<br>
&lt;li&gt;&nbsp;Namespace&nbsp;effects<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=F2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;F-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Mangled&nbsp;name&nbsp;size&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;g&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Typical&nbsp;name&nbsp;mangling&nbsp;schemes&nbsp;to&nbsp;date&nbsp;typically&nbsp;begin&nbsp;to&nbsp;produce&nbsp;very<br>
long&nbsp;names.&nbsp;&nbsp;SGI&nbsp;routinely&nbsp;encounters&nbsp;multi-kilobyte&nbsp;names,<br>
and&nbsp;increasing&nbsp;usage&nbsp;of&nbsp;namespaces&nbsp;and&nbsp;templates&nbsp;will&nbsp;make&nbsp;them&nbsp;worse.<br>
This&nbsp;has&nbsp;a&nbsp;negative&nbsp;impact&nbsp;on&nbsp;object&nbsp;file&nbsp;size,&nbsp;and&nbsp;on&nbsp;linker&nbsp;speed.<br>
&lt;p&gt;<br>
SGI&nbsp;has&nbsp;considered&nbsp;solutions&nbsp;to&nbsp;this&nbsp;problem&nbsp;including&nbsp;modified&nbsp;string<br>
tables&nbsp;and/or&nbsp;symbol&nbsp;tables&nbsp;to&nbsp;eliminate&nbsp;redundancy.<br>
Cygnus,&nbsp;HP,&nbsp;and&nbsp;Sun&nbsp;have&nbsp;also&nbsp;considered&nbsp;or&nbsp;implemented&nbsp;approaches<br>
which&nbsp;at&nbsp;least&nbsp;mitigate&nbsp;it.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=F3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;F-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Distinguish&nbsp;template&nbsp;instantiation&nbsp;and&nbsp;specialization<br>
&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;g&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990520&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
In&nbsp;order&nbsp;to&nbsp;allow&nbsp;detection&nbsp;of&nbsp;conflicting&nbsp;template&nbsp;instantiation<br>
and&nbsp;specialization&nbsp;(in&nbsp;different&nbsp;translation&nbsp;units),<br>
should&nbsp;we&nbsp;name&nbsp;them&nbsp;differently?<br>
If&nbsp;we&nbsp;do&nbsp;so&nbsp;in&nbsp;an&nbsp;easily&nbsp;recognizable&nbsp;way,<br>
the&nbsp;linker&nbsp;could&nbsp;check&nbsp;for&nbsp;conflicts&nbsp;and&nbsp;report&nbsp;the&nbsp;ODR&nbsp;violation.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Miscellaneous&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=G1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;G-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Basic&nbsp;command&nbsp;line&nbsp;options&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;HP&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Can&nbsp;we&nbsp;agree&nbsp;on&nbsp;basic&nbsp;command&nbsp;line&nbsp;options&nbsp;(compiler&nbsp;and&nbsp;linker)<br>
for&nbsp;fundamental&nbsp;functionality,<br>
possibly&nbsp;allowing&nbsp;portable&nbsp;makefiles?<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=G2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;G-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Detection&nbsp;of&nbsp;ODR&nbsp;violations&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sun&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
[Sun]<br>
(See&nbsp;also&nbsp;F-3.)<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=G3&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;G-3&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Inlined&nbsp;routine&nbsp;linkage&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Sun&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990603&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Inline&nbsp;routines&nbsp;with&nbsp;external&nbsp;linkage&nbsp;require&nbsp;a&nbsp;method&nbsp;of&nbsp;handling<br>
vague&nbsp;linkage&nbsp;(see&nbsp;B-5&nbsp;for&nbsp;definition)&nbsp;for&nbsp;the&nbsp;out-of-line&nbsp;instance,<br>
as&nbsp;well&nbsp;as&nbsp;for&nbsp;any&nbsp;static&nbsp;data&nbsp;they&nbsp;contain.<br>
The&nbsp;latter&nbsp;includes&nbsp;string&nbsp;constants&nbsp;per&nbsp;[7.1.2]/4.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990624&nbsp;Cygnus&nbsp;--&nbsp;Jason]&lt;/font&gt;<br>
How&nbsp;should&nbsp;we&nbsp;handle&nbsp;local&nbsp;static&nbsp;variables&nbsp;in&nbsp;inlines?<br>
G++&nbsp;currently&nbsp;avoids&nbsp;this&nbsp;issue&nbsp;by&nbsp;suppressing<br>
inlining&nbsp;of&nbsp;functions&nbsp;with&nbsp;local&nbsp;statics.<br>
If&nbsp;we&nbsp;don't&nbsp;want&nbsp;to&nbsp;do&nbsp;that,<br>
we'll&nbsp;need&nbsp;to&nbsp;specify&nbsp;a&nbsp;mangling&nbsp;for&nbsp;the&nbsp;statics,<br>
and&nbsp;handle&nbsp;multiple&nbsp;copies&nbsp;like&nbsp;we&nbsp;do&nbsp;above.<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=G4&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;G-4&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Dynamic&nbsp;init&nbsp;of&nbsp;local&nbsp;static&nbsp;objects&nbsp;and&nbsp;multithreading&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;call&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SCO&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990607&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
The&nbsp;Standard&nbsp;requires&nbsp;that&nbsp;local&nbsp;static&nbsp;objects&nbsp;with&nbsp;dynamic<br>
constructors&nbsp;be&nbsp;initialized&nbsp;exactly&nbsp;once,&nbsp;the&nbsp;first&nbsp;time&nbsp;the&nbsp;containing<br>
scope&nbsp;is&nbsp;entered.<br>
Multi-threading&nbsp;renders&nbsp;the&nbsp;simple&nbsp;check&nbsp;of&nbsp;a&nbsp;flag&nbsp;before<br>
initialization&nbsp;inadequate&nbsp;to&nbsp;prevent&nbsp;multiple&nbsp;initialization.<br>
Should&nbsp;the&nbsp;ABI&nbsp;require&nbsp;locking&nbsp;for&nbsp;this&nbsp;purpose,<br>
and&nbsp;if&nbsp;so,&nbsp;what&nbsp;are&nbsp;the&nbsp;necessary&nbsp;interfaces?<br>
In&nbsp;addition&nbsp;to&nbsp;the&nbsp;locking&nbsp;of&nbsp;the&nbsp;initialization,<br>
special&nbsp;exception&nbsp;handling&nbsp;treatment&nbsp;is&nbsp;required&nbsp;to&nbsp;deal&nbsp;with&nbsp;an<br>
exception&nbsp;during&nbsp;construction.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990607&nbsp;SCO&nbsp;--&nbsp;Jonathan]&lt;/font&gt;<br>
The&nbsp;standard&nbsp;is&nbsp;mute&nbsp;on&nbsp;multiple&nbsp;threads&nbsp;of&nbsp;control&nbsp;in&nbsp;general,&nbsp;so&nbsp;<br>
there&nbsp;is&nbsp;no&nbsp;requirement&nbsp;in&nbsp;the&nbsp;language&nbsp;to&nbsp;support&nbsp;what&nbsp;I'm&nbsp;talking<br>
about.&nbsp;But&nbsp;as&nbsp;a&nbsp;practical&nbsp;matter&nbsp;compilers&nbsp;have&nbsp;to&nbsp;do&nbsp;it&nbsp;(Watcom&nbsp;gave<br>
a&nbsp;paper&nbsp;on&nbsp;their&nbsp;approach&nbsp;during&nbsp;the&nbsp;standardization&nbsp;process,&nbsp;if&nbsp;I<br>
remember).&nbsp;&nbsp;This&nbsp;example&nbsp;using&nbsp;UI/SVR4&nbsp;threads&nbsp;will&nbsp;usually&nbsp;show<br>
whether&nbsp;a&nbsp;compiler&nbsp;does&nbsp;it&nbsp;or&nbsp;not:&nbsp;<br>
<br>
&lt;pre&gt;&lt;code&gt;<br>
thr5.C:<br>
//&nbsp;static&nbsp;local&nbsp;initialization&nbsp;and&nbsp;threads<br>
<br>
#include&nbsp;&lt;stdlib.h&gt;<br>
#define&nbsp;EXIT(a)&nbsp;exit(a)<br>
#define&nbsp;THR_EXIT()&nbsp;thr_exit(0)<br>
<br>
#include&nbsp;&lt;thread.h&gt;<br>
<br>
int&nbsp;init_count&nbsp;=&nbsp;0;<br>
int&nbsp;start_count&nbsp;=&nbsp;0;<br>
<br>
int&nbsp;init()<br>
{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::thr_yield();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;++init_count;<br>
}<br>
<br>
void*&nbsp;start(void*&nbsp;s)<br>
{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_count++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;int&nbsp;i&nbsp;=&nbsp;init();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;!=&nbsp;1)&nbsp;EXIT(5);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THR_EXIT();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
int&nbsp;main()<br>
{<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread_t&nbsp;t1,&nbsp;t2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(::thr_create(0,&nbsp;0,&nbsp;start,&nbsp;0,&nbsp;0L,&nbsp;&amp;t1)&nbsp;!=&nbsp;0)&nbsp;EXIT(1);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(::thr_create(0,&nbsp;0,&nbsp;start,&nbsp;0,&nbsp;0L,&nbsp;&amp;t2)&nbsp;!=&nbsp;0)&nbsp;EXIT(2);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(::thr_join(t1,&nbsp;0,&nbsp;0)&nbsp;!=&nbsp;0)&nbsp;EXIT(3);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(::thr_join(t2,&nbsp;0,&nbsp;0)&nbsp;!=&nbsp;0)&nbsp;EXIT(4);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(start_count&nbsp;!=&nbsp;2)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT(6);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(init_count&nbsp;!=&nbsp;1)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT(7);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THR_EXIT();<br>
}<br>
&lt;/code&gt;&lt;/pre&gt;<br>
<br>
&lt;p&gt;<br>
When&nbsp;compiled&nbsp;with&nbsp;CC&nbsp;-Kthread&nbsp;thr5.C&nbsp;on&nbsp;UnixWare&nbsp;7,&nbsp;for&nbsp;instance,<br>
it&nbsp;passes&nbsp;by&nbsp;returning&nbsp;0.&nbsp;&nbsp;When&nbsp;compiled&nbsp;with&nbsp;CC&nbsp;-mt&nbsp;thr5.C&nbsp;on<br>
Solaris/x86&nbsp;C++&nbsp;4.2&nbsp;(sorry&nbsp;don't&nbsp;have&nbsp;the&nbsp;latest&nbsp;version!),&nbsp;it<br>
fails&nbsp;by&nbsp;returning&nbsp;5.<br>
<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990607&nbsp;Sun&nbsp;--&nbsp;Mike&nbsp;Ball]&lt;/font&gt;<br>
As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;tell,&nbsp;the&nbsp;language&nbsp;says&nbsp;that&nbsp;the&nbsp;automatic&nbsp;blocking&nbsp;<br>
issue&nbsp;isn't&nbsp;a&nbsp;valid&nbsp;approach.&nbsp;&nbsp;It&nbsp;says&nbsp;what&nbsp;has&nbsp;to&nbsp;happen,&nbsp;and<br>
it&nbsp;isn't&nbsp;that.<br>
<br>
&lt;p&gt;<br>
If&nbsp;you&nbsp;look&nbsp;at&nbsp;the&nbsp;entire&nbsp;statement&nbsp;you&nbsp;find&nbsp;that&nbsp;it&nbsp;reads:<br>
&lt;quote&gt;<br>
&quot;Otherwise&nbsp;such&nbsp;an&nbsp;object&nbsp;is&nbsp;initialized&nbsp;the&nbsp;first&nbsp;time&nbsp;control&nbsp;passes<br>
through&nbsp;its&nbsp;declaration;&nbsp;such&nbsp;an&nbsp;object&nbsp;is&nbsp;considered&nbsp;initialized&nbsp;upon<br>
the&nbsp;completion&nbsp;of&nbsp;its&nbsp;initialization.<br>
If&nbsp;the&nbsp;initialization&nbsp;exits&nbsp;by&nbsp;throwing&nbsp;an&nbsp;exception,<br>
the&nbsp;initialization&nbsp;is&nbsp;not&nbsp;complete,<br>
so&nbsp;it&nbsp;will&nbsp;be&nbsp;tried&nbsp;again&nbsp;the&nbsp;next&nbsp;time&nbsp;control&nbsp;enters&nbsp;the&nbsp;declaration.<br>
If&nbsp;control&nbsp;re-enters&nbsp;the&nbsp;declaration&nbsp;(recursively)<br>
while&nbsp;the&nbsp;object&nbsp;is&nbsp;being&nbsp;initialized,<br>
the&nbsp;behavior&nbsp;is&nbsp;undefined.&quot;<br>
&lt;/quote&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;word&nbsp;&quot;recursively&quot;&nbsp;is&nbsp;normative,<br>
so&nbsp;eliminates&nbsp;that&nbsp;sentence&nbsp;from&nbsp;consideration.<br>
<br>
&lt;p&gt;<br>
One&nbsp;can,&nbsp;of&nbsp;course,&nbsp;make&nbsp;any&nbsp;extension&nbsp;to&nbsp;the&nbsp;language,<br>
but&nbsp;in&nbsp;this&nbsp;case&nbsp;I&nbsp;think&nbsp;the&nbsp;extension&nbsp;invalidates&nbsp;some&nbsp;otherwise&nbsp;valid&nbsp;code.<br>
<br>
&lt;p&gt;<br>
The&nbsp;sentence&nbsp;I'm&nbsp;referring&nbsp;to&nbsp;is&nbsp;that&nbsp;the&nbsp;object&nbsp;is&nbsp;considered<br>
initialized&nbsp;upon&nbsp;the&nbsp;completion&nbsp;of&nbsp;its&nbsp;initialization.<br>
This&nbsp;is&nbsp;explicit,&nbsp;and&nbsp;the&nbsp;reason&nbsp;for&nbsp;it&nbsp;is&nbsp;covered&nbsp;in&nbsp;the&nbsp;following&nbsp;sentence,<br>
which&nbsp;discusses&nbsp;an&nbsp;initialization&nbsp;that&nbsp;terminates&nbsp;with&nbsp;an&nbsp;exception.<br>
A&nbsp;person&nbsp;catching&nbsp;such&nbsp;an&nbsp;exception&nbsp;has&nbsp;the&nbsp;right&nbsp;to&nbsp;try&nbsp;again<br>
without&nbsp;danger&nbsp;that&nbsp;the&nbsp;static&nbsp;variable&nbsp;will&nbsp;be&nbsp;initialized&nbsp;in&nbsp;the&nbsp;meantime.<br>
<br>
&lt;p&gt;<br>
I&nbsp;don't&nbsp;see&nbsp;anything&nbsp;at&nbsp;all&nbsp;to&nbsp;justify&nbsp;semantics&nbsp;that&nbsp;say,<br>
&quot;after&nbsp;initialization&nbsp;is&nbsp;started,&nbsp;Any&nbsp;other&nbsp;threads&nbsp;of&nbsp;control&nbsp;are<br>
blocked&nbsp;until&nbsp;that&nbsp;thread&nbsp;completes&nbsp;the&nbsp;initialization,<br>
unless,&nbsp;of&nbsp;course,&nbsp;it&nbsp;executes&nbsp;by&nbsp;an&nbsp;exception,<br>
in&nbsp;which&nbsp;case&nbsp;the&nbsp;other&nbsp;thread&nbsp;can&nbsp;do&nbsp;the&nbsp;initialization&nbsp;before&nbsp;the<br>
exception&nbsp;handler&nbsp;gets&nbsp;a&nbsp;chance&nbsp;to&nbsp;try&nbsp;again,&nbsp;except....&quot;<br>
&nbsp;Take&nbsp;an&nbsp;attempt&nbsp;to&nbsp;define&nbsp;the&nbsp;semantics&nbsp;as&nbsp;far&nbsp;as&nbsp;you&nbsp;like.<br>
<br>
&lt;p&gt;<br>
The&nbsp;problem&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;for&nbsp;the&nbsp;compiler&nbsp;writer&nbsp;to&nbsp;know<br>
what&nbsp;the&nbsp;programmer&nbsp;really&nbsp;wanted&nbsp;to&nbsp;do.<br>
I&nbsp;can&nbsp;(and&nbsp;will&nbsp;at&nbsp;some&nbsp;other&nbsp;date,&nbsp;if&nbsp;necessary)<br>
come&nbsp;up&nbsp;with&nbsp;scenarios&nbsp;justifying&nbsp;a&nbsp;variety&nbsp;of&nbsp;mutual&nbsp;exclusion&nbsp;policies,<br>
including&nbsp;none.<br>
<br>
&lt;p&gt;<br>
The&nbsp;solution&nbsp;is&nbsp;to&nbsp;let&nbsp;the&nbsp;programmer&nbsp;write&nbsp;the&nbsp;mutual&nbsp;exclusion,&nbsp;the<br>
same&nbsp;as&nbsp;we&nbsp;do&nbsp;for&nbsp;every&nbsp;other&nbsp;potential&nbsp;race&nbsp;condition.<br>
It's&nbsp;a&nbsp;real&nbsp;mess,&nbsp;and,&nbsp;I&nbsp;claim,&nbsp;an&nbsp;unwise&nbsp;one&nbsp;to&nbsp;put&nbsp;in&nbsp;as&nbsp;an&nbsp;extension.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990608&nbsp;HP&nbsp;--&nbsp;Christophe]&lt;/font&gt;<br>
The&nbsp;semantics&nbsp;currently&nbsp;implemented&nbsp;in&nbsp;the&nbsp;HP&nbsp;aC++&nbsp;compiler&nbsp;is&nbsp;as&nbsp;follows:<br>
&lt;ul&gt;<br>
&lt;li&gt;&nbsp;No&nbsp;two&nbsp;thread&nbsp;can&nbsp;enter&nbsp;a&nbsp;static&nbsp;initialization&nbsp;at&nbsp;the&nbsp;same&nbsp;time<br>
&lt;li&gt;&nbsp;Threads&nbsp;are&nbsp;blocked&nbsp;until&nbsp;immediately&nbsp;after&nbsp;the&nbsp;static&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;initialization&nbsp;either&nbsp;succeeds&nbsp;or&nbsp;fails&nbsp;with&nbsp;an&nbsp;exception.<br>
&lt;/ul&gt;<br>
<br>
&lt;p&gt;<br>
There&nbsp;are&nbsp;details&nbsp;of&nbsp;our&nbsp;implementation&nbsp;that&nbsp;I&nbsp;disagree&nbsp;with,&nbsp;but&nbsp;in&nbsp;&nbsp;<br>
general,&nbsp;the&nbsp;semantics&nbsp;seem&nbsp;clear&nbsp;and&nbsp;sane,&nbsp;not&nbsp;as&nbsp;convoluted&nbsp;as&nbsp;you&nbsp;&nbsp;<br>
seemed&nbsp;to&nbsp;imply.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;correctly&nbsp;covers&nbsp;the&nbsp;case&nbsp;where&nbsp;&nbsp;<br>
the&nbsp;static&nbsp;initialization&nbsp;fails&nbsp;with&nbsp;an&nbsp;exception.&nbsp;Any&nbsp;thread&nbsp;at&nbsp;that&nbsp;&nbsp;<br>
point&nbsp;can&nbsp;attempt&nbsp;the&nbsp;initialization.<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990608&nbsp;SCO&nbsp;--&nbsp;Jonathan]&lt;/font&gt;<br>
Here's&nbsp;what&nbsp;the&nbsp;SCO&nbsp;UnixWare&nbsp;7&nbsp;C++&nbsp;compiler&nbsp;does&nbsp;for&nbsp;IA-32,<br>
from&nbsp;a&nbsp;(slightly&nbsp;sanitized)&nbsp;design&nbsp;document.<br>
&nbsp;It&nbsp;meets&nbsp;Jim's&nbsp;goal&nbsp;of&nbsp;having&nbsp;no&nbsp;overhead&nbsp;for&nbsp;non-threaded&nbsp;programs<br>
and&nbsp;minimal&nbsp;overhead&nbsp;for&nbsp;threaded&nbsp;programs&nbsp;unless<br>
actual&nbsp;contention&nbsp;occurs&nbsp;(infrequent),<br>
and&nbsp;meets&nbsp;Mike's&nbsp;goal&nbsp;of&nbsp;handling&nbsp;exceptions&nbsp;in&nbsp;the&nbsp;initialization&nbsp;correctly<br>
(although&nbsp;it&nbsp;doesn't&nbsp;guarantee&nbsp;that&nbsp;the&nbsp;thread&nbsp;getting&nbsp;the&nbsp;exception&nbsp;is<br>
the&nbsp;one&nbsp;that&nbsp;gets&nbsp;next&nbsp;crack&nbsp;at&nbsp;initializing&nbsp;the&nbsp;static).<br>
&nbsp;It's&nbsp;also&nbsp;worth&nbsp;noting&nbsp;that&nbsp;dynamic&nbsp;initialization&nbsp;of&nbsp;local&nbsp;variables<br>
(static&nbsp;or&nbsp;otherwise)&nbsp;is&nbsp;very&nbsp;common&nbsp;in&nbsp;C++,<br>
since&nbsp;that's&nbsp;what&nbsp;most&nbsp;object&nbsp;constructions&nbsp;involve,<br>
so&nbsp;I&nbsp;don't&nbsp;think&nbsp;this&nbsp;case&nbsp;is&nbsp;as&nbsp;rare&nbsp;as&nbsp;Jim&nbsp;does.<br>
<br>
<br>
&lt;p&gt;<br>
[...]&nbsp;This&nbsp;is&nbsp;in&nbsp;local&nbsp;static&nbsp;variables&nbsp;with&nbsp;dynamic&nbsp;initialization,<br>
where&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;out&nbsp;a&nbsp;static&nbsp;one-time&nbsp;flag&nbsp;to&nbsp;guard&nbsp;the<br>
initialization.<br>
Two&nbsp;threads&nbsp;could&nbsp;read&nbsp;the&nbsp;flag&nbsp;as&nbsp;zero&nbsp;before&nbsp;either&nbsp;of&nbsp;them&nbsp;set&nbsp;it,<br>
resulting&nbsp;in&nbsp;multiple&nbsp;initializations.<br>
<br>
&lt;p&gt;<br>
[...]&nbsp;Accordingly,&nbsp;when&nbsp;compilation&nbsp;is&nbsp;done&nbsp;with&nbsp;-Kthread&nbsp;on,<br>
a&nbsp;code&nbsp;sequence&nbsp;will&nbsp;be&nbsp;generated&nbsp;to&nbsp;lock&nbsp;this&nbsp;initialization.&nbsp;&nbsp;<br>
[...]&nbsp;the&nbsp;basic&nbsp;idea&nbsp;is&nbsp;to&nbsp;have&nbsp;one&nbsp;guard&nbsp;saying&nbsp;whether&nbsp;the<br>
initialization&nbsp;is&nbsp;done&nbsp;(so&nbsp;that&nbsp;multiple&nbsp;initializations&nbsp;do&nbsp;not&nbsp;occur)<br>
and&nbsp;have&nbsp;another&nbsp;guard&nbsp;saying&nbsp;whether&nbsp;initialization&nbsp;is&nbsp;in&nbsp;progress<br>
(so&nbsp;that&nbsp;a&nbsp;second&nbsp;thread&nbsp;doesn't&nbsp;access&nbsp;what&nbsp;it&nbsp;thinks&nbsp;is<br>
an&nbsp;initialized&nbsp;value&nbsp;before&nbsp;the&nbsp;first&nbsp;thread&nbsp;has&nbsp;finished&nbsp;the<br>
initialization).&nbsp;&nbsp;[...]<br>
<br>
&lt;p&gt;<br>
When&nbsp;compiled&nbsp;with&nbsp;-Kthread,&nbsp;the&nbsp;generated&nbsp;code&nbsp;for&nbsp;a&nbsp;dynamic<br>
initialization&nbsp;of&nbsp;a&nbsp;local&nbsp;static&nbsp;variable&nbsp;will&nbsp;look&nbsp;like&nbsp;the<br>
following.&nbsp;guard&nbsp;is&nbsp;a&nbsp;local&nbsp;static&nbsp;boolean,&nbsp;initialized&nbsp;to&nbsp;zero,<br>
generated&nbsp;by&nbsp;the&nbsp;[middle&nbsp;pass&nbsp;of&nbsp;the&nbsp;compiler].&nbsp;<br>
Two&nbsp;bits&nbsp;of&nbsp;it&nbsp;are&nbsp;used:&nbsp;the&nbsp;low-order&nbsp;'done&nbsp;bit'<br>
and&nbsp;the&nbsp;next-low-order&nbsp;'busy&nbsp;bit'.<br>
<br>
&lt;pre&gt;&lt;code&gt;<br>
.again:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movl&nbsp;&nbsp;&nbsp;&nbsp;$guard,%eax<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testl&nbsp;&nbsp;&nbsp;$1,(%eax)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;test&nbsp;the&nbsp;done&nbsp;bit<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.done&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;if&nbsp;set,&nbsp;variable&nbsp;is&nbsp;initialized,<br>
done<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock;&nbsp;btsl&nbsp;&nbsp;$1,(%eax)&nbsp;&nbsp;&nbsp;//&nbsp;test&nbsp;and&nbsp;set&nbsp;the&nbsp;busy&nbsp;bit<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.busy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&nbsp;init&nbsp;code&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;not&nbsp;busy,&nbsp;do&nbsp;the&nbsp;initialization<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movl&nbsp;&nbsp;&nbsp;&nbsp;$guard,%eax<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;movl&nbsp;&nbsp;&nbsp;&nbsp;$3,(%eax)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;set&nbsp;the&nbsp;done&nbsp;bit<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.done<br>
.busy:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;&nbsp;%eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;call&nbsp;RTS&nbsp;routine&nbsp;to&nbsp;wait,&nbsp;passing&nbsp;address<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call1&nbsp;&nbsp;&nbsp;__static_init_wait&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;of&nbsp;guard&nbsp;to&nbsp;monitor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testl&nbsp;&nbsp;&nbsp;%eax,%eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;1&nbsp;means&nbsp;exception&nbsp;occurred&nbsp;in&nbsp;init&nbsp;code,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popl&nbsp;&nbsp;&nbsp;&nbsp;%ecx<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jnz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.again&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;start&nbsp;the&nbsp;whole&nbsp;thing&nbsp;over<br>
.done&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;0&nbsp;means&nbsp;wait&nbsp;finished<br>
&lt;/code&gt;&lt;/pre&gt;<br>
<br>
&lt;p&gt;<br>
The&nbsp;above&nbsp;code&nbsp;will&nbsp;work&nbsp;for&nbsp;position-independent&nbsp;code&nbsp;as&nbsp;well.<br>
<br>
The&nbsp;complication&nbsp;due&nbsp;to&nbsp;exceptions&nbsp;is:<br>
what&nbsp;happens&nbsp;if&nbsp;the&nbsp;initialization&nbsp;code&nbsp;throws&nbsp;an&nbsp;exception?<br>
The&nbsp;[compiler]&nbsp;EH&nbsp;tables&nbsp;will&nbsp;have&nbsp;set&nbsp;up&nbsp;a&nbsp;special&nbsp;region&nbsp;and&nbsp;flag&nbsp;in<br>
their&nbsp;region&nbsp;table&nbsp;to&nbsp;detect&nbsp;this&nbsp;situation,<br>
along&nbsp;with&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;guard&nbsp;variable.<br>
Because&nbsp;the&nbsp;initialization&nbsp;never&nbsp;completed,<br>
when&nbsp;the&nbsp;RTS&nbsp;sees&nbsp;that&nbsp;it&nbsp;is&nbsp;cleaning&nbsp;up&nbsp;from&nbsp;such&nbsp;a&nbsp;region,<br>
it&nbsp;will&nbsp;reset&nbsp;the&nbsp;guard&nbsp;variable&nbsp;back&nbsp;to&nbsp;both&nbsp;zeroes.<br>
This&nbsp;will&nbsp;free&nbsp;up&nbsp;a&nbsp;busy-waiting&nbsp;thread,&nbsp;if&nbsp;any,<br>
or&nbsp;will&nbsp;reset&nbsp;everything&nbsp;for&nbsp;the&nbsp;next&nbsp;thread&nbsp;that&nbsp;calls&nbsp;the&nbsp;function.<br>
<br>
&lt;p&gt;<br>
The&nbsp;idea&nbsp;of&nbsp;the&nbsp;__static_init_wait()&nbsp;RTS&nbsp;routine&nbsp;is&nbsp;to&nbsp;monitor&nbsp;the<br>
value&nbsp;of&nbsp;guard&nbsp;bits&nbsp;passed&nbsp;in,&nbsp;by&nbsp;looping&nbsp;on&nbsp;this&nbsp;decision&nbsp;table:<br>
&lt;pre&gt;&lt;code&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;done&nbsp;&nbsp;&nbsp;&nbsp;busy<br>
&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1&nbsp;in&nbsp;%eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(EH&nbsp;wipe-out)<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0&nbsp;in&nbsp;%eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(no&nbsp;longer&nbsp;busy)<br>
&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue&nbsp;to&nbsp;wait&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(still&nbsp;busy)<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;internal&nbsp;error,&nbsp;shouldn't&nbsp;happen<br>
&lt;/code&gt;&lt;/pre&gt;<br>
<br>
&lt;p&gt;<br>
As&nbsp;for&nbsp;how&nbsp;the&nbsp;wait&nbsp;is&nbsp;done&nbsp;[...&nbsp;not&nbsp;relevant&nbsp;for&nbsp;ABI,<br>
although&nbsp;currently&nbsp;we're&nbsp;using&nbsp;thr_yield(),<br>
which&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;be&nbsp;right&nbsp;for&nbsp;this&nbsp;context].<br>
<br>
&lt;p&gt;<br>
&lt;font&nbsp;color=blue&gt;[990608&nbsp;SGI&nbsp;--&nbsp;Hans]&lt;/font&gt;<br>
I'd&nbsp;like&nbsp;to&nbsp;make&nbsp;some&nbsp;claims&nbsp;about&nbsp;function&nbsp;scope&nbsp;static&nbsp;constructor<br>
calls&nbsp;in&nbsp;multithreaded&nbsp;environments.<br>
I&nbsp;personally&nbsp;can't&nbsp;recall&nbsp;ever&nbsp;having&nbsp;used&nbsp;such&nbsp;a&nbsp;construct,<br>
which&nbsp;somewhat&nbsp;substantiates&nbsp;my&nbsp;claims,<br>
but&nbsp;also&nbsp;implies&nbsp;some&nbsp;lack&nbsp;of&nbsp;certainty.<br>
I'd&nbsp;be&nbsp;interested&nbsp;in&nbsp;hearing&nbsp;any&nbsp;arguments&nbsp;to&nbsp;the&nbsp;contrary.<br>
<br>
&lt;p&gt;<br>
I&nbsp;believe&nbsp;that&nbsp;these&nbsp;arguments&nbsp;imply&nbsp;that&nbsp;this&nbsp;problem&nbsp;is&nbsp;not&nbsp;important<br>
enough&nbsp;to&nbsp;warrant&nbsp;added&nbsp;ABI&nbsp;complexity&nbsp;or&nbsp;overhead&nbsp;for&nbsp;sequential&nbsp;code.<br>
<br>
&lt;p&gt;<br>
Consider&nbsp;the&nbsp;following&nbsp;skeletal&nbsp;example:<br>
<br>
&lt;p&gt;&lt;code&gt;<br>
f(int&nbsp;x)&nbsp;{&nbsp;static&nbsp;foo&nbsp;a(...);&nbsp;...&nbsp;}<br>
&lt;/code&gt;<br>
<br>
&lt;ol&gt;<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
If&nbsp;the&nbsp;constructor&nbsp;argument&nbsp;doesn't&nbsp;depend&nbsp;on&nbsp;the&nbsp;function&nbsp;parameter,<br>
and&nbsp;the&nbsp;code&nbsp;behaves&nbsp;reasonably,&nbsp;it&nbsp;should&nbsp;be&nbsp;possible&nbsp;to&nbsp;rewrite&nbsp;this&nbsp;as<br>
<br>
&lt;p&gt;&lt;code&gt;<br>
static&nbsp;foo&nbsp;a(...);<br>
&lt;br&gt;<br>
f(int&nbsp;x)&nbsp;{&nbsp;...&nbsp;}<br>
&lt;/code&gt;<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
If&nbsp;I&nbsp;read&nbsp;the&nbsp;standard&nbsp;correctly&nbsp;(and&nbsp;that's&nbsp;a&nbsp;big&nbsp;disclaimer),<br>
the&nbsp;compiler&nbsp;is&nbsp;entitled&nbsp;to&nbsp;perform&nbsp;the&nbsp;above&nbsp;transformation&nbsp;under<br>
conditions&nbsp;that&nbsp;are&nbsp;usually&nbsp;true,<br>
but&nbsp;hard&nbsp;for&nbsp;the&nbsp;compiler&nbsp;to&nbsp;deduce.<br>
Thus&nbsp;code&nbsp;that&nbsp;relies&nbsp;on&nbsp;the&nbsp;initialization&nbsp;occurring&nbsp;during&nbsp;the<br>
execution&nbsp;of&nbsp;f&nbsp;is&nbsp;usually&nbsp;broken.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Thus&nbsp;the&nbsp;foo&nbsp;constructor&nbsp;cannot&nbsp;rely&nbsp;on&nbsp;its&nbsp;caller&nbsp;holding&nbsp;any&nbsp;locks.<br>
It&nbsp;must&nbsp;explicitly&nbsp;acquire&nbsp;any&nbsp;locks&nbsp;it&nbsp;needs.<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
It&nbsp;is&nbsp;far&nbsp;preferable&nbsp;to&nbsp;write&nbsp;the&nbsp;transformed&nbsp;form&nbsp;with&nbsp;a&nbsp;file&nbsp;scope<br>
static&nbsp;variable&nbsp;to&nbsp;start&nbsp;with.<br>
The&nbsp;initial&nbsp;form&nbsp;risks&nbsp;deadlock,<br>
since&nbsp;f&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;locks&nbsp;held&nbsp;which&nbsp;the&nbsp;constructor<br>
can't&nbsp;assume&nbsp;are&nbsp;held.<br>
If&nbsp;it&nbsp;needs&nbsp;one&nbsp;of&nbsp;those&nbsp;locks&nbsp;it&nbsp;will&nbsp;need&nbsp;to&nbsp;reacquire&nbsp;it.<br>
With&nbsp;default&nbsp;mutex&nbsp;semantics&nbsp;that&nbsp;results&nbsp;in&nbsp;deadlock&nbsp;with&nbsp;itself.<br>
(If&nbsp;locks&nbsp;may&nbsp;be&nbsp;reentered,<br>
it&nbsp;may&nbsp;fail&nbsp;in&nbsp;a&nbsp;more&nbsp;subtle&nbsp;manner&nbsp;since&nbsp;the&nbsp;foo&nbsp;constructor&nbsp;may<br>
acquire&nbsp;a&nbsp;monitor&nbsp;lock&nbsp;whose&nbsp;monitor&nbsp;invariant&nbsp;doesn't&nbsp;hold.)<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
File&nbsp;scope&nbsp;static&nbsp;constructor&nbsp;calls&nbsp;aren't&nbsp;a&nbsp;problem&nbsp;and&nbsp;require&nbsp;no&nbsp;locking,<br>
since&nbsp;they&nbsp;are&nbsp;executed&nbsp;in&nbsp;a&nbsp;single&nbsp;thread&nbsp;before&nbsp;main&nbsp;is&nbsp;called&nbsp;or<br>
before&nbsp;dlopen&nbsp;returns.<br>
(Forking&nbsp;a&nbsp;thread&nbsp;in&nbsp;a&nbsp;static&nbsp;constructor&nbsp;should&nbsp;probably&nbsp;be&nbsp;disallowed.<br>
Threads&nbsp;may&nbsp;not&nbsp;have&nbsp;been&nbsp;fully&nbsp;initialized,&nbsp;among&nbsp;other&nbsp;issues.)<br>
<br>
&lt;p&gt;<br>
&lt;li&gt;<br>
Static&nbsp;function&nbsp;scope&nbsp;constructor&nbsp;calls&nbsp;which&nbsp;depend&nbsp;on&nbsp;function<br>
arguments&nbsp;are&nbsp;likely&nbsp;to&nbsp;involve&nbsp;a&nbsp;race&nbsp;condition&nbsp;anyway,<br>
if&nbsp;multiple&nbsp;instances&nbsp;of&nbsp;the&nbsp;function&nbsp;can&nbsp;be&nbsp;invoked&nbsp;concurrently.<br>
Any&nbsp;of&nbsp;the&nbsp;calls&nbsp;might&nbsp;determine&nbsp;the&nbsp;constructor&nbsp;parameters.<br>
Thus&nbsp;these&nbsp;aren't&nbsp;very&nbsp;interesting&nbsp;either.<br>
And&nbsp;if&nbsp;they&nbsp;are&nbsp;really&nbsp;needed,&nbsp;they&nbsp;can&nbsp;be&nbsp;replaced&nbsp;with&nbsp;a&nbsp;file&nbsp;scope<br>
static&nbsp;constructor&nbsp;call&nbsp;plus&nbsp;an&nbsp;assignment.<br>
<br>
&lt;/ol&gt;<br>
<br>
<br>
<br>
&lt;p&gt;&nbsp;&lt;hr&gt;&nbsp;&lt;p&gt;<br>
&lt;h3&gt;&nbsp;Library&nbsp;Interface&nbsp;Issues&nbsp;&lt;/h3&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=H1&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;H-1&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Runtime&nbsp;library&nbsp;DSO&nbsp;name&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;tools&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990616&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Determine&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;common&nbsp;C++&nbsp;runtime&nbsp;library&nbsp;DSO,<br>
e.g.&nbsp;&lt;code&gt;libC.so&lt;/code&gt;.<br>
If&nbsp;there&nbsp;are&nbsp;to&nbsp;be&nbsp;vendor-specific&nbsp;support&nbsp;libraries&nbsp;which&nbsp;must&nbsp;coexist<br>
in&nbsp;programs&nbsp;from&nbsp;mixed&nbsp;sources,&nbsp;identify&nbsp;naming&nbsp;convention&nbsp;for&nbsp;them.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;table&nbsp;border=on&nbsp;cellpadding=3&gt;<br>
<br>
&lt;tr&gt;<br>
&lt;th&gt;&nbsp;#&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Issue&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Class&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Status&nbsp;&lt;/th&gt;<br>
&lt;th&gt;&nbsp;Source&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Opened&nbsp;&lt;/th&gt;&nbsp;&lt;th&gt;&nbsp;Closed&nbsp;&lt;/th&gt;<br>
&lt;/tr&gt;<br>
<br>
&lt;tr&gt;&nbsp;&lt;a&nbsp;name=H2&gt;&lt;/a&gt;&nbsp;&lt;td&gt;&nbsp;H-2&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;Runtime&nbsp;library&nbsp;API&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;lif&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;open&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;SGI&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;990616&nbsp;&lt;/td&gt;<br>
&lt;td&gt;&nbsp;&lt;/td&gt;<br>
&lt;/tr&gt;<br>
&lt;tr&gt;&nbsp;&lt;td&nbsp;colspan=7&gt;<br>
&lt;b&gt;Summary&lt;/b&gt;:<br>
Define&nbsp;the&nbsp;required&nbsp;entrypoints&nbsp;in&nbsp;the&nbsp;common&nbsp;C++&nbsp;runtime&nbsp;library&nbsp;DSO,<br>
and&nbsp;their&nbsp;prototypes.<br>
&lt;/td&gt;&nbsp;&lt;/tr&gt;<br>
<br>
&lt;/table&gt;<br>
<br>
&lt;p&gt;<br>
&lt;hr&gt;<br>
<br>
&lt;p&gt;<br>
Please&nbsp;send&nbsp;corrections&nbsp;to&nbsp;&lt;a&nbsp;href=mailto:dehnert@sgi.com&gt;Jim&nbsp;Dehnert&lt;/a&gt;.<br>
<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
