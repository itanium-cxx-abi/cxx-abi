<tt>
&lt;HTML&gt;<br>
&nbsp;&nbsp;&lt;HEAD&gt;<br>
&nbsp;&nbsp;&lt;TITLE&gt;Unwinding&nbsp;ABI&lt;/TITLE&gt;&lt;/HEAD&gt;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;BODY&nbsp;BGCOLOR=#FFFFFF&gt;<br>
&nbsp;&nbsp;<br>
<br>
&lt;H1&gt;Unwinding&nbsp;ABI&lt;/H1&gt;<br>
<br>
&lt;P&gt;Here&nbsp;is&nbsp;a&nbsp;quick&nbsp;description&nbsp;of&nbsp;the&nbsp;personality&nbsp;routine&nbsp;interface<br>
and&nbsp;semantics.&nbsp;This&nbsp;description&nbsp;is&nbsp;a&nbsp;slight&nbsp;extension&nbsp;of&nbsp;the&nbsp;existing<br>
C++&nbsp;exception&nbsp;handling&nbsp;framework&nbsp;implemented&nbsp;by&nbsp;HP&nbsp;for&nbsp;IA64.&nbsp;The<br>
extension&nbsp;is&nbsp;to&nbsp;allow&nbsp;multiple&nbsp;runtimes&nbsp;from&nbsp;possibly&nbsp;different<br>
vendors&nbsp;or&nbsp;for&nbsp;possibly&nbsp;different&nbsp;languages&nbsp;to&nbsp;cooperate&nbsp;in<br>
processsing&nbsp;an&nbsp;exception,&nbsp;&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;and&nbsp;to&nbsp;account&nbsp;for<br>
other&nbsp;possible&nbsp;reasons&nbsp;to&nbsp;unwind&nbsp;the&nbsp;stack,&nbsp;such&nbsp;as&nbsp;longjmp&nbsp;or&nbsp;thread<br>
termination.&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;This&nbsp;document&nbsp;assumes&nbsp;that&nbsp;the&nbsp;chapter&nbsp;11&nbsp;of&nbsp;the&nbsp;Intel/HP<br>
&quot;IA-64&nbsp;Software&nbsp;Conventions&nbsp;and&nbsp;Runtime&nbsp;Architecture&quot;<br>
document&nbsp;is&nbsp;known&nbsp;to&nbsp;the&nbsp;reader.&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;It&nbsp;describes<br>
only&nbsp;the&nbsp;routines&nbsp;used&nbsp;to&nbsp;perform&nbsp;the&nbsp;unwinding.&nbsp;Additional<br>
language-specific&nbsp;or&nbsp;library-specific&nbsp;support&nbsp;is&nbsp;required&nbsp;to<br>
implement,&nbsp;for&nbsp;instance,&nbsp;C++&nbsp;exception&nbsp;handling,&nbsp;a&nbsp;stack-unwinding<br>
longjmp,&nbsp;or&nbsp;pthread&nbsp;cancellation/exit.&nbsp;The&nbsp;proposed&nbsp;&quot;unwind&nbsp;library&quot;<br>
is&nbsp;intended&nbsp;to&nbsp;allow&nbsp;such&nbsp;situations&nbsp;to&nbsp;perform&nbsp;unwinding&nbsp;in&nbsp;a<br>
consistent&nbsp;and&nbsp;cooperative&nbsp;manner.&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;H2&gt;Interface:&lt;/H2&gt;<br>
<br>
&lt;P&gt;The&nbsp;unwinding&nbsp;library&nbsp;interface&nbsp;consists&nbsp;of&nbsp;at&nbsp;least&nbsp;the&nbsp;following<br>
routines:&lt;/P&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;TT&gt;_Unwind_RaiseException&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_DeleteException&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_GetGR&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_SetGR&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_GetIP&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_SetIP&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_GetRegionStart&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;TT&gt;_Unwind_GetLanguageSpecificData&lt;/TT&gt;,&lt;BR&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;<br>
&lt;TT&gt;_Unwind_ForcedUnwind&lt;/TT&gt;.<br>
&lt;/FONT&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
&lt;P&gt;In&nbsp;addition,&nbsp;a&nbsp;language&nbsp;and&nbsp;vendor&nbsp;specific&nbsp;personality&nbsp;routine<br>
will&nbsp;be&nbsp;stored&nbsp;by&nbsp;the&nbsp;compiler&nbsp;in&nbsp;the&nbsp;unwind&nbsp;descriptor&nbsp;for&nbsp;the&nbsp;stack<br>
frames&nbsp;requiring&nbsp;exception&nbsp;processing.&nbsp;&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;The<br>
personality&nbsp;routine&nbsp;is&nbsp;called&nbsp;by&nbsp;the&nbsp;unwinder&nbsp;to&nbsp;handle<br>
language-specific&nbsp;tasks&nbsp;such&nbsp;as&nbsp;identifying&nbsp;the&nbsp;frame&nbsp;handling&nbsp;a<br>
particular&nbsp;exception.&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;<br>
&lt;H3&gt;Design&nbsp;Discussion&lt;/H3&gt;<br>
<br>
&lt;P&gt;There&nbsp;are&nbsp;two&nbsp;major&nbsp;reasons&nbsp;for&nbsp;unwinding&nbsp;the&nbsp;stack:&nbsp;exceptions&nbsp;and<br>
&quot;forced&quot;&nbsp;unwinding&nbsp;(longjmp,&nbsp;thread&nbsp;termination).&nbsp;This&nbsp;proposal&nbsp;tries<br>
to&nbsp;keep&nbsp;both&nbsp;similar.&lt;/P&gt;<br>
<br>
&lt;P&gt;There&nbsp;is&nbsp;a&nbsp;major&nbsp;difference,&nbsp;however.&nbsp;In&nbsp;the&nbsp;case&nbsp;an&nbsp;exception&nbsp;is<br>
thrown,&nbsp;stack&nbsp;is&nbsp;unwound&nbsp;while&nbsp;the&nbsp;exception&nbsp;propagates,&nbsp;but&nbsp;it&nbsp;is<br>
expected&nbsp;that&nbsp;each&nbsp;runtime&nbsp;knows&nbsp;if&nbsp;it&nbsp;wants&nbsp;to&nbsp;catch&nbsp;the&nbsp;exception&nbsp;or<br>
let&nbsp;it&nbsp;go&nbsp;through.&nbsp;This&nbsp;task&nbsp;is&nbsp;delegated&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine,<br>
which&nbsp;is&nbsp;supposed&nbsp;to&nbsp;act&nbsp;properly&nbsp;for&nbsp;any&nbsp;type&nbsp;of&nbsp;exception,&nbsp;either<br>
&quot;native&quot;&nbsp;or&nbsp;&quot;foreign&quot;.&nbsp;Some&nbsp;guidelines&nbsp;for&nbsp;&quot;acting&nbsp;properly&quot;&nbsp;are&nbsp;given<br>
below.&lt;/P&gt;<br>
<br>
&lt;P&gt;During&nbsp;&quot;forced&nbsp;unwinding&quot;,&nbsp;on&nbsp;the&nbsp;other&nbsp;hand,&nbsp;an&nbsp;external&nbsp;force&nbsp;is<br>
driving&nbsp;the&nbsp;unwinding.&nbsp;For&nbsp;instance,&nbsp;this&nbsp;can&nbsp;be&nbsp;the&nbsp;longjmp<br>
routine.&nbsp;This&nbsp;external&nbsp;force,&nbsp;not&nbsp;each&nbsp;personality&nbsp;routine,&nbsp;knows&nbsp;when<br>
to&nbsp;stop&nbsp;unwinding.&nbsp;The&nbsp;fact&nbsp;that&nbsp;a&nbsp;personality&nbsp;routine&nbsp;is&nbsp;not&nbsp;given&nbsp;a<br>
choice&nbsp;about&nbsp;whether&nbsp;unwinding&nbsp;will&nbsp;go&nbsp;further&nbsp;or&nbsp;not&nbsp;is&nbsp;indicated&nbsp;by<br>
the&nbsp;&lt;TT&gt;EH_FORCE_UNWIND&lt;/TT&gt;&nbsp;flag.&lt;/P&gt;<br>
<br>
&lt;P&gt;To&nbsp;accomodate&nbsp;for&nbsp;these&nbsp;differences,&nbsp;two&nbsp;different&nbsp;routines&nbsp;are<br>
proposed.&nbsp;&lt;TT&gt;_Unwind_RaiseException&lt;/TT&gt;&nbsp;performs&nbsp;unwinding&nbsp;under&nbsp;the<br>
personality&nbsp;routines&nbsp;control.&nbsp;&lt;TT&gt;_Unwind_ForcedUnwind&lt;/TT&gt;,&nbsp;on&nbsp;the<br>
other&nbsp;hand,&nbsp;performs&nbsp;unwinding,&nbsp;but&nbsp;gives&nbsp;the&nbsp;&quot;external&nbsp;force&quot;&nbsp;the<br>
opportunity&nbsp;to&nbsp;intercept&nbsp;calls&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine.&lt;/P&gt;<br>
<br>
<br>
&lt;P&gt;This&nbsp;way,&nbsp;each&nbsp;personality&nbsp;routine&nbsp;does&nbsp;not&nbsp;have&nbsp;to&nbsp;know&nbsp;about&nbsp;any<br>
of&nbsp;the&nbsp;possible&nbsp;&quot;external&nbsp;driving&nbsp;forces&quot;&nbsp;that&nbsp;may&nbsp;cause&nbsp;an<br>
unwind.&nbsp;For&nbsp;instance,&nbsp;the&nbsp;C++&nbsp;personality&nbsp;routine&nbsp;has&nbsp;to&nbsp;deal&nbsp;only<br>
with&nbsp;C++&nbsp;exceptions&nbsp;(and&nbsp;possibly&nbsp;disguising&nbsp;foreign&nbsp;exceptions),&nbsp;but<br>
it&nbsp;does&nbsp;not&nbsp;need&nbsp;to&nbsp;know&nbsp;anything&nbsp;about&nbsp;unwinding&nbsp;done&nbsp;on&nbsp;behalf&nbsp;of<br>
setjmp/longjmp&nbsp;or&nbsp;pthreads&nbsp;cancellation.&lt;/P&gt;.<br>
&lt;/FONT&gt;<br>
<br>
<br>
<br>
&lt;H3&gt;Routines&nbsp;Interface&lt;/H3&gt;<br>
<br>
&lt;P&gt;The&nbsp;unwind&nbsp;runtime&nbsp;routines&nbsp;have&nbsp;the&nbsp;following&nbsp;interface&nbsp;and<br>
semantics&nbsp;(all&nbsp;routines&nbsp;are&nbsp;&lt;TT&gt;extern&nbsp;&quot;C&quot;&lt;/TT&gt;):&lt;/P&gt;<br>
<br>
&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;<br>
&lt;PRE&gt;struct&nbsp;_Unwind_Exception&lt;/PRE&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;P&gt;This&nbsp;type&nbsp;is&nbsp;used&nbsp;to&nbsp;refer&nbsp;to&nbsp;&lt;EM&gt;exception&nbsp;objects&lt;/EM&gt;,&nbsp;that&nbsp;is<br>
the&nbsp;representation&nbsp;in&nbsp;memory&nbsp;of&nbsp;an&nbsp;exception&nbsp;being&nbsp;thrown.&nbsp;The<br>
complete&nbsp;representation&nbsp;of&nbsp;an&nbsp;exception&nbsp;is&nbsp;runtime&nbsp;and&nbsp;language<br>
specific,&nbsp;and&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;contiguous&nbsp;area&nbsp;of&nbsp;memory<br>
beginning&nbsp;with&nbsp;the&nbsp;_Unwind_Exception&nbsp;object.&nbsp;The&nbsp;_Unwind_Exception<br>
structure&nbsp;is&nbsp;defined&nbsp;as:&lt;/P&gt;<br>
<br>
&lt;PRE&gt;struct&nbsp;_Unwind_Exception<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;uint64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception_class;<br>
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*personality_routine)(int,&nbsp;int,&nbsp;uint64,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;_Unwind_Exception&nbsp;*,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;_Unwind_Context&nbsp;*);<br>
&nbsp;&nbsp;&nbsp;&nbsp;uint64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unwinder_private_state_1;<br>
&nbsp;&nbsp;&nbsp;&nbsp;uint64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unwinder_private_state_2;<br>
};&lt;/PRE&gt;<br>
<br>
&lt;P&gt;Any&nbsp;pointer&nbsp;to&nbsp;an&nbsp;_Unwind_Exception&nbsp;must&nbsp;be&nbsp;double-word<br>
aligned.&nbsp;The&nbsp;private&nbsp;state&nbsp;in&nbsp;an&nbsp;exception&nbsp;object&nbsp;should&nbsp;neither&nbsp;be<br>
read&nbsp;by&nbsp;nor&nbsp;written&nbsp;to&nbsp;by&nbsp;personality&nbsp;routines&nbsp;or&nbsp;other&nbsp;parts&nbsp;of&nbsp;the<br>
language-specific&nbsp;runtime.&nbsp;The&nbsp;personality&nbsp;routine&nbsp;pointer&nbsp;is&nbsp;64-bit<br>
(a&nbsp;double&nbsp;word.)&lt;/P&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
&lt;PRE&gt;struct&nbsp;_Unwind_Context&lt;/PRE&gt;<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;P&gt;This&nbsp;type&nbsp;is&nbsp;used&nbsp;to&nbsp;refer&nbsp;to&nbsp;a&nbsp;system-specific&nbsp;data&nbsp;structure&nbsp;used<br>
by&nbsp;the&nbsp;system&nbsp;unwinder.&nbsp;It&nbsp;should&nbsp;be&nbsp;considered&nbsp;totally&nbsp;opaque.&nbsp;This<br>
context&nbsp;is&nbsp;created&nbsp;and&nbsp;destroyed&nbsp;by&nbsp;the&nbsp;system,&nbsp;and&nbsp;passed&nbsp;to&nbsp;the<br>
personality&nbsp;routine&nbsp;during&nbsp;unwinding&nbsp;(see&nbsp;below.)&lt;/P&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
&lt;/FONT&gt;<br>
<br>
&lt;PRE&gt;uint64&nbsp;_Unwind_RaiseException&nbsp;(uint64&nbsp;exception_class,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;_Unwind_Exception&nbsp;*exception_object);&lt;/PRE&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;P&gt;Raise&nbsp;an&nbsp;exception,&nbsp;passing&nbsp;along&nbsp;the&nbsp;given&nbsp;exception&nbsp;class&nbsp;and<br>
exception&nbsp;object.&nbsp;The&nbsp;exception&nbsp;object&nbsp;has&nbsp;been&nbsp;allocated&nbsp;by&nbsp;the<br>
language-specific&nbsp;runtime,&nbsp;and&nbsp;has&nbsp;a&nbsp;language-specific<br>
format,&nbsp;except&nbsp;that&nbsp;it&nbsp;must&nbsp;begin&nbsp;with&nbsp;the&nbsp;&lt;TT&gt;_Unwind_Exception&lt;/TT&gt;<br>
struct.&nbsp;&lt;TT&gt;_Unwind_RaiseException&lt;/TT&gt;&nbsp;does&nbsp;not&nbsp;return,&nbsp;unless&nbsp;an<br>
error&nbsp;condition&nbsp;is&nbsp;found&nbsp;(such&nbsp;as&nbsp;no&nbsp;handler&nbsp;accepting&nbsp;to&nbsp;handle&nbsp;the<br>
exception,&nbsp;bad&nbsp;stack&nbsp;format,&nbsp;etc).&lt;/P&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;PRE&gt;void&nbsp;_Unwind_Resume&nbsp;(struct&nbsp;_Unwind_Exception&nbsp;*exception_object);&lt;/PRE&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;P&gt;Resume&nbsp;propagation&nbsp;of&nbsp;an&nbsp;existing&nbsp;exception&nbsp;after&nbsp;executing&nbsp;some<br>
cleanup&nbsp;code&nbsp;in&nbsp;a&nbsp;partially&nbsp;unwound&nbsp;stack.&lt;/P&gt;<br>
<br>
&lt;P&gt;A&nbsp;call&nbsp;to&nbsp;this&nbsp;routine&nbsp;is&nbsp;inserted&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;landing&nbsp;pad&nbsp;that<br>
performed&nbsp;cleanup,&nbsp;but&nbsp;did&nbsp;not&nbsp;resume&nbsp;normal&nbsp;execution.&nbsp;It&nbsp;causes<br>
unwinding&nbsp;to&nbsp;proceed&nbsp;further.&lt;/P&gt;<br>
<br>
&lt;P&gt;[Note:&nbsp;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;to&nbsp;implement<br>
rethrowing.&nbsp;To&nbsp;the&nbsp;unwinding&nbsp;runtime,&nbsp;the&nbsp;catch&nbsp;code&nbsp;that&nbsp;rethrows&nbsp;was<br>
a&nbsp;handler,&nbsp;and&nbsp;the&nbsp;previous&nbsp;unwinding&nbsp;session&nbsp;was&nbsp;terminated&nbsp;before<br>
entering&nbsp;it.&nbsp;Rethrowing&nbsp;is&nbsp;implemented&nbsp;by&nbsp;calling<br>
_Unwind_RaiseException&nbsp;again&nbsp;with&nbsp;the&nbsp;same&nbsp;exception&nbsp;object.]<br>
<br>
&lt;P&gt;[Note&nbsp;2:&nbsp;Compared&nbsp;to&nbsp;HP&nbsp;runtime,&nbsp;the&nbsp;exception&nbsp;class&nbsp;and&nbsp;frame<br>
handle&nbsp;arguments&nbsp;have&nbsp;been&nbsp;removed.&nbsp;They&nbsp;also&nbsp;need&nbsp;no&nbsp;longer&nbsp;be&nbsp;passed<br>
to&nbsp;the&nbsp;landing&nbsp;pads.&nbsp;Instead,&nbsp;the&nbsp;unwinder&nbsp;will&nbsp;store&nbsp;the&nbsp;information<br>
in&nbsp;one&nbsp;of&nbsp;its&nbsp;2&nbsp;reserved&nbsp;words.]<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;COLOR=&quot;#FF0000&quot;&gt;[Note&nbsp;3:&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;routine&nbsp;in&nbsp;the<br>
unwind&nbsp;library&nbsp;which&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;by&nbsp;generated<br>
code:&nbsp;it&nbsp;will&nbsp;be&nbsp;inserted&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;landing&nbsp;pad&nbsp;in&nbsp;a<br>
&quot;landing-pad&quot;&nbsp;model.]&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;PRE&gt;void&nbsp;_Unwind_DeleteException(struct&nbsp;_Unwind_Exception&nbsp;*exception_object);&lt;/PRE&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;P&gt;Deletes&nbsp;the&nbsp;given&nbsp;exception.&lt;/P&gt;<br>
<br>
&lt;P&gt;If&nbsp;a&nbsp;given&nbsp;runtime&nbsp;resumes&nbsp;normal&nbsp;execution&nbsp;after&nbsp;catching&nbsp;a&nbsp;foreign<br>
exception,&nbsp;it&nbsp;will&nbsp;not&nbsp;know&nbsp;how&nbsp;to&nbsp;delete&nbsp;that&nbsp;exception.&nbsp;This<br>
exception&nbsp;will&nbsp;be&nbsp;deleted&nbsp;by&nbsp;calling&nbsp;&lt;TT&gt;_Unwind_DeleteException&lt;/TT&gt;,&nbsp;which<br>
in&nbsp;turn&nbsp;will&nbsp;delegate&nbsp;the&nbsp;task&nbsp;to&nbsp;the&nbsp;original&nbsp;personality&nbsp;routine<br>
(see&nbsp;&lt;TT&gt;EH_DELETE_EXCEPTION_OBJECT&lt;/TT&gt;&nbsp;below).&lt;/P&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;P&gt;&lt;TT&gt;uint64&nbsp;_Unwind_GetGR(struct&nbsp;_Unwind_Context&nbsp;*context,&nbsp;int&nbsp;index);&lt;BR&gt;<br>
uint64&nbsp;_Unwind_GetIP(struct&nbsp;_Unwind_Context&nbsp;*context);&lt;BR&gt;<br>
void&nbsp;_Unwind_SetGR(struct&nbsp;_Unwind_Context&nbsp;*context,&nbsp;int&nbsp;index,&nbsp;uint64&nbsp;new_value);&lt;BR&gt;<br>
void&nbsp;_Unwind_SetIP(struct&nbsp;_Unwind_Context&nbsp;*context,&nbsp;uint64&nbsp;new_value);&lt;/TT&gt;&lt;/P&gt;<br>
<br>
&lt;BLOCKQUOTE&gt;<br>
Get&nbsp;or&nbsp;set&nbsp;registers&nbsp;from&nbsp;the&nbsp;given&nbsp;unwinder&nbsp;context.&nbsp;The&nbsp;'context'<br>
argument&nbsp;is&nbsp;the&nbsp;same&nbsp;argument&nbsp;passed&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine&nbsp;(see<br>
below).[Note:&nbsp;Minor&nbsp;changes&nbsp;compared&nbsp;to&nbsp;the&nbsp;existing&nbsp;unwinding<br>
interface,&nbsp;mostly&nbsp;to&nbsp;hide&nbsp;the&nbsp;register&nbsp;classes]<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;P&gt;&lt;TT&gt;uint64&nbsp;_Unwind_GetLanguageSpecificData(struct&nbsp;_Unwind_Context&nbsp;*context)&lt;/TT&gt;&lt;/P&gt;<br>
&lt;BLOCKQUOTE&gt;<br>
Get&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;language-specific&nbsp;data&nbsp;area&nbsp;for&nbsp;the&nbsp;current<br>
stack&nbsp;frame.&nbsp;The&nbsp;'&lt;TT&gt;context&lt;/TT&gt;'&nbsp;argument&nbsp;is&nbsp;the&nbsp;same&nbsp;argument<br>
passed&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine.[Note:&nbsp;This&nbsp;is&nbsp;not&nbsp;stricly&nbsp;required:<br>
it&nbsp;could&nbsp;be&nbsp;accessed&nbsp;through&nbsp;_Unwind_GetIP&nbsp;using&nbsp;the&nbsp;documented&nbsp;format<br>
of&nbsp;the&nbsp;UnwindInfoBlock,&nbsp;but&nbsp;since&nbsp;this&nbsp;work&nbsp;has&nbsp;been&nbsp;done&nbsp;for&nbsp;finding<br>
the&nbsp;personality&nbsp;routine&nbsp;in&nbsp;the&nbsp;first&nbsp;place,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;cache<br>
the&nbsp;result&nbsp;in&nbsp;the&nbsp;context,&nbsp;as&nbsp;we&nbsp;currently&nbsp;do.&nbsp;We&nbsp;could&nbsp;also&nbsp;pass&nbsp;it<br>
as&nbsp;an&nbsp;argument&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine.]<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;P&gt;&lt;TT&gt;uint64&nbsp;_Unwind_GetRegionStart(struct&nbsp;_Unwind_Context&nbsp;*context)&lt;/TT&gt;&lt;/P&gt;<br>
&lt;BLOCKQUOTE&gt;<br>
Get&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;current&nbsp;procedure&nbsp;or&nbsp;region&nbsp;of<br>
code.&nbsp;[Note:&nbsp;This&nbsp;is&nbsp;required&nbsp;for&nbsp;us&nbsp;because&nbsp;we&nbsp;store&nbsp;data&nbsp;relative&nbsp;to<br>
the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;code.&nbsp;So&nbsp;let's&nbsp;make&nbsp;it&nbsp;mandatory&nbsp;;-]<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;P&gt;&lt;B&gt;&lt;FONT&nbsp;SIZE=4&gt;PERSONALITY&nbsp;ROUTINE:&lt;/FONT&gt;&lt;/B&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;personality&nbsp;routine&nbsp;is&nbsp;defined&nbsp;with&nbsp;the&nbsp;following<br>
interface:&lt;/P&gt;<br>
&lt;BLOCKQUOTE&gt;<br>
&lt;TT&gt;int&nbsp;PersonalityRoutine&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;(int&nbsp;version,&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;phase,&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt64&nbsp;exceptionClass,&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;_Unwind_Exception&nbsp;*exceptionObject,&lt;BR&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;_Unwind_Context&nbsp;*context);&lt;/TT&gt;<br>
&lt;/BLOCKQUOTE&gt;<br>
<br>
<br>
&lt;P&gt;[Note:&nbsp;the&nbsp;frame_handle&nbsp;argument&nbsp;has&nbsp;been&nbsp;removed:&nbsp;it&nbsp;was&nbsp;used&nbsp;only<br>
once&nbsp;in&nbsp;the&nbsp;runtime,&nbsp;and&nbsp;the&nbsp;cost&nbsp;of&nbsp;reading&nbsp;it&nbsp;back&nbsp;from&nbsp;the<br>
exception&nbsp;object&nbsp;is&nbsp;really&nbsp;minimal,&nbsp;compared&nbsp;to&nbsp;the&nbsp;cost&nbsp;of&nbsp;having&nbsp;to<br>
spill&nbsp;it&nbsp;in&nbsp;all&nbsp;landing&nbsp;pads...&nbsp;The&nbsp;context&nbsp;argument&nbsp;type&nbsp;has&nbsp;been<br>
made&nbsp;opaque]&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;arguments&nbsp;have&nbsp;the&nbsp;following&nbsp;role&nbsp;and&nbsp;meanings:&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;version&lt;/B&gt;:&nbsp;Version&nbsp;number&nbsp;that&nbsp;the&nbsp;compiler&nbsp;and&nbsp;personality<br>
routine&nbsp;agree&nbsp;on,&nbsp;identifying&nbsp;for&nbsp;instance&nbsp;language-specific&nbsp;table<br>
format.&nbsp;This&nbsp;version&nbsp;number&nbsp;is&nbsp;read&nbsp;from&nbsp;the&nbsp;unwind&nbsp;information&nbsp;block<br>
(unwind&nbsp;tables)&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;phase&lt;/B&gt;:&nbsp;Indicates&nbsp;what&nbsp;processing&nbsp;the&nbsp;personality&nbsp;routine&nbsp;is<br>
supposed&nbsp;to&nbsp;perform.&nbsp;The&nbsp;possible&nbsp;actions&nbsp;are&nbsp;described&nbsp;below&nbsp;under<br>
'&lt;B&gt;UNWINDING&nbsp;PHASES&lt;/B&gt;'&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;exceptionClass&lt;/B&gt;:&nbsp;An&nbsp;8-bytes&nbsp;identifier&nbsp;specifying&nbsp;the&nbsp;type&nbsp;of<br>
the&nbsp;thrown&nbsp;exception.&nbsp;By&nbsp;convention,&nbsp;the&nbsp;high&nbsp;4&nbsp;bytes&nbsp;indicate&nbsp;the<br>
vendor&nbsp;(for&nbsp;instance&nbsp;HP\0\0),&nbsp;and&nbsp;the&nbsp;low&nbsp;4&nbsp;bytes&nbsp;indicate&nbsp;the<br>
language&nbsp;(for&nbsp;instance&nbsp;C++\0.)&nbsp;[Note:&nbsp;For&nbsp;C++,&nbsp;it&nbsp;is&nbsp;expected&nbsp;that<br>
agreement&nbsp;will&nbsp;be&nbsp;reached&nbsp;on&nbsp;a&nbsp;common&nbsp;'exceptionObject',&nbsp;but&nbsp;different<br>
vendors&nbsp;may&nbsp;still&nbsp;chose&nbsp;to&nbsp;have&nbsp;different&nbsp;personality&nbsp;routines&nbsp;with<br>
different&nbsp;table&nbsp;formats.]&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;exceptionObject&lt;/B&gt;:&nbsp;The&nbsp;pointer&nbsp;to&nbsp;a&nbsp;memory&nbsp;location&nbsp;recording<br>
the&nbsp;necessary&nbsp;information&nbsp;for&nbsp;processing&nbsp;the&nbsp;exception&nbsp;according&nbsp;to<br>
the&nbsp;semantics&nbsp;of&nbsp;a&nbsp;given&nbsp;language.&nbsp;[Note:&nbsp;For&nbsp;C++,&nbsp;it&nbsp;is&nbsp;assumed&nbsp;that<br>
the&nbsp;format&nbsp;of&nbsp;this&nbsp;exception&nbsp;object&nbsp;can&nbsp;be&nbsp;agreed&nbsp;upon,&nbsp;even&nbsp;if&nbsp;we<br>
disagree&nbsp;on&nbsp;the&nbsp;LSDA&nbsp;and/or&nbsp;landing&nbsp;pad&nbsp;registers&nbsp;or&nbsp;similar<br>
details.]&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;context&lt;/B&gt;:&nbsp;Unwinder&nbsp;state&nbsp;information&nbsp;for&nbsp;use&nbsp;by&nbsp;the<br>
personality&nbsp;routine.&nbsp;This&nbsp;is&nbsp;used&nbsp;by&nbsp;the&nbsp;personality&nbsp;routine&nbsp;in<br>
particular&nbsp;to&nbsp;access&nbsp;the&nbsp;frame's&nbsp;registers.&nbsp;[Note:&nbsp;I&nbsp;don't&nbsp;see&nbsp;how<br>
anything&nbsp;could&nbsp;work&nbsp;without&nbsp;a&nbsp;minimal&nbsp;common&nbsp;unwinder&nbsp;interface&nbsp;-<br>
which&nbsp;is&nbsp;why&nbsp;it&nbsp;has&nbsp;been&nbsp;defined&nbsp;above]&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;return&nbsp;value&lt;/B&gt;:&nbsp;The&nbsp;return&nbsp;value&nbsp;from&nbsp;the&nbsp;personality&nbsp;routine<br>
indicates&nbsp;how&nbsp;further&nbsp;undinwind&nbsp;should&nbsp;happen,&nbsp;as&nbsp;well&nbsp;as&nbsp;possible<br>
error&nbsp;conditions.&nbsp;See&nbsp;&quot;&lt;B&gt;UNWINDING&nbsp;PHASES&lt;/B&gt;&quot;&nbsp;below<br>
for&nbsp;details.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;&lt;FONT&nbsp;SIZE=4&gt;UNWINDING&nbsp;PHASES&lt;/FONT&gt;&lt;/B&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;Unwinding&nbsp;is&nbsp;a&nbsp;2-phases&nbsp;process.&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;PASS&nbsp;1&nbsp;unwinds&nbsp;through&nbsp;the&nbsp;stack,&nbsp;looking&nbsp;for&nbsp;a<br>
&quot;handler&quot;,&nbsp;that&nbsp;is&nbsp;a&nbsp;code&nbsp;that&nbsp;has&nbsp;the&nbsp;potential&nbsp;to&nbsp;stop&nbsp;the<br>
exception&nbsp;propagation.&nbsp;For&nbsp;C++,&nbsp;this&nbsp;would&nbsp;be&nbsp;a&nbsp;'catch'&nbsp;clause.&nbsp;The<br>
first&nbsp;pass&nbsp;can&nbsp;do&nbsp;a&nbsp;&quot;quick&quot;&nbsp;unwind,&nbsp;meaning&nbsp;it&nbsp;does&nbsp;not&nbsp;need<br>
to&nbsp;maintain&nbsp;full&nbsp;registers&nbsp;state.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;PASS&nbsp;2&nbsp;starts&nbsp;once&nbsp;a&nbsp;handler&nbsp;has&nbsp;been&nbsp;found.&nbsp;For&nbsp;each&nbsp;stack&nbsp;frame<br>
that&nbsp;requires&nbsp;some&nbsp;cleanup,&nbsp;it&nbsp;performs&nbsp;that&nbsp;cleanup.&nbsp;For&nbsp;C++,&nbsp;this<br>
would&nbsp;be&nbsp;destructors&nbsp;in&nbsp;addition&nbsp;to&nbsp;catch&nbsp;clauses.&nbsp;If&nbsp;compensation<br>
code&nbsp;for&nbsp;some&nbsp;optimization&nbsp;is&nbsp;required,&nbsp;this&nbsp;is&nbsp;also&nbsp;the&nbsp;pass&nbsp;this<br>
code&nbsp;will&nbsp;be&nbsp;executed.&nbsp;During&nbsp;that&nbsp;pass,&nbsp;the&nbsp;stack&nbsp;is&nbsp;actually<br>
unwound,&nbsp;and&nbsp;full&nbsp;register&nbsp;state&nbsp;is&nbsp;restored&nbsp;prior&nbsp;to&nbsp;executing&nbsp;any<br>
cleanup,&nbsp;compensation&nbsp;or&nbsp;handler&nbsp;code.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;[Note:&nbsp;Cleanup&nbsp;code&nbsp;is&nbsp;code&nbsp;doing&nbsp;some&nbsp;user-defined&nbsp;cleanup&nbsp;such&nbsp;as<br>
destructors.&nbsp;Compensation&nbsp;code&nbsp;is&nbsp;code&nbsp;inserted&nbsp;by&nbsp;the&nbsp;compiler&nbsp;to<br>
compensate&nbsp;for&nbsp;an&nbsp;optimization&nbsp;that&nbsp;moved&nbsp;code&nbsp;past&nbsp;the&nbsp;throwing<br>
call.&nbsp;Handler&nbsp;code&nbsp;is&nbsp;user-defined&nbsp;code&nbsp;that&nbsp;possibly&nbsp;can&nbsp;resume<br>
normal&nbsp;execution]&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;unwinding&nbsp;phase&nbsp;argument&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine&nbsp;is&nbsp;a<br>
bitwise&nbsp;or&nbsp;of&nbsp;the&nbsp;following<br>
constants:&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;&lt;TT&gt;EH_SEARCH_PHASE&lt;/TT&gt;&nbsp;=&nbsp;1:&nbsp;Indicates&nbsp;that&nbsp;the<br>
personality&nbsp;routine&nbsp;should&nbsp;check&nbsp;if&nbsp;the&nbsp;current&nbsp;frame&nbsp;contains&nbsp;a<br>
handler,&nbsp;and&nbsp;if&nbsp;so&nbsp;return&nbsp;&lt;TT&gt;EH_HANDLER_FOUND&lt;/TT&gt;,&nbsp;or&nbsp;otherwise<br>
return&nbsp;&lt;TT&gt;EH_CONTINUE_UNWIND&lt;/TT&gt;.&nbsp;&lt;TT&gt;EH_SEARCH_PHASE&lt;/TT&gt;&nbsp;cannot&nbsp;be<br>
set&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as<br>
&lt;TT&gt;EH_CLEANUP_PHASE&lt;/TT&gt;.&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;&lt;TT&gt;EH_CLEANUP_PHASE&lt;/TT&gt;<br>
=&nbsp;2:&nbsp;Indicates&nbsp;that&nbsp;the&nbsp;personality&nbsp;routine&nbsp;should&nbsp;perform&nbsp;cleanup&nbsp;for<br>
the&nbsp;current&nbsp;frame.&nbsp;The&nbsp;personality&nbsp;routine&nbsp;can&nbsp;perform&nbsp;this&nbsp;cleanup<br>
itself,&nbsp;by&nbsp;calling&nbsp;nested&nbsp;procedures,&nbsp;and&nbsp;return<br>
&lt;TT&gt;EH_CONTINUE_UNWIND&lt;/TT&gt;&nbsp;[&nbsp;Note:&nbsp;This&nbsp;is&nbsp;required&nbsp;to&nbsp;support&nbsp;the<br>
Intel&nbsp;nested&nbsp;procedures&nbsp;model].&nbsp;Alternatively,&nbsp;it&nbsp;can&nbsp;setup&nbsp;the<br>
registers&nbsp;(including&nbsp;the&nbsp;IP)&nbsp;for&nbsp;transferring&nbsp;control&nbsp;to&nbsp;a<br>
&quot;landing&nbsp;pad&quot;,&nbsp;and&nbsp;return&nbsp;&lt;TT&gt;EH_INSTALL_HANDLER&lt;/TT&gt;&nbsp;(See<br>
&quot;&lt;B&gt;TRANSFERRING&nbsp;CONTROL&nbsp;TO&nbsp;A&nbsp;LANDING&nbsp;PAD&lt;/B&gt;&quot;<br>
below).&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;&lt;TT&gt;EH_HANDLER_FRAME&lt;/TT&gt;&nbsp;=&nbsp;4:&nbsp;During&nbsp;pass&nbsp;2,<br>
indicates&nbsp;to&nbsp;the&nbsp;personality&nbsp;routine&nbsp;that&nbsp;the&nbsp;current&nbsp;frame&nbsp;is&nbsp;the&nbsp;one<br>
which&nbsp;was&nbsp;flagged&nbsp;as&nbsp;the&nbsp;handler&nbsp;frame&nbsp;during&nbsp;pass<br>
1.&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;&lt;TT&gt;EH_DELETE_EXCEPTION_OBJECT&lt;/TT&gt;&nbsp;=&nbsp;8:&nbsp;During<br>
pass&nbsp;2,&nbsp;indicates&nbsp;that&nbsp;the&nbsp;runtime&nbsp;that&nbsp;actually&nbsp;caught&nbsp;the&nbsp;exception<br>
does&nbsp;not&nbsp;know&nbsp;how&nbsp;to&nbsp;delete&nbsp;it,&nbsp;and&nbsp;called<br>
&lt;TT&gt;_Unwind_DeleteException&lt;/TT&gt;.&nbsp;'&lt;TT&gt;context&lt;/TT&gt;'&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;in<br>
that&nbsp;case.&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;&lt;TT&gt;EH_FATAL_PASS2_ERROR&lt;/TT&gt;&nbsp;=<br>
16:&nbsp;During&nbsp;pass&nbsp;2,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;unwinding&nbsp;error<br>
occured.&nbsp;In&nbsp;that&nbsp;case,&nbsp;the&nbsp;personality&nbsp;routine&nbsp;should&nbsp;not&nbsp;return.&nbsp;This<br>
is&nbsp;sent&nbsp;to&nbsp;the&nbsp;original&nbsp;personality&nbsp;routine&nbsp;associated&nbsp;to&nbsp;the&nbsp;initial<br>
exception&nbsp;object.&nbsp;[Note:&nbsp;This&nbsp;is&nbsp;required&nbsp;if&nbsp;we&nbsp;want&nbsp;to&nbsp;ensure&nbsp;that<br>
&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;never&nbsp;returns,&nbsp;and&nbsp;if&nbsp;we&nbsp;also&nbsp;want&nbsp;to&nbsp;be&nbsp;able<br>
to&nbsp;call&nbsp;&lt;TT&gt;terminate()&nbsp;&lt;/TT&gt;in&nbsp;the&nbsp;case&nbsp;a&nbsp;stack&nbsp;inconsistency&nbsp;is<br>
found&nbsp;during&nbsp;pass&nbsp;2.&nbsp;An&nbsp;error&nbsp;detected&nbsp;during&nbsp;pass&nbsp;1&nbsp;is&nbsp;reported&nbsp;by<br>
returning&nbsp;from&nbsp;&lt;TT&gt;_Unwind_RaiseException&lt;/TT&gt;.]&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;TT&gt;EH_FORCE_UNWIND&lt;/TT&gt;&nbsp;=&nbsp;32:&nbsp;During&nbsp;pass&nbsp;2,&nbsp;indicates&nbsp;that<br>
no&nbsp;language&nbsp;is&nbsp;allowed&nbsp;to&nbsp;&quot;catch&quot;&nbsp;the&nbsp;exception.&nbsp;This&nbsp;flag<br>
is&nbsp;set&nbsp;while&nbsp;unwinding&nbsp;the&nbsp;stack&nbsp;for&nbsp;longjmp&nbsp;or&nbsp;during&nbsp;thread<br>
cancellation.&nbsp;User-defined&nbsp;code&nbsp;in&nbsp;a&nbsp;catch&nbsp;clause&nbsp;may&nbsp;still&nbsp;be<br>
executed,&nbsp;but&nbsp;the&nbsp;catch&nbsp;clause&nbsp;has&nbsp;to&nbsp;resume&nbsp;unwinding&nbsp;at&nbsp;its<br>
end.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=4&gt;&lt;B&gt;TRANSFERRING&nbsp;CONTROL&nbsp;TO&nbsp;A&nbsp;LANDING<br>
PAD:&lt;/B&gt;&lt;/FONT&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;In&nbsp;the&nbsp;case&nbsp;the&nbsp;personality&nbsp;routine&nbsp;wants&nbsp;to&nbsp;transfer&nbsp;control&nbsp;to&nbsp;a<br>
landing&nbsp;pad,&nbsp;it&nbsp;setups&nbsp;registers&nbsp;(including&nbsp;IP)&nbsp;to&nbsp;suitable&nbsp;values&nbsp;for<br>
entering&nbsp;the&nbsp;landing&nbsp;pad.&nbsp;Prior&nbsp;to&nbsp;executing&nbsp;code&nbsp;in&nbsp;the&nbsp;landing&nbsp;pad,<br>
registers&nbsp;not&nbsp;altered&nbsp;by&nbsp;the&nbsp;personality&nbsp;routine&nbsp;will&nbsp;be&nbsp;restored&nbsp;to<br>
the&nbsp;exact&nbsp;state&nbsp;they&nbsp;were&nbsp;in&nbsp;that&nbsp;frame&nbsp;before&nbsp;the&nbsp;call&nbsp;that&nbsp;threw&nbsp;the<br>
exception.&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;landing&nbsp;pad&nbsp;can&nbsp;either&nbsp;resume&nbsp;execution&nbsp;to&nbsp;normal&nbsp;(as,&nbsp;for<br>
instance,&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;C++&nbsp;&lt;TT&gt;catch&lt;/TT&gt;),&nbsp;or&nbsp;resume&nbsp;unwinding&nbsp;by<br>
calling&nbsp;the&nbsp;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;function&nbsp;and&nbsp;passing&nbsp;it&nbsp;the<br>
'&lt;TT&gt;exceptionObject&lt;/TT&gt;'&nbsp;argument&nbsp;received&nbsp;by&nbsp;the&nbsp;personality<br>
routine.&nbsp;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;will&nbsp;never&nbsp;return.&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;should&nbsp;be&nbsp;called&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the<br>
personality&nbsp;routine&nbsp;did&nbsp;not&nbsp;return&nbsp;&lt;TT&gt;EH_HANDLER_FOUND&lt;/TT&gt;&nbsp;during<br>
phase&nbsp;1.&nbsp;In&nbsp;other&nbsp;words,&nbsp;the&nbsp;unwinder&nbsp;can&nbsp;allocate&nbsp;some&nbsp;resources&nbsp;(for<br>
instance&nbsp;memory)&nbsp;and&nbsp;keep&nbsp;track&nbsp;of&nbsp;them&nbsp;in&nbsp;the&nbsp;exception&nbsp;object<br>
reserved&nbsp;words.&nbsp;It&nbsp;should&nbsp;then&nbsp;free&nbsp;these&nbsp;resources&nbsp;before<br>
transferring&nbsp;control&nbsp;to&nbsp;the&nbsp;last&nbsp;(handler)&nbsp;landing&nbsp;pad.&nbsp;It&nbsp;does&nbsp;not<br>
need&nbsp;to&nbsp;free&nbsp;the&nbsp;resources&nbsp;before&nbsp;entering&nbsp;non-handler&nbsp;landing-pads,<br>
since&nbsp;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;&nbsp;will&nbsp;ultimately&nbsp;be&nbsp;called.&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;landing&nbsp;pad&nbsp;will&nbsp;receive&nbsp;various&nbsp;arguments&nbsp;from&nbsp;the&nbsp;runtime,<br>
typically&nbsp;passed&nbsp;in&nbsp;registers&nbsp;set&nbsp;using&nbsp;&lt;TT&gt;_Unwind_setGR&lt;/TT&gt;&nbsp;by&nbsp;the<br>
personality&nbsp;routine.&nbsp;For&nbsp;a&nbsp;landing&nbsp;pad&nbsp;that&nbsp;can&nbsp;lead&nbsp;to<br>
&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;,&nbsp;one&nbsp;argument&nbsp;must&nbsp;be&nbsp;the<br>
&lt;TT&gt;exceptionObject&lt;/TT&gt;&nbsp;pointer,&nbsp;which&nbsp;must&nbsp;be&nbsp;preserved&nbsp;to&nbsp;be&nbsp;passed<br>
to&nbsp;&lt;TT&gt;_Unwind_Resume&lt;/TT&gt;.&nbsp;[Note:&nbsp;Thanks&nbsp;to&nbsp;the&nbsp;4&nbsp;reserved&nbsp;words&nbsp;in<br>
the&nbsp;exception&nbsp;object,&nbsp;2&nbsp;landing-pad&nbsp;arguments&nbsp;have&nbsp;been&nbsp;eliminated.]<br>
The&nbsp;landing&nbsp;pad&nbsp;may&nbsp;receive&nbsp;other&nbsp;arguments,&nbsp;for&nbsp;instance&nbsp;a&nbsp;'switch<br>
value'&nbsp;indicating&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;exception&nbsp;being&nbsp;caught.&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;&lt;FONT&nbsp;SIZE=4&gt;RULES&nbsp;FOR&nbsp;CORRECT&nbsp;INTER-LANGUAGE<br>
OPERATION:&lt;/FONT&gt;&lt;/B&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;following&nbsp;rules&nbsp;must&nbsp;be&nbsp;observed&nbsp;for&nbsp;correct&nbsp;operation&nbsp;between<br>
languages&nbsp;and/or&nbsp;runtimes&nbsp;from&nbsp;different&nbsp;vendors:&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;An&nbsp;exception&nbsp;which&nbsp;has&nbsp;an&nbsp;unknown&nbsp;class&nbsp;must&nbsp;not&nbsp;be&nbsp;altered&nbsp;by&nbsp;the<br>
personality&nbsp;routine.&nbsp;The&nbsp;semantics&nbsp;of&nbsp;foreign&nbsp;exception&nbsp;processing<br>
depend&nbsp;on&nbsp;the&nbsp;language&nbsp;of&nbsp;the&nbsp;stack&nbsp;frame&nbsp;being&nbsp;unwound.&nbsp;This&nbsp;covers<br>
in&nbsp;particular&nbsp;how&nbsp;exceptions&nbsp;from&nbsp;a&nbsp;foreign&nbsp;language&nbsp;are&nbsp;mapped&nbsp;to&nbsp;the<br>
native&nbsp;language&nbsp;in&nbsp;that&nbsp;frame.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;If&nbsp;a&nbsp;runtime&nbsp;resumes&nbsp;normal&nbsp;execution,&nbsp;and&nbsp;the&nbsp;caught&nbsp;exception&nbsp;was<br>
created&nbsp;by&nbsp;another&nbsp;runtime,&nbsp;it&nbsp;should&nbsp;call<br>
&lt;TT&gt;_Unwind_DeleteException&lt;/TT&gt;.&nbsp;This&nbsp;is&nbsp;true&nbsp;even&nbsp;if&nbsp;it&nbsp;understands&nbsp;the<br>
exception&nbsp;object&nbsp;format&nbsp;(such&nbsp;as&nbsp;would&nbsp;be&nbsp;the&nbsp;case&nbsp;between&nbsp;different<br>
C++&nbsp;runtimes).&nbsp;[Note:&nbsp;This&nbsp;is&nbsp;because&nbsp;the&nbsp;other&nbsp;runtime&nbsp;might<br>
have&nbsp;to&nbsp;update&nbsp;some&nbsp;global&nbsp;variables&nbsp;that&nbsp;point&nbsp;to&nbsp;the&nbsp;exception&nbsp;being<br>
deleted.]&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;A&nbsp;runtime&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;catch&nbsp;an&nbsp;exception&nbsp;if&nbsp;the<br>
EH_FORCE_UNWIND&nbsp;flag&nbsp;was&nbsp;passed&nbsp;to&nbsp;the&nbsp;personality<br>
routine.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;&lt;B&gt;&lt;FONT&nbsp;SIZE=4&gt;CATCHING&nbsp;FOREIGN&nbsp;EXCEPTIONS&nbsp;IN&nbsp;C++&lt;/FONT&gt;&lt;/B&gt;&lt;/P&gt;<br>
<br>
&lt;P&gt;Foreign&nbsp;exception&nbsp;can&nbsp;be&nbsp;caught&nbsp;in&nbsp;a&nbsp;&lt;TT&gt;catch(...)&lt;/TT&gt;.&nbsp;They&nbsp;can<br>
also&nbsp;be&nbsp;caught&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;of&nbsp;a&nbsp;&lt;TT&gt;__foreign_exception&lt;/TT&gt;<br>
class,&nbsp;defined&nbsp;in&nbsp;&lt;TT&gt;&lt;exception&gt;&lt;/TT&gt;.&nbsp;[Note:&nbsp;The<br>
&lt;TT&gt;__foreign_exception&lt;/TT&gt;&nbsp;may&nbsp;have&nbsp;subclasses,&nbsp;such&nbsp;as<br>
&lt;TT&gt;__java_exception&lt;/TT&gt;&nbsp;and&nbsp;&lt;TT&gt;__ada_exception&lt;/TT&gt;,&nbsp;if&nbsp;the&nbsp;runtime<br>
is&nbsp;capable&nbsp;of&nbsp;identifying&nbsp;some&nbsp;of&nbsp;the&nbsp;foreign&nbsp;languages.]&lt;/P&gt;<br>
<br>
&lt;P&gt;The&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;in&nbsp;the&nbsp;following&nbsp;cases:&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;A&nbsp;&lt;TT&gt;__foreign_exception&lt;/TT&gt;&nbsp;catch&nbsp;argument&nbsp;is&nbsp;accessed&nbsp;in&nbsp;any<br>
way&nbsp;(including&nbsp;taking&nbsp;its&nbsp;address).&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;A&nbsp;&lt;TT&gt;__foreign_exception&lt;/TT&gt;&nbsp;is&nbsp;active&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as<br>
another&nbsp;exception&nbsp;(either&nbsp;there&nbsp;is&nbsp;a&nbsp;nested&nbsp;exception&nbsp;while&nbsp;catching<br>
the&nbsp;foreign&nbsp;exception,&nbsp;or&nbsp;the&nbsp;foreign&nbsp;exception&nbsp;was&nbsp;itself<br>
nested)&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&lt;TT&gt;uncaught_exception()&lt;/TT&gt;,&nbsp;&lt;TT&gt;set_terminate()&lt;/TT&gt;,<br>
&lt;TT&gt;set_unexpected()&lt;/TT&gt;,&nbsp;&lt;TT&gt;terminate()&lt;/TT&gt;&nbsp;or<br>
&lt;TT&gt;unexpected()&lt;/TT&gt;&nbsp;is&nbsp;called&nbsp;at&nbsp;a&nbsp;time&nbsp;a&nbsp;foreign&nbsp;exception&nbsp;exists<br>
(for&nbsp;instance,&nbsp;calling&nbsp;&lt;TT&gt;set_terminate&lt;/TT&gt;()&nbsp;during&nbsp;unwinding&nbsp;of&nbsp;a<br>
foreign&nbsp;exception)&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;[Note:&nbsp;All&nbsp;these&nbsp;cases&nbsp;might&nbsp;involve&nbsp;accessing&nbsp;the&nbsp;C++&nbsp;specific<br>
content&nbsp;of&nbsp;the&nbsp;thrown&nbsp;exception,&nbsp;for&nbsp;instance&nbsp;to&nbsp;chain&nbsp;active<br>
exceptions]&lt;/P&gt;<br>
<br>
&lt;P&gt;Otherwise,&nbsp;a&nbsp;catch&nbsp;block&nbsp;catching&nbsp;a&nbsp;foreign&nbsp;exception&nbsp;is<br>
allowed:&lt;/P&gt;&lt;UL&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;To&nbsp;resume&nbsp;normal&nbsp;execution,&nbsp;thereby&nbsp;stopping&nbsp;propagation&nbsp;of&nbsp;the<br>
foreign&nbsp;exception&nbsp;and&nbsp;deleting&nbsp;it,&lt;/P&gt;&lt;/LI&gt;&lt;LI&gt;<br>
<br>
&lt;P&gt;&nbsp;Or&nbsp;to&nbsp;rethrow&nbsp;the&nbsp;foreign&nbsp;exception.&nbsp;In&nbsp;that&nbsp;case,&nbsp;the&nbsp;original<br>
exception&nbsp;object&nbsp;should&nbsp;have&nbsp;been&nbsp;unaltered&nbsp;in&nbsp;any&nbsp;way&nbsp;by&nbsp;the<br>
C++&nbsp;runtime.&lt;/P&gt;&lt;/LI&gt;&lt;/UL&gt;<br>
<br>
&lt;P&gt;A&nbsp;catch-all&nbsp;block&nbsp;may&nbsp;be&nbsp;executed&nbsp;during&nbsp;forced&nbsp;unwinding.&nbsp;For<br>
instance,&nbsp;a&nbsp;longjmp&nbsp;may&nbsp;execute&nbsp;code&nbsp;in&nbsp;a&nbsp;catch(...)&nbsp;during&nbsp;stack<br>
unwinding.&nbsp;However,&nbsp;if&nbsp;this&nbsp;happens,&nbsp;unwinding&nbsp;will&nbsp;proceed&nbsp;at&nbsp;the&nbsp;end<br>
of&nbsp;the&nbsp;catch-all&nbsp;block,&nbsp;whether&nbsp;or&nbsp;not&nbsp;there&nbsp;is&nbsp;an&nbsp;explicit<br>
rethrow.&lt;/P&gt;Setting&nbsp;the&nbsp;low&nbsp;4&nbsp;bytes&nbsp;of&nbsp;exception&nbsp;class&nbsp;to&nbsp;C++\0&nbsp;is<br>
reserved&nbsp;for&nbsp;use&nbsp;by&nbsp;C++&nbsp;runtimes&nbsp;compatible&nbsp;with&nbsp;the&nbsp;common<br>
C++&nbsp;ABI.&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
