<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style&gt;On&nbsp;Thu,&nbsp;Jan&nbsp;17,&nbsp;2013&nbsp;at&nbsp;2:35&nbsp;PM,&nbsp;Michael&nbsp;Wong&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:michaelw@ca.ibm.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michaelw@ca.ibm.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;<br>
&lt;p&gt;&lt;tt&gt;&lt;font&gt;Lawrence&nbsp;Crowl&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:crowl@googlers.com&quot;&nbsp;target=&quot;_blank&quot;&gt;crowl@googlers.com&lt;/a&gt;&gt;&nbsp;wrote&nbsp;on&nbsp;01/17/2013&nbsp;04:50:52&nbsp;PM:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;From:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Lawrence&nbsp;Crowl&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:crowl@googlers.com&quot;&nbsp;target=&quot;_blank&quot;&gt;crowl@googlers.com&lt;/a&gt;&gt;&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;To:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Michael&nbsp;Wong/Toronto/IBM@IBMCA&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Cc:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:cxx-abi-dev@codesourcery.com&quot;&nbsp;target=&quot;_blank&quot;&gt;cxx-abi-dev@codesourcery.com&lt;/a&gt;&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Date:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;01/17/2013&nbsp;04:50&nbsp;PM&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Subject:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Re:&nbsp;[cxx-abi-dev]&nbsp;lambda&nbsp;ABI&nbsp;inline&nbsp;function&nbsp;ODR&nbsp;compatibility&nbsp;issue&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&lt;/font&gt;&lt;/tt&gt;&lt;/p&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;tt&gt;&lt;font&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;1/16/13,&nbsp;Michael&nbsp;Wong&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:michaelw@ca.ibm.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michaelw@ca.ibm.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Does&nbsp;the&nbsp;C++&nbsp;Standard&nbsp;committee&nbsp;intend&nbsp;for&nbsp;the&nbsp;ODR&nbsp;to&nbsp;imply&nbsp;that&nbsp;lambdas&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;need&nbsp;to&nbsp;have&nbsp;an&nbsp;ABI&nbsp;specified&nbsp;layout&nbsp;in&nbsp;order&nbsp;to&nbsp;deal&nbsp;with&nbsp;inline&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;functions.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;&lt;/font&gt;&lt;/tt&gt;&lt;/div&gt;&lt;tt&gt;&lt;font&gt;<br>
&gt;&nbsp;I&nbsp;believe&nbsp;that&nbsp;we&nbsp;thought&nbsp;it&nbsp;was&nbsp;not&nbsp;an&nbsp;issue.&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Consider&nbsp;the&nbsp;following&nbsp;with&nbsp;one&nbsp;object&nbsp;compiled&nbsp;with&nbsp;-DMAIN&nbsp;and&nbsp;another&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;without:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;-&nbsp;in&nbsp;one&nbsp;case&nbsp;the&nbsp;layout&nbsp;needs&nbsp;to&nbsp;be&nbsp;compatible&nbsp;between&nbsp;different&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;implementations&nbsp;since&nbsp;the&nbsp;static&nbsp;local&nbsp;is&nbsp;shared&nbsp;between&nbsp;translation&nbsp;units&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;/data/a.o:&nbsp;In&nbsp;function&nbsp;`main&#39;:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;a.cpp:(.text+0x18):&nbsp;undefined&nbsp;reference&nbsp;to&nbsp;`bar()&#39;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;collect2:&nbsp;error:&nbsp;ld&nbsp;returned&nbsp;1&nbsp;exit&nbsp;status&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;-&nbsp;in&nbsp;the&nbsp;other&nbsp;case,&nbsp;the&nbsp;layout&nbsp;needs&nbsp;to&nbsp;be&nbsp;compatible&nbsp;between&nbsp;different&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;implementations&nbsp;in&nbsp;order&nbsp;to&nbsp;satisfy&nbsp;the&nbsp;ODR&nbsp;requirement&nbsp;that&nbsp;the&nbsp;program&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;behave&nbsp;as&nbsp;if&nbsp;there&nbsp;was&nbsp;only&nbsp;one&nbsp;definition&nbsp;of&nbsp;the&nbsp;inline&nbsp;function&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;extern&nbsp;&quot;C&quot;&nbsp;int&nbsp;printf(const&nbsp;char&nbsp;*,&nbsp;...);&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;extern&nbsp;long&nbsp;gz;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;inline&nbsp;void&nbsp;foo()&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; long&nbsp;x&nbsp;=&nbsp;0,&nbsp;q&nbsp;=&nbsp;0,&nbsp;&amp;z&nbsp;=&nbsp;gz;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; static&nbsp;auto&nbsp;f&nbsp;=&nbsp;[=,&nbsp;&amp;z]()&nbsp;mutable&nbsp;{&nbsp;q&nbsp;+=&nbsp;++x;&nbsp;gz&nbsp;=&nbsp;q&nbsp;+&nbsp;x;&nbsp;};&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; long&nbsp;a,&nbsp;b;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; auto&nbsp;ff&nbsp;=&nbsp;[=]{&nbsp;sizeof(a&nbsp;/*not&nbsp;an&nbsp;odr-use*/),&nbsp;printf(&quot;%u\n&quot;,&nbsp;&amp;b&nbsp;&lt;&nbsp;&amp;a);&nbsp;};&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; f();&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; ff();&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;}&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;void&nbsp;bar();&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;#if&nbsp;!&nbsp;MAIN&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;void&nbsp;bar()&nbsp;{&nbsp;foo();&nbsp;}&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;#else&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;long&nbsp;gz;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;int&nbsp;main()&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; foo();&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; bar();&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; foo();&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp; &nbsp; return&nbsp;gz;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;}&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;#endif&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&gt;&nbsp;And&nbsp;this&nbsp;code&nbsp;demonstrates&nbsp;that&nbsp;it&nbsp;is&nbsp;an&nbsp;issue.&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;Agreed.&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Do&nbsp;you&nbsp;have&nbsp;a&nbsp;proposal?&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;Probably&nbsp;2&nbsp;thoughts:&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;1.&nbsp;Make&nbsp;a&nbsp;static&nbsp;in&nbsp;an&nbsp;inline&nbsp;a&nbsp;violation&nbsp;of&nbsp;the&nbsp;ODR&nbsp;rule&nbsp;in&nbsp;the&nbsp;C++&nbsp;Std&nbsp;(add&nbsp;in&nbsp;suitable&nbsp;wording&nbsp;covering&nbsp;all&nbsp;uses&nbsp;with&nbsp;external&nbsp;linkage)or&nbsp;&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;2.&nbsp;create&nbsp;an&nbsp;ABI&nbsp;binding&nbsp;in&nbsp;the&nbsp;C++&nbsp;ABI&nbsp;such&nbsp;that&nbsp;all&nbsp;vendors&nbsp;follow&nbsp;the&nbsp;same&nbsp;behavior&nbsp;in&nbsp;this&nbsp;case&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;I&nbsp;think&nbsp;I&nbsp;am&nbsp;OK&nbsp;with&nbsp;either&nbsp;solution.&lt;/font&gt;&lt;/tt&gt;&lt;br&gt;<br>
&lt;tt&gt;&lt;font&gt;There&nbsp;may&nbsp;be&nbsp;other&nbsp;solutions&nbsp;I&nbsp;have&nbsp;not&nbsp;entertained&nbsp;yet&nbsp;...&lt;/font&gt;&lt;/tt&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;For&nbsp;option&nbsp;1,&nbsp;we&nbsp;would&nbsp;only&nbsp;need&nbsp;to&nbsp;disallow&nbsp;static&nbsp;local&nbsp;variables&nbsp;from&nbsp;having&nbsp;types&nbsp;involving&nbsp;local&nbsp;lambdas&nbsp;with&nbsp;captures,&nbsp;right?&nbsp;All&nbsp;the&nbsp;other&nbsp;problems&nbsp;I&nbsp;can&nbsp;think&nbsp;of&nbsp;would&nbsp;be&nbsp;handled&nbsp;by&nbsp;putting&nbsp;the&nbsp;lambda&#39;s&nbsp;symbols&nbsp;in&nbsp;a&nbsp;COMDAT&nbsp;with&nbsp;the&nbsp;containing&nbsp;function.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;tt&gt;&lt;font&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;I&nbsp;apologize&nbsp;if&nbsp;this&nbsp;issue&nbsp;has&nbsp;been&nbsp;dealt&nbsp;with.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Regards,&nbsp;Michael&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;OpenMP&nbsp;CEO:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://openmp.org/wp/about-openmp/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://openmp.org/wp/about-openmp/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;My&nbsp;Blogs:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://ibm.co/pCvPHR&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ibm.co/pCvPHR&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;C++11&nbsp;status:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://tinyurl.com/43y8xgf&quot;&nbsp;target=&quot;_blank&quot;&gt;http://tinyurl.com/43y8xgf&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Boost&nbsp;test&nbsp;results&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.ibm.com/support/docview.wss?&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.ibm.com/support/docview.wss?&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;rs=2239&amp;context=SSJT9L&amp;uid=swg27006911&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;C/C++&nbsp;Compilers&nbsp;Support/Feature&nbsp;Request&nbsp;Page&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.ibm.com/software/awdtools/ccompilers/support/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.ibm.com/software/awdtools/ccompilers/support/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.ibm.com/support/docview.wss?uid=swg27005811&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.ibm.com/support/docview.wss?uid=swg27005811&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;STM:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://sites.google.com/site/tmforcplusplus/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://sites.google.com/site/tmforcplusplus/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Director&nbsp;&amp;&nbsp;Vice&nbsp;President&nbsp;ISOCPP.org&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Canada&nbsp;and&nbsp;IBM&nbsp;C++Standard&nbsp;HoD&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Chair&nbsp;of&nbsp;WG21&nbsp;SG5&nbsp;Transactional&nbsp;Memory&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;XL&nbsp;C++&nbsp;Compiler&nbsp;kernel&nbsp;Development&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;IBM&nbsp;Canada&nbsp;Ltd.,&nbsp;C2/KD2/8200/MKM&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;8200&nbsp;Warden&nbsp;Avenue&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Markham,&nbsp;Ontario&nbsp; L6G&nbsp;1C7&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;W:&lt;a&nbsp;href=&quot;tel:905-413-3283&quot;&nbsp;value=&quot;+19054133283&quot;&nbsp;target=&quot;_blank&quot;&gt;905-413-3283&lt;/a&gt;&nbsp;F:&lt;a&nbsp;href=&quot;tel:905-413-4839&quot;&nbsp;value=&quot;+19054134839&quot;&nbsp;target=&quot;_blank&quot;&gt;905-413-4839&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&gt;&nbsp;--&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Lawrence&nbsp;Crowl&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/tt&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
cxx-abi-dev&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:cxx-abi-dev@codesourcery.com&quot;&gt;cxx-abi-dev@codesourcery.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
