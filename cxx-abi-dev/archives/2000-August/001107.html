<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Automatic locking for C++ local static initialization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Automatic%20locking%20for%20C%2B%2B%20local%20static%20initialization&In-Reply-To=%3C200008022338.QAA08514%40baalbek.engr.sgi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001105.html">
   <LINK REL="Next"  HREF="001108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Automatic locking for C++ local static initialization</H1>
    <B>Jim Dehnert</B> 
    <A HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Automatic%20locking%20for%20C%2B%2B%20local%20static%20initialization&In-Reply-To=%3C200008022338.QAA08514%40baalbek.engr.sgi.com%3E"
       TITLE="Automatic locking for C++ local static initialization">dehnert at baalbek.engr.sgi.com
       </A><BR>
    <I>Wed Aug  2 23:38:40 UTC 2000</I>
    <P><UL>
        <LI>Previous message: <A HREF="001105.html">Automatic locking for C++ local static initialization
</A></li>
        <LI>Next message: <A HREF="001108.html">Automatic locking for C++ local static initialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1107">[ date ]</a>
              <a href="thread.html#1107">[ thread ]</a>
              <a href="subject.html#1107">[ subject ]</a>
              <a href="author.html#1107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> From: Christophe de Dinechin &lt;<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">ddd at cup.hp.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> The C++ Standard says so: you are not allowed to enter the same constructor
</I>&gt;<i> twice. To me, this is one of the rare statements in the Standard that has an
</I>&gt;<i> impact on a threading implementation.
</I>
Without taking a position on the overall question, I think it's
important to comment on this statement.  The Standard does not
contemplate threading, period.  Some threading issues might be impacted
by &quot;reasonable&quot; extensions of what is stated, such as the one you cite,
but that was not the intent of the Standard, and should not be
interpreted that way.  The Standard describes a sequential language.
If it were extended to explicitly encompass threading, many issues
would need to be dealt with, and in that context, many of them might
not come out as pure &quot;extensions&quot; of the current language.  I think,
for instance, that an equally reasonable extension to this case would
be simply to forbid (make undefined) multiple threads from entering a
scope with local statics needing construction at the same time.

This is similar to the issues involved in global object destruction
when a DSO is unloaded early.  The Standard, which doesn't contemplate
DSOs, specifies a destructor order that isn't practical if the DSO goes
away early.  So we do something &quot;reasonable,&quot; albeit contrary to the
Standard.

The threading issues are the same.  We don't have guidance from the
Standard -- while we should certainly consider its principles as
guidance, we shouldn't consider its rules as determining choices in
areas to which they weren't intended to apply.

Jim

-	    Jim Dehnert		<A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">dehnert at sgi.com</A>
				(650)933-4272


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001105.html">Automatic locking for C++ local static initialization
</A></li>
	<LI>Next message: <A HREF="001108.html">Automatic locking for C++ local static initialization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1107">[ date ]</a>
              <a href="thread.html#1107">[ thread ]</a>
              <a href="subject.html#1107">[ subject ]</a>
              <a href="author.html#1107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">More information about the cxx-abi-dev
mailing list</a><br>
</body></html>
