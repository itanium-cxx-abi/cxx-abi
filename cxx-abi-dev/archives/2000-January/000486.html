<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Vcall/vbase offset clarification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Vcall/vbase%20offset%20clarification&In-Reply-To=%3C20000125103813V.mitchell%40codesourcery.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000485.html">
   <LINK REL="Next"  HREF="000487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Vcall/vbase offset clarification</H1>
    <B>Mark Mitchell</B> 
    <A HREF="mailto:cxx-abi-dev%40codesourcery.com?Subject=Re%3A%20Vcall/vbase%20offset%20clarification&In-Reply-To=%3C20000125103813V.mitchell%40codesourcery.com%3E"
       TITLE="Vcall/vbase offset clarification">mark at codesourcery.com
       </A><BR>
    <I>Tue Jan 25 18:38:13 UTC 2000</I>
    <P><UL>
        <LI>Previous message: <A HREF="000485.html">array new-expressions: proposal
</A></li>
        <LI>Next message: <A HREF="000487.html">Memories...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#486">[ date ]</a>
              <a href="thread.html#486">[ thread ]</a>
              <a href="subject.html#486">[ subject ]</a>
              <a href="author.html#486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
It is unclear from the draft what sign these offsets should have.  (In
other words, to compute the address of the vbase, do we add the vbase
offset, or subtract it?  To compute the adjusted `this' pointer do we
add the offset, or subtract it?)

I expect the intention was to make these additive, but we should add
some explicit language.  How about:

  The vbase offset is the value that must be added to the address of
  the derived class in order to obtain the address of the virtual 
  base.

  The vcall offset is the value that must be added to the `this' 
  pointer in the most-derived class in order to obtain the correct
  `this' pointer for the function called.

Also, it is probably worth noting in the Category 3/Category 4 section
on class layout that the algorithm for calculating what vbase offsets
you need is actually uniform.  The complication in Category 4 about
whether an indirect virtual base is inherited directly via a
non-virtual base cannot arise in Category 3 -- but it is correct to
simply code the Category 4 algorithm and apply it everywhere.  

In other words, the Category 3 algorithm is merely an optimization
over the Category 4 algorithm; the results obtained either way will be
identical.

At least I think so. :-)

--
Mark Mitchell                   <A HREF="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">mark at codesourcery.com</A>
CodeSourcery, LLC               <A HREF="http://www.codesourcery.com">http://www.codesourcery.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000485.html">array new-expressions: proposal
</A></li>
	<LI>Next message: <A HREF="000487.html">Memories...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#486">[ date ]</a>
              <a href="thread.html#486">[ thread ]</a>
              <a href="subject.html#486">[ subject ]</a>
              <a href="author.html#486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://sourcerytools.com/cgi-bin/mailman/listinfo/cxx-abi-dev">More information about the cxx-abi-dev
mailing list</a><br>
</body></html>
